!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).diffusion=e()}}((function(){var e,t=function(e){var t;return function(r){return t||e(t={exports:{},parent:r},t.exports),t.exports}},r=t((function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n({});!function(e){e[e.NONE=0]="NONE",e[e.JSON=1]="JSON"}(t.SchemaType||(t.SchemaType={})),function(e){e[e.GREEN=0]="GREEN",e[e.AMBER=1]="AMBER",e[e.RED=2]="RED"}(t.StatusLevel||(t.StatusLevel={}));var o=function(){function e(e){this.internal=e,this.clientRequestsService=e.getServiceLocator().obtain(r.GATEWAY_CLIENT_REQUEST),this.getClientsService=e.getServiceLocator().obtain(r.GET_GATEWAY_CLIENTS),this.registerClientService=e.getServiceLocator().obtain(r.REGISTER_GATEWAY_CLIENT),this.removeClientService=e.getServiceLocator().obtain(r.REMOVE_GATEWAY_CLIENT)}return e.prototype.checkSessionId=function(e){if(e instanceof zf.SessionId)return e;if("string"==typeof e)return zf.SessionId.fromString(e);if(null===e)throw Error("Session ID must be a string or SessionId, but was null");throw Error("Session ID must be a string or SessionId, but had type: "+typeof e)},e.prototype.checkClientKey=function(e){if(null==e||"object"!=typeof e)throw Error("clientKey must be a non-null object");if(null===e.type||void 0===e.type)throw Error("clientKey type must not be null or undefined");if(null===e.id||void 0===e.id)throw Error("clientKey id must not be null or undefined");return e},e.prototype.getConfiguration=function(e){var t=this,r=this.checkSessionId(e);return new Promise((function(e,n){t.internal.checkConnected(n)&&t.clientRequestsService.send(new nS.GatewayClientGetConfigurationRequest(r),(function(t,r){t?n(t):e(r)}))}))},e.prototype.getStatus=function(e){var t=this,r=this.checkSessionId(e);return new Promise((function(e,n){t.internal.checkConnected(n)&&t.clientRequestsService.send(new sS.GatewayClientGetStatusRequest(r),(function(t,r){t?n(t):e(r)}))}))},e.prototype.getClients=function(){var e=this;return new Promise((function(t,r){e.internal.checkConnected(r)&&e.getClientsService.send(null,(function(e,n){e?r(e):t(n)}))}))},e.prototype.registerClient=function(e){var t=this,r=this.checkClientKey(e);return new Promise((function(e,n){t.internal.checkConnected(n)&&t.registerClientService.send(r,(function(t){t?n(t):e()}))}))},e.prototype.removeClient=function(e){var t=this,r=this.checkClientKey(e);return new Promise((function(e,n){t.internal.checkConnected(n)&&t.removeClientService.send(r,(function(t){t?n(t):e()}))}))},e}();t.GatewayControlImpl=o})),n=t((function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o({});t.GATEWAY_CLIENT_REQUEST={id:170,request:yS.GatewayClientRequestSerialiser,response:r.GatewayResponseSerialiser},t.REGISTER_GATEWAY_CLIENT={id:173,request:cS.GatewayClientKeySerialiser,response:od.NullSerialiser},t.REMOVE_GATEWAY_CLIENT={id:174,request:cS.GatewayClientKeySerialiser,response:od.NullSerialiser},t.GET_GATEWAY_CLIENTS={id:175,request:od.NullSerialiser,response:fS.GatewayClientListSerialiser}})),o=t((function(e,t){"use strict";var n,o=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var s=r({}),a=i({}),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.read=function(e){var t=tf.read(e,rS.GatewayRequestType);switch(t){case rS.GatewayRequestType.GET_CONFIGURATION:return new ES.GetConfigurationResponse(tf.read(e,s.SchemaType),ba.readString(e),ba.readString(e));case rS.GatewayRequestType.GET_STATUS:return new wS.GetStatusResponse(ba.readCollection(e,a.StatusItemSerialiser.read));default:throw Error("Unknown gateway response type: "+t)}},t}(Pa.AbstractSerialiser);t.GatewayResponseSerialiser=new u})),i=t((function(e,t){"use strict";var n,o=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var i=r({}),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.read=function(e){return{level:tf.read(e,i.StatusLevel),timestamp:ba.readInt64(e),title:ba.readString(e),description:ba.readString(e)}},t}(Pa.AbstractSerialiser);t.StatusItemSerialiser=new s})),s=t((function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=require("zlib");t.decompressSync=function(e){return r.inflateSync(e)}})),a=t((function(e,t){(function(e){"use strict";var r="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=e,t.INSPECT_MAX_BYTES=50;function n(t){if(t>2147483647)throw new RangeError('The value "'+t+'" is invalid for option "size"');var r=new Uint8Array(t);return Object.setPrototypeOf(r,e.prototype),r}function e(e,t,r){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return s(e)}return o(e,t,r)}function o(t,r,o){if("string"==typeof t)return function(t,r){"string"==typeof r&&""!==r||(r="utf8");if(!e.isEncoding(r))throw new TypeError("Unknown encoding: "+r);var o=0|p(t,r),i=n(o),s=i.write(t,r);s!==o&&(i=i.slice(0,s));return i}(t,r);if(ArrayBuffer.isView(t))return a(t);if(null==t)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t);if(x(t,ArrayBuffer)||t&&x(t.buffer,ArrayBuffer))return u(t,r,o);if("undefined"!=typeof SharedArrayBuffer&&(x(t,SharedArrayBuffer)||t&&x(t.buffer,SharedArrayBuffer)))return u(t,r,o);if("number"==typeof t)throw new TypeError('The "value" argument must not be of type number. Received type number');var i=t.valueOf&&t.valueOf();if(null!=i&&i!==t)return e.from(i,r,o);var s=function(t){if(e.isBuffer(t)){var r=0|c(t.length),o=n(r);return 0===o.length||t.copy(o,0,0,r),o}if(void 0!==t.length)return"number"!=typeof t.length||U(t.length)?n(0):a(t);if("Buffer"===t.type&&Array.isArray(t.data))return a(t.data)}(t);if(s)return s;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof t[Symbol.toPrimitive])return e.from(t[Symbol.toPrimitive]("string"),r,o);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t)}function i(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function s(e){return i(e),n(e<0?0:0|c(e))}function a(e){for(var t=e.length<0?0:0|c(e.length),r=n(t),o=0;o<t;o+=1)r[o]=255&e[o];return r}function u(t,r,n){if(r<0||t.byteLength<r)throw new RangeError('"offset" is outside of buffer bounds');if(t.byteLength<r+(n||0))throw new RangeError('"length" is outside of buffer bounds');var o;return o=void 0===r&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,r):new Uint8Array(t,r,n),Object.setPrototypeOf(o,e.prototype),o}function c(e){if(e>=2147483647)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+2147483647..toString(16)+" bytes");return 0|e}function p(t,r){if(e.isBuffer(t))return t.length;if(ArrayBuffer.isView(t)||x(t,ArrayBuffer))return t.byteLength;if("string"!=typeof t)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof t);var n=t.length,o=arguments.length>2&&!0===arguments[2];if(!o&&0===n)return 0;for(var i=!1;;)switch(r){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return L(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return D(t).length;default:if(i)return o?-1:L(t).length;r=(""+r).toLowerCase(),i=!0}}function l(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return I(this,t,r);case"utf8":case"utf-8":return g(this,t,r);case"ascii":return T(this,t,r);case"latin1":case"binary":return O(this,t,r);case"base64":return w(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return b(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function f(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function h(t,r,n,o,i){if(0===t.length)return-1;if("string"==typeof n?(o=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),U(n=+n)&&(n=i?0:t.length-1),n<0&&(n=t.length+n),n>=t.length){if(i)return-1;n=t.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof r&&(r=e.from(r,o)),e.isBuffer(r))return 0===r.length?-1:d(t,r,n,o,i);if("number"==typeof r)return r&=255,"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(t,r,n):Uint8Array.prototype.lastIndexOf.call(t,r,n):d(t,[r],n,o,i);throw new TypeError("val must be string, number or Buffer")}function d(e,t,r,n,o){var i,s=1,a=e.length,u=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;s=2,a/=2,u/=2,r/=2}function c(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(o){var p=-1;for(i=r;i<a;i++)if(c(e,i)===c(t,-1===p?0:i-p)){if(-1===p&&(p=i),i-p+1===u)return p*s}else-1!==p&&(i-=i-p),p=-1}else for(r+u>a&&(r=a-u),i=r;i>=0;i--){for(var l=!0,f=0;f<u;f++)if(c(e,i+f)!==c(t,f)){l=!1;break}if(l)return i}return-1}function y(e,t,r,n){r=Number(r)||0;var o=e.length-r;n?(n=Number(n))>o&&(n=o):n=o;var i=t.length;n>i/2&&(n=i/2);for(var s=0;s<n;++s){var a=parseInt(t.substr(2*s,2),16);if(U(a))return s;e[r+s]=a}return s}function v(e,t,r,n){return j(L(t,e.length-r),e,r,n)}function _(e,t,r,n){return j(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function S(e,t,r,n){return _(e,t,r,n)}function E(e,t,r,n){return j(D(t),e,r,n)}function m(e,t,r,n){return j(function(e,t){for(var r,n,o,i=[],s=0;s<e.length&&!((t-=2)<0);++s)r=e.charCodeAt(s),n=r>>8,o=r%256,i.push(o),i.push(n);return i}(t,e.length-r),e,r,n)}function w(e,t,r){return 0===t&&r===e.length?va.fromByteArray(e):va.fromByteArray(e.slice(t,r))}function g(e,t,r){r=Math.min(e.length,r);for(var n=[],o=t;o<r;){var i,s,a,u,c=e[o],p=null,l=c>239?4:c>223?3:c>191?2:1;if(o+l<=r)switch(l){case 1:c<128&&(p=c);break;case 2:128==(192&(i=e[o+1]))&&(u=(31&c)<<6|63&i)>127&&(p=u);break;case 3:i=e[o+1],s=e[o+2],128==(192&i)&&128==(192&s)&&(u=(15&c)<<12|(63&i)<<6|63&s)>2047&&(u<55296||u>57343)&&(p=u);break;case 4:i=e[o+1],s=e[o+2],a=e[o+3],128==(192&i)&&128==(192&s)&&128==(192&a)&&(u=(15&c)<<18|(63&i)<<12|(63&s)<<6|63&a)>65535&&u<1114112&&(p=u)}null===p?(p=65533,l=1):p>65535&&(p-=65536,n.push(p>>>10&1023|55296),p=56320|1023&p),n.push(p),o+=l}return function(e){var t=e.length;if(t<=4096)return String.fromCharCode.apply(String,e);var r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=4096));return r}(n)}e.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),e.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(e.prototype,"parent",{enumerable:!0,get:function(){if(e.isBuffer(this))return this.buffer}}),Object.defineProperty(e.prototype,"offset",{enumerable:!0,get:function(){if(e.isBuffer(this))return this.byteOffset}}),e.poolSize=8192,e.from=function(e,t,r){return o(e,t,r)},Object.setPrototypeOf(e.prototype,Uint8Array.prototype),Object.setPrototypeOf(e,Uint8Array),e.alloc=function(e,t,r){return function(e,t,r){return i(e),e<=0?n(e):void 0!==t?"string"==typeof r?n(e).fill(t,r):n(e).fill(t):n(e)}(e,t,r)},e.allocUnsafe=function(e){return s(e)},e.allocUnsafeSlow=function(e){return s(e)},e.isBuffer=function(t){return null!=t&&!0===t._isBuffer&&t!==e.prototype},e.compare=function(t,r){if(x(t,Uint8Array)&&(t=e.from(t,t.offset,t.byteLength)),x(r,Uint8Array)&&(r=e.from(r,r.offset,r.byteLength)),!e.isBuffer(t)||!e.isBuffer(r))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(t===r)return 0;for(var n=t.length,o=r.length,i=0,s=Math.min(n,o);i<s;++i)if(t[i]!==r[i]){n=t[i],o=r[i];break}return n<o?-1:o<n?1:0},e.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},e.concat=function(t,r){if(!Array.isArray(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return e.alloc(0);var n;if(void 0===r)for(r=0,n=0;n<t.length;++n)r+=t[n].length;var o=e.allocUnsafe(r),i=0;for(n=0;n<t.length;++n){var s=t[n];if(x(s,Uint8Array)&&(s=e.from(s)),!e.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(o,i),i+=s.length}return o},e.byteLength=p,e.prototype._isBuffer=!0,e.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)f(this,t,t+1);return this},e.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)f(this,t,t+3),f(this,t+1,t+2);return this},e.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)f(this,t,t+7),f(this,t+1,t+6),f(this,t+2,t+5),f(this,t+3,t+4);return this},e.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?g(this,0,e):l.apply(this,arguments)},e.prototype.toLocaleString=e.prototype.toString,e.prototype.equals=function(t){if(!e.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===e.compare(this,t)},e.prototype.inspect=function(){var e="",r=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(e+=" ... "),"<Buffer "+e+">"},r&&(e.prototype[r]=e.prototype.inspect),e.prototype.compare=function(t,r,n,o,i){if(x(t,Uint8Array)&&(t=e.from(t,t.offset,t.byteLength)),!e.isBuffer(t))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof t);if(void 0===r&&(r=0),void 0===n&&(n=t?t.length:0),void 0===o&&(o=0),void 0===i&&(i=this.length),r<0||n>t.length||o<0||i>this.length)throw new RangeError("out of range index");if(o>=i&&r>=n)return 0;if(o>=i)return-1;if(r>=n)return 1;if(this===t)return 0;for(var s=(i>>>=0)-(o>>>=0),a=(n>>>=0)-(r>>>=0),u=Math.min(s,a),c=this.slice(o,i),p=t.slice(r,n),l=0;l<u;++l)if(c[l]!==p[l]){s=c[l],a=p[l];break}return s<a?-1:a<s?1:0},e.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},e.prototype.indexOf=function(e,t,r){return h(this,e,t,r,!0)},e.prototype.lastIndexOf=function(e,t,r){return h(this,e,t,r,!1)},e.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var o=this.length-t;if((void 0===r||r>o)&&(r=o),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var i=!1;;)switch(n){case"hex":return y(this,e,t,r);case"utf8":case"utf-8":return v(this,e,t,r);case"ascii":return _(this,e,t,r);case"latin1":case"binary":return S(this,e,t,r);case"base64":return E(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return m(this,e,t,r);default:if(i)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),i=!0}},e.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function T(e,t,r){var n="";r=Math.min(e.length,r);for(var o=t;o<r;++o)n+=String.fromCharCode(127&e[o]);return n}function O(e,t,r){var n="";r=Math.min(e.length,r);for(var o=t;o<r;++o)n+=String.fromCharCode(e[o]);return n}function I(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var o="",i=t;i<r;++i)o+=B[e[i]];return o}function b(e,t,r){for(var n=e.slice(t,r),o="",i=0;i<n.length;i+=2)o+=String.fromCharCode(n[i]+256*n[i+1]);return o}function R(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function C(t,r,n,o,i,s){if(!e.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(r>i||r<s)throw new RangeError('"value" argument is out of bounds');if(n+o>t.length)throw new RangeError("Index out of range")}function P(e,t,r,n,o,i){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function N(e,t,r,n,o){return t=+t,r>>>=0,o||P(e,0,r,4),Ia.write(e,t,r,n,23,4),r+4}function A(e,t,r,n,o){return t=+t,r>>>=0,o||P(e,0,r,8),Ia.write(e,t,r,n,52,8),r+8}e.prototype.slice=function(t,r){var n=this.length;(t=~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),(r=void 0===r?n:~~r)<0?(r+=n)<0&&(r=0):r>n&&(r=n),r<t&&(r=t);var o=this.subarray(t,r);return Object.setPrototypeOf(o,e.prototype),o},e.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||R(e,t,this.length);for(var n=this[e],o=1,i=0;++i<t&&(o*=256);)n+=this[e+i]*o;return n},e.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||R(e,t,this.length);for(var n=this[e+--t],o=1;t>0&&(o*=256);)n+=this[e+--t]*o;return n},e.prototype.readUInt8=function(e,t){return e>>>=0,t||R(e,1,this.length),this[e]},e.prototype.readUInt16LE=function(e,t){return e>>>=0,t||R(e,2,this.length),this[e]|this[e+1]<<8},e.prototype.readUInt16BE=function(e,t){return e>>>=0,t||R(e,2,this.length),this[e]<<8|this[e+1]},e.prototype.readUInt32LE=function(e,t){return e>>>=0,t||R(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},e.prototype.readUInt32BE=function(e,t){return e>>>=0,t||R(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},e.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||R(e,t,this.length);for(var n=this[e],o=1,i=0;++i<t&&(o*=256);)n+=this[e+i]*o;return n>=(o*=128)&&(n-=Math.pow(2,8*t)),n},e.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||R(e,t,this.length);for(var n=t,o=1,i=this[e+--n];n>0&&(o*=256);)i+=this[e+--n]*o;return i>=(o*=128)&&(i-=Math.pow(2,8*t)),i},e.prototype.readInt8=function(e,t){return e>>>=0,t||R(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},e.prototype.readInt16LE=function(e,t){e>>>=0,t||R(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},e.prototype.readInt16BE=function(e,t){e>>>=0,t||R(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},e.prototype.readInt32LE=function(e,t){return e>>>=0,t||R(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},e.prototype.readInt32BE=function(e,t){return e>>>=0,t||R(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},e.prototype.readFloatLE=function(e,t){return e>>>=0,t||R(e,4,this.length),Ia.read(this,e,!0,23,4)},e.prototype.readFloatBE=function(e,t){return e>>>=0,t||R(e,4,this.length),Ia.read(this,e,!1,23,4)},e.prototype.readDoubleLE=function(e,t){return e>>>=0,t||R(e,8,this.length),Ia.read(this,e,!0,52,8)},e.prototype.readDoubleBE=function(e,t){return e>>>=0,t||R(e,8,this.length),Ia.read(this,e,!1,52,8)},e.prototype.writeUIntLE=function(e,t,r,n){(e=+e,t>>>=0,r>>>=0,n)||C(this,e,t,r,Math.pow(2,8*r)-1,0);var o=1,i=0;for(this[t]=255&e;++i<r&&(o*=256);)this[t+i]=e/o&255;return t+r},e.prototype.writeUIntBE=function(e,t,r,n){(e=+e,t>>>=0,r>>>=0,n)||C(this,e,t,r,Math.pow(2,8*r)-1,0);var o=r-1,i=1;for(this[t+o]=255&e;--o>=0&&(i*=256);)this[t+o]=e/i&255;return t+r},e.prototype.writeUInt8=function(e,t,r){return e=+e,t>>>=0,r||C(this,e,t,1,255,0),this[t]=255&e,t+1},e.prototype.writeUInt16LE=function(e,t,r){return e=+e,t>>>=0,r||C(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},e.prototype.writeUInt16BE=function(e,t,r){return e=+e,t>>>=0,r||C(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},e.prototype.writeUInt32LE=function(e,t,r){return e=+e,t>>>=0,r||C(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},e.prototype.writeUInt32BE=function(e,t,r){return e=+e,t>>>=0,r||C(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},e.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t>>>=0,!n){var o=Math.pow(2,8*r-1);C(this,e,t,r,o-1,-o)}var i=0,s=1,a=0;for(this[t]=255&e;++i<r&&(s*=256);)e<0&&0===a&&0!==this[t+i-1]&&(a=1),this[t+i]=(e/s>>0)-a&255;return t+r},e.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t>>>=0,!n){var o=Math.pow(2,8*r-1);C(this,e,t,r,o-1,-o)}var i=r-1,s=1,a=0;for(this[t+i]=255&e;--i>=0&&(s*=256);)e<0&&0===a&&0!==this[t+i+1]&&(a=1),this[t+i]=(e/s>>0)-a&255;return t+r},e.prototype.writeInt8=function(e,t,r){return e=+e,t>>>=0,r||C(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},e.prototype.writeInt16LE=function(e,t,r){return e=+e,t>>>=0,r||C(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},e.prototype.writeInt16BE=function(e,t,r){return e=+e,t>>>=0,r||C(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},e.prototype.writeInt32LE=function(e,t,r){return e=+e,t>>>=0,r||C(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},e.prototype.writeInt32BE=function(e,t,r){return e=+e,t>>>=0,r||C(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},e.prototype.writeFloatLE=function(e,t,r){return N(this,e,t,!0,r)},e.prototype.writeFloatBE=function(e,t,r){return N(this,e,t,!1,r)},e.prototype.writeDoubleLE=function(e,t,r){return A(this,e,t,!0,r)},e.prototype.writeDoubleBE=function(e,t,r){return A(this,e,t,!1,r)},e.prototype.copy=function(t,r,n,o){if(!e.isBuffer(t))throw new TypeError("argument should be a Buffer");if(n||(n=0),o||0===o||(o=this.length),r>=t.length&&(r=t.length),r||(r=0),o>0&&o<n&&(o=n),o===n)return 0;if(0===t.length||0===this.length)return 0;if(r<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(o<0)throw new RangeError("sourceEnd out of bounds");o>this.length&&(o=this.length),t.length-r<o-n&&(o=t.length-r+n);var i=o-n;if(this===t&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(r,n,o);else if(this===t&&n<r&&r<o)for(var s=i-1;s>=0;--s)t[s+r]=this[s+n];else Uint8Array.prototype.set.call(t,this.subarray(n,o),r);return i},e.prototype.fill=function(t,r,n,o){if("string"==typeof t){if("string"==typeof r?(o=r,r=0,n=this.length):"string"==typeof n&&(o=n,n=this.length),void 0!==o&&"string"!=typeof o)throw new TypeError("encoding must be a string");if("string"==typeof o&&!e.isEncoding(o))throw new TypeError("Unknown encoding: "+o);if(1===t.length){var i=t.charCodeAt(0);("utf8"===o&&i<128||"latin1"===o)&&(t=i)}}else"number"==typeof t?t&=255:"boolean"==typeof t&&(t=Number(t));if(r<0||this.length<r||this.length<n)throw new RangeError("Out of range index");if(n<=r)return this;var s;if(r>>>=0,n=void 0===n?this.length:n>>>0,t||(t=0),"number"==typeof t)for(s=r;s<n;++s)this[s]=t;else{var a=e.isBuffer(t)?t:e.from(t,o),u=a.length;if(0===u)throw new TypeError('The value "'+t+'" is invalid for argument "value"');for(s=0;s<n-r;++s)this[s+r]=a[s%u]}return this};var M=/[^+/0-9A-Za-z-_]/g;function L(e,t){var r;t=t||1/0;for(var n=e.length,o=null,i=[],s=0;s<n;++s){if((r=e.charCodeAt(s))>55295&&r<57344){if(!o){if(r>56319){(t-=3)>-1&&i.push(239,191,189);continue}if(s+1===n){(t-=3)>-1&&i.push(239,191,189);continue}o=r;continue}if(r<56320){(t-=3)>-1&&i.push(239,191,189),o=r;continue}r=65536+(o-55296<<10|r-56320)}else o&&(t-=3)>-1&&i.push(239,191,189);if(o=null,r<128){if((t-=1)<0)break;i.push(r)}else if(r<2048){if((t-=2)<0)break;i.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;i.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;i.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return i}function D(e){return va.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(M,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function j(e,t,r,n){for(var o=0;o<n&&!(o+r>=t.length||o>=e.length);++o)t[o+r]=e[o];return o}function x(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function U(e){return e!=e}var B=function(){for(var e=new Array(256),t=0;t<16;++t)for(var r=16*t,n=0;n<16;++n)e[r+n]="0123456789abcdef"[t]+"0123456789abcdef"[n];return e}()}).call(this,a({}).Buffer)})),u=Math.ceil,c=Math.floor,p=function(e){return isNaN(e=+e)?0:(e>0?c:u)(e)},l=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e},f={charAt:(e=!0,function(t,r){var n,o,i=String(l(t)),s=p(r),a=i.length;return s<0||s>=a?e?"":void 0:(n=i.charCodeAt(s))<55296||n>56319||s+1===a||(o=i.charCodeAt(s+1))<56320||o>57343?e?i.charAt(s):n:e?i.slice(s,s+2):o-56320+(n-55296<<10)+65536})},h={};(function(e){var t=function(e){return e&&e.Math==Math&&e};h=t("object"==typeof globalThis&&globalThis)||t("object"==typeof window&&window)||t("object"==typeof self&&self)||t("object"==typeof e&&e)||Function("return this")()}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var d=function(e){try{return!!e()}catch(e){return!0}},y=!d((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),v=function(e){return"object"==typeof e?null!==e:"function"==typeof e},_=h.document,S=v(_)&&v(_.createElement),E=function(e){return S?_.createElement(e):{}},m=!y&&!d((function(){return 7!=Object.defineProperty(E("div"),"a",{get:function(){return 7}}).a})),w=function(e){if(!v(e))throw TypeError(String(e)+" is not an object");return e},g=function(e,t){if(!v(e))return e;var r,n;if(t&&"function"==typeof(r=e.toString)&&!v(n=r.call(e)))return n;if("function"==typeof(r=e.valueOf)&&!v(n=r.call(e)))return n;if(!t&&"function"==typeof(r=e.toString)&&!v(n=r.call(e)))return n;throw TypeError("Can't convert object to primitive value")},T={},O=Object.defineProperty;T.f=y?O:function(e,t,r){if(w(e),t=g(t,!0),w(r),m)try{return O(e,t,r)}catch(e){}if("get"in r||"set"in r)throw TypeError("Accessors not supported");return"value"in r&&(e[t]=r.value),e};var I=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},b=y?function(e,t,r){return T.f(e,t,I(1,r))}:function(e,t,r){return e[t]=r,e},R=function(e,t){try{b(h,e,t)}catch(r){h[e]=t}return t},C=h["__core-js_shared__"]||R("__core-js_shared__",{}),P=Function.toString;"function"!=typeof C.inspectSource&&(C.inspectSource=function(e){return P.call(e)});var N,A=C.inspectSource,M=h.WeakMap,L="function"==typeof M&&/native code/.test(A(M)),D={}.hasOwnProperty,j=function(e,t){return D.call(e,t)};(N=function(e,t){return C[e]||(C[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.6.5",mode:"global",copyright:"© 2020 Denis Pushkarev (zloirock.ru)"});var x,U,B,k=0,q=Math.random(),V=function(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++k+q).toString(36)},F=N("keys"),G=function(e){return F[e]||(F[e]=V(e))},H={},W=h.WeakMap;if(L){var Y=new W,z=Y.get,Q=Y.has,$=Y.set;x=function(e,t){return $.call(Y,e,t),t},U=function(e){return z.call(Y,e)||{}},B=function(e){return Q.call(Y,e)}}else{var K=G("state");H[K]=!0,x=function(e,t){return b(e,K,t),t},U=function(e){return j(e,K)?e[K]:{}},B=function(e){return j(e,K)}}var J={set:x,get:U,enforce:function(e){return B(e)?U(e):x(e,{})},getterFor:function(e){return function(t){var r;if(!v(t)||(r=U(t)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return r}}},X={},Z={}.propertyIsEnumerable,ee=Object.getOwnPropertyDescriptor,te=ee&&!Z.call({1:2},1);X.f=te?function(e){var t=ee(this,e);return!!t&&t.enumerable}:Z;var re={}.toString,ne=function(e){return re.call(e).slice(8,-1)},oe="".split,ie=d((function(){return!Object("z").propertyIsEnumerable(0)}))?function(e){return"String"==ne(e)?oe.call(e,""):Object(e)}:Object,se=function(e){return ie(l(e))},ae={},ue=Object.getOwnPropertyDescriptor;ae.f=y?ue:function(e,t){if(e=se(e),t=g(t,!0),m)try{return ue(e,t)}catch(e){}if(j(e,t))return I(!X.f.call(e,t),e[t])};var ce,pe=J.get,le=J.enforce,fe=String(String).split("String");(ce=function(e,t,r,n){var o=!!n&&!!n.unsafe,i=!!n&&!!n.enumerable,s=!!n&&!!n.noTargetGet;"function"==typeof r&&("string"!=typeof t||j(r,"name")||b(r,"name",t),le(r).source=fe.join("string"==typeof t?t:"")),e!==h?(o?!s&&e[t]&&(i=!0):delete e[t],i?e[t]=r:b(e,t,r)):i?e[t]=r:R(t,r)})(Function.prototype,"toString",(function(){return"function"==typeof this&&pe(this).source||A(this)}));var he=h,de=function(e){return"function"==typeof e?e:void 0},ye=function(e,t){return arguments.length<2?de(he[e])||de(h[e]):he[e]&&he[e][t]||h[e]&&h[e][t]},ve=Math.min,_e=function(e){return e>0?ve(p(e),9007199254740991):0},Se=Math.max,Ee=Math.min,me=function(e,t){var r=p(e);return r<0?Se(r+t,0):Ee(r,t)},we=function(e){return function(t,r,n){var o,i=se(t),s=_e(i.length),a=me(n,s);if(e&&r!=r){for(;s>a;)if((o=i[a++])!=o)return!0}else for(;s>a;a++)if((e||a in i)&&i[a]===r)return e||a||0;return!e&&-1}},ge={includes:we(!0),indexOf:we(!1)},Te=ge.indexOf,Oe=function(e,t){var r,n=se(e),o=0,i=[];for(r in n)!j(H,r)&&j(n,r)&&i.push(r);for(;t.length>o;)j(n,r=t[o++])&&(~Te(i,r)||i.push(r));return i},Ie=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],be={},Re=Ie.concat("length","prototype");be.f=Object.getOwnPropertyNames||function(e){return Oe(e,Re)};var Ce={};Ce.f=Object.getOwnPropertySymbols;var Pe,Ne,Ae,Me=ye("Reflect","ownKeys")||function(e){var t=be.f(w(e)),r=Ce.f;return r?t.concat(r(e)):t},Le=function(e,t){for(var r=Me(t),n=T.f,o=ae.f,i=0;i<r.length;i++){var s=r[i];j(e,s)||n(e,s,o(t,s))}},De=/#|\.prototype\./,je=function(e,t){var r=Ue[xe(e)];return r==ke||r!=Be&&("function"==typeof t?d(t):!!t)},xe=je.normalize=function(e){return String(e).replace(De,".").toLowerCase()},Ue=je.data={},Be=je.NATIVE="N",ke=je.POLYFILL="P",qe=je,Ve=ae.f,Fe=function(e,t){var r,n,o,i,s,a=e.target,u=e.global,c=e.stat;if(r=u?h:c?h[a]||R(a,{}):(h[a]||{}).prototype)for(n in t){if(i=t[n],o=e.noTargetGet?(s=Ve(r,n))&&s.value:r[n],!qe(u?n:a+(c?".":"#")+n,e.forced)&&void 0!==o){if(typeof i==typeof o)continue;Le(i,o)}(e.sham||o&&o.sham)&&b(i,"sham",!0),ce(r,n,i,e)}},Ge=function(e){return Object(l(e))},He=!d((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),We=G("IE_PROTO"),Ye=Object.prototype,ze=He?Object.getPrototypeOf:function(e){return e=Ge(e),j(e,We)?e[We]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?Ye:null},Qe=!!Object.getOwnPropertySymbols&&!d((function(){return!String(Symbol())})),$e=Qe&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,Ke=N("wks"),Je=h.Symbol,Xe=$e?Je:Je&&Je.withoutSetter||V,Ze=function(e){return j(Ke,e)||(Qe&&j(Je,e)?Ke[e]=Je[e]:Ke[e]=Xe("Symbol."+e)),Ke[e]},et=Ze("iterator"),tt=!1;[].keys&&("next"in(Ae=[].keys())?(Ne=ze(ze(Ae)))!==Object.prototype&&(Pe=Ne):tt=!0),null==Pe&&(Pe={}),j(Pe,et)||b(Pe,et,(function(){return this}));var rt,nt={IteratorPrototype:Pe,BUGGY_SAFARI_ITERATORS:tt},ot=Object.keys||function(e){return Oe(e,Ie)},it=y?Object.defineProperties:function(e,t){w(e);for(var r,n=ot(t),o=n.length,i=0;o>i;)T.f(e,r=n[i++],t[r]);return e},st=ye("document","documentElement"),at=G("IE_PROTO"),ut=function(){},ct=function(e){return"<script>"+e+"<\/script>"},pt=function(){try{rt=document.domain&&new ActiveXObject("htmlfile")}catch(e){}var e,t;pt=rt?function(e){e.write(ct("")),e.close();var t=e.parentWindow.Object;return e=null,t}(rt):((t=E("iframe")).style.display="none",st.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(ct("document.F=Object")),e.close(),e.F);for(var r=Ie.length;r--;)delete pt.prototype[Ie[r]];return pt()};H[at]=!0;var lt=Object.create||function(e,t){var r;return null!==e?(ut.prototype=w(e),r=new ut,ut.prototype=null,r[at]=e):r=pt(),void 0===t?r:it(r,t)},ft=T.f,ht=Ze("toStringTag"),dt=function(e,t,r){e&&!j(e=r?e:e.prototype,ht)&&ft(e,ht,{configurable:!0,value:t})},yt={},vt=nt.IteratorPrototype,_t=function(){return this},St=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{(e=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(r,[]),t=r instanceof Array}catch(e){}return function(r,n){return w(r),function(e){if(!v(e)&&null!==e)throw TypeError("Can't set "+String(e)+" as a prototype")}(n),t?e.call(r,n):r.__proto__=n,r}}():void 0),Et=nt.IteratorPrototype,mt=nt.BUGGY_SAFARI_ITERATORS,wt=Ze("iterator"),gt=function(){return this},Tt=function(e,t,r,n,o,i,s){!function(e,t,r){var n=t+" Iterator";e.prototype=lt(vt,{next:I(1,r)}),dt(e,n,!1),yt[n]=_t}(r,t,n);var a,u,c,p=function(e){if(e===o&&y)return y;if(!mt&&e in h)return h[e];switch(e){case"keys":case"values":case"entries":return function(){return new r(this,e)}}return function(){return new r(this)}},l=t+" Iterator",f=!1,h=e.prototype,d=h[wt]||h["@@iterator"]||o&&h[o],y=!mt&&d||p(o),v="Array"==t&&h.entries||d;if(v&&(a=ze(v.call(new e)),Et!==Object.prototype&&a.next&&(ze(a)!==Et&&(St?St(a,Et):"function"!=typeof a[wt]&&b(a,wt,gt)),dt(a,l,!0))),"values"==o&&d&&"values"!==d.name&&(f=!0,y=function(){return d.call(this)}),h[wt]!==y&&b(h,wt,y),yt[t]=y,o)if(u={values:p("values"),keys:i?y:p("keys"),entries:p("entries")},s)for(c in u)(mt||f||!(c in h))&&ce(h,c,u[c]);else Fe({target:t,proto:!0,forced:mt||f},u);return u},Ot=f.charAt,It=J.set,bt=J.getterFor("String Iterator");Tt(String,"String",(function(e){It(this,{type:"String Iterator",string:String(e),index:0})}),(function(){var e,t=bt(this),r=t.string,n=t.index;return n>=r.length?{value:void 0,done:!0}:(e=Ot(r,n),t.index+=e.length,{value:e,done:!1})}));var Rt=function(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e},Ct=function(e,t,r){if(Rt(e),void 0===t)return e;switch(r){case 0:return function(){return e.call(t)};case 1:return function(r){return e.call(t,r)};case 2:return function(r,n){return e.call(t,r,n)};case 3:return function(r,n,o){return e.call(t,r,n,o)}}return function(){return e.apply(t,arguments)}},Pt=function(e,t,r,n){try{return n?t(w(r)[0],r[1]):t(r)}catch(t){var o=e.return;throw void 0!==o&&w(o.call(e)),t}},Nt=Ze("iterator"),At=Array.prototype,Mt=function(e){return void 0!==e&&(yt.Array===e||At[Nt]===e)},Lt=function(e,t,r){var n=g(t);n in e?T.f(e,n,I(0,r)):e[n]=r},Dt={};Dt[Ze("toStringTag")]="z";var jt="[object z]"===String(Dt),xt=Ze("toStringTag"),Ut="Arguments"==ne(function(){return arguments}()),Bt=jt?ne:function(e){var t,r,n;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),xt))?r:Ut?ne(t):"Object"==(n=ne(t))&&"function"==typeof t.callee?"Arguments":n},kt=Ze("iterator"),qt=function(e){if(null!=e)return e[kt]||e["@@iterator"]||yt[Bt(e)]},Vt=Ze("iterator"),Ft=!1;try{var Gt=0,Ht={next:function(){return{done:!!Gt++}},return:function(){Ft=!0}};Ht[Vt]=function(){return this},Array.from(Ht,(function(){throw 2}))}catch(e){}var Wt=function(e,t){if(!t&&!Ft)return!1;var r=!1;try{var n={};n[Vt]=function(){return{next:function(){return{done:r=!0}}}},e(n)}catch(e){}return r},Yt=!Wt((function(e){Array.from(e)}));Fe({target:"Array",stat:!0,forced:Yt},{from:function(e){var t,r,n,o,i,s,a=Ge(e),u="function"==typeof this?this:Array,c=arguments.length,p=c>1?arguments[1]:void 0,l=void 0!==p,f=qt(a),h=0;if(l&&(p=Ct(p,c>2?arguments[2]:void 0,2)),null==f||u==Array&&Mt(f))for(r=new u(t=_e(a.length));t>h;h++)s=l?p(a[h],h):a[h],Lt(r,h,s);else for(i=(o=f.call(a)).next,r=new u;!(n=i.call(o)).done;h++)s=l?Pt(o,p,[n.value,h],!0):n.value,Lt(r,h,s);return r.length=h,r}});var zt=Array.isArray||function(e){return"Array"==ne(e)};Fe({target:"Array",stat:!0},{isArray:zt});var Qt=d((function(){function e(){}return!(Array.of.call(e)instanceof e)}));Fe({target:"Array",stat:!0,forced:Qt},{of:function(){for(var e=0,t=arguments.length,r=new("function"==typeof this?this:Array)(t);t>e;)Lt(r,e,arguments[e++]);return r.length=t,r}});var $t,Kt,Jt=Ze("species"),Xt=function(e,t){var r;return zt(e)&&("function"!=typeof(r=e.constructor)||r!==Array&&!zt(r.prototype)?v(r)&&null===(r=r[Jt])&&(r=void 0):r=void 0),new(void 0===r?Array:r)(0===t?0:t)},Zt=ye("navigator","userAgent")||"",er=h.process,tr=er&&er.versions,rr=tr&&tr.v8;rr?Kt=($t=rr.split("."))[0]+$t[1]:Zt&&(!($t=Zt.match(/Edge\/(\d+)/))||$t[1]>=74)&&($t=Zt.match(/Chrome\/(\d+)/))&&(Kt=$t[1]);var nr=Kt&&+Kt,or=Ze("species"),ir=function(e){return nr>=51||!d((function(){var t=[];return(t.constructor={})[or]=function(){return{foo:1}},1!==t[e](Boolean).foo}))},sr=Ze("isConcatSpreadable"),ar=nr>=51||!d((function(){var e=[];return e[sr]=!1,e.concat()[0]!==e})),ur=ir("concat"),cr=function(e){if(!v(e))return!1;var t=e[sr];return void 0!==t?!!t:zt(e)};Fe({target:"Array",proto:!0,forced:!ar||!ur},{concat:function(e){var t,r,n,o,i,s=Ge(this),a=Xt(s,0),u=0;for(t=-1,n=arguments.length;t<n;t++)if(cr(i=-1===t?s:arguments[t])){if(u+(o=_e(i.length))>9007199254740991)throw TypeError("Maximum allowed index exceeded");for(r=0;r<o;r++,u++)r in i&&Lt(a,u,i[r])}else{if(u>=9007199254740991)throw TypeError("Maximum allowed index exceeded");Lt(a,u++,i)}return a.length=u,a}});var pr=Math.min,lr=[].copyWithin||function(e,t){var r=Ge(this),n=_e(r.length),o=me(e,n),i=me(t,n),s=arguments.length>2?arguments[2]:void 0,a=pr((void 0===s?n:me(s,n))-i,n-o),u=1;for(i<o&&o<i+a&&(u=-1,i+=a-1,o+=a-1);a-- >0;)i in r?r[o]=r[i]:delete r[o],o+=u,i+=u;return r},fr=Ze("unscopables"),hr=Array.prototype;null==hr[fr]&&T.f(hr,fr,{configurable:!0,value:lt(null)});var dr=function(e){hr[fr][e]=!0};Fe({target:"Array",proto:!0},{copyWithin:lr}),dr("copyWithin");var yr=[].push,vr=function(e){var t=1==e,r=2==e,n=3==e,o=4==e,i=6==e,s=5==e||i;return function(a,u,c,p){for(var l,f,h=Ge(a),d=ie(h),y=Ct(u,c,3),v=_e(d.length),_=0,S=p||Xt,E=t?S(a,v):r?S(a,0):void 0;v>_;_++)if((s||_ in d)&&(f=y(l=d[_],_,h),e))if(t)E[_]=f;else if(f)switch(e){case 3:return!0;case 5:return l;case 6:return _;case 2:yr.call(E,l)}else if(o)return!1;return i?-1:n||o?o:E}},_r={forEach:vr(0),map:vr(1),filter:vr(2),some:vr(3),every:vr(4),find:vr(5),findIndex:vr(6)},Sr=function(e,t){var r=[][e];return!!r&&d((function(){r.call(null,t||function(){throw 1},1)}))},Er=Object.defineProperty,mr={},wr=function(e){throw e},gr=function(e,t){if(j(mr,e))return mr[e];t||(t={});var r=[][e],n=!!j(t,"ACCESSORS")&&t.ACCESSORS,o=j(t,0)?t[0]:wr,i=j(t,1)?t[1]:void 0;return mr[e]=!!r&&!d((function(){if(n&&!y)return!0;var e={length:-1};n?Er(e,1,{enumerable:!0,get:wr}):e[1]=1,r.call(e,o,i)}))},Tr=_r.every,Or=Sr("every"),Ir=gr("every");Fe({target:"Array",proto:!0,forced:!Or||!Ir},{every:function(e){return Tr(this,e,arguments.length>1?arguments[1]:void 0)}});Fe({target:"Array",proto:!0},{fill:function(e){for(var t=Ge(this),r=_e(t.length),n=arguments.length,o=me(n>1?arguments[1]:void 0,r),i=n>2?arguments[2]:void 0,s=void 0===i?r:me(i,r);s>o;)t[o++]=e;return t}}),dr("fill");var br=_r.filter,Rr=ir("filter"),Cr=gr("filter");Fe({target:"Array",proto:!0,forced:!Rr||!Cr},{filter:function(e){return br(this,e,arguments.length>1?arguments[1]:void 0)}});var Pr=_r.find,Nr=!0,Ar=gr("find");"find"in[]&&Array(1).find((function(){Nr=!1})),Fe({target:"Array",proto:!0,forced:Nr||!Ar},{find:function(e){return Pr(this,e,arguments.length>1?arguments[1]:void 0)}}),dr("find");var Mr=_r.findIndex,Lr=!0,Dr=gr("findIndex");"findIndex"in[]&&Array(1).findIndex((function(){Lr=!1})),Fe({target:"Array",proto:!0,forced:Lr||!Dr},{findIndex:function(e){return Mr(this,e,arguments.length>1?arguments[1]:void 0)}}),dr("findIndex");var jr=function(e,t,r,n,o,i,s,a){for(var u,c=o,p=0,l=!!s&&Ct(s,a,3);p<n;){if(p in r){if(u=l?l(r[p],p,t):r[p],i>0&&zt(u))c=jr(e,t,u,_e(u.length),c,i-1)-1;else{if(c>=9007199254740991)throw TypeError("Exceed the acceptable array length");e[c]=u}c++}p++}return c},xr=jr;Fe({target:"Array",proto:!0},{flat:function(){var e=arguments.length?arguments[0]:void 0,t=Ge(this),r=_e(t.length),n=Xt(t,0);return n.length=xr(n,t,t,r,0,void 0===e?1:p(e)),n}});Fe({target:"Array",proto:!0},{flatMap:function(e){var t,r=Ge(this),n=_e(r.length);return Rt(e),(t=Xt(r,0)).length=xr(t,r,r,n,0,1,e,arguments.length>1?arguments[1]:void 0),t}});var Ur=_r.forEach,Br=Sr("forEach"),kr=gr("forEach"),qr=Br&&kr?[].forEach:function(e){return Ur(this,e,arguments.length>1?arguments[1]:void 0)};Fe({target:"Array",proto:!0,forced:[].forEach!=qr},{forEach:qr});var Vr=ge.includes,Fr=gr("indexOf",{ACCESSORS:!0,1:0});Fe({target:"Array",proto:!0,forced:!Fr},{includes:function(e){return Vr(this,e,arguments.length>1?arguments[1]:void 0)}}),dr("includes");var Gr=ge.indexOf,Hr=[].indexOf,Wr=!!Hr&&1/[1].indexOf(1,-0)<0,Yr=Sr("indexOf"),zr=gr("indexOf",{ACCESSORS:!0,1:0});Fe({target:"Array",proto:!0,forced:Wr||!Yr||!zr},{indexOf:function(e){return Wr?Hr.apply(this,arguments)||0:Gr(this,e,arguments.length>1?arguments[1]:void 0)}});var Qr=J.set,$r=J.getterFor("Array Iterator"),Kr=Tt(Array,"Array",(function(e,t){Qr(this,{type:"Array Iterator",target:se(e),index:0,kind:t})}),(function(){var e=$r(this),t=e.target,r=e.kind,n=e.index++;return!t||n>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==r?{value:n,done:!1}:"values"==r?{value:t[n],done:!1}:{value:[n,t[n]],done:!1}}),"values");yt.Arguments=yt.Array,dr("keys"),dr("values"),dr("entries");var Jr=[].join,Xr=ie!=Object,Zr=Sr("join",",");Fe({target:"Array",proto:!0,forced:Xr||!Zr},{join:function(e){return Jr.call(se(this),void 0===e?",":e)}});var en=Math.min,tn=[].lastIndexOf,rn=!!tn&&1/[1].lastIndexOf(1,-0)<0,nn=Sr("lastIndexOf"),on=gr("indexOf",{ACCESSORS:!0,1:0}),sn=rn||!nn||!on?function(e){if(rn)return tn.apply(this,arguments)||0;var t=se(this),r=_e(t.length),n=r-1;for(arguments.length>1&&(n=en(n,p(arguments[1]))),n<0&&(n=r+n);n>=0;n--)if(n in t&&t[n]===e)return n||0;return-1}:tn;Fe({target:"Array",proto:!0,forced:sn!==[].lastIndexOf},{lastIndexOf:sn});var an=_r.map,un=ir("map"),cn=gr("map");Fe({target:"Array",proto:!0,forced:!un||!cn},{map:function(e){return an(this,e,arguments.length>1?arguments[1]:void 0)}});var pn=function(e){return function(t,r,n,o){Rt(r);var i=Ge(t),s=ie(i),a=_e(i.length),u=e?a-1:0,c=e?-1:1;if(n<2)for(;;){if(u in s){o=s[u],u+=c;break}if(u+=c,e?u<0:a<=u)throw TypeError("Reduce of empty array with no initial value")}for(;e?u>=0:a>u;u+=c)u in s&&(o=r(o,s[u],u,i));return o}},ln={left:pn(!1),right:pn(!0)},fn=ln.left,hn=Sr("reduce"),dn=gr("reduce",{1:0});Fe({target:"Array",proto:!0,forced:!hn||!dn},{reduce:function(e){return fn(this,e,arguments.length,arguments.length>1?arguments[1]:void 0)}});var yn=ln.right,vn=Sr("reduceRight"),_n=gr("reduce",{1:0});Fe({target:"Array",proto:!0,forced:!vn||!_n},{reduceRight:function(e){return yn(this,e,arguments.length,arguments.length>1?arguments[1]:void 0)}});var Sn=[].reverse,En=[1,2];Fe({target:"Array",proto:!0,forced:String(En)===String(En.reverse())},{reverse:function(){return zt(this)&&(this.length=this.length),Sn.call(this)}});var mn=ir("slice"),wn=gr("slice",{ACCESSORS:!0,0:0,1:2}),gn=Ze("species"),Tn=[].slice,On=Math.max;Fe({target:"Array",proto:!0,forced:!mn||!wn},{slice:function(e,t){var r,n,o,i=se(this),s=_e(i.length),a=me(e,s),u=me(void 0===t?s:t,s);if(zt(i)&&("function"!=typeof(r=i.constructor)||r!==Array&&!zt(r.prototype)?v(r)&&null===(r=r[gn])&&(r=void 0):r=void 0,r===Array||void 0===r))return Tn.call(i,a,u);for(n=new(void 0===r?Array:r)(On(u-a,0)),o=0;a<u;a++,o++)a in i&&Lt(n,o,i[a]);return n.length=o,n}});var In=_r.some,bn=Sr("some"),Rn=gr("some");Fe({target:"Array",proto:!0,forced:!bn||!Rn},{some:function(e){return In(this,e,arguments.length>1?arguments[1]:void 0)}});var Cn=[],Pn=Cn.sort,Nn=d((function(){Cn.sort(void 0)})),An=d((function(){Cn.sort(null)})),Mn=Sr("sort");Fe({target:"Array",proto:!0,forced:Nn||!An||!Mn},{sort:function(e){return void 0===e?Pn.call(Ge(this)):Pn.call(Ge(this),Rt(e))}});var Ln=Ze("species"),Dn=function(e){var t=ye(e),r=T.f;y&&t&&!t[Ln]&&r(t,Ln,{configurable:!0,get:function(){return this}})};Dn("Array");var jn=ir("splice"),xn=gr("splice",{ACCESSORS:!0,0:0,1:2}),Un=Math.max,Bn=Math.min;Fe({target:"Array",proto:!0,forced:!jn||!xn},{splice:function(e,t){var r,n,o,i,s,a,u=Ge(this),c=_e(u.length),l=me(e,c),f=arguments.length;if(0===f?r=n=0:1===f?(r=0,n=c-l):(r=f-2,n=Bn(Un(p(t),0),c-l)),c+r-n>9007199254740991)throw TypeError("Maximum allowed length exceeded");for(o=Xt(u,n),i=0;i<n;i++)(s=l+i)in u&&Lt(o,i,u[s]);if(o.length=n,r<n){for(i=l;i<c-n;i++)a=i+r,(s=i+n)in u?u[a]=u[s]:delete u[a];for(i=c;i>c-n+r;i--)delete u[i-1]}else if(r>n)for(i=c-n;i>l;i--)a=i+r-1,(s=i+n-1)in u?u[a]=u[s]:delete u[a];for(i=0;i<r;i++)u[i+l]=arguments[i+2];return u.length=c-n+r,o}});dr("flat");dr("flatMap");he.Array;var kn=Object.isFrozen,qn=function(e,t){if(!kn||!zt(e)||!kn(e))return!1;for(var r,n=0,o=e.length;n<o;)if(!("string"==typeof(r=e[n++])||t&&void 0===r))return!1;return 0!==o};Fe({target:"Array",stat:!0},{isTemplateObject:function(e){if(!qn(e,!0))return!1;var t=e.raw;return!(t.length!==e.length||!qn(t,!1))}});var Vn=T.f;y&&!("lastItem"in[])&&(Vn(Array.prototype,"lastItem",{configurable:!0,get:function(){var e=Ge(this),t=_e(e.length);return 0==t?void 0:e[t-1]},set:function(e){var t=Ge(this),r=_e(t.length);return t[0==r?0:r-1]=e}}),dr("lastItem"));var Fn=T.f;y&&!("lastIndex"in[])&&(Fn(Array.prototype,"lastIndex",{configurable:!0,get:function(){var e=Ge(this),t=_e(e.length);return 0==t?0:t-1}}),dr("lastIndex"));var Gn=!d((function(){return Object.isExtensible(Object.preventExtensions({}))})),Hn={},Wn=T.f,Yn=V("meta"),zn=0,Qn=Object.isExtensible||function(){return!0},$n=function(e){Wn(e,Yn,{value:{objectID:"O"+ ++zn,weakData:{}}})},Kn=Hn={REQUIRED:!1,fastKey:function(e,t){if(!v(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!j(e,Yn)){if(!Qn(e))return"F";if(!t)return"E";$n(e)}return e[Yn].objectID},getWeakData:function(e,t){if(!j(e,Yn)){if(!Qn(e))return!0;if(!t)return!1;$n(e)}return e[Yn].weakData},onFreeze:function(e){return Gn&&Kn.REQUIRED&&Qn(e)&&!j(e,Yn)&&$n(e),e}};H[Yn]=!0;var Jn,Xn=function(e,t){this.stopped=e,this.result=t};(Jn=function(e,t,r,n,o){var i,s,a,u,c,p,l,f=Ct(t,r,n?2:1);if(o)i=e;else{if("function"!=typeof(s=qt(e)))throw TypeError("Target is not iterable");if(Mt(s)){for(a=0,u=_e(e.length);u>a;a++)if((c=n?f(w(l=e[a])[0],l[1]):f(e[a]))&&c instanceof Xn)return c;return new Xn(!1)}i=s.call(e)}for(p=i.next;!(l=p.call(i)).done;)if("object"==typeof(c=Pt(i,f,l.value,n))&&c&&c instanceof Xn)return c;return new Xn(!1)}).stop=function(e){return new Xn(!0,e)};var Zn=function(e,t,r){if(!(e instanceof t))throw TypeError("Incorrect "+(r?r+" ":"")+"invocation");return e},eo=function(e,t,r){var n,o;return St&&"function"==typeof(n=t.constructor)&&n!==r&&v(o=n.prototype)&&o!==r.prototype&&St(e,o),e},to=function(e,t,r){var n=-1!==e.indexOf("Map"),o=-1!==e.indexOf("Weak"),i=n?"set":"add",s=h[e],a=s&&s.prototype,u=s,c={},p=function(e){var t=a[e];ce(a,e,"add"==e?function(e){return t.call(this,0===e?0:e),this}:"delete"==e?function(e){return!(o&&!v(e))&&t.call(this,0===e?0:e)}:"get"==e?function(e){return o&&!v(e)?void 0:t.call(this,0===e?0:e)}:"has"==e?function(e){return!(o&&!v(e))&&t.call(this,0===e?0:e)}:function(e,r){return t.call(this,0===e?0:e,r),this})};if(qe(e,"function"!=typeof s||!(o||a.forEach&&!d((function(){(new s).entries().next()})))))u=r.getConstructor(t,e,n,i),Hn.REQUIRED=!0;else if(qe(e,!0)){var l=new u,f=l[i](o?{}:-0,1)!=l,y=d((function(){l.has(1)})),_=Wt((function(e){new s(e)})),S=!o&&d((function(){for(var e=new s,t=5;t--;)e[i](t,t);return!e.has(-0)}));_||((u=t((function(t,r){Zn(t,u,e);var o=eo(new s,t,u);return null!=r&&Jn(r,o[i],o,n),o}))).prototype=a,a.constructor=u),(y||S)&&(p("delete"),p("has"),n&&p("get")),(S||f)&&p(i),o&&a.clear&&delete a.clear}return c[e]=u,Fe({global:!0,forced:u!=s},c),dt(u,e),o||r.setStrong(u,e,n),u},ro=function(e,t,r){for(var n in t)ce(e,n,t[n],r);return e},no=T.f,oo=Hn.fastKey,io=J.set,so=J.getterFor,ao={getConstructor:function(e,t,r,n){var o=e((function(e,i){Zn(e,o,t),io(e,{type:t,index:lt(null),first:void 0,last:void 0,size:0}),y||(e.size=0),null!=i&&Jn(i,e[n],e,r)})),i=so(t),s=function(e,t,r){var n,o,s=i(e),u=a(e,t);return u?u.value=r:(s.last=u={index:o=oo(t,!0),key:t,value:r,previous:n=s.last,next:void 0,removed:!1},s.first||(s.first=u),n&&(n.next=u),y?s.size++:e.size++,"F"!==o&&(s.index[o]=u)),e},a=function(e,t){var r,n=i(e),o=oo(t);if("F"!==o)return n.index[o];for(r=n.first;r;r=r.next)if(r.key==t)return r};return ro(o.prototype,{clear:function(){for(var e=i(this),t=e.index,r=e.first;r;)r.removed=!0,r.previous&&(r.previous=r.previous.next=void 0),delete t[r.index],r=r.next;e.first=e.last=void 0,y?e.size=0:this.size=0},delete:function(e){var t=i(this),r=a(this,e);if(r){var n=r.next,o=r.previous;delete t.index[r.index],r.removed=!0,o&&(o.next=n),n&&(n.previous=o),t.first==r&&(t.first=n),t.last==r&&(t.last=o),y?t.size--:this.size--}return!!r},forEach:function(e){for(var t,r=i(this),n=Ct(e,arguments.length>1?arguments[1]:void 0,3);t=t?t.next:r.first;)for(n(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!a(this,e)}}),ro(o.prototype,r?{get:function(e){var t=a(this,e);return t&&t.value},set:function(e,t){return s(this,0===e?0:e,t)}}:{add:function(e){return s(this,e=0===e?0:e,e)}}),y&&no(o.prototype,"size",{get:function(){return i(this).size}}),o},setStrong:function(e,t,r){var n=t+" Iterator",o=so(t),i=so(n);Tt(e,t,(function(e,t){io(this,{type:n,target:e,state:o(e),kind:t,last:void 0})}),(function(){for(var e=i(this),t=e.kind,r=e.last;r&&r.removed;)r=r.previous;return e.target&&(e.last=r=r?r.next:e.state.first)?"keys"==t?{value:r.key,done:!1}:"values"==t?{value:r.value,done:!1}:{value:[r.key,r.value],done:!1}:(e.target=void 0,{value:void 0,done:!0})}),r?"entries":"values",!r,!0),Dn(t)}},uo=(to("Map",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),ao),jt?{}.toString:function(){return"[object "+Bt(this)+"]"});jt||ce(Object.prototype,"toString",uo,{unsafe:!0});var co={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},po=Ze("iterator"),lo=Ze("toStringTag"),fo=Kr.values;for(var ho in co){var yo=h[ho],vo=yo&&yo.prototype;if(vo){if(vo[po]!==fo)try{b(vo,po,fo)}catch(e){vo[po]=fo}if(vo[lo]||b(vo,lo,ho),co[ho])for(var _o in Kr)if(vo[_o]!==Kr[_o])try{b(vo,_o,Kr[_o])}catch(e){vo[_o]=Kr[_o]}}}he.Map;var So=function(e){var t,r,n,o,i=arguments.length,s=i>1?arguments[1]:void 0;return Rt(this),(t=void 0!==s)&&Rt(s),null==e?new this:(r=[],t?(n=0,o=Ct(s,i>2?arguments[2]:void 0,2),Jn(e,(function(e){r.push(o(e,n++))}))):Jn(e,r.push,r),new this(r))};Fe({target:"Map",stat:!0},{from:So});var Eo=function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];return new this(t)};Fe({target:"Map",stat:!0},{of:Eo});var mo=function(){for(var e,t=w(this),r=Rt(t.delete),n=!0,o=0,i=arguments.length;o<i;o++)e=r.call(t,arguments[o]),n=n&&e;return!!n};Fe({target:"Map",proto:!0,real:!0,forced:!1},{deleteAll:function(){return mo.apply(this,arguments)}});var wo=function(e){var t=qt(e);if("function"!=typeof t)throw TypeError(String(e)+" is not iterable");return w(t.call(e))},go=function(e){return Map.prototype.entries.call(e)};Fe({target:"Map",proto:!0,real:!0,forced:!1},{every:function(e){var t=w(this),r=go(t),n=Ct(e,arguments.length>1?arguments[1]:void 0,3);return!Jn(r,(function(e,r){if(!n(r,e,t))return Jn.stop()}),void 0,!0,!0).stopped}});var To=Ze("species"),Oo=function(e,t){var r,n=w(e).constructor;return void 0===n||null==(r=w(n)[To])?t:Rt(r)};Fe({target:"Map",proto:!0,real:!0,forced:!1},{filter:function(e){var t=w(this),r=go(t),n=Ct(e,arguments.length>1?arguments[1]:void 0,3),o=new(Oo(t,ye("Map"))),i=Rt(o.set);return Jn(r,(function(e,r){n(r,e,t)&&i.call(o,e,r)}),void 0,!0,!0),o}});Fe({target:"Map",proto:!0,real:!0,forced:!1},{find:function(e){var t=w(this),r=go(t),n=Ct(e,arguments.length>1?arguments[1]:void 0,3);return Jn(r,(function(e,r){if(n(r,e,t))return Jn.stop(r)}),void 0,!0,!0).result}});Fe({target:"Map",proto:!0,real:!0,forced:!1},{findKey:function(e){var t=w(this),r=go(t),n=Ct(e,arguments.length>1?arguments[1]:void 0,3);return Jn(r,(function(e,r){if(n(r,e,t))return Jn.stop(e)}),void 0,!0,!0).result}});Fe({target:"Map",stat:!0},{groupBy:function(e,t){var r=new this;Rt(t);var n=Rt(r.has),o=Rt(r.get),i=Rt(r.set);return Jn(e,(function(e){var s=t(e);n.call(r,s)?o.call(r,s).push(e):i.call(r,s,[e])})),r}});Fe({target:"Map",proto:!0,real:!0,forced:!1},{includes:function(e){return Jn(go(w(this)),(function(t,r){if((n=r)===(o=e)||n!=n&&o!=o)return Jn.stop();var n,o}),void 0,!0,!0).stopped}});Fe({target:"Map",stat:!0},{keyBy:function(e,t){var r=new this;Rt(t);var n=Rt(r.set);return Jn(e,(function(e){n.call(r,t(e),e)})),r}});Fe({target:"Map",proto:!0,real:!0,forced:!1},{keyOf:function(e){return Jn(go(w(this)),(function(t,r){if(r===e)return Jn.stop(t)}),void 0,!0,!0).result}});Fe({target:"Map",proto:!0,real:!0,forced:!1},{mapKeys:function(e){var t=w(this),r=go(t),n=Ct(e,arguments.length>1?arguments[1]:void 0,3),o=new(Oo(t,ye("Map"))),i=Rt(o.set);return Jn(r,(function(e,r){i.call(o,n(r,e,t),r)}),void 0,!0,!0),o}});Fe({target:"Map",proto:!0,real:!0,forced:!1},{mapValues:function(e){var t=w(this),r=go(t),n=Ct(e,arguments.length>1?arguments[1]:void 0,3),o=new(Oo(t,ye("Map"))),i=Rt(o.set);return Jn(r,(function(e,r){i.call(o,e,n(r,e,t))}),void 0,!0,!0),o}});Fe({target:"Map",proto:!0,real:!0,forced:!1},{merge:function(e){for(var t=w(this),r=Rt(t.set),n=0;n<arguments.length;)Jn(arguments[n++],r,t,!0);return t}});Fe({target:"Map",proto:!0,real:!0,forced:!1},{reduce:function(e){var t=w(this),r=go(t),n=arguments.length<2,o=n?void 0:arguments[1];if(Rt(e),Jn(r,(function(r,i){n?(n=!1,o=i):o=e(o,i,r,t)}),void 0,!0,!0),n)throw TypeError("Reduce of empty map with no initial value");return o}});Fe({target:"Map",proto:!0,real:!0,forced:!1},{some:function(e){var t=w(this),r=go(t),n=Ct(e,arguments.length>1?arguments[1]:void 0,3);return Jn(r,(function(e,r){if(n(r,e,t))return Jn.stop()}),void 0,!0,!0).stopped}});Fe({target:"Map",proto:!0,real:!0,forced:!1},{update:function(e,t){var r=w(this),n=arguments.length;Rt(t);var o=r.has(e);if(!o&&n<3)throw TypeError("Updating absent value");var i=o?r.get(e):Rt(n>2?arguments[2]:void 0)(e,r);return r.set(e,t(i,e,r)),r}});var Io=function(e,t){var r,n=w(this),o=arguments.length>2?arguments[2]:void 0;if("function"!=typeof t&&"function"!=typeof o)throw TypeError("At least one callback required");return n.has(e)?(r=n.get(e),"function"==typeof t&&(r=t(r),n.set(e,r))):"function"==typeof o&&(r=o(),n.set(e,r)),r};Fe({target:"Map",proto:!0,real:!0,forced:!1},{upsert:Io});Fe({target:"Map",proto:!0,real:!0,forced:!1},{updateOrInsert:Io});var bo,Ro="[\t\n\v\f\r                　\u2028\u2029\ufeff]",Co=RegExp("^"+Ro+Ro+"*"),Po=RegExp(Ro+Ro+"*$"),No={trim:(bo=3,function(e){var t=String(l(e));return 1&bo&&(t=t.replace(Co,"")),2&bo&&(t=t.replace(Po,"")),t})},Ao=be.f,Mo=ae.f,Lo=T.f,Do=No.trim,jo=h.Number,xo=jo.prototype,Uo="Number"==ne(lt(xo)),Bo=function(e){var t,r,n,o,i,s,a,u,c=g(e,!1);if("string"==typeof c&&c.length>2)if(43===(t=(c=Do(c)).charCodeAt(0))||45===t){if(88===(r=c.charCodeAt(2))||120===r)return NaN}else if(48===t){switch(c.charCodeAt(1)){case 66:case 98:n=2,o=49;break;case 79:case 111:n=8,o=55;break;default:return+c}for(s=(i=c.slice(2)).length,a=0;a<s;a++)if((u=i.charCodeAt(a))<48||u>o)return NaN;return parseInt(i,n)}return+c};if(qe("Number",!jo(" 0o1")||!jo("0b1")||jo("+0x1"))){for(var ko,qo=function(e){var t=arguments.length<1?0:e,r=this;return r instanceof qo&&(Uo?d((function(){xo.valueOf.call(r)})):"Number"!=ne(r))?eo(new jo(Bo(t)),r,qo):Bo(t)},Vo=y?Ao(jo):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),Fo=0;Vo.length>Fo;Fo++)j(jo,ko=Vo[Fo])&&!j(qo,ko)&&Lo(qo,ko,Mo(jo,ko));qo.prototype=xo,xo.constructor=qo,ce(h,"Number",qo)}Fe({target:"Number",stat:!0},{EPSILON:Math.pow(2,-52)});var Go=h.isFinite,Ho=Number.isFinite||function(e){return"number"==typeof e&&Go(e)};Fe({target:"Number",stat:!0},{isFinite:Ho});var Wo=Math.floor,Yo=function(e){return!v(e)&&isFinite(e)&&Wo(e)===e};Fe({target:"Number",stat:!0},{isInteger:Yo});Fe({target:"Number",stat:!0},{isNaN:function(e){return e!=e}});var zo=Math.abs;Fe({target:"Number",stat:!0},{isSafeInteger:function(e){return Yo(e)&&zo(e)<=9007199254740991}});Fe({target:"Number",stat:!0},{MAX_SAFE_INTEGER:9007199254740991});Fe({target:"Number",stat:!0},{MIN_SAFE_INTEGER:-9007199254740991});var Qo=No.trim,$o=h.parseFloat,Ko=1/$o("\t\n\v\f\r                　\u2028\u2029\ufeff-0")!=-1/0?function(e){var t=Qo(String(e)),r=$o(t);return 0===r&&"-"==t.charAt(0)?-0:r}:$o;Fe({target:"Number",stat:!0,forced:Number.parseFloat!=Ko},{parseFloat:Ko});var Jo=No.trim,Xo=h.parseInt,Zo=/^[+-]?0[Xx]/,ei=8!==Xo("\t\n\v\f\r                　\u2028\u2029\ufeff08")||22!==Xo("\t\n\v\f\r                　\u2028\u2029\ufeff0x16")?function(e,t){var r=Jo(String(e));return Xo(r,t>>>0||(Zo.test(r)?16:10))}:Xo;Fe({target:"Number",stat:!0,forced:Number.parseInt!=ei},{parseInt:ei});var ti=function(e){if("number"!=typeof e&&"Number"!=ne(e))throw TypeError("Incorrect invocation");return+e},ri="".repeat||function(e){var t=String(l(this)),r="",n=p(e);if(n<0||n==1/0)throw RangeError("Wrong number of repetitions");for(;n>0;(n>>>=1)&&(t+=t))1&n&&(r+=t);return r},ni=1..toFixed,oi=Math.floor,ii=function(e,t,r){return 0===t?r:t%2==1?ii(e,t-1,r*e):ii(e*e,t/2,r)},si=ni&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!d((function(){ni.call({})}));Fe({target:"Number",proto:!0,forced:si},{toFixed:function(e){var t,r,n,o,i=ti(this),s=p(e),a=[0,0,0,0,0,0],u="",c="0",l=function(e,t){for(var r=-1,n=t;++r<6;)n+=e*a[r],a[r]=n%1e7,n=oi(n/1e7)},f=function(e){for(var t=6,r=0;--t>=0;)r+=a[t],a[t]=oi(r/e),r=r%e*1e7},h=function(){for(var e=6,t="";--e>=0;)if(""!==t||0===e||0!==a[e]){var r=String(a[e]);t=""===t?r:t+ri.call("0",7-r.length)+r}return t};if(s<0||s>20)throw RangeError("Incorrect fraction digits");if(i!=i)return"NaN";if(i<=-1e21||i>=1e21)return String(i);if(i<0&&(u="-",i=-i),i>1e-21)if(r=(t=function(e){for(var t=0,r=e;r>=4096;)t+=12,r/=4096;for(;r>=2;)t+=1,r/=2;return t}(i*ii(2,69,1))-69)<0?i*ii(2,-t,1):i/ii(2,t,1),r*=4503599627370496,(t=52-t)>0){for(l(0,r),n=s;n>=7;)l(1e7,0),n-=7;for(l(ii(10,n,1),0),n=t-1;n>=23;)f(1<<23),n-=23;f(1<<n),l(1,1),f(2),c=h()}else l(0,r),l(1<<-t,0),c=h()+ri.call("0",s);return c=s>0?u+((o=c.length)<=s?"0."+ri.call("0",s-o)+c:c.slice(0,o-s)+"."+c.slice(o-s)):u+c}});var ai=1..toPrecision,ui=d((function(){return"1"!==ai.call(1,void 0)}))||!d((function(){ai.call({})}));Fe({target:"Number",proto:!0,forced:ui},{toPrecision:function(e){return void 0===e?ai.call(ti(this)):ai.call(ti(this),e)}});he.Number;var ci=/^[\da-z]+$/;Fe({target:"Number",stat:!0},{fromString:function(e,t){var r,n,o=1;if("string"!=typeof e)throw TypeError("Invalid number representation");if(!e.length)throw SyntaxError("Invalid number representation");if("-"==e.charAt(0)&&(o=-1,!(e=e.slice(1)).length))throw SyntaxError("Invalid number representation");if((r=void 0===t?10:p(t))<2||r>36)throw RangeError("Invalid radix");if(!ci.test(e)||(n=ei(e,r)).toString(r)!==e)throw SyntaxError("Invalid number representation");return o*n}});var pi,li=X.f,fi={values:(pi=!1,function(e){for(var t,r=se(e),n=ot(r),o=n.length,i=0,s=[];o>i;)t=n[i++],y&&!li.call(r,t)||s.push(pi?[t,r[t]]:r[t]);return s})}.values;Fe({target:"Object",stat:!0},{values:function(e){return fi(e)}});he.Object.values;var hi,di,yi,vi=h.Promise,_i=/(iphone|ipod|ipad).*applewebkit/i.test(Zt),Si=h.location,Ei=h.setImmediate,mi=h.clearImmediate,wi=h.process,gi=h.MessageChannel,Ti=h.Dispatch,Oi=0,Ii={},bi=function(e){if(Ii.hasOwnProperty(e)){var t=Ii[e];delete Ii[e],t()}},Ri=function(e){return function(){bi(e)}},Ci=function(e){bi(e.data)},Pi=function(e){h.postMessage(e+"",Si.protocol+"//"+Si.host)};Ei&&mi||(Ei=function(e){for(var t=[],r=1;arguments.length>r;)t.push(arguments[r++]);return Ii[++Oi]=function(){("function"==typeof e?e:Function(e)).apply(void 0,t)},hi(Oi),Oi},mi=function(e){delete Ii[e]},"process"==ne(wi)?hi=function(e){wi.nextTick(Ri(e))}:Ti&&Ti.now?hi=function(e){Ti.now(Ri(e))}:gi&&!_i?(yi=(di=new gi).port2,di.port1.onmessage=Ci,hi=Ct(yi.postMessage,yi,1)):!h.addEventListener||"function"!=typeof postMessage||h.importScripts||d(Pi)||"file:"===Si.protocol?hi="onreadystatechange"in E("script")?function(e){st.appendChild(E("script")).onreadystatechange=function(){st.removeChild(this),bi(e)}}:function(e){setTimeout(Ri(e),0)}:(hi=Pi,h.addEventListener("message",Ci,!1)));var Ni,Ai,Mi,Li,Di,ji,xi,Ui,Bi={set:Ei},ki=ae.f,qi=Bi.set,Vi=h.MutationObserver||h.WebKitMutationObserver,Fi=h.process,Gi=h.Promise,Hi="process"==ne(Fi),Wi=ki(h,"queueMicrotask"),Yi=Wi&&Wi.value;Yi||(Ni=function(){var e,t;for(Hi&&(e=Fi.domain)&&e.exit();Ai;){t=Ai.fn,Ai=Ai.next;try{t()}catch(e){throw Ai?Li():Mi=void 0,e}}Mi=void 0,e&&e.enter()},Hi?Li=function(){Fi.nextTick(Ni)}:Vi&&!_i?(Di=!0,ji=document.createTextNode(""),new Vi(Ni).observe(ji,{characterData:!0}),Li=function(){ji.data=Di=!Di}):Gi&&Gi.resolve?(xi=Gi.resolve(void 0),Ui=xi.then,Li=function(){Ui.call(xi,Ni)}):Li=function(){qi.call(h,Ni)});var zi=Yi||function(e){var t={fn:e,next:void 0};Mi&&(Mi.next=t),Ai||(Ai=t,Li()),Mi=t},Qi={},$i=function(e){var t,r;this.promise=new e((function(e,n){if(void 0!==t||void 0!==r)throw TypeError("Bad Promise constructor");t=e,r=n})),this.resolve=Rt(t),this.reject=Rt(r)};Qi.f=function(e){return new $i(e)};var Ki,Ji,Xi,Zi,es=function(e,t){if(w(e),v(t)&&t.constructor===e)return t;var r=Qi.f(e);return(0,r.resolve)(t),r.promise},ts=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}},rs=Bi.set,ns=Ze("species"),os="Promise",is=J.get,ss=J.set,as=J.getterFor(os),us=vi,cs=h.TypeError,ps=h.document,ls=h.process,fs=ye("fetch"),hs=Qi.f,ds=hs,ys="process"==ne(ls),vs=!!(ps&&ps.createEvent&&h.dispatchEvent),_s=qe(os,(function(){if(!(A(us)!==String(us))){if(66===nr)return!0;if(!ys&&"function"!=typeof PromiseRejectionEvent)return!0}if(nr>=51&&/native code/.test(us))return!1;var e=us.resolve(1),t=function(e){e((function(){}),(function(){}))};return(e.constructor={})[ns]=t,!(e.then((function(){}))instanceof t)})),Ss=_s||!Wt((function(e){us.all(e).catch((function(){}))})),Es=function(e){var t;return!(!v(e)||"function"!=typeof(t=e.then))&&t},ms=function(e,t,r){if(!t.notified){t.notified=!0;var n=t.reactions;zi((function(){for(var o=t.value,i=1==t.state,s=0;n.length>s;){var a,u,c,p=n[s++],l=i?p.ok:p.fail,f=p.resolve,h=p.reject,d=p.domain;try{l?(i||(2===t.rejection&&Os(e,t),t.rejection=1),!0===l?a=o:(d&&d.enter(),a=l(o),d&&(d.exit(),c=!0)),a===p.promise?h(cs("Promise-chain cycle")):(u=Es(a))?u.call(a,f,h):f(a)):h(o)}catch(e){d&&!c&&d.exit(),h(e)}}t.reactions=[],t.notified=!1,r&&!t.rejection&&gs(e,t)}))}},ws=function(e,t,r){var n,o;vs?((n=ps.createEvent("Event")).promise=t,n.reason=r,n.initEvent(e,!1,!0),h.dispatchEvent(n)):n={promise:t,reason:r},(o=h["on"+e])?o(n):"unhandledrejection"===e&&function(e,t){var r=h.console;r&&r.error&&(1===arguments.length?r.error(e):r.error(e,t))}("Unhandled promise rejection",r)},gs=function(e,t){rs.call(h,(function(){var r,n=t.value;if(Ts(t)&&(r=ts((function(){ys?ls.emit("unhandledRejection",n,e):ws("unhandledrejection",e,n)})),t.rejection=ys||Ts(t)?2:1,r.error))throw r.value}))},Ts=function(e){return 1!==e.rejection&&!e.parent},Os=function(e,t){rs.call(h,(function(){ys?ls.emit("rejectionHandled",e):ws("rejectionhandled",e,t.value)}))},Is=function(e,t,r,n){return function(o){e(t,r,o,n)}},bs=function(e,t,r,n){t.done||(t.done=!0,n&&(t=n),t.value=r,t.state=2,ms(e,t,!0))},Rs=function(e,t,r,n){if(!t.done){t.done=!0,n&&(t=n);try{if(e===r)throw cs("Promise can't be resolved itself");var o=Es(r);o?zi((function(){var n={done:!1};try{o.call(r,Is(Rs,e,n,t),Is(bs,e,n,t))}catch(r){bs(e,n,r,t)}})):(t.value=r,t.state=1,ms(e,t,!1))}catch(r){bs(e,{done:!1},r,t)}}};_s&&(us=function(e){Zn(this,us,os),Rt(e),Ki.call(this);var t=is(this);try{e(Is(Rs,this,t),Is(bs,this,t))}catch(e){bs(this,t,e)}},(Ki=function(e){ss(this,{type:os,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=ro(us.prototype,{then:function(e,t){var r=as(this),n=hs(Oo(this,us));return n.ok="function"!=typeof e||e,n.fail="function"==typeof t&&t,n.domain=ys?ls.domain:void 0,r.parent=!0,r.reactions.push(n),0!=r.state&&ms(this,r,!1),n.promise},catch:function(e){return this.then(void 0,e)}}),Ji=function(){var e=new Ki,t=is(e);this.promise=e,this.resolve=Is(Rs,e,t),this.reject=Is(bs,e,t)},Qi.f=hs=function(e){return e===us||e===Xi?new Ji(e):ds(e)},"function"==typeof vi&&(Zi=vi.prototype.then,ce(vi.prototype,"then",(function(e,t){var r=this;return new us((function(e,t){Zi.call(r,e,t)})).then(e,t)}),{unsafe:!0}),"function"==typeof fs&&Fe({global:!0,enumerable:!0,forced:!0},{fetch:function(e){return es(us,fs.apply(h,arguments))}}))),Fe({global:!0,wrap:!0,forced:_s},{Promise:us}),dt(us,os,!1),Dn(os),Xi=ye(os),Fe({target:os,stat:!0,forced:_s},{reject:function(e){var t=hs(this);return t.reject.call(void 0,e),t.promise}}),Fe({target:os,stat:!0,forced:_s},{resolve:function(e){return es(this,e)}}),Fe({target:os,stat:!0,forced:Ss},{all:function(e){var t=this,r=hs(t),n=r.resolve,o=r.reject,i=ts((function(){var r=Rt(t.resolve),i=[],s=0,a=1;Jn(e,(function(e){var u=s++,c=!1;i.push(void 0),a++,r.call(t,e).then((function(e){c||(c=!0,i[u]=e,--a||n(i))}),o)})),--a||n(i)}));return i.error&&o(i.value),r.promise},race:function(e){var t=this,r=hs(t),n=r.reject,o=ts((function(){var o=Rt(t.resolve);Jn(e,(function(e){o.call(t,e).then(r.resolve,n)}))}));return o.error&&n(o.value),r.promise}}),Fe({target:"Promise",stat:!0},{allSettled:function(e){var t=this,r=Qi.f(t),n=r.resolve,o=r.reject,i=ts((function(){var r=Rt(t.resolve),o=[],i=0,s=1;Jn(e,(function(e){var a=i++,u=!1;o.push(void 0),s++,r.call(t,e).then((function(e){u||(u=!0,o[a]={status:"fulfilled",value:e},--s||n(o))}),(function(e){u||(u=!0,o[a]={status:"rejected",reason:e},--s||n(o))}))})),--s||n(o)}));return i.error&&o(i.value),r.promise}});var Cs=!!vi&&d((function(){vi.prototype.finally.call({then:function(){}},(function(){}))}));Fe({target:"Promise",proto:!0,real:!0,forced:Cs},{finally:function(e){var t=Oo(this,ye("Promise")),r="function"==typeof e;return this.then(r?function(r){return es(t,e()).then((function(){return r}))}:e,r?function(r){return es(t,e()).then((function(){throw r}))}:e)}}),"function"!=typeof vi||vi.prototype.finally||ce(vi.prototype,"finally",ye("Promise").prototype.finally);he.Promise;var Ps=J.set,Ns=J.getterFor("AggregateError"),As=function(e,t){var r=this;if(!(r instanceof As))return new As(e,t);St&&(r=St(new Error(t),ze(r)));var n=[];return Jn(e,n.push,n),y?Ps(r,{errors:n,type:"AggregateError"}):r.errors=n,void 0!==t&&b(r,"message",String(t)),r};As.prototype=lt(Error.prototype,{constructor:I(5,As),message:I(5,""),name:I(5,"AggregateError")}),y&&T.f(As.prototype,"errors",{get:function(){return Ns(this).errors},configurable:!0}),Fe({global:!0},{AggregateError:As});Fe({target:"Promise",stat:!0},{try:function(e){var t=Qi.f(this),r=ts(e);return(r.error?t.reject:t.resolve)(r.value),t.promise}});Fe({target:"Promise",stat:!0},{any:function(e){var t=this,r=Qi.f(t),n=r.resolve,o=r.reject,i=ts((function(){var r=Rt(t.resolve),i=[],s=0,a=1,u=!1;Jn(e,(function(e){var c=s++,p=!1;i.push(void 0),a++,r.call(t,e).then((function(e){p||u||(u=!0,n(e))}),(function(e){p||u||(p=!0,i[c]=e,--a||o(new(ye("AggregateError"))(i,"No one promise resolved")))}))})),--a||o(new(ye("AggregateError"))(i,"No one promise resolved"))}));return i.error&&o(i.value),r.promise}});to("Set",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),ao),he.Set;Fe({target:"Set",stat:!0},{from:So});Fe({target:"Set",stat:!0},{of:Eo});var Ms=function(){for(var e=w(this),t=Rt(e.add),r=0,n=arguments.length;r<n;r++)t.call(e,arguments[r]);return e};Fe({target:"Set",proto:!0,real:!0,forced:!1},{addAll:function(){return Ms.apply(this,arguments)}});Fe({target:"Set",proto:!0,real:!0,forced:!1},{deleteAll:function(){return mo.apply(this,arguments)}});var Ls=function(e){return Set.prototype.values.call(e)};Fe({target:"Set",proto:!0,real:!0,forced:!1},{every:function(e){var t=w(this),r=Ls(t),n=Ct(e,arguments.length>1?arguments[1]:void 0,3);return!Jn(r,(function(e){if(!n(e,e,t))return Jn.stop()}),void 0,!1,!0).stopped}});Fe({target:"Set",proto:!0,real:!0,forced:!1},{difference:function(e){var t=w(this),r=new(Oo(t,ye("Set")))(t),n=Rt(r.delete);return Jn(e,(function(e){n.call(r,e)})),r}});Fe({target:"Set",proto:!0,real:!0,forced:!1},{filter:function(e){var t=w(this),r=Ls(t),n=Ct(e,arguments.length>1?arguments[1]:void 0,3),o=new(Oo(t,ye("Set"))),i=Rt(o.add);return Jn(r,(function(e){n(e,e,t)&&i.call(o,e)}),void 0,!1,!0),o}});Fe({target:"Set",proto:!0,real:!0,forced:!1},{find:function(e){var t=w(this),r=Ls(t),n=Ct(e,arguments.length>1?arguments[1]:void 0,3);return Jn(r,(function(e){if(n(e,e,t))return Jn.stop(e)}),void 0,!1,!0).result}});Fe({target:"Set",proto:!0,real:!0,forced:!1},{intersection:function(e){var t=w(this),r=new(Oo(t,ye("Set"))),n=Rt(t.has),o=Rt(r.add);return Jn(e,(function(e){n.call(t,e)&&o.call(r,e)})),r}});Fe({target:"Set",proto:!0,real:!0,forced:!1},{isDisjointFrom:function(e){var t=w(this),r=Rt(t.has);return!Jn(e,(function(e){if(!0===r.call(t,e))return Jn.stop()})).stopped}});Fe({target:"Set",proto:!0,real:!0,forced:!1},{isSubsetOf:function(e){var t=wo(this),r=w(e),n=r.has;return"function"!=typeof n&&(r=new(ye("Set"))(e),n=Rt(r.has)),!Jn(t,(function(e){if(!1===n.call(r,e))return Jn.stop()}),void 0,!1,!0).stopped}});Fe({target:"Set",proto:!0,real:!0,forced:!1},{isSupersetOf:function(e){var t=w(this),r=Rt(t.has);return!Jn(e,(function(e){if(!1===r.call(t,e))return Jn.stop()})).stopped}});Fe({target:"Set",proto:!0,real:!0,forced:!1},{join:function(e){var t=w(this),r=Ls(t),n=void 0===e?",":String(e),o=[];return Jn(r,o.push,o,!1,!0),o.join(n)}});Fe({target:"Set",proto:!0,real:!0,forced:!1},{map:function(e){var t=w(this),r=Ls(t),n=Ct(e,arguments.length>1?arguments[1]:void 0,3),o=new(Oo(t,ye("Set"))),i=Rt(o.add);return Jn(r,(function(e){i.call(o,n(e,e,t))}),void 0,!1,!0),o}});Fe({target:"Set",proto:!0,real:!0,forced:!1},{reduce:function(e){var t=w(this),r=Ls(t),n=arguments.length<2,o=n?void 0:arguments[1];if(Rt(e),Jn(r,(function(r){n?(n=!1,o=r):o=e(o,r,r,t)}),void 0,!1,!0),n)throw TypeError("Reduce of empty set with no initial value");return o}});Fe({target:"Set",proto:!0,real:!0,forced:!1},{some:function(e){var t=w(this),r=Ls(t),n=Ct(e,arguments.length>1?arguments[1]:void 0,3);return Jn(r,(function(e){if(n(e,e,t))return Jn.stop()}),void 0,!1,!0).stopped}});Fe({target:"Set",proto:!0,real:!0,forced:!1},{symmetricDifference:function(e){var t=w(this),r=new(Oo(t,ye("Set")))(t),n=Rt(r.delete),o=Rt(r.add);return Jn(e,(function(e){n.call(r,e)||o.call(r,e)})),r}});Fe({target:"Set",proto:!0,real:!0,forced:!1},{union:function(e){var t=w(this),r=new(Oo(t,ye("Set")))(t);return Jn(e,Rt(r.add),r),r}});var Ds={};Object.defineProperty(Ds,"__esModule",{value:!0});var js=function(){function e(e,t){this.currentTimeout=null,this.pingTimeout=e,this.connection=t,this.currentTimeout=setTimeout(t.closeIdleConnection.bind(t),e)}return e.prototype.onSystemPing=function(){var e=this;null!==this.currentTimeout&&(clearTimeout(this.currentTimeout),this.currentTimeout=setTimeout((function(){e.connection.closeIdleConnection()}),this.pingTimeout))},e.prototype.shutdown=function(){null!==this.currentTimeout&&(clearTimeout(this.currentTimeout),this.currentTimeout=null)},e}();Ds.ConnectionActivityMonitorImpl=js;var xs={};Object.defineProperty(xs,"__esModule",{value:!0});var Us={onSystemPing:function(){},shutdown:function(){}};xs.connectionActivityMonitorFactory=function(e,t){if(!t.systemPingPeriod)return Us;var r=t.systemPingPeriod.toNumber();if(r>0){var n=2*r;return new Ds.ConnectionActivityMonitorImpl(n,e)}return Us};var Bs={};Object.defineProperty(Bs,"__esModule",{value:!0});var ks=function(){function e(e){this.factory=e}return e.prototype.onNewConnection=function(e,t){this.currentConnectionMonitor=this.factory(e,t)},e.prototype.onConnectionClosed=function(){void 0!==this.currentConnectionMonitor&&(this.currentConnectionMonitor.shutdown(),this.currentConnectionMonitor=void 0)},e.prototype.onSystemPing=function(){void 0!==this.currentConnectionMonitor&&this.currentConnectionMonitor.onSystemPing()},e}();Bs.NOOP={onNewConnection:function(){},onConnectionClosed:function(){},onSystemPing:function(){}},Bs.create=function(e){return new ks(e)};var qs={};Object.defineProperty(qs,"__esModule",{value:!0}),function(e){e.INITIALISING="initialising",e.CONNECTING="connecting",e.CONNECTED="connected",e.DISCONNECTED="disconnected",e.RECONNECTING="reconnecting",e.CLOSING="closing",e.CLOSED="closed"}(qs.InternalSessionState||(qs.InternalSessionState={}));var Vs={};Object.defineProperty(Vs,"__esModule",{value:!0});var Fs=function(){function e(e,t){this.id=e,this.reason=t}return e.prototype.toString=function(){return this.id+": "+this.reason},e}();Vs.ErrorReason=Fs;var Gs=Ws,Hs=null;try{Hs=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(e){}function Ws(e,t,r){this.low=0|e,this.high=0|t,this.unsigned=!!r}function Ys(e){return!0===(e&&e.__isLong__)}Ws.prototype.__isLong__,Object.defineProperty(Ws.prototype,"__isLong__",{value:!0}),Ws.isLong=Ys;var zs={},Qs={};function $s(e,t){var r,n,o;return t?(o=0<=(e>>>=0)&&e<256)&&(n=Qs[e])?n:(r=Js(e,(0|e)<0?-1:0,!0),o&&(Qs[e]=r),r):(o=-128<=(e|=0)&&e<128)&&(n=zs[e])?n:(r=Js(e,e<0?-1:0,!1),o&&(zs[e]=r),r)}function Ks(e,t){if(isNaN(e))return t?sa:ia;if(t){if(e<0)return sa;if(e>=ra)return la}else{if(e<=-na)return fa;if(e+1>=na)return pa}return e<0?Ks(-e,t).neg():Js(e%ta|0,e/ta|0,t)}function Js(e,t,r){return new Ws(e,t,r)}Ws.fromInt=$s,Ws.fromNumber=Ks,Ws.fromBits=Js;var Xs=Math.pow;function Zs(e,t,r){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return ia;if("number"==typeof t?(r=t,t=!1):t=!!t,(r=r||10)<2||36<r)throw RangeError("radix");var n;if((n=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===n)return Zs(e.substring(1),t,r).neg();for(var o=Ks(Xs(r,8)),i=ia,s=0;s<e.length;s+=8){var a=Math.min(8,e.length-s),u=parseInt(e.substring(s,s+a),r);if(a<8){var c=Ks(Xs(r,a));i=i.mul(c).add(Ks(u))}else i=(i=i.mul(o)).add(Ks(u))}return i.unsigned=t,i}function ea(e,t){return"number"==typeof e?Ks(e,t):"string"==typeof e?Zs(e,t):Js(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}Ws.fromString=Zs,Ws.fromValue=ea;var ta=4294967296,ra=ta*ta,na=ra/2,oa=$s(1<<24),ia=$s(0);Ws.ZERO=ia;var sa=$s(0,!0);Ws.UZERO=sa;var aa=$s(1);Ws.ONE=aa;var ua=$s(1,!0);Ws.UONE=ua;var ca=$s(-1);Ws.NEG_ONE=ca;var pa=Js(-1,2147483647,!1);Ws.MAX_VALUE=pa;var la=Js(-1,-1,!0);Ws.MAX_UNSIGNED_VALUE=la;var fa=Js(0,-2147483648,!1);Ws.MIN_VALUE=fa;var ha=Ws.prototype;ha.toInt=function(){return this.unsigned?this.low>>>0:this.low},ha.toNumber=function(){return this.unsigned?(this.high>>>0)*ta+(this.low>>>0):this.high*ta+(this.low>>>0)},ha.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(fa)){var t=Ks(e),r=this.div(t),n=r.mul(t).sub(this);return r.toString(e)+n.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var o=Ks(Xs(e,6),this.unsigned),i=this,s="";;){var a=i.div(o),u=(i.sub(a.mul(o)).toInt()>>>0).toString(e);if((i=a).isZero())return u+s;for(;u.length<6;)u="0"+u;s=""+u+s}},ha.getHighBits=function(){return this.high},ha.getHighBitsUnsigned=function(){return this.high>>>0},ha.getLowBits=function(){return this.low},ha.getLowBitsUnsigned=function(){return this.low>>>0},ha.getNumBitsAbs=function(){if(this.isNegative())return this.eq(fa)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},ha.isZero=function(){return 0===this.high&&0===this.low},ha.eqz=ha.isZero,ha.isNegative=function(){return!this.unsigned&&this.high<0},ha.isPositive=function(){return this.unsigned||this.high>=0},ha.isOdd=function(){return 1==(1&this.low)},ha.isEven=function(){return 0==(1&this.low)},ha.equals=function(e){return Ys(e)||(e=ea(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&(this.high===e.high&&this.low===e.low)},ha.eq=ha.equals,ha.notEquals=function(e){return!this.eq(e)},ha.neq=ha.notEquals,ha.ne=ha.notEquals,ha.lessThan=function(e){return this.comp(e)<0},ha.lt=ha.lessThan,ha.lessThanOrEqual=function(e){return this.comp(e)<=0},ha.lte=ha.lessThanOrEqual,ha.le=ha.lessThanOrEqual,ha.greaterThan=function(e){return this.comp(e)>0},ha.gt=ha.greaterThan,ha.greaterThanOrEqual=function(e){return this.comp(e)>=0},ha.gte=ha.greaterThanOrEqual,ha.ge=ha.greaterThanOrEqual,ha.compare=function(e){if(Ys(e)||(e=ea(e)),this.eq(e))return 0;var t=this.isNegative(),r=e.isNegative();return t&&!r?-1:!t&&r?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},ha.comp=ha.compare,ha.negate=function(){return!this.unsigned&&this.eq(fa)?fa:this.not().add(aa)},ha.neg=ha.negate,ha.add=function(e){Ys(e)||(e=ea(e));var t=this.high>>>16,r=65535&this.high,n=this.low>>>16,o=65535&this.low,i=e.high>>>16,s=65535&e.high,a=e.low>>>16,u=0,c=0,p=0,l=0;return p+=(l+=o+(65535&e.low))>>>16,c+=(p+=n+a)>>>16,u+=(c+=r+s)>>>16,u+=t+i,Js((p&=65535)<<16|(l&=65535),(u&=65535)<<16|(c&=65535),this.unsigned)},ha.subtract=function(e){return Ys(e)||(e=ea(e)),this.add(e.neg())},ha.sub=ha.subtract,ha.multiply=function(e){if(this.isZero())return ia;if(Ys(e)||(e=ea(e)),Hs)return Js(Hs.mul(this.low,this.high,e.low,e.high),Hs.get_high(),this.unsigned);if(e.isZero())return ia;if(this.eq(fa))return e.isOdd()?fa:ia;if(e.eq(fa))return this.isOdd()?fa:ia;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(oa)&&e.lt(oa))return Ks(this.toNumber()*e.toNumber(),this.unsigned);var t=this.high>>>16,r=65535&this.high,n=this.low>>>16,o=65535&this.low,i=e.high>>>16,s=65535&e.high,a=e.low>>>16,u=65535&e.low,c=0,p=0,l=0,f=0;return l+=(f+=o*u)>>>16,p+=(l+=n*u)>>>16,l&=65535,p+=(l+=o*a)>>>16,c+=(p+=r*u)>>>16,p&=65535,c+=(p+=n*a)>>>16,p&=65535,c+=(p+=o*s)>>>16,c+=t*u+r*a+n*s+o*i,Js((l&=65535)<<16|(f&=65535),(c&=65535)<<16|(p&=65535),this.unsigned)},ha.mul=ha.multiply,ha.divide=function(e){if(Ys(e)||(e=ea(e)),e.isZero())throw Error("division by zero");var t,r,n;if(Hs)return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?Js((this.unsigned?Hs.div_u:Hs.div_s)(this.low,this.high,e.low,e.high),Hs.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?sa:ia;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return sa;if(e.gt(this.shru(1)))return ua;n=sa}else{if(this.eq(fa))return e.eq(aa)||e.eq(ca)?fa:e.eq(fa)?aa:(t=this.shr(1).div(e).shl(1)).eq(ia)?e.isNegative()?aa:ca:(r=this.sub(e.mul(t)),n=t.add(r.div(e)));if(e.eq(fa))return this.unsigned?sa:ia;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();n=ia}for(r=this;r.gte(e);){t=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));for(var o=Math.ceil(Math.log(t)/Math.LN2),i=o<=48?1:Xs(2,o-48),s=Ks(t),a=s.mul(e);a.isNegative()||a.gt(r);)a=(s=Ks(t-=i,this.unsigned)).mul(e);s.isZero()&&(s=aa),n=n.add(s),r=r.sub(a)}return n},ha.div=ha.divide,ha.modulo=function(e){return Ys(e)||(e=ea(e)),Hs?Js((this.unsigned?Hs.rem_u:Hs.rem_s)(this.low,this.high,e.low,e.high),Hs.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},ha.mod=ha.modulo,ha.rem=ha.modulo,ha.not=function(){return Js(~this.low,~this.high,this.unsigned)},ha.and=function(e){return Ys(e)||(e=ea(e)),Js(this.low&e.low,this.high&e.high,this.unsigned)},ha.or=function(e){return Ys(e)||(e=ea(e)),Js(this.low|e.low,this.high|e.high,this.unsigned)},ha.xor=function(e){return Ys(e)||(e=ea(e)),Js(this.low^e.low,this.high^e.high,this.unsigned)},ha.shiftLeft=function(e){return Ys(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?Js(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):Js(0,this.low<<e-32,this.unsigned)},ha.shl=ha.shiftLeft,ha.shiftRight=function(e){return Ys(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?Js(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):Js(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},ha.shr=ha.shiftRight,ha.shiftRightUnsigned=function(e){if(Ys(e)&&(e=e.toInt()),0===(e&=63))return this;var t=this.high;return e<32?Js(this.low>>>e|t<<32-e,t>>>e,this.unsigned):Js(32===e?t:t>>>e-32,0,this.unsigned)},ha.shru=ha.shiftRightUnsigned,ha.shr_u=ha.shiftRightUnsigned,ha.toSigned=function(){return this.unsigned?Js(this.low,this.high,!1):this},ha.toUnsigned=function(){return this.unsigned?this:Js(this.low,this.high,!0)},ha.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},ha.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},ha.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},Ws.fromBytes=function(e,t,r){return r?Ws.fromBytesLE(e,t):Ws.fromBytesBE(e,t)},Ws.fromBytesLE=function(e,t){return new Ws(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},Ws.fromBytesBE=function(e,t){return new Ws(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};var da={};Object.defineProperty(da,"__esModule",{value:!0});var ya=function(){function e(e){this.val=e}return e.fromString=function(t){return new e(Gs.fromString(t,!1))},e.prototype.toString=function(){return this.val.toString(10)},e.prototype.equals=function(e){return e.val&&this.val.equals(e.val)},e}();da.ConversationId=ya,da.ONEWAY_CID=new ya(Gs.fromNumber(0));for(var va={toByteArray:function(e){var t,r,n=Ta(e),o=n[0],i=n[1],s=new Ea(function(e,t,r){return 3*(t+r)/4-r}(0,o,i)),a=0,u=i>0?o-4:o;for(r=0;r<u;r+=4)t=Sa[e.charCodeAt(r)]<<18|Sa[e.charCodeAt(r+1)]<<12|Sa[e.charCodeAt(r+2)]<<6|Sa[e.charCodeAt(r+3)],s[a++]=t>>16&255,s[a++]=t>>8&255,s[a++]=255&t;2===i&&(t=Sa[e.charCodeAt(r)]<<2|Sa[e.charCodeAt(r+1)]>>4,s[a++]=255&t);1===i&&(t=Sa[e.charCodeAt(r)]<<10|Sa[e.charCodeAt(r+1)]<<4|Sa[e.charCodeAt(r+2)]>>2,s[a++]=t>>8&255,s[a++]=255&t);return s},fromByteArray:function(e){for(var t,r=e.length,n=r%3,o=[],i=0,s=r-n;i<s;i+=16383)o.push(Oa(e,i,i+16383>s?s:i+16383));1===n?(t=e[r-1],o.push(_a[t>>2]+_a[t<<4&63]+"==")):2===n&&(t=(e[r-2]<<8)+e[r-1],o.push(_a[t>>10]+_a[t>>4&63]+_a[t<<2&63]+"="));return o.join("")}},_a=[],Sa=[],Ea="undefined"!=typeof Uint8Array?Uint8Array:Array,ma="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",wa=0,ga=ma.length;wa<ga;++wa)_a[wa]=ma[wa],Sa[ma.charCodeAt(wa)]=wa;function Ta(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function Oa(e,t,r){for(var n,o,i=[],s=t;s<r;s+=3)n=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),i.push(_a[(o=n)>>18&63]+_a[o>>12&63]+_a[o>>6&63]+_a[63&o]);return i.join("")}Sa["-".charCodeAt(0)]=62,Sa["_".charCodeAt(0)]=63;var Ia={read:function(e,t,r,n,o){var i,s,a=8*o-n-1,u=(1<<a)-1,c=u>>1,p=-7,l=r?o-1:0,f=r?-1:1,h=e[t+l];for(l+=f,i=h&(1<<-p)-1,h>>=-p,p+=a;p>0;i=256*i+e[t+l],l+=f,p-=8);for(s=i&(1<<-p)-1,i>>=-p,p+=n;p>0;s=256*s+e[t+l],l+=f,p-=8);if(0===i)i=1-c;else{if(i===u)return s?NaN:1/0*(h?-1:1);s+=Math.pow(2,n),i-=c}return(h?-1:1)*s*Math.pow(2,i-n)},write:function(e,t,r,n,o,i){var s,a,u,c=8*i-o-1,p=(1<<c)-1,l=p>>1,f=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,h=n?0:i-1,d=n?1:-1,y=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=p):(s=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-s))<1&&(s--,u*=2),(t+=s+l>=1?f/u:f*Math.pow(2,1-l))*u>=2&&(s++,u/=2),s+l>=p?(a=0,s=p):s+l>=1?(a=(t*u-1)*Math.pow(2,o),s+=l):(a=t*Math.pow(2,l-1)*Math.pow(2,o),s=0));o>=8;e[r+h]=255&a,h+=d,a/=256,o-=8);for(s=s<<o|a,c+=o;c>0;e[r+h]=255&s,h+=d,s/=256,c-=8);e[r+h-d]|=128*y}},ba={};(function(e){"use strict";var t=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(ba,"__esModule",{value:!0});var r=Gs.fromNumber(128),n=Gs.fromNumber(127),o=n.not();function i(e){var t=e.read();if(-1===t)throw new Error("End of stream");return t}function s(e){for(var t=0,r=0;t<32;){var n=i(e);if(r|=(127&n)<<t,0==(128&n))return r;t+=7}throw new Error("Malformed int32")}function a(e,t){for(;0!=(-128&t);)e.write(127&t|128),t>>>=7;e.write(t)}function u(e){var t=s(e);return e.readMany(t)}function c(e,t){a(e,t.length),e.writeMany(t)}function p(e){var t=u(e);return t?t.toString("utf8"):""}function l(t,r){c(t,e.from(r,"utf8"))}function f(e,r,n,o){var i,s;a(e,Object.keys(r).length);try{for(var u=t(Object.getOwnPropertyNames(r)),c=u.next();!c.done;c=u.next()){var p=c.value;n(e,p),o(e,r[p])}}catch(e){i={error:e}}finally{try{c&&!c.done&&(s=u.return)&&s.call(u)}finally{if(i)throw i.error}}}function h(e,t,r){for(var n=s(e),o={},i=0;i<n;++i){o[t(e)]=r(e)}return o}ba.readByte=i,ba.readInt64=function(e){for(var t=Gs.fromNumber(0),o=0;o<64;){var s=i(e),a=Gs.fromNumber(s);if(t=t.or(a.and(n).shiftLeft(o)),a.and(r).equals(0))return t;o+=7}throw new Error("Malformed int64")},ba.writeInt64=function(e,t){for(var i=t instanceof Gs?t:Gs.fromNumber(t,!1);!i.and(o).equals(0);)e.write(i.and(n).or(r).toInt()),i=i.shiftRightUnsigned(7);e.write(i.toInt())},ba.readInt32=s,ba.writeInt32=a,ba.writeByte=function(e,t){e.write(t)},ba.readBytes=u,ba.writeBytes=c,ba.readString=p,ba.writeString=l,ba.writeCollection=function(e,r,n){var o,i;a(e,r.length);try{for(var s=t(r),u=s.next();!u.done;u=s.next()){n(e,u.value)}}catch(e){o={error:e}}finally{try{u&&!u.done&&(i=s.return)&&i.call(s)}finally{if(o)throw o.error}}},ba.readCollection=function(e,t){for(var r=s(e),n=[],o=0;o<r;++o)n.push(t(e));return n},ba.readDictionary=function(e,t){return h(e,p,t)},ba.writeDictionary=function(e,t,r){f(e,t,l,r)},ba.writeObject=f,ba.readObject=h,ba.readMap=function(e,t,r){for(var n=s(e),o=new Map,i=0;i<n;++i){var a=t(e);o.set(a,r(e))}return o},ba.writeMap=function(e,t,r,n){a(e,t.size),t.forEach((function(t,o){r(e,o),n(e,t)}))},ba.readBoolean=function(e){return 0!==e.readInt8()},ba.writeBoolean=function(e,t){e.writeInt8(t?1:0)}}).call(this,a({}).Buffer);var Ra={};Object.defineProperty(Ra,"__esModule",{value:!0});var Ca=function(){function e(){}return e.prototype.read=function(e){return new da.ConversationId(ba.readInt64(e))},e.prototype.write=function(e,t){ba.writeInt64(e,t.val)},e}();Ra.CIDSerialiser=new Ca;var Pa={};Object.defineProperty(Pa,"__esModule",{value:!0});var Na=function(){function e(){}return e.prototype.read=function(e){throw new Error("AbstractSerialiser#read is not implemented")},e.prototype.write=function(e,t){throw new Error("AbstractSerialiser#write is not implemented")},e}();Pa.AbstractSerialiser=Na;var Aa={};Object.defineProperty(Aa,"__esModule",{value:!0});var Ma=function(){function e(e,t){this.service=e,this.cid=t}return e.createRequestHeader=function(t,r){return new e(t,r)},e.prototype.createResponseHeader=function(){return new e(this.service,this.cid)},e.prototype.createErrorHeader=function(){return new e(this.service,this.cid)},e.prototype.toString=function(){return"<"+this.service+", "+this.cid.toString()+">"},e}();Aa.CommandHeader=Ma;var La,Da={},ja=this&&this.__extends||(La=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}La(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(Da,"__esModule",{value:!0});var xa=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ja(t,e),t.prototype.read=function(e){var t=ba.readInt32(e),r=Ra.CIDSerialiser.read(e);return new Aa.CommandHeader(t,r)},t.prototype.write=function(e,t){ba.writeInt32(e,t.service),Ra.CIDSerialiser.write(e,t.cid)},t}(Pa.AbstractSerialiser),Ua=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ja(t,e),t.prototype.write=function(e,t){Ra.CIDSerialiser.write(e,t.cid)},t.prototype.read=function(e){var t=Ra.CIDSerialiser.read(e);return new Aa.CommandHeader(0,t)},t}(Pa.AbstractSerialiser);Da.CommandHeaderSerialiser=new xa,Da.ResponseCommandHeaderSerialiser=new Ua;var Ba={exports:{}};!function(e,t){"use strict";Ba.exports?Ba.exports=t():e.log=t()}(this,(function(){"use strict";var e=function(){},t=["trace","debug","info","warn","error"];function r(e,t){var r=e[t];if("function"==typeof r.bind)return r.bind(e);try{return Function.prototype.bind.call(r,e)}catch(t){return function(){return Function.prototype.apply.apply(r,[e,arguments])}}}function n(t){return"debug"===t&&(t="log"),"undefined"!=typeof console&&(void 0!==console[t]?r(console,t):void 0!==console.log?r(console,"log"):e)}function o(r,n){for(var o=0;o<t.length;o++){var i=t[o];this[i]=o<r?e:this.methodFactory(i,r,n)}this.log=this.debug}function i(e,t,r){return function(){"undefined"!=typeof console&&(o.call(this,t,r),this[e].apply(this,arguments))}}function s(e,t,r){return n(e)||i.apply(this,arguments)}function a(e,r,n){var i,a=this,u="loglevel";function c(){var e;if("undefined"!=typeof window){try{e=window.localStorage[u]}catch(e){}if(void 0===e)try{var t=window.document.cookie,r=t.indexOf(encodeURIComponent(u)+"=");-1!==r&&(e=/^([^;]+)/.exec(t.slice(r))[1])}catch(e){}return void 0===a.levels[e]&&(e=void 0),e}}e&&(u+=":"+e),a.name=e,a.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},a.methodFactory=n||s,a.getLevel=function(){return i},a.setLevel=function(r,n){if("string"==typeof r&&void 0!==a.levels[r.toUpperCase()]&&(r=a.levels[r.toUpperCase()]),!("number"==typeof r&&r>=0&&r<=a.levels.SILENT))throw"log.setLevel() called with invalid level: "+r;if(i=r,!1!==n&&function(e){var r=(t[e]||"silent").toUpperCase();if("undefined"!=typeof window){try{return void(window.localStorage[u]=r)}catch(e){}try{window.document.cookie=encodeURIComponent(u)+"="+r+";"}catch(e){}}}(r),o.call(a,r,e),"undefined"==typeof console&&r<a.levels.SILENT)return"No console available for logging"},a.setDefaultLevel=function(e){c()||a.setLevel(e,!1)},a.enableAll=function(e){a.setLevel(a.levels.TRACE,e)},a.disableAll=function(e){a.setLevel(a.levels.SILENT,e)};var p=c();null==p&&(p=null==r?"WARN":r),a.setLevel(p,!1)}var u=new a,c={};u.getLogger=function(e){if("string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=c[e];return t||(t=c[e]=new a(e,u.getLevel(),u.methodFactory)),t};var p="undefined"!=typeof window?window.log:void 0;return u.noConflict=function(){return"undefined"!=typeof window&&window.log===u&&(window.log=p),u},u.getLoggers=function(){return c},u})),Ba=Ba.exports;var ka,qa={},Va=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};function Fa(e,t){var r="|"+e.toUpperCase()+"|"+t+"|",n=function(){return new Date};return function(t,o){o?Ba[e](n()+r+t,o):Ba[e](n()+r+t)}}Object.defineProperty(qa,"__esModule",{value:!0}),function(e){e.trace="trace",e.debug="debug",e.info="info",e.warn="warn",e.error="error"}(ka=qa.LoggingLevel||(qa.LoggingLevel={})),qa.create=function(e){var t,r,n={};try{for(var o=Va(Object.keys(ka)),i=o.next();!i.done;i=o.next()){var s=i.value;n[s]=Fa(s,e)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}return n},qa.setLevel=Ba.setLevel;var Ga={};Object.defineProperty(Ga,"__esModule",{value:!0});var Ha=function(){function e(e){this.buffer=e,this.count=e.length,this.pos=0}return e.prototype.read=function(){return this.pos<this.count?255&this.buffer[this.pos++]:-1},e.prototype.peek=function(){return this.pos<this.count?255&this.buffer[this.pos]:-1},e.prototype.readMany=function(e){var t=Math.min(e,this.count-this.pos);if(t<0)throw new Error("Length out of bounds");var r=this.buffer.slice(this.pos,this.pos+t);return this.pos+=t,r},e.prototype.readUntil=function(e){for(var t=this.count,r=this.pos;r<this.count;r++)if(this.buffer[r]===e){t=r;break}var n=this.buffer.slice(this.pos,t);return this.pos=t===this.count?t:t+1,n},e.prototype.readInt8=function(){return this.buffer.readInt8(this.pos++)},e.prototype.readInt32=function(){var e=this.buffer.readInt32BE(this.pos);return this.pos+=4,e},e.prototype.readInt64=function(){var e=this.buffer.readInt32BE(this.pos);this.pos+=4;var t=this.buffer.readInt32BE(this.pos);return this.pos+=4,Gs.fromBits(t,e,!1)},e.prototype.readUInt64=function(){var e=this.buffer.readInt32BE(this.pos);this.pos+=4;var t=this.buffer.readInt32BE(this.pos);return this.pos+=4,Gs.fromBits(t,e,!0)},e.prototype.hasRemaining=function(){return this.pos<this.buffer.length},e}();Ga.BufferInputStream=Ha;var Wa={};(function(e){"use strict";Object.defineProperty(Wa,"__esModule",{value:!0});var t=function(){function t(t){void 0===t&&(t=32),"number"==typeof t?(this.buffer=e.alloc(t),this.count=0):(this.buffer=t,this.count=t.length)}return t.prototype.write=function(e){this.ensureCapacity(this.count+1),this.buffer[this.count++]=e},t.prototype.writeMany=function(e,t,r){void 0===t&&(t=0),void 0===r&&(r=e.length),0!==r&&(this.ensureCapacity(this.count+r),e.copy(this.buffer,this.count,t,t+r),this.count+=r)},t.prototype.writeString=function(t){var r=e.byteLength(t);this.ensureCapacity(this.count+r),this.buffer.write(t,this.count,r),this.count+=r},t.prototype.writeInt8=function(e){this.ensureCapacity(this.count+1),this.buffer.writeInt8(e,this.count++)},t.prototype.writeInt32=function(e){this.ensureCapacity(this.count+4),this.buffer.writeInt32BE(e,this.count),this.count+=4},t.prototype.writeInt64=function(e){this.ensureCapacity(this.count+8),this.buffer.writeInt32BE(e.getHighBits(),this.count),this.buffer.writeInt32BE(e.getLowBits(),this.count+4),this.count+=8},t.prototype.getBuffer=function(){return this.buffer.slice(0,this.count)},t.prototype.getBase64=function(){return this.getBuffer().toString("base64")},t.prototype.ensureCapacity=function(e){e-this.buffer.length>0&&this.grow(e)},t.prototype.grow=function(t){var r=this.buffer.length<<1;r-t<0&&(r=t);try{var n=e.alloc(r);this.buffer.copy(n),this.buffer=n}catch(e){throw new Error("Unable to resize BufferOutputStream to "+r)}},t}();Wa.BufferOutputStream=t}).call(this,a({}).Buffer);var Ya={};Object.defineProperty(Ya,"__esModule",{value:!0}),Ya.PROTOCOL={TYPE:"WB",CAPABILITIES:function(){try{if(require("zlib"))return!0}catch(e){return!1}return!1}()?10:8,PROTOCOL_BYTE:35,CURRENT_VERSION:21};var za={};Object.defineProperty(za,"__esModule",{value:!0});var Qa=function(){function e(e,t){this.encodingByte=e,this.messageTypeFlags=t}return e.extractMessageType=function(e){return-11000001&e},e.extractMessageEncoding=function(e){return 128===(11e6&e)?za.EncodingType.ZLIB:za.EncodingType.NO_ENCODING},e}();za.MessageEncoding=Qa,za.EncodingType={NO_ENCODING:new Qa(0,0),ZLIB:new Qa(18,1)};var $a={};Object.defineProperty($a,"__esModule",{value:!0}),$a.isObjectAs=function(e){return e instanceof Object};var Ka={};(function(e){"use strict";var t=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(Ka,"__esModule",{value:!0});var r,n,o,i=qa.create("Message");10===Ya.PROTOCOL.CAPABILITIES?r=s({}):(i.warn("Per message compression is disabled because 'zlib' bundle is not included"),r=null),function(e){e[e.SERVICE_REQUEST=0]="SERVICE_REQUEST",e[e.SERVICE_RESPONSE=6]="SERVICE_RESPONSE",e[e.SERVICE_ERROR=7]="SERVICE_ERROR",e[e.TOPIC_VALUE=4]="TOPIC_VALUE",e[e.TOPIC_DELTA=5]="TOPIC_DELTA",e[e.ABORT_NOTIFICATION=28]="ABORT_NOTIFICATION",e[e.CLOSE_REQUEST=29]="CLOSE_REQUEST",e[e.FETCH_REPLY=34]="FETCH_REPLY"}(n=Ka.types||(Ka.types={})),function(e){e[e.NONE=0]="NONE",e[e.ENCRYPTION_REQUESTED=1]="ENCRYPTION_REQUESTED",e[e.COMPRESSION_REQUESTED=2]="COMPRESSION_REQUESTED",e[e.BASE64_REQUESTED=3]="BASE64_REQUESTED",e[e.ENCRYPTED=17]="ENCRYPTED",e[e.COMPRESSED=18]="COMPRESSED",e[e.BASE64=19]="BASE64"}(o=Ka.encoding||(Ka.encoding={}));var a=function(){function e(e,t,r,n,o){this.type=e,this.encoding=t,this.id=r.id,this.topic=r.topic,this.data=n,this.headers=o}return e.prototype.getInputStream=function(){return new Ga.BufferInputStream(this.data)},e}(),u=function(e){function r(t){var r=e.call(this,t.type,t.encoding,t,t.buffer,t.headers)||this;return r.stream=new Wa.BufferOutputStream(t.buffer),r}return t(r,e),r.prototype.getStream=function(){return this.stream},r.prototype.getBuffer=function(){return this.stream.getBuffer()},r}(a);Ka.parse=function(e,t){var i=new Ga.BufferInputStream(e),s=i.read(),u=za.MessageEncoding.extractMessageType(s),c=za.MessageEncoding.extractMessageEncoding(s);if(void 0===n[u]&&t(new Error("Invalid message type: "+u),null),u===n.SERVICE_REQUEST||u===n.SERVICE_RESPONSE||u===n.SERVICE_ERROR)t(null,function(e,t){var r=t.readMany(t.count);return new a(e,o.NONE,{},r,[])}(u,i));else if(u===n.TOPIC_VALUE||u===n.TOPIC_DELTA)!function(e,t,n,i){var s=[],u={id:n.readInt32()};if(t===za.EncodingType.ZLIB&&null!==r)try{var c=r.decompressSync(n.readMany(n.count));i(null,new a(e,o.COMPRESSED,u,c,s))}catch(e){i(e,null)}else i(null,new a(e,o.NONE,u,n.readMany(n.count),s))}(u,c,i,t);else{var p=i.readUntil(1).toString().split(""),l=i.readMany(i.count),f=u===n.FETCH_REPLY?p.shift():void 0;t(null,new a(u,o.NONE,{topic:f},l,p))}},Ka.create=function(t){var r;if(void 0===t||"number"==typeof t&&void 0===n[t])throw new Error("Invalid message type: "+t);return(r=$a.isObjectAs(t)?t:{type:t}).encoding=r.encoding||0,r.headers=r.headers||[],r.buffer=r.buffer||e.alloc(0),new u(r)},Ka.writeToBuffer=function(e,t){t.write(e.type),t.writeString(function(e){return e.type!==n.FETCH_REPLY?"":[e.topic].concat(e.headers).join("")+""}(e)),t.writeMany(e.getBuffer())}}).call(this,a({}).Buffer);var Ja={};Object.defineProperty(Ja,"__esModule",{value:!0}),Ja.enumerize=function(e){Object.keys(e).forEach((function(t){var r=e[t].id;void 0!==r&&(e[r]=t)}))};var Xa={};Object.defineProperty(Xa,"__esModule",{value:!0}),Xa.ErrorReason={COMMUNICATION_FAILURE:new Vs.ErrorReason(100,"Communication with server failed"),SESSION_CLOSED:new Vs.ErrorReason(101,"Session is closed"),REQUEST_TIME_OUT:new Vs.ErrorReason(102,"Request time out"),ACCESS_DENIED:new Vs.ErrorReason(103,"Access denied"),UNSUPPORTED:new Vs.ErrorReason(104,"Unsupported service"),CALLBACK_EXCEPTION:new Vs.ErrorReason(105,"An application callback threw an exception. Check logs for more information"),INVALID_DATA:new Vs.ErrorReason(106,"Invalid data"),NO_SUCH_SESSION:new Vs.ErrorReason(107,"A requested session could not be found"),INCOMPATIBLE_DATATYPE:new Vs.ErrorReason(108,"Data type is incompatible"),UNHANDLED_MESSAGE:new Vs.ErrorReason(109,"A message was not handled"),CLUSTER_REPARTITION:new Vs.ErrorReason(110,"The cluster was repartitioning and the request could not be routed."),INCOMPATIBLE_STATE:new Vs.ErrorReason(111,"Topic operation not performed because it is managed by a component that prohibits external updates"),CLUSTER_ROUTING:new Vs.ErrorReason(112,"The cluster operation could not be routed."),TOPIC_TREE_REGISTRATION_CONFLICT:new Vs.ErrorReason(200,"A conflicting registration exists on the same branch of the topic tree"),HANDLER_CONFLICT:new Vs.ErrorReason(201,"Conflict with an existing handler"),INVALID_PATH:new Vs.ErrorReason(202,"Invalid path"),REJECTED_REQUEST:new Vs.ErrorReason(9003,"A request has been rejected by the recipient session")},Ja.enumerize(Xa.ErrorReason);var Za={};Object.defineProperty(Za,"__esModule",{value:!0});var eu=qa.create("ServiceAdapter"),tu={respond:function(){},fail:function(){}},ru=function(){function e(e,t){this.listeners={},this.internalSession=e,this.sender=t}return e.prototype.sendRequest=function(e,t,r){var n=Ka.create({type:Ka.types.SERVICE_REQUEST}),o=n.getStream();Da.CommandHeaderSerialiser.write(o,e),r.write(o,t),eu.debug("Sending command request: "+e,t),this.sender(n)},e.prototype.sendResponse=function(e,t,r){var n=Ka.create({type:Ka.types.SERVICE_RESPONSE}),o=n.getStream();Da.ResponseCommandHeaderSerialiser.write(o,e),r.write(o,t),eu.debug("Sending command response: "+e,t),this.sender(n)},e.prototype.sendError=function(e,t,r){var n=Ka.create({type:Ka.types.SERVICE_ERROR}),o=n.getStream();Da.ResponseCommandHeaderSerialiser.write(o,e),ba.writeString(o,r),ba.writeInt32(o,t.id),eu.debug("Sending command error: "+t.id,r),this.sender(n)},e.prototype.addService=function(e,t){var r=this;if(void 0!==this.listeners[e.id])throw new Error("Service already exists for service "+e.id);var n=e.request,o=e.response;this.listeners[e.id]=function(i,s){var a=n.read(s),u=i.cid.equals(da.ONEWAY_CID)?tu:{respond:function(e){var t=i.createResponseHeader();r.sendResponse(t,e,o)},fail:function(e,t,n){void 0===n&&(n=!0);var o=i.createErrorHeader();if(r.sendError(o,e,t),n)throw e}};try{t.onRequest(r.internalSession,a,u)}catch(t){throw eu.error(t),new Error("Unable to handle request for service "+e.id)}}},e.prototype.isServiceRegistered=function(e){return void 0!==this.listeners[e]},e.prototype.onMessage=function(e,t){switch(e){case Ka.types.SERVICE_REQUEST:this.handleRequest(Da.CommandHeaderSerialiser.read(t),t);break;case Ka.types.SERVICE_RESPONSE:this.handleResponse(Ra.CIDSerialiser.read(t),t);break;case Ka.types.SERVICE_ERROR:this.handleError(Ra.CIDSerialiser.read(t),t);break;default:throw new Error("Unknown Command Service message "+e)}},e.prototype.handleRequest=function(e,t){var r=this.listeners[e.service];r?(eu.debug("Received command request for service: "+e),r(e,t)):(eu.error("Received command request for unknown service: "+e),this.sendError(e.createErrorHeader(),Xa.ErrorReason.COMMUNICATION_FAILURE,"Unknown client service: "+e.service))},e.prototype.handleResponse=function(e,t){eu.debug("Received command response: "+e),this.internalSession.getConversationSet().respondIfPresent(e,t)},e.prototype.handleError=function(e,t){var r=ba.readString(t),n=ba.readInt32(t),o=new Vs.ErrorReason(n,r);eu.warn("Received command error",o),this.internalSession.getConversationSet().discard(e,o)},e}();Za.ServiceAdapter=ru;var nu={},ou=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function s(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){e.done?o(e.value):new r((function(t){t(e.value)})).then(s,a)}u((n=n.apply(e,t||[])).next())}))},iu=this&&this.__generator||function(e,t){var r,n,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(nu,"__esModule",{value:!0});var su=qa.create("ServiceLocator"),au=function(){function e(e,t){this.context=e,this.serviceAdapter=t}return e.prototype.obtain=function(e){var t=this,r=e.request,n=e.response;return{send:function(o,i){return void 0===i&&(i=function(){}),ou(t,void 0,void 0,(function(){var t,s,a,u=this;return iu(this,(function(c){switch(c.label){case 0:return t={onOpen:function(t){var n=new Aa.CommandHeader(e.id,t);try{u.serviceAdapter.sendRequest(n,o,r)}catch(e){throw i(e),e}},onResponse:function(t,r){var o;try{o=n.read(r)}catch(t){return su.debug("Failed to deserialise response from service "+e.id,t.stack),i(t),!0}try{i(null,o)}catch(t){su.debug("Request callback for service '"+e.id+"' threw an error",t.stack);try{i(t)}catch(t){su.debug("Failed to notify callback error for service '"+e.id+"'",t)}}return!0},onDiscard:function(e,t){i(t)}},[4,(s=this.context.getConversationSet()).newConversation(t)];case 1:return a=c.sent(),[2,function(){s.discard(a,new Error("Cancelled"))}]}}))}))}}},e}();nu.ServiceLocatorImpl=au;var uu={};Object.defineProperty(uu,"__esModule",{value:!0});var cu=["PUBLISH_VALUES_ONLY","SCHEMA","VALIDATE_VALUES","TIDY_ON_UNSUBSCRIBE","TIME_SERIES_EVENT_VALUE_TYPE","TIME_SERIES_RETAINED_RANGE","TIME_SERIES_SUBSCRIPTION_RANGE","DONT_RETAIN_VALUE","PERSISTENT","REMOVAL","OWNER","COMPRESSION","CONFLATION","PRIORITY"],pu=function(){function e(e,t){void 0===t&&(t={}),this.type=e,this.properties=t}return e.prototype.withProperty=function(t,r){if("string"!=typeof t||cu.indexOf(t.toUpperCase())<0)throw new Error("Invalid key: "+t);if("string"!=typeof r)throw new Error("Invalid value, must be string: "+r);var n={};for(var o in n[t]=r,this.properties)o!==t&&(n[o]=this.properties[o]);return new e(this.type,n)},e.PUBLISH_VALUES_ONLY="PUBLISH_VALUES_ONLY",e.VALIDATE_VALUES="VALIDATE_VALUES",e.TIDY_ON_UNSUBSCRIBE="TIDY_ON_UNSUBSCRIBE",e.TIME_SERIES_EVENT_VALUE_TYPE="TIME_SERIES_EVENT_VALUE_TYPE",e.TIME_SERIES_RETAINED_RANGE="TIME_SERIES_RETAINED_RANGE",e.TIME_SERIES_SUBSCRIPTION_RANGE="TIME_SERIES_SUBSCRIPTION_RANGE",e.SCHEMA="SCHEMA",e.DONT_RETAIN_VALUE="DONT_RETAIN_VALUE",e.PERSISTENT="PERSISTENT",e.REMOVAL="REMOVAL",e.CONFLATION="CONFLATION",e.OWNER="OWNER",e.COMPRESSION="COMPRESSION",e.PRIORITY="PRIORITY",e}();uu.TopicSpecification=pu;var lu={};Object.defineProperty(lu,"__esModule",{value:!0});var fu=function(e,t,r){this.id=e,this.stateful=t,this.functional=r};lu.TopicTypeEnum={ROUTING:new fu(12,!1,!0),BINARY:new fu(14,!0,!1),JSON:new fu(15,!0,!1),STRING:new fu(17,!0,!1),INT64:new fu(18,!0,!1),DOUBLE:new fu(19,!0,!1),TIME_SERIES:new fu(16,!0,!1),RECORD_V2:new fu(20,!0,!1),UNKNOWN_TOPIC_TYPE:new fu(21,!1,!1)},Ja.enumerize(lu.TopicTypeEnum);var hu={};Object.defineProperty(hu,"__esModule",{value:!0});var du=function(){function e(){}return e.getAllTypes=function(){return new Set([lu.TopicTypeEnum.JSON,lu.TopicTypeEnum.BINARY,lu.TopicTypeEnum.RECORD_V2,lu.TopicTypeEnum.DOUBLE,lu.TopicTypeEnum.INT64,lu.TopicTypeEnum.STRING,lu.TopicTypeEnum.TIME_SERIES])},e}();hu.FetchRequest=du;var yu={};Object.defineProperty(yu,"__esModule",{value:!0});var vu=function(e,t){this.id=e,this.reason=t};yu.UnsubscribeReasonEnum={SUBSCRIPTION_REFRESH:new vu(void 0,"The server has re-subscribed this session"),STREAM_CHANGE:new vu(void 0,"A more specific stream has been registered to the same path"),REQUESTED:new vu(0,"The unsubscription was requested by this client"),CONTROL:new vu(1,"The server or another client unsubscribed this client"),REMOVED:new vu(2,"The topic was removed"),AUTHORIZATION:new vu(3,"Not authorized to subscribe to this topic"),UNKNOWN_UNSUBSCRIBE_REASON:new vu(4,"Unknown unsubscribe reason"),BACK_PRESSURE:new vu(5,"The server has unsubscribed due to a backlog of messages")},Ja.enumerize(yu.UnsubscribeReasonEnum),Object.freeze(yu.UnsubscribeReasonEnum);var _u=function(e,t){this.id=e,this.reason=t};yu.UpdateFailReasonEnum={INCOMPATIBLE_UPDATE:new _u(1,"Update type is incompatible with topic type"),UPDATE_FAILED:new _u(2,"Update failed - possible content incompatibility"),INVALID_UPDATER:new _u(3,"Updater is invalid for updating"),MISSING_TOPIC:new _u(4,"Topic does not exist"),EXCLUSIVE_UPDATER_CONFLICT:new _u(7,"An exclusive update source is already registered for the topic branch"),DELTA_WITHOUT_VALUE:new _u(8,"An attempt has been made to apply a delta to a topic that does not yet have a value"),CLUSTER_REPARTITION:new _u(9,"When trying to update the topic the cluster was migrating the partition that owns the topic"),INCOMPATIBLE_STATE:new _u(10,"An update could not be performed because the topic is managed bya component (e.g fan-out) that prohibits updates from the caller"),UNSATISFIED_CONSTRAINT:new _u(-1,"The topic update failed because the constraint was not satisfied"),INVALID_UPDATE_STREAM:new _u(-2,"The topic update failed because the update stream is no longer valid")},Ja.enumerize(yu.UpdateFailReasonEnum),Object.freeze(yu.UpdateFailReasonEnum);var Su=function(e,t){this.id=e,this.reason=t};yu.TopicAddFailReasonEnum={EXISTS:new Su(1,"The topic already exists with the same details"),EXISTS_MISMATCH:new Su(2,"The topic already exists, with different details"),INVALID_PATH:new Su(3,"The topic path is invalid"),INVALID_DETAILS:new Su(4,"The topic details are invalid"),USER_CODE_ERROR:new Su(5,"A user supplied class could not be found or instantiated"),TOPIC_NOT_FOUND:new Su(6,"A referenced topic could not be found"),PERMISSIONS_FAILURE:new Su(7,"Invalid permissions to add a topic at the specified path"),INITIALISE_ERROR:new Su(8,"The topic could not be initialised, supplied value may be of the wrong format"),UNEXPECTED_ERROR:new Su(9,"An unexpected error occured while creating the topic"),CLUSTER_REPARTITION:new Su(10,"When trying to create the topic the cluster was migrating the partition that owns the topic"),EXCEEDED_LICENSE_LIMIT:new Su(11,"Adding the topic failed because of a license limit"),INCOMPATIBLE_PARENT:new Su(12,"Adding the topic failed because an incompatible topic is already bound to the parent path"),EXISTS_INCOMPATIBLE:new Su(14,"Adding the topic failed because a topic is already bound to the specifiedpath but the caller does not have the rights to manage it"),INVALID_NAME:new Su(15,"The supplied topic path is invalid.")},Ja.enumerize(yu.TopicAddFailReasonEnum),Object.freeze(yu.TopicAddFailReasonEnum),yu.topicsNamespace={FetchRequest:hu.FetchRequest,TopicType:lu.TopicTypeEnum,TopicSpecification:uu.TopicSpecification,UnsubscribeReason:yu.UnsubscribeReasonEnum,UpdateFailReason:yu.UpdateFailReasonEnum,TopicAddFailReason:yu.TopicAddFailReasonEnum};var Eu={};Object.defineProperty(Eu,"__esModule",{value:!0});var mu=function(){function e(e,t,r){this.id=e,this.message=t,this.canReconnect=r}return e.prototype.toString=function(){return"id: "+this.message},e}();Eu.CloseReasonImpl=mu;var wu={};Object.defineProperty(wu,"__esModule",{value:!0});var gu=function(){function e(){this.valueClass=e}return e.prototype.name=function(){return"any"},e}();wu.AnyDataTypeImpl=gu;var Tu,Ou={};Object.defineProperty(Ou,"__esModule",{value:!0}),function(e){e[e.UINT=0]="UINT",e[e.INT=1]="INT",e[e.BYTES=2]="BYTES",e[e.STRING=3]="STRING",e[e.ARRAY=4]="ARRAY",e[e.MAP=5]="MAP",e[e.SEMANTIC=6]="SEMANTIC",e[e.SIMPLE=7]="SIMPLE",e[e.FLOAT=7]="FLOAT"}(Ou.types||(Ou.types={})),function(e){e[e.FALSE=20]="FALSE",e[e.TRUE=21]="TRUE",e[e.NULL=22]="NULL",e[e.UNDEFINED=23]="UNDEFINED",e[e.SIMPLE=24]="SIMPLE",e[e.HALF_PRECISION=25]="HALF_PRECISION",e[e.SINGLE_PRECISION=26]="SINGLE_PRECISION",e[e.DOUBLE_PRECISION=27]="DOUBLE_PRECISION",e[e.BREAK=31]="BREAK"}(Ou.additional||(Ou.additional={})),Ou.BYTE_BREAK=255,function(e){e[e.ARRAY_START=0]="ARRAY_START",e[e.ARRAY_END=1]="ARRAY_END",e[e.MAP_START=2]="MAP_START",e[e.MAP_END=3]="MAP_END",e[e.STRING_START=4]="STRING_START",e[e.STRING_END=5]="STRING_END",e[e.VALUE=6]="VALUE"}(Tu=Ou.tokens||(Ou.tokens={})),Ou.isStructStart=function(e){switch(e){case Tu.ARRAY_START:case Tu.MAP_START:case Tu.STRING_START:return!0;default:return!1}},Ou.isStructEnd=function(e){switch(e){case Tu.ARRAY_END:case Tu.MAP_END:case Tu.STRING_END:return!0;default:return!1}};var Iu,bu={};Object.defineProperty(bu,"__esModule",{value:!0}),function(e){e[e.root=0]="root",e[e.string=1]="string",e[e.array=2]="array",e[e.object=3]="object"}(Iu=bu.TokenContextType||(bu.TokenContextType={}));var Ru=function(){function e(){this.ROOT={length:-1,type:Iu.root,read:0},this.stack=[],this.tail=this.ROOT}return e.prototype.type=function(){return this.tail.type},e.prototype.read=function(){return this.tail.read},e.prototype.expected=function(){return this.tail.length},e.prototype.push=function(e,t){void 0===t&&(t=-1),this.tail={length:t,type:e,read:0},this.stack.push(this.tail)},e.prototype.pop=function(){var e=this.stack.pop();return this.stack.length?this.tail=this.stack[this.stack.length-1]:this.tail=this.ROOT,e},e.prototype.next=function(){if(!this.hasRemaining())throw new Error("Exceeded expected collection limit");this.tail.read++},e.prototype.break=function(){this.acceptsBreakMarker()&&(this.tail.length=0,this.tail.read=0)},e.prototype.hasRemaining=function(){return-1===this.tail.length||this.tail.length>this.tail.read},e.prototype.acceptsBreakMarker=function(){return this.tail!==this.ROOT&&-1===this.tail.length},e}();bu.Context=Ru;var Cu={};(function(e){"use strict";var t=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(Cu,"__esModule",{value:!0});var r=4294967296;function n(e,t,r){for(var n=r?0:4,o=3;o>=0;--o)t[n+o]=255&e,e>>=8}function o(e,t){var r=t?0:4;return e[r]*(1<<24)+(e[r+1]<<16)+(e[r+2]<<8)+e[r+3]}var i=function(){function i(o,s){this.buffer=e.from([0,0,0,0,0,0,0,0]),e.isBuffer(o)&&(this.buffer=o),"string"==typeof o&&function(e,o,i){var s,a,u="-"===e[0];u?e=e.substring(1):"0x"===e.substring(0,2)&&(e=e.substring(2),o=16);var c=0,p=0;try{for(var l=t(e),f=l.next();!f.done;f=l.next()){var h=f.value;p=p*o+parseInt(h,o),c=c*o+Math.floor(p/r),p%=r}}catch(e){s={error:e}}finally{try{f&&!f.done&&(a=l.return)&&a.call(l)}finally{if(s)throw s.error}}u&&(c=~c,p?p=r-p:c++),n(c,i,!0),n(p,i,!1)}(o,s=s||10,this.buffer),"number"==typeof o&&("number"==typeof s?(n(o,this.buffer,!0),n(s,this.buffer,!1)):o>=0?function(e,t){for(var r=7;r>=0;--r)t[r]=255&e,e/=256}(o,this.buffer):function(e,t){e++;for(var r=7;r>=0;--r)t[r]=255&-e^255,e/=256}(o,this.buffer)),o instanceof i&&(n(o.getHighBits(),this.buffer,!0),n(o.getLowBits(),this.buffer,!1))}return i.toString=function(){return"Int64Impl"},i.prototype.getHighBits=function(){return o(this.buffer,!0)},i.prototype.getLowBits=function(){return o(this.buffer,!1)},i.prototype.toBuffer=function(){return this.buffer},i.prototype.toNumber=function(){var e=0|this.getHighBits(),t=this.getLowBits();return e?e*r+t:t},i.prototype.isNegative=function(){return!!(2147483648&this.getHighBits())},i.prototype.toString=function(e){void 0===e&&(e=10);var t=this.getHighBits(),n=this.getLowBits(),o=this.isNegative();if(o&&(t=~t,n=r-n),0===t&&0===n)return"0";for(var i="";t||n;){var s=t%e*r+n;t=Math.floor(t/e),n=Math.floor(s/e),i=(s%e).toString(e)+i}return o&&(i="-"+i),i},i.prototype.equals=function(e){return!!(e&&e instanceof i)&&(this.getHighBits()===e.getHighBits()&&this.getLowBits()===e.getLowBits())},i}();Cu.Int64Impl=i}).call(this,a({}).Buffer);var Pu={};(function(e){"use strict";Object.defineProperty(Pu,"__esModule",{value:!0});var t=new Error,r=e.alloc(0),n=function(){function n(e,t,r){void 0===t&&(t=0),void 0===r&&(r=e.length),this.bufferOffset=t,this.length=r,this.data=e,this.context=new bu.Context,this.pos=this.bufferOffset}return n.prototype.reset=function(){this.context=new bu.Context,this.token=void 0,this.type=void 0,this.pos=this.bufferOffset},n.prototype.hasRemaining=function(){var e=this.context.type()===bu.TokenContextType.root?this.length:this.length+1;return this.pos<this.bufferOffset+e},n.prototype.offset=function(){return this.pos},n.prototype.getContext=function(){return this.context},n.prototype.getToken=function(){return this.token},n.prototype.nextToken=function(){if(!this.hasRemaining())return null;var e=this.context.type(),t=this.pos;if(e!==bu.TokenContextType.root&&!this.context.hasRemaining()){switch(e){case bu.TokenContextType.object:this.type=Ou.tokens.MAP_END;break;case bu.TokenContextType.array:this.type=Ou.tokens.ARRAY_END;break;case bu.TokenContextType.string:this.type=Ou.tokens.STRING_END}return this.context.pop(),{pos:this.pos,type:this.type,getBuffer:function(){return r}}}this.context.next();var n,o=this.readHeader();switch(o.type){case Ou.types.INT:case Ou.types.UINT:case Ou.types.FLOAT:case Ou.types.SIMPLE:this.type=Ou.tokens.VALUE,n=this.readValue(o);break;case Ou.types.BYTES:case Ou.types.STRING:o.raw===Ou.additional.BREAK?(this.context.push(bu.TokenContextType.string,-1),this.type=Ou.tokens.STRING_START):(this.type=Ou.tokens.VALUE,n=this.readValue(o));break;case Ou.types.ARRAY:this.context.push(bu.TokenContextType.array,this.readCollectionLength(o)),this.type=Ou.tokens.ARRAY_START;break;case Ou.types.MAP:var i=this.readCollectionLength(o);i>=0&&(i*=2),this.context.push(bu.TokenContextType.object,i),this.type=Ou.tokens.MAP_START;break;case Ou.types.SEMANTIC:return this.nextToken();default:throw new Error("Unknown CBOR header type: "+o.type)}if(n instanceof Error){if(this.context.acceptsBreakMarker())return this.context.break(),this.nextToken();throw new Error("Unexpected break flag outside of indefinite-length context")}var s=this.data;return this.token={pos:t,type:this.type,value:n,header:o,length:this.pos,getBuffer:function(){return s.slice(this.pos,this.length)}},this.token},n.prototype.readValue=function(e){switch(e.type){case Ou.types.UINT:return this.readHeaderValue(e);case Ou.types.INT:return this.readHeaderValue(e,!0);case Ou.types.BYTES:return this.readBuffer(this.readHeaderValue(e));case Ou.types.STRING:return this.readBuffer(this.readHeaderValue(e)).toString("utf-8");case Ou.types.SIMPLE:return this.readSimpleValue(e.raw)}throw new Error("Unrecognised value type ("+e.type+")")},n.prototype.readSimpleValue=function(e){switch(e){case Ou.additional.TRUE:return!0;case Ou.additional.FALSE:return!1;case Ou.additional.NULL:return null;case Ou.additional.BREAK:return t;case Ou.additional.HALF_PRECISION:return this.readFloat16();case Ou.additional.SINGLE_PRECISION:return this.readFloat32();case Ou.additional.DOUBLE_PRECISION:return this.readFloat64();default:return}},n.prototype.readByte=function(){if(this.pos<this.data.length)return this.data[this.pos++];throw new Error("Exhausted token stream")},n.prototype.readBuffer=function(e){return this.data.slice(this.pos,this.pos+=e)},n.prototype.readUint16=function(){var e=this.data.readUInt16BE(this.pos);return this.pos+=2,e},n.prototype.readUint32=function(){var e=this.data.readUInt32BE(this.pos);return this.pos+=4,e},n.prototype.readUint64=function(t){var r=e.from(this.readBuffer(8));if(t)for(var n=0;n<8;++n)r[n]=~r[n];var o=new Cu.Int64Impl(r),i=o.toNumber();return i<=9007199254740991&&i>=-9007199254740991?i:o},n.prototype.readFloat16=function(){var e=this.readUint16(),t=1023&e,r=(31744&e)>>10,n=(32768&e)>>15?-1:1;return 0===r?n*Math.pow(2,-14)*(t/Math.pow(2,10)):31===r?t?NaN:n*(1/0):n*Math.pow(2,r-15)*(1+t/Math.pow(2,10))},n.prototype.readFloat32=function(){var e=this.data.readFloatBE(this.pos);return this.pos+=4,e},n.prototype.readFloat64=function(){var e=this.data.readDoubleBE(this.pos);return this.pos+=8,e},n.prototype.readHeader=function(){var e=this.readByte();return{type:e>>5,raw:31&e}},n.prototype.readHeaderValue=function(e,r){void 0===r&&(r=!1);var n=e.raw,o=function(e){return r?-1-e:e};if(n<24)return o(n);switch(n){case Ou.additional.SIMPLE:return o(this.readByte());case Ou.additional.HALF_PRECISION:return o(this.readUint16());case Ou.additional.SINGLE_PRECISION:return o(this.readUint32());case Ou.additional.DOUBLE_PRECISION:return this.readUint64(r);case Ou.additional.BREAK:return t;default:throw new Error("Unexpected value "+n)}},n.prototype.readCollectionLength=function(e){var r=this.readHeaderValue(e);return r===t?-1:r},n}();Pu.Tokeniser=n}).call(this,a({}).Buffer);var Nu={};Object.defineProperty(Nu,"__esModule",{value:!0});var Au=function(e,t,r){void 0===t&&(t=0),void 0===r&&(r=e.length),this.$buffer=e,this.$offset=t,this.$length=r};Nu.BufferSlice=Au;
/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */
var Mu=function(e){return null!=e&&(Lu(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&Lu(e.slice(0,0))}(e)||!!e._isBuffer)};function Lu(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}var Du={};(function(e){"use strict";var t=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(Du,"__esModule",{value:!0});var r=function(r){function n(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=e.length),r.call(this,e,t,n)||this}return t(n,r),n.prototype.visit=function(t){if(this.hasChanges()){for(var r=new Pu.Tokeniser(this.$buffer,this.$offset,this.$length);r.hasRemaining();){var n=r.nextToken(),o=!1;if(e.isBuffer(n.value))o=!t.insert(n.value);else{var i=n.value,s=r.nextToken().value;o=!t.match(i,s)}if(o)return void t.end()}t.end()}else t.noChange()},n.prototype.hasChanges=function(){return 1!==this.$length},n}(Nu.BufferSlice);Du.BinaryDeltaImpl=r}).call(this,{isBuffer:Mu});var ju={};(function(e){"use strict";Object.defineProperty(ju,"__esModule",{value:!0});var t=function(){function t(t,r,n){this.tokeniser=e.isBuffer(t)?new Pu.Tokeniser(t,r,n):t}return t.prototype.hasRemaining=function(){return this.tokeniser.hasRemaining()},t.prototype.nextValue=function(){return this.nextValueExpecting(r)},t.prototype.nextValueExpecting=function(t){if(!this.tokeniser.hasRemaining())throw new Error("Token stream exhausted");var r=this.tokeniser.nextToken();if(t(r.header.type))return function t(r,n){switch(r.type){case Ou.tokens.VALUE:return r.value;case Ou.tokens.MAP_START:for(var o={};;){var i=n.nextToken();if(null===i)throw new Error("Unexpected EOF (reading: map key)");if(i.type===Ou.tokens.MAP_END)break;var s=n.nextToken();if(null===s||s.type===Ou.tokens.MAP_END)throw new Error("Unexpected EOF (reading: map value)");var a=t(i,n);if(null==a)throw new Error("Cannot have undefined key (reading: map key)");o[a.toString()]=t(s,n)}return o;case Ou.tokens.ARRAY_START:for(var u=[];;){var c=n.nextToken();if(null===c)throw new Error("Unexpected EOF (reading: array value)");if(c.type===Ou.tokens.ARRAY_END)break;u.push(t(c,n))}return u;case Ou.tokens.STRING_START:for(var p=[];;){var l=n.nextToken();if(null===l)throw new Error("Unexpected EOF (reading: indefinite-length string");if(l.type===Ou.tokens.STRING_END)break;if(l.header.type!==r.header.type)throw new Error("Unexpected chunk type ("+l.header.type+") within string");p.push(l.value)}switch(r.header.type){case Ou.types.BYTES:return e.concat(p);case Ou.types.STRING:return p.join("");default:throw new Error("Unexpected chunk type ("+r.header.type+") (reading: string)")}default:throw new Error("Unexpected token: "+JSON.stringify(r))}}(r,this.tokeniser);throw new Error("Unexpected CBOR type")},t}();function r(){return!0}ju.Decoder=t,ju.isDouble=function(e){return e===Ou.types.FLOAT},ju.isInt64=function(e){return e===Ou.types.UINT||e===Ou.types.INT},ju.isString=function(e){return e===Ou.types.STRING}}).call(this,a({}).Buffer);var xu={};(function(e){"use strict";var t=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(xu,"__esModule",{value:!0});var r=function(){function r(){this.bos=new Wa.BufferOutputStream}return r.prototype.writeByte=function(e){this.bos.write(e)},r.prototype.writeBuffer=function(e,t,r){void 0===t&&(t=0),void 0===r&&(r=e.length),this.bos.writeMany(e,t,r)},r.prototype.writeUint16=function(e){this.writeByte(e>>8&255),this.writeByte(255&e)},r.prototype.writeUint32=function(e){this.writeUint16(e>>16&65535),this.writeUint16(65535&e)},r.prototype.writeUint64=function(e){this.writeUint32(Math.floor(e/4294967296)),this.writeUint32(e%4294967296)},r.prototype.writeBreakHeader=function(e){this.writeByte(e<<5|Ou.additional.BREAK)},r.prototype.writeToken=function(e,t){var r=e<<5;t<24?this.writeByte(r|t):t<256?(this.writeByte(24|r),this.writeByte(t)):t<65536?(this.writeByte(25|r),this.writeUint16(t)):t<4294967296?(this.writeByte(26|r),this.writeUint32(t)):(this.writeByte(27|r),this.writeUint64(t))},r.prototype.writeNumber=function(t){if(t.toString().indexOf(".")>-1){var r=e.alloc(8);r.writeDoubleBE(t,0),this.writeByte(Ou.types.SIMPLE<<5|Ou.additional.DOUBLE_PRECISION),this.writeBuffer(r)}else t<0?this.writeToken(Ou.types.INT,-1-t):this.writeToken(Ou.types.UINT,t)},r.prototype.writeString=function(t){var r=e.from(t,"utf-8");this.writeToken(Ou.types.STRING,r.length),this.writeBuffer(r)},r.prototype.writeBinary=function(e,t,r){void 0===r&&(r=e.length),this.writeToken(Ou.types.BYTES,r),this.writeBuffer(e,t,r)},r.prototype.writeBoolean=function(e){this.writeToken(Ou.types.SIMPLE,e?Ou.additional.TRUE:Ou.additional.FALSE)},r.prototype.writeUndefined=function(){this.writeToken(Ou.types.SIMPLE,Ou.additional.UNDEFINED)},r.prototype.writeNull=function(){this.writeToken(Ou.types.SIMPLE,Ou.additional.NULL)},r.prototype.writeObject=function(e){var r,n,o=Object.getOwnPropertyNames(e);this.startObject(o.length);try{for(var i=t(o),s=i.next();!s.done;s=i.next()){var a=s.value;this.encode(a),this.encode(e[a])}}catch(e){r={error:e}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}},r.prototype.writeArray=function(e){var r,n;this.startArray(e.length);try{for(var o=t(e),i=o.next();!i.done;i=o.next()){var s=i.value;this.encode(s)}}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}},r.prototype.break=function(){return this.writeBreakHeader(Ou.types.SIMPLE),this},r.prototype.startArray=function(e){return void 0===e?this.writeBreakHeader(Ou.types.ARRAY):this.writeToken(Ou.types.ARRAY,e),this},r.prototype.startObject=function(e){return void 0===e?this.writeBreakHeader(Ou.types.MAP):this.writeToken(Ou.types.MAP,e),this},r.prototype.writeInt64=function(t){var r=0|t.getHighBits();if(0===r||-1===r)this.writeNumber(t.toNumber());else if(t.isNegative()){this.writeByte(Ou.types.INT<<5|27);for(var n=e.from(t.toBuffer()),o=0;o<8;++o)n[o]=~n[o];this.writeBuffer(n)}else this.writeByte(Ou.types.UINT<<5|27),this.writeBuffer(t.toBuffer());return this},r.prototype.writeDouble=function(t){var r=e.alloc(8);return r.writeDoubleBE(t,0),this.writeByte(Ou.types.SIMPLE<<5|Ou.additional.DOUBLE_PRECISION),this.writeBuffer(r),this},r.prototype.encode=function(t,r,n){if(t instanceof Date)this.writeString(t.toJSON());else if(null===t)this.writeNull();else if(void 0===t)this.writeUndefined();else if(t instanceof Cu.Int64Impl)this.writeInt64(t);else switch(typeof t){case"boolean":this.writeBoolean(t);break;case"string":this.writeString(t);break;case"number":this.writeNumber(t);break;case"object":e.isBuffer(t)?this.writeBinary(t,r,n):Array.isArray(t)?this.writeArray(t):this.writeObject(t)}return this},r.prototype.flush=function(){var e=this.bos.getBuffer();return this.bos=new Wa.BufferOutputStream,e},r}();xu.Encoder=r}).call(this,a({}).Buffer);var Uu={};Object.defineProperty(Uu,"__esModule",{value:!0}),Uu.approximateSquareRoot=function(e){if(e<0)throw new Error("Value must be great or equal to 0");if(0===e)return 0;var t=32-function(e){if(0===e)return 32;var t=1;return e>>>16==0&&(t+=16,e<<=16),e>>>24==0&&(t+=8,e<<=8),e>>>28==0&&(t+=4,e<<=4),e>>>30==0&&(t+=2,e<<=2),t-=e>>>31}(e);return 1<<Math.round(t/2)},Uu.findNextPowerOfTwo=function(e){if(e<0||e>1<<30)throw new Error("Illegal argument: "+e);return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e},Uu.MAX_INT32=2147483647,Uu.MAX_SAFE_INTEGER=9007199254740991;var Bu={},ku=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)s.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return s};Object.defineProperty(Bu,"__esModule",{value:!0});Bu.SUCCESS=0,Bu.REPLACE=1,Bu.NO_CHANGE=2;var qu=function(){function e(e){this.maximumD=(e-3)/4,this.vectorLength=0,this.vector=[]}return e.prototype.fill=function(e){for(var t=e;t<this.vectorLength+4;t+=4)this.vector[t+0]=-1,this.vector[t+1]=-1,this.vector[t+2]=2147483647,this.vector[t+3]=2147483647},e.prototype.ensure=function(e){this.vectorLength=4*(e+1)+3},e.prototype.initialise=function(e){return this.ensure(e),this.fill(3),this.vector},e.prototype.extend=function(e){if(e>this.maximumD)return null;var t=this.vectorLength;return this.ensure(e),this.fill(t),this.vector},e}();function Vu(e){return e<0?-4*e-1:4*e}function Fu(e){return Vu(e)+2}function Gu(e,t){var r=e[Vu(t)];return void 0===r?0:r}function Hu(e,t){var r=e[Fu(t)];return void 0===r?0:r}function Wu(e,t,r){e[Vu(t)]=r}function Yu(e,t,r){e[Fu(t)]=r}function zu(e,t){var r=Gu(e,t+1),n=Gu(e,t-1);return r<n?n:r+1}function Qu(e,t){var r=Hu(e,t+1),n=Hu(e,t-1);return r<n?r:n-1}function $u(e,t){return e<=t?e:2*t-e}function Ku(e,t,r){if(t<0)throw new Error("offset "+t+" < 0");if(r<0)throw new Error("length "+r+" < 0");if(t+r>e.length||t+r<0)throw new Error("offset "+t+" + "+r+" > "+e.length)}var Ju=function(){function e(e,t,r,n,o){this.storage=e,this.a=t,this.b=r,this.script=n,this.bailOutFactor=o}return e.prototype.diff=function(e,t,r,n,o){void 0===o&&(o=this.bailOutFactor),Ku(this.a,e,t),Ku(this.b,r,n);var i=this.afterCommonPrefix(e,t,r,n),s=this.beforeCommonSuffix(e,t,r,n,i),a=s+n-t;return!!this.script.match(e,i)&&((i===s?this.script.insert(r+i,a-i):i===a?this.script.delete():this.middleSnake(e+i,s-i,r+i,a-i,o))&&this.script.match(e+s,t-s))},e.prototype.afterCommonPrefix=function(e,t,r,n){for(var o=Math.min(t,n),i=0;i<o;++i)if(this.a[e+i]!==this.b[r+i])return i;return Math.max(0,o)},e.prototype.beforeCommonSuffix=function(e,t,r,n,o){for(var i=Math.max(0,t-n)+o,s=t;s>i;--s)if(this.a[e+s-1]!==this.b[r+s+n-t-1])return s;return Math.min(t,i)},e.prototype.diffNoPrefix=function(e,t,r,n,o){void 0===o&&(o=this.bailOutFactor);var i=this.beforeCommonSuffix(e,t,r,n,0),s=i+n-t;return(0===i?this.script.insert(r,s):0===s?this.script.delete():this.middleSnake(e,i,r,s,o))&&this.script.match(e+i,t-i)},e.prototype.diffNoSuffix=function(e,t,r,n,o){void 0===o&&(o=this.bailOutFactor);var i=this.afterCommonPrefix(e,t,r,n);return!!this.script.match(e,i)&&(i===t?this.script.insert(r+i,n-i):i===n?this.script.delete():this.middleSnake(e+i,t-i,r+i,n-i,o))},e.prototype.middleSnake=function(e,t,r,n,o){var i=t-n,s=1&i,a=this.storage.initialise(1);Wu(a,0,0),Yu(a,0,t);var u=1,c=o;do{for(var p=$u(u,t),l=$u(u,n),f=-p;f<=l;f+=2){var h=zu(a,f),d=h+this.afterCommonPrefix(e+h,t-h,r+h+f,n-f-h);if(s&&Math.abs(f+i)<=u-1&&d>=Hu(a,f+i))return this.recurse(e,t,r,n,h,d,f);Wu(a,f,d)}for(var y=-l;y<=p;y+=2){var v=Qu(a,y),_=y-i,S=this.beforeCommonSuffix(e,v,r,_+v,0);if(!s&&Math.abs(_)<=u&&S<=Gu(a,_))return this.recurse(e,t,r,n,S,v,_);Yu(a,y,S)}if(0==(63&u)&&this.slowProgress(a,t,n,p,l,u))c-=48;else if(u>Math.max(4,c))return this.bail(a,e,t,r,n,p,l,Math.trunc(c/2));++u,a=this.storage.extend(u)}while(null!==a);return!1},e.prototype.slowProgress=function(e,t,r,n,o,i){var s=ku(this.bestForward(e,t,r,n,o),2),a=s[0],u=s[1],c=ku(this.bestReverse(e,t,r,n,o),2);return a+u+(t+r-c[0]-c[1])<Uu.approximateSquareRoot(i)*i},e.prototype.bestForward=function(e,t,r,n,o){for(var i=0,s=0,a=-n;a<=o;a+=2){var u=Math.min(Gu(e,a),t,r-a),c=u+a;u+c>i+s&&(i=u,s=c)}return[i,s]},e.prototype.bestReverse=function(e,t,r,n,o){for(var i=t,s=r,a=-o;a<=n;a+=2){var u=a-(t-r),c=Math.max(Hu(e,a),0,-u),p=c+u;c+p<i+s&&(i=c,s=p)}return[i,s]},e.prototype.recurse=function(e,t,r,n,o,i,s){return this.diffNoPrefix(e,o,r,o+s)&&this.script.match(e+o,i-o)&&this.diffNoSuffix(e+i,t-i,r+i+s,n-i-s)},e.prototype.bail=function(e,t,r,n,o,i,s,a){var u=ku(this.bestForward(e,r,o,i,s),2),c=u[0],p=u[1],l=ku(this.bestReverse(e,r,o,i,s),2),f=l[0],h=l[1];return c>=f||p>=h?r+o-f-h>c+p?this.splitDiff(t,f,r,n,h,o):this.splitDiff(t,c,r,n,p,o):this.diffNoPrefix(t,c,n,p)&&this.boundedDiff(t+c,f-c,n+p,h-p,r,o,a)&&this.diffNoSuffix(t+f,r-f,n+h,o-h)},e.prototype.boundedDiff=function(e,t,r,n,o,i,s){var a=o*i;if(t*n>=Math.floor((1<<24)+a/2)){if(s<=0){var u=Math.trunc(t/4),c=u+Math.trunc(t/2),p=Math.trunc(n/4),l=p+Math.trunc(n/2);return this.noDiff(r,p)&&this.diff(e+u,c-u,r+p,l-p,s)&&this.noDiff(r+l,n-l)}var f=Math.trunc(t/2),h=Math.trunc(n/2);return this.splitDiff(e,f,t,r,h,n,s)}return this.middleSnake(e,t,r,n,s)},e.prototype.splitDiff=function(e,t,r,n,o,i,s){return this.diffNoPrefix(e,t,n,o,s)&&this.diffNoSuffix(e+t,r-t,n+o,i-o,s)},e.prototype.noDiff=function(e,t){return this.script.insert(e,t)&&this.script.delete()},e}();function Xu(e,t,r){return e.insert(t,r)}function Zu(e,t,r){return e.match(t,r)}function ec(){return!0}function tc(e,t,r){var n=!0,o=0,i=0,s=ec;function a(){return n=n&&s===ec,s(e,i,o)}function u(e,t,r){if(r>0)if(s!==e){if(!a())return!1;s=e,i=t,o=r}else o+=r;return!0}return{insert:function(e,t){return u(Xu,e-r,t)},match:function(e,r){return u(Zu,e-t,r)},delete:function(e,t){if(s===Xu)return!0;var r=a();return s=ec,r},close:function(t,r){if(n){if(s===Xu)return Bu.REPLACE;if(0===i&&o===t)return Bu.NO_CHANGE}return a()&&e.close()?Bu.SUCCESS:Bu.REPLACE}}}var rc=function(){function e(e,t){void 0===e&&(e=2147483647),void 0===t&&(t=1e4),this.bailOutFactor=t,this.storage=new qu(e)}return e.prototype.diff=function(e,t,r,n,o,i,s){var a=tc(s,t,o);return new Ju(this.storage,e,n,a,this.bailOutFactor).diff(t,r,o,i)?a.close(r,i):Bu.REPLACE},e}();Bu.MyersBinaryDiff=rc;var nc={};(function(e){"use strict";Object.defineProperty(nc,"__esModule",{value:!0});var t=new xu.Encoder;function r(e){return e<24?1:e<255?2:e<=65535?3:5}function n(e,t,n){var o=r(e)+1;return r(t+n)-r(n)+t<=o}nc.NO_CHANGE=new Du.BinaryDeltaImpl(e.from([-10]),0,1);var o=function(){function e(e,t,r,n){this.insertStart=-1,this.matchStart=-1,this.cborEncoder=e,this.buffer=t,this.offset=r,this.blowsBudget=n}return e.prototype.insert=function(e,t){if(-1!==this.matchStart){if(n(this.matchStart,this.matchLength,t))return this.matchStart=-1,-1===this.insertStart?(this.insertStart=e-this.matchLength,this.insertLength=this.matchLength+t):this.insertLength+=this.matchLength+t,!0;if(!this.flush())return!1}return-1===this.insertStart?(this.insertStart=e,this.insertLength=t):this.insertLength+=t,!0},e.prototype.match=function(e,t){if(-1!==this.matchStart){if(!this.flush())return!1}else if(-1!==this.insertStart&&n(e,t,this.insertLength))return this.insertLength+=t,!0;return this.matchStart=e,this.matchLength=t,!0},e.prototype.delete=function(e,t){return!0},e.prototype.close=function(){return this.flush()},e.prototype.flush=function(){return(-1===this.insertStart||this.writeInsert())&&(-1===this.matchStart||this.writeMatch())},e.prototype.writeInsert=function(){return!this.blowsBudget(this.insertLength+r(this.insertLength))&&(t.encode(this.buffer,this.offset+this.insertStart,this.insertLength),this.insertStart=-1,!0)},e.prototype.writeMatch=function(){return!this.blowsBudget(r(this.matchStart)+r(this.matchLength))&&(this.cborEncoder.encode(this.matchStart),this.cborEncoder.encode(this.matchLength),this.matchStart=-1,!0)},e}(),i=function(){function r(e,t,r){this.binaryDiff=new Bu.MyersBinaryDiff,this.implementation=e,this.cToV=r,this.vToC=t}return r.prototype.name=function(){return"binary"},r.prototype.diff=function(e,r){var n,i=this.vToC(e),s=this.vToC(r),a=s.$buffer,u=s.$offset,c=s.$length,p=c,l=new o(t,a,u,(function(e){return(p-=e)<=0})),f=this.binaryDiff.diff(i.$buffer,i.$offset,i.$length,a,u,c,l),h=t.flush();switch(f){case Bu.REPLACE:return n=s,t.encode(n.$buffer,n.$offset,n.$length),new Du.BinaryDeltaImpl(t.flush());case Bu.NO_CHANGE:return nc.NO_CHANGE;default:return this.readDelta(h)}},r.prototype.apply=function(e,t){return this.applyImpl(e,t).value},r.prototype.applyImpl=function(t,r,n){var o=r,i=n||this.vToC(t);if(!r||!r.hasChanges())return{value:this.cToV(i),cbor:i};for(var s=new ju.Decoder(o.$buffer),a=new Wa.BufferOutputStream;s.hasRemaining();){var u=s.nextValue();e.isBuffer(u)?a.writeMany(u):"number"==typeof u&&a.writeMany(i.$buffer,i.$offset+u,s.nextValue())}var c=new this.implementation(a.getBuffer());return{value:this.cToV(c),cbor:c}},r.prototype.readDelta=function(e,t,r){var n=new Du.BinaryDeltaImpl(e,t,r);return 1===n.$length&&e[n.$offset]===nc.NO_CHANGE.$buffer[0]?nc.NO_CHANGE:n},r.prototype.writeDelta=function(e){var t=e;return t.$buffer.slice(t.$offset,t.$offset+t.$length)},r.prototype.noChange=function(){return nc.NO_CHANGE},r.prototype.isValueCheaper=function(e,t){return e.$length<=t.$length},r}();nc.BinaryDeltaTypeImpl=i}).call(this,a({}).Buffer);var oc={},ic=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(oc,"__esModule",{value:!0});var sc=function(e){function t(t,r,n){return void 0===r&&(r=0),void 0===n&&(n=t.length),e.call(this,t,r,n)||this}return ic(t,e),t.toString=function(){return"BytesImpl"},t.prototype.length=function(){return this.$length},t.prototype.asBuffer=function(){return this.$buffer.slice(this.$offset,this.$offset+this.$length)},t.prototype.copyTo=function(e,t){void 0===t&&(t=0),this.$buffer.copy(e,t,this.$offset,this.$offset+this.$length)},t.prototype.equals=function(e){return this.equalBytes(e.$buffer,e.$offset,e.$length)},t.prototype.equalBytes=function(e,t,r){if(void 0===t&&(t=0),void 0===r&&(r=e.length),this.$length!==r)return!1;if(this.$buffer===e&&this.$offset===t)return!0;for(var n=0;n<r;++n)if(this.$buffer[this.$offset+n]!==e[t+n])return!1;return!0},t}(Nu.BufferSlice);oc.BytesImpl=sc;var ac={};Object.defineProperty(ac,"__esModule",{value:!0});var uc=function(){function e(e,t,r,n,o,i,s){var a=this;this.valueConverters={},this.typeName=e,this.cToV=o,this.vToC=n,this.implementation=r,i.forEach((function(e){a.valueConverters[e.toString()]=function(t,r,n){return new e(t,r,n)}})),this.valueConverters[oc.BytesImpl.toString()]=function(e,t,r){return new oc.BytesImpl(e,t,r)},this.valueConverters[t.toString()]=this.readValue.bind(this),this.valueConverters[wu.AnyDataTypeImpl.toString()]=this.readValue.bind(this),this.valueClass=t,s&&(this.binaryDeltaTypeImpl=new nc.BinaryDeltaTypeImpl(r,n,o))}return e.prototype.name=function(){return this.typeName},e.prototype.toString=function(){return this.typeName+" data type"},e.prototype.writeValue=function(e){var t=this.vToC(e);if(null===t)throw new Error(this+" cannot write "+e);return t.asBuffer()},e.prototype.toBytes=function(e){var t=this.vToC(e);if(t)return t;throw new Error(this+" cannot convert value to Bytes: "+e)},e.prototype.readValue=function(e,t,r){return e instanceof oc.BytesImpl?e instanceof this.implementation?this.cToV(e):this.readValue(e.$buffer,e.$offset,e.$length):this.cToV(new this.implementation(e,t,r))},e.prototype.canReadAs=function(e){return void 0!==this.valueConverters[e.toString()]},e.prototype.readAs=function(e,t,r,n){if(t instanceof oc.BytesImpl)return this.readAs(e,t.$buffer,t.$offset,t.$length);if(this.valueConverters[e.toString()])return this.valueConverters[e.toString()](t,r,n);throw new Error(this+" is incompatible with values of "+e)},e.prototype.deltaType=function(e){if(!e||"binary"===e||e instanceof Du.BinaryDeltaImpl)return this.binaryDeltaType();throw new Error(this+" has no '"+e+"' delta type")},e.prototype.binaryDeltaType=function(){if(void 0===this.binaryDeltaTypeImpl)throw new Error(this+" has no binary delta type");return this.binaryDeltaTypeImpl},e}();ac.AbstractDataType=uc;var cc={};function pc(e,t){switch(t.length){case 0:return e();case 1:return e(t[0]);case 2:return e(t[0],t[1]);case 3:return e(t[0],t[1],t[2]);case 4:return e(t[0],t[1],t[2],t[3]);case 5:return e(t[0],t[1],t[2],t[3],t[4]);case 6:return e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return e(t[0],t[1],t[2],t[3],t[4],t[5],t[6]);case 8:return e(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7])}return e.apply(e,t)}Object.defineProperty(cc,"__esModule",{value:!0}),cc.curryR=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];return pc(e,r.concat(t))}},cc.callWithArguments=pc,cc.identity=function(e){return e};var lc={};(function(e){"use strict";var t=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();function r(t){if(t instanceof n)return t;if(e.isBuffer(t))return new n(t);throw new Error("Unable to read Binary value from: "+t)}Object.defineProperty(lc,"__esModule",{value:!0});var n=function(e){function n(t,r,n){return void 0===r&&(r=0),void 0===n&&(n=t.length),e.call(this,t,r,n)||this}return t(n,e),n.toString=function(){return"BinaryImpl"},n.from=function(e){return r(e)},n.prototype.get=function(){return this.asBuffer()},n.prototype.diff=function(e,t){return o.diff(e,this)},n.prototype.apply=function(e){return o.apply(this,e)},n.prototype.toString=function(){return"Binary <"+this.$length+" bytes> "+this.get().toString()},n}(oc.BytesImpl);lc.BinaryImpl=n;var o=new nc.BinaryDeltaTypeImpl(n,r,cc.identity)}).call(this,{isBuffer:Mu});var fc={},hc=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(fc,"__esModule",{value:!0});var dc=function(e){function t(){var t=e.call(this,"binary",lc.BinaryImpl,lc.BinaryImpl,lc.BinaryImpl.from,cc.identity,[],!0)||this;return t.Binary=lc.BinaryImpl,t}return hc(t,e),t.prototype.from=function(e){return lc.BinaryImpl.from(e)},t.prototype.validate=function(){},t}(ac.AbstractDataType);fc.BinaryDataTypeImpl=dc;var yc={},vc=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(yc,"__esModule",{value:!0});var _c=function(){function e(e){this.index=e}return e.prototype.equals=function(t){return t===this||!!(t&&t instanceof e)&&t.index===this.index},e.prototype.toString=function(){return"/"+this.index},e}(),Sc=new _c(0),Ec=function(){function e(e){this.expression="/"+function(e){for(var t=0;t<e.length;++t){var r=e.charAt(t);if("/"===r||"~"===r){var n=e.length,o=[];o.push(e.substring(0,t));for(var i=t;i<n;++i){var s=e.charAt(i);"/"===s?o.push("~1"):"~"===s?o.push("~0"):o.push(s)}return o.join("")}}return e}(e)}return e.prototype.equals=function(t){return t===this||!!(t&&t instanceof e)&&t.expression===this.expression},e.prototype.toString=function(){return this.expression},e}(),mc=function(){function e(e){if(this.pos=0,""!==e&&"/"!==e.charAt(0))throw new Error("JSON Pointer expression must be empty or start with '/' : "+e);this.expression=e}return e.prototype.nextSegmentString=function(){for(var e=this.pos;this.pos<this.expression.length;++this.pos){var t=this.expression[this.pos];if("/"===t)break;if("~"===t){for(var r=[this.expression.substring(e,this.pos)],n=this.expression.length;this.pos<n;++this.pos){var o=this.expression.charAt(this.pos);if("/"===o)break;if("~"===o&&this.pos!==n-1){++this.pos;var i=this.expression.charAt(this.pos);"0"===i?r.push("~"):"1"===i?r.push("/"):(r.push("~"),r.push(i))}else r.push(o)}return r.join("")}}return this.expression.substring(e,this.pos)},e.prototype.maybeIndex=function(e){var t=e.length;if(0===t||t>10)return null;for(var r=0;r<t;++r){var n=e.charAt(r);if(n<"0"||n>"9")return null;if("0"===n&&0===r)return 1===t?Sc:null}var o=parseInt(e,10);return o>Uu.MAX_INT32?null:new _c(o)},e.prototype.next=function(){if(this.pos===this.expression.length)return null;++this.pos;var e=this.nextSegmentString(),t=this.maybeIndex(e);return null!==t?t:new Ec(e)},e}(),wc=function(){function e(e){this.segments=e}return e.parse=function(t){if(t instanceof e)return t;for(var r=yc.ROOT,n=new mc(t);;){var o=n.next();if(null===o)return r;r=r.withSegment(o)}},e.prototype.withKey=function(e){return this.withSegment(new Ec(e))},e.prototype.withIndex=function(e){return this.withSegment(new _c(e))},e.prototype.withSegment=function(t){return new e(this.segments.concat(t))},e.prototype.equalIgnoringIndexes=function(e){if(e===this)return!0;var t=this.segments.length;if(t!==e.segments.length)return!1;for(var r=0;r<t;++r){var n=this.segments[r],o=e.segments[r];if(n instanceof _c){if(o instanceof Ec)return!1}else if(!n.equals(o))return!1}return!0},e.prototype.toString=function(){var e,t,r=[];try{for(var n=vc(this.segments),o=n.next();!o.done;o=n.next()){var i=o.value;r.push(i.toString())}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}return r.join("")},e.prototype.equals=function(t){if(t===this)return!0;if(!(t&&t instanceof e))return!1;if(this.segments.length!==t.segments.length)return!1;for(var r=this.segments.length,n=0;n<r;++n){var o=this.segments[n],i=t.segments[n];if(!o.equals(i))return!1}return!0},e}();yc.JSONPointer=wc,yc.ROOT=new wc([]);var gc={};Object.defineProperty(gc,"__esModule",{value:!0}),gc.requireNonNull=function(e,t){if(null==e)throw new Error(t+" is null");return e};var Tc={},Oc=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(Tc,"__esModule",{value:!0});var Ic=function(){function e(e,t,r){this.segment=e,this.pointer=t,this.children=[],this.value=null,this.context=r}return e.prototype.count=function(){var e,t,r=this.value?1:0;try{for(var n=Oc(this.children),o=n.next();!o.done;o=n.next()){r+=o.value.count()}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}return r},e.prototype.addChild=function(t){var r=new e(t,this.pointer.withSegment(t),this.context);return this.children.push(r),r},e.prototype.findChild=function(e){var t,r;try{for(var n=Oc(this.children),o=n.next();!o.done;o=n.next()){var i=o.value;if(e.equals(i.segment))return i}}catch(e){t={error:e}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}return null},e.prototype.setValue=function(e){var t=this.value;return null===t&&this.context.size++,this.value=e,t},e.prototype.removeDescendants=function(){var e,t,r=0;try{for(var n=Oc(this.children),o=n.next();!o.done;o=n.next()){r+=o.value.count()}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}return this.children=[],this.context.size-=r,r},e.prototype.numberOfChildren=function(){var e,t,r=0;try{for(var n=Oc(this.children),o=n.next();!o.done;o=n.next()){r+=o.value.value?1:0}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}return r},e.prototype.toString=function(){return this.pointer+"="+this.value},e}(),bc=function(){function e(e){this.nextChildIndex=0,this.node=e}return e.prototype.nextChild=function(){var e=this.node.children;return this.nextChildIndex>=e.length?null:e[this.nextChildIndex++]},e}(),Rc=function(){function e(e){this.nextEntry=e(),this.nextWithValue=e}return e.prototype.hasNext=function(){return null!==this.nextEntry},e.prototype.next=function(){if(null===this.nextEntry)throw new Error("No such element");var e=this.nextEntry;return this.nextEntry=this.nextWithValue(),e},e}(),Cc=function(){function e(){this.root=new Ic(null,yc.ROOT,this),this.size=0}return e.prototype.put=function(e,t){gc.requireNonNull(t,"value");for(var r=this.root,n=0;n<e.segments.length;){var o=e.segments[n++],i=r.findChild(o);if(null===i){r=r.addChild(o);break}r=i}for(;n<e.segments.length;n++)r=r.addChild(e.segments[n]);return r.setValue(t)},e.prototype.contains=function(e){return null!==this.get(e)},e.prototype.get=function(e){var t=this.getEntry(e);return t?t.value:null},e.prototype.getEntry=function(e){var t,r,n=this.root;try{for(var o=Oc(e.segments),i=o.next();!i.done;i=o.next()){var s=i.value;if(null===(n=n.findChild(s)))return null}}catch(e){t={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}return n},e.prototype.descendants=function(t){var r=new e,n=this.root,o=r.root,i=t.segments,s=i.length;if(0===s)return this;for(var a=0;a<s-1;++a){var u=i[a];if(null===(n=n.findChild(u)))return Pc;o=o.addChild(u)}var c=n.findChild(i[s-1]);return null===c?Pc:(o.children.push(c),r.size=c.count(),r)},e.prototype.intersection=function(t){var r=new e,n=this.root,o=r.root,i=t.segments,s=i.length;if(0===s)return this;null!==n.value&&o.setValue(n.value);for(var a=0;a<s-1;++a){var u=i[a];if(null===(n=n.findChild(u)))return r;o=o.addChild(u),null!==n.value&&o.setValue(n.value)}var c=n.findChild(i[s-1]);return null===c||(o.children.push(c),r.size+=c.count()),r},e.prototype.iterator=function(){var e=[this.root];return new Rc((function(){for(;;){var t=e.shift();if(void 0===t)return null;for(var r=t.children.length;r>0;--r)e.unshift(t.children[r-1]);if(null!==t.value)return t}}))},e.prototype.postOrder=function(){var e=[new bc(this.root)];return new Rc((function(){for(;;){var t=e[0];if(void 0===t)return null;var r=t.nextChild();if(null===r){if(e.shift(),null!==t.node.value)return t.node}else{if(0===r.children.length)return r;e.unshift(new bc(r))}}}))},e.prototype.toString=function(){for(var e=["{"],t=this.iterator();t.hasNext();)e.length>1&&e.push(", "),e.push(t.next());return e.push("}"),e.join("")},e}();Tc.JSONPointerMap=Cc;var Pc=new Cc,Nc={},Ac=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Mc=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(Nc,"__esModule",{value:!0});var Lc=function(){function e(e,t,r,n){this.tokenRange=[],this.accumulatedTokens=0,this.totalTokens=0,this.tokeniser=e,this.base=t,this.startOffset=r,this.nextOffset=n}return e.prototype.total=function(){return this.totalTokens},e.prototype.accumulated=function(){return this.accumulatedTokens},e.prototype.newArray=function(e,t){return new Dc(this.tokeniser,this.currentPointer(this.base,this.totalTokens),e,t)},e.prototype.newObject=function(e,t){return new jc(this.tokeniser,this.currentPointer(this.base,this.totalTokens),e,t)},e.prototype.notEmptyAndSplitBy=function(e){return this.startOffset<e&&0!==this.totalTokens},e.prototype.add=function(e){return this.tokenRange[this.accumulatedTokens]=[this.nextOffset,e],this.nextOffset=e,++this.accumulatedTokens,++this.totalTokens,!1},e.prototype.setNextStart=function(e){this.nextOffset=e},e.prototype.skip=function(){++this.totalTokens,this.accumulatedTokens=0},e.prototype.takeAll=function(e){for(var t=this.totalTokens-this.accumulatedTokens,r=0;r<this.accumulatedTokens;++r){var n=this.tokenRange[r],o=n[0],i=n[1];this.take(e,this.base,t,t+r,o,i-o)}this.accumulatedTokens=0},e.prototype.splitStructureEnd=function(e){e.splitStructureEnd(this.base,this.totalTokens,this.startOffset,this.nextOffset+1-this.startOffset)},e.prototype.toString=function(){return this.base.toString()},e}(),Dc=function(e){function t(t,r,n,o){return e.call(this,t,r,n,o)||this}return Ac(t,e),t.prototype.take=function(e,t,r,n,o,i){e.accept(t.withIndex(n),o,i)},t.prototype.currentPointer=function(e,t){return e.withIndex(t)},t}(Lc),jc=function(e){function t(t,r,n,o){var i=e.call(this,t,r,n,o)||this;return i.pendingKeyName="",i.pendingKey=!0,i.keys=[],i}return Ac(t,e),t.prototype.add=function(t){return this.pendingKey?(this.setNextStart(t),this.pendingKeyName=this.tokeniser.getToken().value,this.pendingKey=!1):(this.keys[this.accumulated()]=this.pendingKeyName,this.pendingKey=!0,e.prototype.add.call(this,t)),!this.pendingKey},t.prototype.take=function(e,t,r,n,o,i){e.accept(t.withKey(this.keys[n-r]),o,i)},t.prototype.currentPointer=function(e){return e.withKey(this.pendingKeyName)},t}(Lc),xc=function(e){function t(t){return e.call(this,t,yc.ROOT,-1,0)||this}return Ac(t,e),t.prototype.take=function(e,t,r,n,o,i){if(this.total()>1)throw new Error("Invalid JSON: multiple values found");e.accept(t,o,i)},t.prototype.currentPointer=function(e){return e},t}(Lc),Uc=function(){function e(e){this.parentStack=[],this.tokeniser=new Pu.Tokeniser(e.$buffer,e.$offset,e.$length),this.structure=new xc(this.tokeniser),this.startOffset=this.tokeniser.offset(),this.json=e}return e.prototype.spanToNext=function(e,t){return this.spanTo(e,t,!0)},e.prototype.spanTo=function(e,t,r){var n,o;void 0===r&&(r=!1);var i=this.nextByte();if(i>=e)return 0;var s,a=this.parentStack.length,u=r,c=i;do{s=this.tokeniser.nextToken();var p=c;if(c=this.nextByte(),null===s){if(0!==this.parentStack.length)throw new Error("Invalid structure");break}if(s.type===Ou.tokens.VALUE)u=this.structure.add(c);else if(s.type===Ou.tokens.ARRAY_START)this.parentStack.push(this.structure),this.structure=this.structure.newArray(p,c);else if(s.type===Ou.tokens.MAP_START)this.parentStack.push(this.structure),this.structure=this.structure.newObject(p,c);else if(Ou.isStructEnd(s.type)){var l=this.parentStack.pop();this.structure.notEmptyAndSplitBy(i)?(this.structure.takeAll(t),this.structure.splitStructureEnd(t),l.skip(),l.setNextStart(c)):l.add(c),this.structure=l,u=!1}}while(u||c<e||this.nextTokenIsStructEnd(s,c));try{for(var f=Mc(this.parentStack),h=f.next();!h.done;h=f.next()){h.value.takeAll(t)}}catch(e){n={error:e}}finally{try{h&&!h.done&&(o=f.return)&&o.call(f)}finally{if(n)throw n.error}}return this.structure.takeAll(t),this.parentStack.length-a},e.prototype.nextTokenIsStructEnd=function(e,t){var r=this.tokeniser.getContext();return Ou.isStructStart(e.type)?0===r.expected():r.acceptsBreakMarker()&&t<this.json.$length&&this.json.$buffer[this.json.$offset+t]===Ou.BYTE_BREAK||!r.hasRemaining()},e.prototype.nextByte=function(){return this.tokeniser.offset()-this.startOffset},e.prototype.toString=function(){var e=["SpanParser"," next=",this.nextByte().toString()," ["];return this.parentStack.forEach((function(t){e.push(t.toString()),e.push(", ")})),e.push(this.structure.toString()),e.push("]"),e.join("")},e}();Nc.SpanParser=Uc;var Bc={};(function(e){"use strict";Object.defineProperty(Bc,"__esModule",{value:!0});var t=function(){function e(e){this.splitStructures=e}return e.prototype.accept=function(e,t,r){this.last=e,this.lastStart=t,this.lastLength=r},e.prototype.foundLast=function(){return void 0!==this.last},e.prototype.consumeLast=function(e){e.accept(this.last,this.lastStart,this.lastLength)},e.prototype.splitStructureEnd=function(e,t,r,n){this.splitStructures.put(e,{start:r,length:n,elements:t})},e}();function r(e,t,r,n){return e.equalBytes(t.$buffer,t.$offset+r,n)}var n=function(){function e(e,t,n,o,i,s){var a=this;this.removedSplitStructures=new Tc.JSONPointerMap,this.insertedSplitStructures=new Tc.JSONPointerMap,this.oldOffset=0,this.newOffset=0,this.pendingRemove=null,this.pendingInsert=null,this.inserter={accept:function(e,t,n){null!==a.pendingRemove&&a.pendingRemove.equalIgnoringIndexes(e)&&r(a.pendingRemoveValue,a.newValue,t,n)?(a.pendingRemove=null,a.pendingRemoveValue=null):(a.addInsert(e,a.partOf(a.newValue,t,n)),a.addRemove(null,null))},splitStructureEnd:function(e,t,r,n){a.insertedSplitStructures.put(e,{start:r,length:n,elements:t})}},this.remover={accept:function(e,t,n){null!==a.pendingInsert&&a.pendingInsert.equalIgnoringIndexes(e)&&r(a.pendingInsertValue,a.oldValue,t,n)?(a.pendingInsert=null,a.pendingInsertValue=null):(a.addRemove(e,a.copyPartOf(a.oldValue,t,n)),a.addInsert(null,null))},splitStructureEnd:function(e,t,r,n){a.removedSplitStructures.put(e,{start:r,length:n,elements:t})}},this.oldParser=new Nc.SpanParser(e),this.newParser=new Nc.SpanParser(t),this.oldValue=e,this.newValue=t,this.inserted=n,this.removed=o,this.partOf=i,this.copyPartOf=s}return e.prototype.match=function(e,t){return this.handleDelete(this.oldOffset,e-this.oldOffset),this.handleMatch(e,t),!0},e.prototype.handleDelete=function(e,t){this.checkInvariants();var r=e+t;this.oldParser.nextByte()<r&&(0!==this.oldParser.spanTo(r,this.remover)||this.oldParser.nextByte()>r)&&this.newParser.spanToNext(this.newOffset+1,this.inserter)},e.prototype.handleMatch=function(e,r){this.checkInvariants();var n=this.newOffset,o=e+r;this.newOffset+=r,this.oldOffset=o;var i=this.oldParser.nextByte(),s=this.newParser.nextByte();s>n&&i===e?this.oldParser.spanToNext(e+1,this.remover):i>e&&s===n&&this.newParser.spanToNext(n+1,this.inserter);var a=new t(this.removedSplitStructures),u=new t(this.insertedSplitStructures);this.oldParser.spanTo(o,a),this.newParser.spanTo(this.newOffset,u);var c=a.foundLast()&&this.oldParser.nextByte()>o,p=u.foundLast()&&this.newParser.nextByte()>this.newOffset;c&&p&&(a.consumeLast(this.remover),u.consumeLast(this.inserter))},e.prototype.insert=function(e){return this.checkInvariants(),this.newOffset+=e.length,this.newParser.nextByte()<this.newOffset&&(0!==this.newParser.spanTo(this.newOffset,this.inserter)||this.newParser.nextByte()>this.newOffset)&&this.oldParser.spanToNext(this.oldOffset+1,this.remover),!0},e.prototype.end=function(){this.handleDelete(this.oldOffset,this.oldValue.$length-this.oldOffset),this.addInsert(null,null),this.addRemove(null,null),this.replaceFullRemovedStructures(),this.replaceFullInsertedStructures()},e.prototype.addInsert=function(e,t){null!==this.pendingInsert&&this.inserted.put(this.pendingInsert,this.pendingInsertValue),this.pendingInsert=e,this.pendingInsertValue=t},e.prototype.addRemove=function(e,t){null!==this.pendingRemove&&this.removed.put(this.pendingRemove,this.pendingRemoveValue),this.pendingRemove=e,this.pendingRemoveValue=t},e.prototype.noChange=function(){},e.prototype.checkInvariants=function(){if(this.oldParser.nextByte()<this.oldOffset||this.newParser.nextByte()<this.newOffset)throw new Error("Invalid binary delta")},e.prototype.replaceFullRemovedStructures=function(){for(var e=this.removedSplitStructures.postOrder();e.hasNext();){var t=e.next(),r=t.value,n=this.removed.getEntry(t.pointer);null!==n&&n.numberOfChildren()===r.elements&&(n.setValue(this.copyPartOf(this.oldValue,r.start,r.length)),n.removeDescendants())}},e.prototype.replaceFullInsertedStructures=function(){for(var e=this.insertedSplitStructures.postOrder();e.hasNext();){var t=e.next(),r=t.value,n=this.inserted.getEntry(t.pointer);null!==n&&n.numberOfChildren()===r.elements&&(n.setValue(this.partOf(this.newValue,r.start,r.length)),n.removeDescendants())}},e}(),o=function(){function e(e){this.entries=[],this.parts=e;for(var t=e.iterator();t.hasNext();){var r=t.next();this.entries.push({key:r.pointer.toString(),value:r.value.get()})}this.length=this.entries.length}return e.prototype.get=function(e){return this.parts.get(yc.JSONPointer.parse(e)).get()},e.prototype.entrySet=function(){return this.entries},e.prototype.containsKey=function(e){return this.parts.contains(yc.JSONPointer.parse(e))},e.prototype.descendants=function(t){return new e(this.parts.descendants(yc.JSONPointer.parse(t)))},e.prototype.intersection=function(t){return new e(this.parts.intersection(yc.JSONPointer.parse(t)))},e}(),i=function(){function t(e,t,r,o){this.insertedMap=new Tc.JSONPointerMap,this.removedMap=new Tc.JSONPointerMap,this.factory=e,void 0!==o?o.visit(new n(t,r,this.insertedMap,this.removedMap,this.partOf.bind(this),this.copyPartOf.bind(this))):(this.insertedMap.put(yc.ROOT,t),this.removedMap.put(yc.ROOT,r))}return t.prototype.partOf=function(e,t,r){return new this.factory(e.$buffer,e.$offset+t,r)},t.prototype.copyPartOf=function(t,r,n){var o=t.$offset+r,i=e.alloc(n);return t.$buffer.copy(i,0,o,o+n),new this.factory(i,0,n)},t.prototype.removed=function(){return new o(this.removedMap)},t.prototype.inserted=function(){return new o(this.insertedMap)},t.prototype.hasChanges=function(){return 0!==this.removedMap.size||0!==this.insertedMap.size},t.prototype.toString=function(){return["REMOVE ",this.removedMap," INSERT ",this.insertedMap].join("")},t}();Bc.JSONDeltaImpl=i}).call(this,a({}).Buffer);var kc={},qc=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(kc,"__esModule",{value:!0});var Vc=new xu.Encoder;function Fc(e){return e instanceof Hc?e:new Hc(Vc.encode(e).flush())}function Gc(e,t){return t instanceof Cu.Int64Impl?t.toString():t}var Hc=function(e){function t(t,r,n){return void 0===r&&(r=0),void 0===n&&(n=t.length),e.call(this,t,r,n)||this}return qc(t,e),t.toString=function(){return"JSONImpl"},t.from=function(e){return Fc(e)},t.prototype.get=function(){return new ju.Decoder(this.$buffer,this.$offset,this.$length).nextValue()},t.prototype.diff=function(e,r){var n=this.binaryDiff(e);return"json"===r?new Bc.JSONDeltaImpl(t,e,this,n):n},t.prototype.binaryDiff=function(e){return Wc.diff(e,this)},t.prototype.jsonDiff=function(e){return this.diff(e,"json")},t.prototype.apply=function(e){return Wc.apply(this,e)},t.prototype.toString=function(){return JSON.stringify(this.get())},t.prototype.toJsonString=function(){return JSON.stringify(this.get(),Gc)},t}(oc.BytesImpl);kc.JSONImpl=Hc;var Wc=new nc.BinaryDeltaTypeImpl(Hc,Fc,cc.identity),Yc={},zc=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(Yc,"__esModule",{value:!0});var Qc=function(e){function t(){var t=e.call(this,"json",kc.JSONImpl,kc.JSONImpl,kc.JSONImpl.from,cc.identity,[],!0)||this;return t.JSON=kc.JSONImpl,t}return zc(t,e),t.prototype.fromJsonString=function(e){return kc.JSONImpl.from(JSON.parse(e))},t.prototype.from=function(e){return kc.JSONImpl.from(e)},t.prototype.validate=function(){},t}(ac.AbstractDataType);Yc.JSONDataTypeImpl=Qc;var $c={};(function(e){"use strict";var t=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty($c,"__esModule",{value:!0});var r=new xu.Encoder,n=new oc.BytesImpl(e.from([246])),o=function(e){function o(t,o,i,s,a){var u=this,c=function(e){return i(e,r),new oc.BytesImpl(r.flush())};return(u=e.call(this,t,o,oc.BytesImpl,c,(function(e){return n.equals(e)?null:new ju.Decoder(e.$buffer,e.$offset,e.$length).nextValueExpecting(s)}),[kc.JSONImpl],a)||this).serialise=i,u.fromValue=c,u}return t(o,e),o.prototype.writeValue=function(e){return null==e?n.asBuffer():(this.serialise(e,r),r.flush())},o.prototype.validate=function(){},o.prototype.from=function(e){return e.$buffer?e:this.fromValue(e)},o}(ac.AbstractDataType);$c.PrimitiveDataType=o}).call(this,a({}).Buffer);var Kc={},Jc=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();function Xc(e,t){null==e?t.encode(null):t.writeDouble(e)}Object.defineProperty(Kc,"__esModule",{value:!0});var Zc=function(e){function t(){return e.call(this,"double",Number,Xc,ju.isDouble,!1)||this}return Jc(t,e),t}($c.PrimitiveDataType);Kc.DoubleDataTypeImpl=Zc;var ep={},tp=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();function rp(e,t){null==e?t.encode(null):t.writeInt64(new Cu.Int64Impl(e))}Object.defineProperty(ep,"__esModule",{value:!0});var np=function(e){function t(){var t=e.call(this,"int64",Cu.Int64Impl,rp,ju.isInt64,!1)||this;return t.Int64=Cu.Int64Impl,t}return tp(t,e),t}($c.PrimitiveDataType);ep.Int64DataTypeImpl=np;var op={},ip=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();function sp(e,t){null==e?t.encode(null):t.encode(e.toString())}Object.defineProperty(op,"__esModule",{value:!0});var ap=function(e){function t(){return e.call(this,"string",String,sp,ju.isString,!0)||this}return ip(t,e),t}($c.PrimitiveDataType);op.StringDataTypeImpl=ap;var up={};function cp(e,t,r,n,o){if(0===r)return 0;if(e[0]===n)return 1;for(var i=1,s=t;s<t+r;s++)e[s]===o&&i++;return i}Object.defineProperty(up,"__esModule",{value:!0}),up.RECORD_DELIMITER=1,up.FIELD_DELIMITER=2,up.EMPTY_FIELD=3,up.RECORD_MU=4,up.FIELD_MU=5,String.fromCharCode(up.RECORD_DELIMITER),String.fromCharCode(up.FIELD_DELIMITER),String.fromCharCode(up.EMPTY_FIELD),String.fromCharCode(up.RECORD_MU),String.fromCharCode(up.FIELD_MU),up.bytesToString=function(e,t,r){for(var n="",o=t;o<t+r;++o)switch(e[o]){case up.FIELD_DELIMITER:n+="<FD>";break;case up.RECORD_DELIMITER:n+="<RD>";break;case up.EMPTY_FIELD:n+="<EF>";break;case up.FIELD_MU:n+="<FM>";break;case up.RECORD_MU:n+="<RM>";break;default:n+=String.fromCharCode(e[o])}return n},up.recordCount=function(e,t,r){return cp(e,t,r,up.RECORD_MU,up.RECORD_DELIMITER)},up.fieldCount=function(e,t,r){return cp(e,t,r,up.FIELD_MU,up.FIELD_DELIMITER)},up.findDelimiter=function(e,t,r,n){for(var o=t;o<r;o++)if(e[o]===n)return o;return r},up.isSingleEmptyRecord=function(e,t,r){return 1===r&&e[t]===up.RECORD_MU},up.recordIsSingleEmptyField=function(e,t,r){return 1===r&&(e[t]===up.FIELD_MU||e[t]===up.EMPTY_FIELD)};var pp={};(function(e){"use strict";function t(t,r){if(0!==t.length)if(1!==t.length||0!==t[0].length){var n=!1;t.forEach((function(t){if(n?r.write(up.RECORD_DELIMITER):n=!0,1===t.length&&""===t[0])r.write(up.FIELD_MU);else{var o=!1;t.forEach((function(t){o?r.write(up.FIELD_DELIMITER):o=!0,null!=t&&r.writeMany(e.from(t))}))}}))}else r.write(up.RECORD_MU)}Object.defineProperty(pp,"__esModule",{value:!0}),pp.toBuffer=function(e){var r=new Wa.BufferOutputStream;return t(e,r),r.getBuffer()}}).call(this,a({}).Buffer);var lp={};function fp(e,t,r){var n=e.getAbsoluteIndex(r);if(n>t.length-1)throw new Error("Index '"+r+"' does not have a matching entry for variable occurrence record: '"+e.name+"'");return n}function hp(e,t,r){var n=e.getAbsoluteIndex(r);if(n>t.length-1)throw new Error("Index '"+r+"' does not have a matching entry for variable occurrence field: '"+e.name+"'");return n}Object.defineProperty(lp,"__esModule",{value:!0}),lp.resolveRecordIndex=fp,lp.resolveFieldIndex=hp;var dp=function(){function e(e,t){this.recordV2Constructor=e,this.modelSchema=t}return e.prototype.schema=function(){return this.modelSchema},e.prototype.asValue=function(){return new this.recordV2Constructor(pp.toBuffer(this.model()))},e.prototype.get=function(e,t,r,n){var o,i;switch(void 0===t&&(t=0),void 0===n&&(n=0),arguments.length){case 1:var s=this.parseKey(e);e=s.recordName,i=s.recordIndex,o=s.fieldName,n=s.fieldIndex;break;case 2:o=t,i=0;break;default:o=r,i=t}var a=this.modelSchema.getRecord(e),u=a.getField(o),c=this.getRecord(a,i);return c[hp(u,c,n)]},e.prototype.recordCount=function(e){var t=this.modelSchema.getRecord(e);return t.isVariable?this.model().length-t.getIndex():t.min},e.prototype.fieldCount=function(e,t,r){var n=this.modelSchema.getRecord(e),o=n.getField(r);return o.isVariable?this.getRecord(n,t).length-o.getIndex():o.min},e.prototype.getRecord=function(e,t){var r=this.model();return r[fp(e,r,t)]},e.prototype.parseKey=function(e){var t,r,n,o=e.split(".",2);if(1===o.length)t=this.modelSchema.firstRecord().name,r=0,n=o[0];else{var i=this.parseKeyPart(o[0].trim());t=i[0],r=i[1],n=o[1]}var s=this.parseKeyPart(n);return{recordName:t,recordIndex:r,fieldName:s[0],fieldIndex:s[1]}},e.prototype.parseKeyPart=function(e){if(0===e.length)throw new Error("No name specified");var t=e.indexOf("(");if(-1===t)return[e,0];if(0===t)throw new Error("No name specified");var r=e.indexOf(")");if(-1===r||r<t)throw new Error("'(' found without closing ')");if(r<e.length-1)throw new Error("Characters found after closing ')");return[e.substring(0,t),parseInt(e.substring(t+1,r),10)]},e}();lp.AbstractRecordModel=dp;var yp,vp={};Object.defineProperty(vp,"__esModule",{value:!0}),function(e){e.DECIMAL="DECIMAL",e.INTEGER="INTEGER",e.STRING="STRING"}(yp=vp.Type||(vp.Type={}));var _p=function(){function e(e,t,r,n,o,i){this.name=e,this.type=t,this.min=r,this.max=n,this.scale=i,this.index=o,this.isVariable=r!==n}return e.prototype.getAbsoluteIndex=function(e){if(e<0||-1!==this.max&&e>this.max-1)throw new Error("Invalid index '"+e+"' for field '"+this.name+"'");return this.index+e},e.prototype.toString=function(){var e="Name="+this.name+", Type="+this.type;return this.min===this.max?e+=", Occurs="+this.min:(e+=", Min="+this.min+", Max=",-1===this.max?e+="Unlimited":e+=this.max),this.type===yp.DECIMAL&&(e+=", Scale="+this.scale),"Field ["+e+"]"},e.prototype.modelValue=function(){switch(this.type){case yp.DECIMAL:return function(e){switch(e.scale){case void 0:case 1:return"0.0";case 2:return"0.00";case 3:return"0.000";default:for(var t="0.",r=0;r<e.scale;++r)t+="0";return t}}(this);case yp.INTEGER:return"0";case yp.STRING:default:return""}},e.prototype.toJSON=function(){var e={name:this.name,type:this.type,min:this.min,max:this.max};return this.type===yp.DECIMAL&&(e.scale=this.scale),e},e}();vp.FieldImpl=_p,vp.normalise=function(e,t){switch(e.type){case yp.DECIMAL:var r=parseFloat(t);if(Number.isNaN(r))throw new Error("Invalid decimal value: '"+t+"'");return r.toFixed(e.scale);case yp.INTEGER:var n=parseInt(t,10),o=n.toString();if(Number.isNaN(n)||o.indexOf(".")>-1)throw new Error("Invalid integer value: '"+t+"'");return o;case yp.STRING:return t;default:return""}};var Sp={},Ep=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),mp=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};function wp(e,t,r){var n,o,i=r.length,s=e.lastField(),a=s.max,u=s.index;if(-1!==a&&i>u+a)throw new Error("Too many occurrences of field '"+e.name+"("+t+")."+s.name+"'");if(i<u+s.min)throw new Error("Too few field occurrences in record '"+e.name+"("+t+")'");try{for(var c=mp(e.fields),p=c.next();!p.done;p=c.next()){for(var l=p.value,f=l.index,h=l.min,d=f;d<f+h;++d)gp(e,t,l,d-f,r[d]);if(l.isVariable)for(d=f+h;d<i;d++){gp(e,t,l,d-f,r[d])}}}catch(e){n={error:e}}finally{try{p&&!p.done&&(o=c.return)&&o.call(c)}finally{if(n)throw n.error}}}function gp(e,t,r,n,o){try{vp.normalise(r,gc.requireNonNull(o,"FieldData"))}catch(o){throw new Error("Invalid value for field '"+e.name+"("+t+")."+r.name+"("+n+")")}}Object.defineProperty(Sp,"__esModule",{value:!0});var Tp=function(e){function t(t,r,n,o){var i=e.call(this,t,r)||this;return o&&function(e,t){var r,n,o=t.length,i=e.lastRecord(),s=i.index,a=i.max;if(-1!==a&&o>s+a)throw new Error("Too many occurrences of record '"+i.name+"'");if(o<s+i.min)throw new Error("Too few record occurrences");var u=e.records();try{for(var c=mp(u),p=c.next();!p.done;p=c.next()){for(var l=p.value,f=l.index,h=l.min,d=f;d<f+h;++d)wp(l,d-f,t[d]);if(l.isVariable)for(d=f+h;d<o;++d){wp(l,d-f,t[d])}}}catch(e){r={error:e}}finally{try{p&&!p.done&&(n=c.return)&&n.call(c)}finally{if(r)throw r.error}}}(r,n),i.recordData=n,i}return Ep(t,e),t.prototype.model=function(){return Array.from(this.recordData)},t}(lp.AbstractRecordModel);Sp.RecordModelImpl=Tp;var Op={};function Ip(e,t,r,n,o){var i=!1;r<n?i=bp(e,t,r,n,o):r>0&&e[r-1]===up.FIELD_DELIMITER&&o.push(""),i||t.push(Array.from(o)),o.length=0}function bp(e,t,r,n,o){var i=n-r;return 0===o.length&&1===i&&e[r]===up.FIELD_MU?(t.push([""]),!0):(o.push(e.toString("utf8",r,n)),!1)}Object.defineProperty(Op,"__esModule",{value:!0}),Op.parse=function(e,t,r){if(void 0===t&&(t=0),void 0===r&&(r=e.length),0===r)return[];if(1===r&&e[t]===up.RECORD_MU)return[[]];for(var n=[],o=[],i=t,s=t;s<r;++s)e[s]===up.RECORD_DELIMITER?(Ip(e,n,i,s,o),i=s+1):e[s]===up.FIELD_DELIMITER&&(bp(e,n,i,s,o),i=s+1);return function(e,t,r,n,o){if(n>r)bp(e,t,r,n,o);else{var i=e[n-1];i===up.RECORD_DELIMITER?t.push([]):i===up.FIELD_DELIMITER&&o.push("")}o.length&&t.push(Array.from(o))}(e,n,i,r,o),n};var Rp={};(function(e){"use strict";var t=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(Rp,"__esModule",{value:!0});var r,n=function(r){function n(){return r.call(this,e.from([]))||this}return t(n,r),n.prototype.changes=function(){return[]},n}(oc.BytesImpl);Rp.NO_CHANGE=new n,function(e){e.FIELD_CHANGED="FIELD_CHANGED",e.FIELDS_ADDED="FIELDS_ADDED",e.FIELDS_REMOVED="FIELDS_REMOVED",e.RECORDS_ADDED="RECORDS_ADDED",e.RECORDS_REMOVED="RECORDS_REMOVED"}(r=Rp.Type||(Rp.Type={}));var o=function(){function e(e,t,n,o,i){this.type=e,this.recordName=t,this.recordIndex=n,this.fieldName=o,this.fieldIndex=i;var s=t+"("+n+")";e!==r.RECORDS_REMOVED&&e!==r.RECORDS_ADDED&&(s+="."+o+"("+i+")"),this.key=s}return e.prototype.toString=function(){return this.type+" "+this.key},e}(),i=function(e){function n(t,r,n,o,i){void 0===r&&(r=0),void 0===n&&(n=t.length);var s=e.call(this,t,r,n)||this;return s.recordChanges=o,s.fieldChanges=i,s}return t(n,e),n.prototype.changes=function(e){var t=this,r=Op.parse(this.$buffer,this.$offset,this.$length),n=0,o=[];return e.records().forEach((function(e){if(r.length<n+e.min)throw new Error("Insufficient records of type "+e.name+" in delta for schema");n=e.isVariable?t.processVariableRecordChanges(e,n,r,o):t.processFixedRecordChanges(e,n,r,o)})),o},n.prototype.processFixedRecordChanges=function(e,t,r,n){for(var o=t,i=0;i<e.min;++i)this.processRecordChanges(o,e,i,r[o],n),o++;return o},n.prototype.processVariableRecordChanges=function(e,t,n,i){var s=n.length,a=e.max;if(-1!==a&&s>t+a)throw new Error("Too many records of type "+e.name+" in delta for schema");for(var u=t,c=this.recordChanges&&this.recordChanges[0]?this.recordChanges[1]:s,p=0;u<c;u++,p++)this.processRecordChanges(u,e,p,n[u],i);return this.recordChanges&&i.push(new o(this.recordChanges[0]?r.RECORDS_ADDED:r.RECORDS_REMOVED,e.name,this.recordChanges[1]-t,"",0)),u},n.prototype.processRecordChanges=function(e,t,r,n,o){var i=this,s=0;t.fields.forEach((function(a){s=a.isVariable?i.processVariableFieldChanges(t,r,e,a,s,n,o):i.processFixedFieldChanges(t,r,a,s,n,o)}))},n.prototype.processFixedFieldChanges=function(e,t,n,i,s,a){for(var u=s.length,c=i,p=0;p<n.min;++p){if(c>=u)throw new Error("Insufficient fields of type "+n.name+" in delta for schema record "+e.name);""!==s[c]&&a.push(new o(r.FIELD_CHANGED,e.name,t,n.name,p)),c++}return c},n.prototype.processVariableFieldChanges=function(e,t,n,i,s,a,u){var c=a.length,p=s;if(c<p+i.min)throw new Error("Insufficient fields of type "+i.name+" in delta for schema record "+e.name);for(var l=this.fieldChanges[n],f=l?l[1]:c,h=0;p<f;p++,h++)""!==a[p]&&u.push(new o(r.FIELD_CHANGED,e.name,t,i.name,h));return l&&u.push(new o(l[0]?r.FIELDS_ADDED:r.FIELDS_REMOVED,e.name,t,i.name,l[1])),p},n.prototype.toString=function(){return up.bytesToString(this.$buffer,this.$offset,this.$length)},n}(oc.BytesImpl);Rp.RecordV2DeltaImpl=i}).call(this,a({}).Buffer);var Cp={};(function(e){"use strict";var t=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(Cp,"__esModule",{value:!0});var r=function(){function e(){this.delta=new Wa.BufferOutputStream,this.changed=!1,this.recordChanges=null,this.fieldChanges={}}return e.prototype.write=function(e,t,r){void 0!==t&&void 0!==r?this.delta.writeMany(e,t,r):this.delta.write(e)},e.prototype.getDelta=function(){return this.delta.getBuffer()},e.prototype.size=function(){return this.delta.count},e.prototype.hasChanges=function(){return this.changed},e.prototype.setChanged=function(){this.changed=!0},e.prototype.setRecordsChanged=function(e,t){this.recordChanges=[e,t],this.changed=!0},e.prototype.getRecordChanges=function(){return this.recordChanges},e.prototype.setFieldsAdded=function(e,t){this.fieldChanges[e]=[!0,t],this.changed=!0},e.prototype.setFieldsRemoved=function(e,t){this.fieldChanges[e]=[!1,t],this.changed=!0},e.prototype.getFieldChanges=function(){return this.fieldChanges},e}();function n(e,t,r,n,i,s,a,u){if(0!==a){if(!up.recordIsSingleEmptyField(i,s,a))return 0===n?(u.write(i,s,a),void u.setFieldsAdded(e,0)):void(up.recordIsSingleEmptyField(t,r,n)?function(e,t,r,n,o){var i=t[r];i===up.EMPTY_FIELD?o.write(t,r+1,n-1):(o.write(t,r,n),i!==up.FIELD_DELIMITER&&o.setChanged());up.fieldCount(t,r,n)>1&&o.setFieldsAdded(e,1)}(e,i,s,a,u):function(e,t,r,n,i,s,a,u){for(var c=up.fieldCount(t,r,n),p=up.fieldCount(i,s,a),l=Math.min(c,p),f=r,h=r,d=s,y=s,v=u.size(),_=0;_<l;++_)h=up.findDelimiter(t,h,r+n,up.FIELD_DELIMITER),y=up.findDelimiter(i,y,s+a,up.FIELD_DELIMITER),_>0&&u.write(up.FIELD_DELIMITER),o(t,f,h-f,i,d,y-d,u),f=++h,d=++y;p!==c&&(p>c?(u.write(i,d-1,s+a-d+1),u.setFieldsAdded(e,l)):u.setFieldsRemoved(e,l));1===p&&v===u.size()&&u.write(up.FIELD_MU)}(e,t,r,n,i,s,a,u));!function(e,t,r,n,o){if(up.recordIsSingleEmptyField(t,r,n))o.write(up.FIELD_MU);else{up.fieldCount(t,r,n)>1&&o.setFieldsRemoved(e,1),o.write(up.EMPTY_FIELD),o.setChanged()}}(e,t,r,n,u)}else 0!==n&&u.setFieldsRemoved(e,0)}function o(e,t,r,n,o,i,s){(function(e,t,r,n,o,i){if(r===i){if(0===r||function(e,t,r,n,o){for(var i=0;i<o;++i)if(e[t+i]!==r[n+i])return!1;return!0}(e,t,n,o,r))return!0}else{if(1===r&&e[t]===up.EMPTY_FIELD&&0===i)return!0;if(1===i&&n[o]===up.EMPTY_FIELD&&0===r)return!0}return!1})(e,t,r,n,o,i)||(0===i?s.write(up.EMPTY_FIELD):s.write(n,o,i),s.setChanged())}function i(t){if(t instanceof s)return t;if(e.isBuffer(t))return new s(t);throw new Error("Unable to read RecordV2 value from: "+t)}var s=function(o){function s(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=e.length),o.call(this,e,t,r)||this}return t(s,o),s.toString=function(){return"RecordV2Impl"},s.from=function(e){return i(e)},s.prototype.apply=function(e){return a.apply(this,e)},s.prototype.toString=function(){return JSON.stringify(this.asRecords())},s.prototype.asRecords=function(){return Op.parse(this.$buffer,this.$offset,this.$length)},s.prototype.asFields=function(){return this.asRecords().reduce((function(e,t){return e.concat(t)}),[])},s.prototype.asModel=function(e){return new Sp.RecordModelImpl(s,e,this.asRecords(),!1)},s.prototype.asValidatedModel=function(e){return new Sp.RecordModelImpl(s,e,this.asRecords(),!0)},s.prototype.binaryDiff=function(e){return a.diff(e,this)},s.prototype.diff=function(t){var o=t.$buffer,i=t.$offset,s=t.$length,a=this.$buffer,u=this.$offset,c=this.$length;if(0===c)return 0===s?Rp.NO_CHANGE:new Rp.RecordV2DeltaImpl(e.from([]),0,0,[!1,0],{});if(up.isSingleEmptyRecord(a,u,c))return up.isSingleEmptyRecord(o,i,s)?Rp.NO_CHANGE:function(t){switch(t){case 0:return new Rp.RecordV2DeltaImpl(e.from([up.RECORD_MU]),0,1,[!0,0],{});case 1:return new Rp.RecordV2DeltaImpl(e.from([up.RECORD_MU]),0,1,null,{0:[!1,0]});default:return new Rp.RecordV2DeltaImpl(e.from([up.RECORD_MU]),0,1,[!1,1],{0:[!1,0]})}}(up.recordCount(o,i,s));if(0===s)return function(e,t,r){return new Rp.RecordV2DeltaImpl(e,t,r,[!0,0],{})}(a,u,c);if(up.isSingleEmptyRecord(o,i,s))return function(e,t,r){return 1===up.recordCount(e,t,r)?new Rp.RecordV2DeltaImpl(e,t,r,null,{0:[!0,0]}):new Rp.RecordV2DeltaImpl(e,t,r,[!0,1],e[0]===up.RECORD_DELIMITER?{}:{0:[!0,0]})}(a,u,c);var p=function(e,t,o,i,s,a){for(var u=new r,c=up.recordCount(e,t,o),p=up.recordCount(i,s,a),l=Math.min(c,p),f=t,h=t,d=s,y=s,v=0;v<l;++v)h=up.findDelimiter(e,h,t+o,up.RECORD_DELIMITER),y=up.findDelimiter(i,y,s+a,up.RECORD_DELIMITER),v>0&&u.write(up.RECORD_DELIMITER),n(v,e,f,h-f,i,d,y-d,u),f=++h,d=++y;return p!==c&&(p>c&&u.write(i,d-1,s+a-d+1),u.setRecordsChanged(p>c,l)),u}(o,i,s,a,u,c);if(p.hasChanges()){var l=p.getDelta();return new Rp.RecordV2DeltaImpl(l,0,l.length,p.getRecordChanges(),p.getFieldChanges())}return Rp.NO_CHANGE},s}(oc.BytesImpl);Cp.RecordV2Impl=s;var a=new nc.BinaryDeltaTypeImpl(s,i,cc.identity)}).call(this,a({}).Buffer);var Pp={};Object.defineProperty(Pp,"__esModule",{value:!0});var Np=function(){function e(){this.records=[]}return e.prototype.addFields=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];if(arguments.length>1?t.unshift(e):t=e,t){var n=this.records.length?this.records[this.records.length-1]:[];this.records[Math.max(this.records.length-1,0)]=n.concat(t)}return this},e.prototype.addRecord=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return arguments.length>1?t.unshift(e):t=e,t?this.records.push([].concat(t)):this.records.push([]),this},e.prototype.clear=function(){return this.records=[],this},e.prototype.build=function(){return new Cp.RecordV2Impl(pp.toBuffer(this.records))},e}();Pp.RecordV2BuilderImpl=Np;var Ap={};Object.defineProperty(Ap,"__esModule",{value:!0});var Mp=function(){function e(e,t,r,n,o){var i=this;this.name=e,this.min=t,this.max=r,this.index=n,this.isVariable=t!==r,this.fields=o,this.fieldsMap={},o.forEach((function(e){i.fieldsMap[e.name]=e}))}return e.prototype.getFields=function(){return[].concat(this.fields)},e.prototype.getField=function(e){var t=this.fieldsMap[e];if(t)return t;throw new Error("Record '"+this.name+"' has no field named '"+e+"'")},e.prototype.lastField=function(){return this.fields[this.fields.length-1]},e.prototype.createModel=function(){var e=[];return this.fields.forEach((function(t){for(var r=0;r<t.min;++r)e.push(t.modelValue())})),e},e.prototype.getAbsoluteIndex=function(e){if(e<0||-1!==this.max&&e>this.max-1)throw new Error("Invalid index '"+e+"' for record '"+this.name+"'");return this.index+e},e.prototype.toString=function(){var e="Name="+this.name;return this.min===this.max?e+=", Occurs="+this.min:(e+=", Min="+this.min+", Max=",-1===this.max?e+="Unlimited":e+=this.max),"Record ["+(e+=", Fields="+this.fields)+"]"},e}();Ap.RecordImpl=Mp,Ap.toJSON=function(e){return{fields:e.fields.map((function(e){return e.toJSON()})),name:e.name,min:e.min,max:e.max}};var Lp={},Dp=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(Lp,"__esModule",{value:!0});var jp=function(e){function t(t,r){var n=e.call(this,t,r)||this;return n.recordData=r.createModel(),n}return Dp(t,e),t.prototype.model=function(){return this.recordData},t.prototype.set=function(e,t,r,n,o){var i,s;switch(void 0===n&&(n=0),arguments.length){case 2:o=t;var a=this.parseKey(e);e=a.recordName,i=a.recordIndex,s=a.fieldName,n=a.fieldIndex;break;case 3:o=r,s=t,i=0;break;case 5:i=t,s=r;break;default:i=0,s=""}var u=this.schema().getRecord(e),c=this.getRecord(u,i),p=u.getField(s);return c[lp.resolveFieldIndex(p,c,n)]=vp.normalise(p,o),this},t.prototype.add=function(e,t){for(var r,n,o,i=[],s=2;s<arguments.length;s++)i[s-2]=arguments[s];if(arguments.length>2&&"number"==typeof t)o=t,i=i.slice(2),r=this.schema().getRecord(e),n=this.getRecord(r,o);else{if(r=this.schema().lastRecord(),!(this.recordData.length>r.index))throw new Error("Variable record '"+r.name+"' has no occurrences to add a field to");n=this.recordData[this.recordData.length-1]}return this.addValuesToRecord(r,n,i),this},t.prototype.addRecord=function(){var e=this.schema().lastRecord();if(!e.isVariable)throw new Error("Record '"+e.name+"' is not variable");var t=e.max;if(-1!==t&&this.recordData.length-e.index>=t)throw new Error("Record '"+e.name+"' already has maximum number of occurrences");return this.recordData.push(e.createModel()),this},t.prototype.removeRecord=function(e){var t=this.schema().lastRecord();if(!t.isVariable)throw new Error("Record '"+t.name+"' is not variable");var r=lp.resolveRecordIndex(t,this.recordData,e);if(this.recordData.length-t.index-1<t.min)throw new Error("Removing an occurrence of record '"+t.name+"' would violate the minimum number of occurrences");return this.recordData.splice(r,1),this},t.prototype.removeField=function(e,t,r){var n=this.schema().getRecord(e),o=this.getRecord(n,t),i=n.lastField();if(!i.isVariable)throw new Error("Field '"+i.name+"' is not a variable field");var s=lp.resolveFieldIndex(i,o,r);if(o.length-i.index-1<i.min)throw new Error("Removing an occurrence of field '"+i.name+"' would violate the minimum number of occurrences");return o.splice(s,1),this},t.prototype.addValuesToRecord=function(e,t,r){var n=e.lastField();if(!n.isVariable)throw new Error("Final field of record '"+e.name+"' is not variable");var o=n.max;if(-1!==o&&t.length-n.index+r.length>o)throw new Error("Adding values would exceed maximum number of field occurrences");r.forEach((function(e){t.push(vp.normalise(n,e))}))},t}(lp.AbstractRecordModel);Lp.MutableRecordModelImpl=jp;var xp={};Object.defineProperty(xp,"__esModule",{value:!0});var Up=function(){function e(e,t){var r=this;this.recordsMap={},this.recordV2Constructor=e,this.recordsArray=t,t.forEach((function(e){r.recordsMap[e.name]=e}))}return e.prototype.getRecord=function(e){var t=this.recordsMap[e];if(t)return t;throw new Error("Record '"+e+"' is not known")},e.prototype.getRecords=function(){return[].concat(this.recordsArray)},e.prototype.records=function(){return this.recordsArray},e.prototype.firstRecord=function(){return this.recordsArray[0]},e.prototype.lastRecord=function(){return this.recordsArray[this.recordsArray.length-1]},e.prototype.createMutableModel=function(){return new Lp.MutableRecordModelImpl(this.recordV2Constructor,this)},e.prototype.createModel=function(){var e=[];return this.recordsArray.forEach((function(t){var r=t.createModel();if(t.min>0)for(var n=0;n<t.min;++n)e.push([].concat(r))})),e},e.prototype.asJSON=function(){return JSON.stringify({records:this.recordsArray.map(Ap.toJSON)})},e.prototype.toString=function(){return"Schema [Records="+this.recordsArray+"]"},e}();xp.SchemaImpl=Up;var Bp={},kp=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};function qp(e,t,r){if(t<0)throw new Error("'"+e+"' has invalid 'min' value '"+t+"'");if(-1!==r&&(r<1||r<t))throw new Error("'"+e+"' has invalid 'max' value '"+r+"'")}Object.defineProperty(Bp,"__esModule",{value:!0});var Vp=function(){function e(e){this.records=[],this.recordV2Constructor=e}return e.prototype.record=function(e,t,r){return void 0===t&&(t=1),void 0===r&&(r=t),qp(e,t,r),this.checkRecord(e),void 0!==this.currentFields&&this.addRecord(),this.currentName=e,this.currentMin=t,this.currentMax=r,this.currentFields=[],this},e.prototype.string=function(e,t,r){return void 0===t&&(t=1),void 0===r&&(r=t),qp(e,t,r),this.checkField(e),this.currentFields.push(new vp.FieldImpl(e,vp.Type.STRING,t,r,this.fieldIndex())),this},e.prototype.integer=function(e,t,r){return void 0===t&&(t=1),void 0===r&&(r=t),qp(e,t,r),this.checkField(e),this.currentFields.push(new vp.FieldImpl(e,vp.Type.INTEGER,t,r,this.fieldIndex())),this},e.prototype.decimal=function(e,t,r,n){return void 0===r&&(r=1),void 0===n&&(n=r),qp(e,r,n),function(e,t){if(t<1)throw new Error("'"+e+"' has invalid 'scale' value '"+t+"'")}(e,t),this.checkField(e),this.currentFields.push(new vp.FieldImpl(e,vp.Type.DECIMAL,r,n,this.fieldIndex(),t)),this},e.prototype.build=function(){if(void 0!==this.currentFields&&this.addRecord(),0===this.records.length)throw new Error("Schema has no records");return new xp.SchemaImpl(this.recordV2Constructor,this.records)},e.prototype.fieldIndex=function(){var e=this.currentFields;if(0===e.length)return 0;var t=e[e.length-1];return t.index+t.max},e.prototype.addRecord=function(){var e,t=this.currentFields;if(0===t.length)throw new Error("No fields specified for record: '"+this.currentName+"'");if(0===this.records.length)e=0;else{var r=this.records[this.records.length-1];e=r.index+r.max}this.records.push(new Ap.RecordImpl(this.currentName,this.currentMin,this.currentMax,e,t))},e.prototype.checkRecord=function(e){var t,r;if(gc.requireNonNull(e,"name"),e===this.currentName)throw new Error("Duplicate record name: '"+e+"'");if(this.records.length)try{for(var n=kp(this.records),o=n.next();!o.done;o=n.next()){if(e===o.value.name)throw new Error("Duplicate record name: '"+e+"'")}}catch(e){t={error:e}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}if(void 0!==this.currentFields&&this.currentMin!==this.currentMax)throw new Error("Record '"+e+"' not allowed after variable multiplicity record: '"+this.currentName+"'")},e.prototype.checkField=function(e){var t,r;if(gc.requireNonNull(e,"name"),void 0===this.currentFields)throw new Error("Cannot add field '"+e+"' as there is no current record");if(this.currentFields.length){try{for(var n=kp(this.currentFields),o=n.next();!o.done;o=n.next()){if(e===o.value.name)throw new Error("Duplicate field name: '"+e+"'")}}catch(e){t={error:e}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}var i=this.currentFields[this.currentFields.length-1];if(i.isVariable)throw new Error("Field '"+e+"' is not allowed after variable multiplicity field '"+i.name+"'")}},e}();Bp.SchemaBuilderImpl=Vp;var Fp={};Object.defineProperty(Fp,"__esModule",{value:!0});var Gp=function(){function e(e){this.recordV2Constructor=e}return e.prototype.parse=function(e){var t,r=new Bp.SchemaBuilderImpl(this.recordV2Constructor);try{t=JSON.parse(e)}catch(e){throw new Error("Invalid Schema JSON string")}if(void 0===t.records)throw new Error("Schema has no records");return t.records.forEach((function(e){void 0!==e.occurs?r.record(e.name,e.occurs):r.record(e.name,e.min,e.max),e.fields&&e.fields.forEach((function(e){var t,n;void 0!==e.occurs?(t=e.occurs,n=e.occurs):(t=e.min,n=e.max);var o=e.type||"STRING";switch(o.toUpperCase()){case"STRING":r.string(e.name,t,n);break;case"INTEGER":r.integer(e.name,t,n);break;case"DECIMAL":var i=e.scale||2;r.decimal(e.name,i,t,n);break;default:throw new Error("Invalid field type value '"+o+"'")}}))})),r.build()},e}();Fp.SchemaParser=Gp;var Hp={},Wp=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();function Yp(){}Object.defineProperty(Hp,"__esModule",{value:!0});var zp=function(e){function t(t){void 0===t&&(t=Yp);var r=e.call(this,"record_v2",Cp.RecordV2Impl,Cp.RecordV2Impl,Cp.RecordV2Impl.from,cc.identity,[],!0)||this;return r.RecordV2=Cp.RecordV2Impl,r.validator=t,r}return Wp(t,e),t.prototype.from=function(e){return Cp.RecordV2Impl.from(e)},t.prototype.validate=function(e){this.validator(gc.requireNonNull(e,"RecordV2 instance"))},t.prototype.parseSchema=function(e){return new Fp.SchemaParser(Cp.RecordV2Impl).parse(e)},t.prototype.schemaBuilder=function(){return new Bp.SchemaBuilderImpl(Cp.RecordV2Impl)},t.prototype.valueBuilder=function(){return new Pp.RecordV2BuilderImpl},t.prototype.withSchema=function(e){return new t((function(t){return t.asValidatedModel(e)}))},t}(ac.AbstractDataType);Hp.RecordV2DataTypeImpl=zp;var Qp={};Object.defineProperty(Qp,"__esModule",{value:!0});var $p=function(){function e(e,t,r){this.metadata=e,this.originalEvent=t,this.value=r,this.sequence=e.sequence,this.timestamp=e.timestamp,this.author=e.author,this.isEditEvent=!e.equals(t),this.isOriginalEvent=!this.isEditEvent}return e.create=function(t,r,n){return new e(t,r,n)},e.prototype.withValue=function(t){return new e(this.metadata,this.originalEvent,t)},e.prototype.equals=function(t){return!!(t&&t instanceof e)&&(this.metadata.equals(t.metadata)&&this.originalEvent.equals(t.originalEvent)&&this.value===t.value)},e.prototype.toString=function(){return(this.isEditEvent?"Edit of ["+this.originalEvent+"]":"")+"["+this.metadata+"] "+this.value},e}();Qp.EventImpl=$p;var Kp={};Object.defineProperty(Kp,"__esModule",{value:!0});var Jp=function(){function e(e,t,r){this.sequence=e,this.timestamp=t,this.author=r}return e.prototype.equals=function(t){return!!(t&&t instanceof e)&&(this.sequence===t.sequence&&this.timestamp===t.timestamp&&this.author===t.author)},e}();Kp.EventMetadataImpl=Jp;var Xp={},Zp=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(Xp,"__esModule",{value:!0});var el=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Zp(t,e),t.prototype.read=function(e){var t=ba.readInt64(e),r=ba.readInt64(e),n=ba.readString(e);return new Kp.EventMetadataImpl(t.toNumber(),r.toNumber(),n)},t.prototype.write=function(e,t){ba.writeInt64(e,t.sequence),ba.writeInt64(e,t.timestamp),ba.writeString(e,t.author)},t}(Pa.AbstractSerialiser);Xp.EventMetadataImplSerialiser=new el;var tl,rl={},nl=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();function ol(e,t){var r=new Wa.BufferOutputStream;t.isEditEvent?(ba.writeByte(r,tl.EDIT_EVENT),Xp.EventMetadataImplSerialiser.write(r,t.originalEvent)):ba.writeByte(r,tl.ORIGINAL_EVENT),Xp.EventMetadataImplSerialiser.write(r,t);var n=e(t.value);return ba.writeBytes(r,n.$buffer),r.getBuffer()}function il(e,t){var r=new Ga.BufferInputStream(t.$buffer),n=ba.readByte(r);switch(n){case tl.ORIGINAL_EVENT:return function(e,t){var r=Xp.EventMetadataImplSerialiser.read(t),n=e(ba.readBytes(t));return Qp.EventImpl.create(r,r,n)}(e,r);case tl.EDIT_EVENT:return function(e,t){var r=Xp.EventMetadataImplSerialiser.read(t),n=Xp.EventMetadataImplSerialiser.read(t),o=e(ba.readBytes(t));return Qp.EventImpl.create(n,r,o)}(e,r);default:throw new Error("Unrecognised event type: "+n)}}Object.defineProperty(rl,"__esModule",{value:!0}),function(e){e[e.ORIGINAL_EVENT=0]="ORIGINAL_EVENT",e[e.EDIT_EVENT=1]="EDIT_EVENT"}(tl||(tl={}));var sl=function(e){function t(t,r,n,o){var i=e.call(this,t,Qp.EventImpl,oc.BytesImpl,(function(e){return function(e,t){if(!t)throw new Error("Cannot convert null event to Bytes");return new oc.BytesImpl(ol(e,t))}(o,e)}),(function(e){return il(n,e)}),[],!0)||this;return i.valueToBytes=o,i.valueTypeName=r,i}return nl(t,e),t.create=function(e){return new t("timeseriesevent-"+e.name(),e.name(),e.readValue.bind(e),e.toBytes.bind(e))},t.prototype.writeValue=function(e){return ol(this.valueToBytes,e)},t.prototype.validate=function(){},t.prototype.from=function(e){return e instanceof Nu.BufferSlice?e:this.valueToBytes(e.value)},t}(ac.AbstractDataType);rl.TimeSeriesEventDataType=sl;var al={};(function(e){"use strict";Object.defineProperty(al,"__esModule",{value:!0});var t=function(){function t(){this.recordv2Impl=new Hp.RecordV2DataTypeImpl,this.binaryImpl=new fc.BinaryDataTypeImpl,this.stringImpl=new op.StringDataTypeImpl,this.doubleImpl=new Kc.DoubleDataTypeImpl,this.int64Impl=new ep.Int64DataTypeImpl,this.jsonImpl=new Yc.JSONDataTypeImpl,this.anyImpl=new wu.AnyDataTypeImpl}return t.prototype.binary=function(){return this.binaryImpl},t.prototype.string=function(){return this.stringImpl},t.prototype.double=function(){return this.doubleImpl},t.prototype.int64=function(){return this.int64Impl},t.prototype.json=function(){return this.jsonImpl},t.prototype.recordv2=function(){return this.recordv2Impl},t.prototype.any=function(){return this.anyImpl},t.prototype.timeseries=function(e){return rl.TimeSeriesEventDataType.create(e)},t.prototype.getByName=function(e){switch(e.toLowerCase()){case"json":return this.json();case"int64":return this.int64();case"binary":return this.binary();case"string":return this.string();case"double":return this.double();case"record_v2":return this.recordv2();default:return}},t.prototype.getByValue=function(t){return t===lu.TopicTypeEnum.BINARY||t instanceof lc.BinaryImpl||e.isBuffer(t)?this.binary():t===lu.TopicTypeEnum.JSON||t instanceof kc.JSONImpl||t.constructor===Object||"boolean"==typeof t?this.json():t===lu.TopicTypeEnum.STRING||"string"==typeof t?this.string():t===lu.TopicTypeEnum.DOUBLE||"number"==typeof t?this.double():t===lu.TopicTypeEnum.INT64||t instanceof Cu.Int64Impl?this.int64():t===lu.TopicTypeEnum.RECORD_V2||t instanceof Cp.RecordV2Impl?this.recordv2():void 0},t.prototype.get=function(e){var t;return"string"==typeof e&&(t=this.getByName(e)),t||(t=this.getByValue(e)),t||(t=this.getByClassSafely(e)),t||null},t.prototype.getChecked=function(e){if(null==e)throw new Error("No data type for "+e);if(e instanceof Hp.RecordV2DataTypeImpl||e instanceof fc.BinaryDataTypeImpl||e instanceof op.StringDataTypeImpl||e instanceof Kc.DoubleDataTypeImpl||e instanceof ep.Int64DataTypeImpl||e instanceof Yc.JSONDataTypeImpl)return e;var t=this.get(e);if(null===t)throw new Error("No data type for "+e);return t},t.prototype.getValueClassChecked=function(e){switch(this.getChecked(e)){case this.jsonImpl:return kc.JSONImpl;case this.binaryImpl:return lc.BinaryImpl;case this.stringImpl:return String;case this.doubleImpl:return Number;case this.int64Impl:return Cu.Int64Impl;case this.recordv2Impl:return Cp.RecordV2Impl;default:return}},t.prototype.getByClassSafely=function(e){switch(e){case kc.JSONImpl:return this.jsonImpl;case lc.BinaryImpl:return this.binaryImpl;case String:return this.stringImpl;case Number:return this.doubleImpl;case Cu.Int64Impl:return this.int64Impl;case Cp.RecordV2Impl:return this.recordv2Impl;default:return}},t.prototype.getByClass=function(e){var t=this.getByClassSafely(e);if(t)return t;throw new Error("No data type for "+e)},t}(),r=new t;al.DataTypes=r}).call(this,{isBuffer:Mu});var ul={};Object.defineProperty(ul,"__esModule",{value:!0}),ul.memoize=function(e,t,r){void 0===t&&(t={}),void 0===r&&(r=cc.identity);var n=function(){for(var n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];var i=r(n),s=t[i];return s||(s=e.apply(e,n),t[i]=s,s)};return n._uncached=e,n};var cl={};function pl(e){return"'"===e||'"'===e}function ll(e){var t=[],r="",n=0,o=!1;e:for(;n<e.length;n++){var i=e[n];if(pl(i)){for(n++,r="",o=!1;n<e.length;n++){var s=e[n];if(o)r+=s,o=!1;else if("\\"===s)o=!0;else{if(s===i){t.push(r);continue e}r+=s}}throw new Error("Mis-quoted input")}}return t}function fl(e){for(var t=0;t<e.length;t++){var r=e.charAt(t);if('"'===r||"\\"===r||"'"===r){for(var n="",o=0;o<e.length;o++){var i=e.charAt(o);switch(i){case"\\":n+="\\\\";break;case'"':n+='\\"';break;case"'":n+="\\'";break;default:n+=i}}return n}}return e}Object.defineProperty(cl,"__esModule",{value:!0}),cl.split=function(e,t){if(""===e)return[];for(var r=[],n=t.length,o=e.lastIndexOf(t);o>-1;)r.push(e.substring(o+n,e.length)),o=(e=e.substring(0,o)).lastIndexOf(t);return r.push(e),r.reverse()},cl.escape=fl,cl.stringToSet=function(e){return new Set(ll(e))},cl.collectionToString=function(e){var t=[];return e.forEach((function(e){t.push('"'+fl(e)+'"')})),t.join(",")};var hl={};Object.defineProperty(hl,"__esModule",{value:!0}),function(e){e.PATH=">",e.SPLIT_PATH_PATTERN="?",e.FULL_PATH_PATTERN="*",e.SELECTOR_SET="#"}(hl.Prefix||(hl.Prefix={})),function(e){e.PATH=">",e.SPLIT_PATH_PATTERN="?",e.FULL_PATH_PATTERN="*",e.SELECTOR_SET="#"}(hl.Type||(hl.Type={}));var dl={};Object.defineProperty(dl,"__esModule",{value:!0}),dl.PATH_SEPARATOR="/",dl.split=function(e){return e.split(dl.PATH_SEPARATOR)},dl.canonicalise=function(e){if(!e)return"";var t=e.length,r=t>0&&e.charAt(0)===dl.PATH_SEPARATOR?1:0,n=t>1&&e.charAt(t-1)===dl.PATH_SEPARATOR?1:0;return e.substring(r,t-n)};var yl=function(e){this.includesDescendants=e};dl.DescendantQualifier=Object.freeze({MATCH:new yl(!1),DESCENDANTS_OF_MATCH:new yl(!0),MATCH_AND_DESCENDANTS:new yl(!0)});var vl={};Object.defineProperty(vl,"__esModule",{value:!0});var _l=function(){function e(e,t,r){this.type=e,this.prefix=t,this.expression=r}return e.prototype.selects=function(e){var t=dl.canonicalise(e);return 0===t.indexOf(this.prefix)&&this.doSelects(t)},e.prototype.toString=function(){return this.expression},e}();vl.AbstractTopicSelector=_l;var Sl={};Object.defineProperty(Sl,"__esModule",{value:!0}),Sl.regex=function(e,t){if(void 0===t&&(t=""),""===e)throw new Error("Empty regular expression ["+t+"]");try{var r=new RegExp(e);return function(e){var t=r.exec(e);return t&&t[0]===e}}catch(e){throw new Error("Bad regular expression ["+e.message+", "+t+"]")}};var El={},ml=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(El,"__esModule",{value:!0});var wl=function(e){function t(t){var r=e.call(this,t.type,t.prefix,t.expression)||this;if(r.pattern=void 0,r.qualifier=t.qualifier,!t.base)throw new Error("Invalid full-path selector");return r.base=t.base,r}return ml(t,e),t.prototype.doSelects=function(e){if(!this.pattern)switch(this.qualifier){case dl.DescendantQualifier.DESCENDANTS_OF_MATCH:this.pattern=Sl.regex(this.base+"/.+");break;case dl.DescendantQualifier.MATCH_AND_DESCENDANTS:this.pattern=Sl.regex(this.base+"(?:$|/.+)");break;default:case dl.DescendantQualifier.MATCH:this.pattern=Sl.regex(this.base)}return!0===this.pattern(e)},t}(vl.AbstractTopicSelector);El.FullPathSelector=wl;var gl={},Tl=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(gl,"__esModule",{value:!0});var Ol=function(e){function t(t){var r=this,n=t.remainder;if(t.type===hl.Type.PATH){if(""===t.prefix)throw new Error("Topic path must have at least one part: "+n);if(t.prefix.indexOf("//")>-1)throw new Error("Topic path contains empty part: "+n)}return(r=e.call(this,t.type,t.prefix,t.expression)||this).qualifier=t.qualifier,r.path=t.prefix,r}return Tl(t,e),t.prototype.doSelects=function(e){var t=this.path===e,r=0===e.indexOf(this.path+"/");switch(this.qualifier){case dl.DescendantQualifier.MATCH:return t;case dl.DescendantQualifier.DESCENDANTS_OF_MATCH:return r;case dl.DescendantQualifier.MATCH_AND_DESCENDANTS:return t||r;default:return!1}},t}(vl.AbstractTopicSelector);gl.PathSelector=Ol;var Il={},bl=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Rl=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(Il,"__esModule",{value:!0}),Il.DELIMITER="////";var Cl=function(e){function t(r){var n=this,o=[];r.forEach((function(e){e instanceof t?e.selectors.forEach((function(e){o.push(e)})):o.push(e)}));var i=o.join(Il.DELIMITER),s=function(e){var t,r;if(0===e.length)return"";var n=Uu.MAX_INT32,o=[];e.forEach((function(e,t){var r=dl.split(e.prefix);n=Math.min(n,r.length),o[t]=r}));var i=[];e:for(var s=0;s<n;++s){var a=o[0][s];try{for(var u=Rl(o),c=u.next();!c.done;c=u.next()){if(a!==c.value[s])break e}}catch(e){t={error:e}}finally{try{c&&!c.done&&(r=u.return)&&r.call(u)}finally{if(t)throw t.error}}i.push(a),i.push(dl.PATH_SEPARATOR)}return dl.canonicalise(i.join(""))}(o);return(n=e.call(this,hl.Type.SELECTOR_SET,s,hl.Prefix.SELECTOR_SET+i)||this).selectors=o,n}return bl(t,e),t.prototype.selects=function(e){var t,r;try{for(var n=Rl(this.selectors),o=n.next();!o.done;o=n.next()){if(o.value.selects(e))return!0}}catch(e){t={error:e}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}return!1},t.prototype.doSelects=function(e){return this.selects(e)},t}(vl.AbstractTopicSelector);Il.SelectorSet=Cl;var Pl={},Nl=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(Pl,"__esModule",{value:!0});var Al=function(e){function t(t){var r=e.call(this,t.type,t.prefix,t.expression)||this;return r.patterns=void 0,r.qualifier=t.qualifier,r.parts=dl.split(t.base),r.parts.forEach((function(e){if(!e)throw new Error("Invalid split-path selector")})),r}return Nl(t,e),t.prototype.doSelects=function(e){this.patterns||(this.patterns=this.parts.map((function(e){return Sl.regex(e)})));var t=this.patterns.length,r=e.split(dl.PATH_SEPARATOR);switch(this.qualifier){case dl.DescendantQualifier.MATCH:if(r.length!==t)return!1;break;case dl.DescendantQualifier.DESCENDANTS_OF_MATCH:if(r.length<=t)return!1;break;case dl.DescendantQualifier.MATCH_AND_DESCENDANTS:if(r.length<t)return!1}for(var n=0;n<t;++n)if(!this.patterns[n](r[n]))return!1;return!0},t}(vl.AbstractTopicSelector);Pl.SplitPathSelector=Al;var Ml,Ll,Dl,jl=Ml={};function xl(){throw new Error("setTimeout has not been defined")}function Ul(){throw new Error("clearTimeout has not been defined")}function Bl(e){if(Ll===setTimeout)return setTimeout(e,0);if((Ll===xl||!Ll)&&setTimeout)return Ll=setTimeout,setTimeout(e,0);try{return Ll(e,0)}catch(t){try{return Ll.call(null,e,0)}catch(t){return Ll.call(this,e,0)}}}!function(){try{Ll="function"==typeof setTimeout?setTimeout:xl}catch(e){Ll=xl}try{Dl="function"==typeof clearTimeout?clearTimeout:Ul}catch(e){Dl=Ul}}();var kl,ql=[],Vl=!1,Fl=-1;function Gl(){Vl&&kl&&(Vl=!1,kl.length?ql=kl.concat(ql):Fl=-1,ql.length&&Hl())}function Hl(){if(!Vl){var e=Bl(Gl);Vl=!0;for(var t=ql.length;t;){for(kl=ql,ql=[];++Fl<t;)kl&&kl[Fl].run();Fl=-1,t=ql.length}kl=null,Vl=!1,function(e){if(Dl===clearTimeout)return clearTimeout(e);if((Dl===Ul||!Dl)&&clearTimeout)return Dl=clearTimeout,clearTimeout(e);try{Dl(e)}catch(t){try{return Dl.call(null,e)}catch(t){return Dl.call(this,e)}}}(e)}}function Wl(e,t){this.fun=e,this.array=t}function Yl(){}jl.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];ql.push(new Wl(e,t)),1!==ql.length||Vl||Bl(Hl)},Wl.prototype.run=function(){this.fun.apply(null,this.array)},jl.title="browser",jl.browser=!0,jl.env={},jl.argv=[],jl.version="",jl.versions={},jl.on=Yl,jl.addListener=Yl,jl.once=Yl,jl.off=Yl,jl.removeListener=Yl,jl.removeAllListeners=Yl,jl.emit=Yl,jl.prependListener=Yl,jl.prependOnceListener=Yl,jl.listeners=function(e){return[]},jl.binding=function(e){throw new Error("process.binding is not supported")},jl.cwd=function(){return"/"},jl.chdir=function(e){throw new Error("process.chdir is not supported")},jl.umask=function(){return 0};var zl={};(function(e){"use strict";Object.defineProperty(zl,"__esModule",{value:!0});var t=dl.DescendantQualifier;function r(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];if(!e)throw new Error("Empty topic selector expression");if(t.length>0&&(e=[e].concat(t)),e instanceof Array){var s=e.map((function(e){return e instanceof vl.AbstractTopicSelector?e:r(e)}));return new Il.SelectorSet(s)}if("string"==typeof e){var a=n(e);if(o(a))return new gl.PathSelector(a);switch(a.type){case hl.Type.SPLIT_PATH_PATTERN:return new Pl.SplitPathSelector(a);case hl.Type.FULL_PATH_PATTERN:return new El.FullPathSelector(a);case hl.Type.SELECTOR_SET:var u=cl.split(a.remainder,Il.DELIMITER),c=u.map((function(e){return r(e)}));return new Il.SelectorSet(c)}}if(e instanceof vl.AbstractTopicSelector)return e;throw new Error("Topic selector expression must be a string or array")}function n(e){var r=function(e){switch(e[0]){case hl.Prefix.PATH:return hl.Type.PATH;case hl.Prefix.SPLIT_PATH_PATTERN:return hl.Type.SPLIT_PATH_PATTERN;case hl.Prefix.FULL_PATH_PATTERN:return hl.Type.FULL_PATH_PATTERN;case hl.Prefix.SELECTOR_SET:return hl.Type.SELECTOR_SET;case"$":case"%":case"&":case"<":throw new Error("Invalid expression type: "+e);default:return null}}(e);null===r&&(e=hl.Prefix.PATH+e,r=hl.Type.PATH);var n,o,i=e.substring(1);return r===hl.Type.PATH?(o=i,n=t.MATCH):"/"===i[i.length-1]?"/"===i[i.length-2]?(n=t.MATCH_AND_DESCENDANTS,o=dl.canonicalise(i.substring(0,i.length-2))):(n=t.DESCENDANTS_OF_MATCH,o=dl.canonicalise(i.substring(0,i.length-1))):(o=dl.canonicalise(i),n=t.MATCH),{type:r,base:o,prefix:r===hl.Type.PATH?dl.canonicalise(i):function(e){for(var t=[],r=[],n=s,o=0,i=e.length;o<i;++o){var u=e[o];if("\\"===u&&o<i-1){var c=e[o+1];if(n===s)if(o++,"Q"===c)n=a;else{if(!(c<"a"||c>"z")||!(c<"A"||c>"Z")){t.length=0;break}t.push(c)}else"E"===c?(o++,n=s):t.push(u)}else if(u===dl.PATH_SEPARATOR)r.push(t.join("")),t.length=0,t.push(u);else{if(!n(u)){t.length=0;break}t.push(u)}}return r.push(t.join("")),dl.canonicalise(r.join(""))}(o),remainder:i,qualifier:n,expression:r+i}}function o(e){return e.type===hl.Type.PATH||e.type!==hl.Type.SELECTOR_SET&&""!==e.prefix&&e.prefix===e.base}var i=["*",".","+","?","^","$","{","}","(",")","[","]","\\","|"];function s(e){return-1===i.indexOf(e)}function a(){return!0}var u=e&&e.env&&"true"===e.env.DISABLE_TOPIC_CACHE?r:ul.memoize(r,{},(function(e){return JSON.stringify(e)}));zl.parseSelector=u}).call(this,Ml);var Ql={};Object.defineProperty(Ql,"__esModule",{value:!0}),Ql.sessionContext={ErrorReason:Xa.ErrorReason,TopicTypeEnum:lu.TopicTypeEnum,TopicAddFailReasonEnum:yu.TopicAddFailReasonEnum,TopicSpecification:uu.TopicSpecification,TimeSeriesEventDataType:rl.TimeSeriesEventDataType,DataTypes:al.DataTypes,AbstractDataType:ac.AbstractDataType,parseSelector:zl.parseSelector,CloseReason:Eu.CloseReasonImpl};var $l={},Kl=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty($l,"__esModule",{value:!0});var Jl=function(){function e(e,t){this.listeners=e.getListeners(),this.errorCallback=e.getErrorCallback(),this.closeCallback=e.getCloseCallback(),t&&(this.allowedEvents=["close","error","complete"].concat(t))}return e.prototype.on=function(e,t){return this.attach(e,t),this},e.prototype.off=function(e,t){return this.remove(e,t),this},e.prototype.close=function(e){return this.closeCallback(e),this},e.prototype.error=function(e){return this.errorCallback(e),this},e.prototype.attach=function(e,t){var r,n;if("object"==typeof e)try{for(var o=Kl(Object.keys(e)),i=o.next();!i.done;i=o.next()){var s=i.value;this.attach(s,e[s])}}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}else if(t){if(!this.listeners.hasOwnProperty(e)){if(this.allowedEvents&&-1===this.allowedEvents.indexOf(e))throw new Error("Event "+e+" not emitted on this stream, allowed events are "+this.allowedEvents);this.listeners[e]=[]}this.listeners[e].push(t)}},e.prototype.remove=function(e,t){var r,n;if("object"==typeof e)try{for(var o=Kl(Object.keys(e)),i=o.next();!i.done;i=o.next()){var s=i.value;this.remove(s,e[s])}}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}else this.listeners.hasOwnProperty(e)&&(this.listeners[e]=t?this.listeners[e].filter((function(e){return e!==t})):[])},e}();$l.StreamImpl=Jl;var Xl={};(function(e){"use strict";var t=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(Xl,"__esModule",{value:!0});var r=new(function(){function r(){this.pendingEvents=[],this.events=[],this.busy=!1}return r.prototype.addEmitterEvent=function(t){var r=this;this.pendingEvents.push(t),this.busy||(this.busy=!0,e.nextTick((function(){r.drainEmitterQueue()})))},r.prototype.drainEmitterQueue=function(){var r,n,o=this;this.events=this.pendingEvents,this.pendingEvents=[];try{for(var i=t(this.events),s=i.next();!s.done;s=i.next()){var a=s.value;try{a()}catch(e){}}}catch(e){r={error:e}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}this.pendingEvents.length>0?e.nextTick((function(){o.drainEmitterQueue()})):this.busy=!1},r}()),n=function(){function e(e){var t=this;if(this.listeners={},this.closed=!1,this.listener=function(){},void 0===e||void 0===e.stream){var r={getListeners:function(){return t.listeners},getErrorCallback:function(){return t.error.bind(t)},getCloseCallback:function(){return t.close.bind(t)}};this.stream=new $l.StreamImpl(r,e&&e.allowedEvents)}else{if(this.stream=e.stream,void 0===e.listeners)throw new Error("Listeners must be defined when supplying a stream");this.listeners=e.listeners}void 0!==e&&void 0!==e.event&&this.stream.on(e.event,e.callback)}return e.create=function(t){var r={},n=function(){},o=function(){};return{getListeners:function(){return r},getErrorCallback:function(){return function(e){n(e)}},getCloseCallback:function(){return function(e){o(e)}},emitter:function(i){var s=new e({stream:i,listeners:r,allowedEvents:t});return n=s.error.bind(s),o=s.close.bind(s),s}}},e.prototype.emit_unsafe=function(e,t){var n=this,o=function(e){cc.callWithArguments(e,t||[])};r.addEmitterEvent((function(){n.listeners.hasOwnProperty(e)&&n.listeners[e].forEach(o)})),this.listener(e,t)},e.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];!this.closed&&e&&this.emit_unsafe(e,t)},e.prototype.immediate=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];if(!this.closed&&e){var n=function(e){try{cc.callWithArguments(e,t||[])}catch(e){}};this.listeners.hasOwnProperty(e)&&this.listeners[e].forEach(n)}},e.prototype.error=function(e){this.closed||(this.emit_unsafe("error",[e]),this.close(e?e.message:void 0))},e.prototype.close=function(e){this.closed||(this.closed=!0,this.emit_unsafe("close",[e]))},e.prototype.listen=function(e){this.listener=e},e.prototype.get=function(){return this.stream},e}();Xl.Emitter=n}).call(this,Ml);var Zl={};Object.defineProperty(Zl,"__esModule",{value:!0});var ef=function(){function e(){}return e.prototype.read=function(e){return ba.readBoolean(e)},e.prototype.write=function(e,t){ba.writeBoolean(e,t)},e}();Zl.BooleanSerialiser=new ef;var tf={};Object.defineProperty(tf,"__esModule",{value:!0}),tf.read=function(e,t){var r=ba.readByte(e);if(void 0===t[r])throw new Error("Unable to decode enum value "+r);return t[t[r]]},tf.write=function(e,t){"number"==typeof t?ba.writeByte(e,t):ba.writeByte(e,t.id)};var rf,nf={};Object.defineProperty(nf,"__esModule",{value:!0}),function(e){e[e.UNLOCK_ON_SESSION_LOSS=0]="UNLOCK_ON_SESSION_LOSS",e[e.UNLOCK_ON_CONNECTION_LOSS=1]="UNLOCK_ON_CONNECTION_LOSS"}(rf=nf.SessionLockScope||(nf.SessionLockScope={})),nf.SessionLockOptions={SessionLockScope:rf};var of={};Object.defineProperty(of,"__esModule",{value:!0});var sf=function(e,t,r){this.lockName=e,this.sequence=t,this.scope=r};of.SessionLockAcquisition=sf;var af={},uf=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(af,"__esModule",{value:!0});var cf=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return uf(t,e),t.prototype.read=function(e){var t=ba.readString(e),r=ba.readInt64(e),n=tf.read(e,nf.SessionLockScope);return new of.SessionLockAcquisition(t,r,n)},t.prototype.write=function(e,t){ba.writeString(e,t.lockName),ba.writeInt64(e,t.sequence),tf.write(e,t.scope)},t}(Pa.AbstractSerialiser);af.SessionLockAcquisitionSerialiser=new cf;var pf={},lf=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(pf,"__esModule",{value:!0});var ff=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return lf(t,e),t.prototype.write=function(e,t){ba.writeString(e,t.lockName),ba.writeInt64(e,t.requestId),tf.write(e,t.scope)},t}(Pa.AbstractSerialiser);pf.SessionLockRequestSerialiser=new ff;var hf={};Object.defineProperty(hf,"__esModule",{value:!0}),hf.ACQUIRE_SESSION_LOCK={id:114,request:pf.SessionLockRequestSerialiser,response:af.SessionLockAcquisitionSerialiser},hf.RELEASE_SESSION_LOCK={id:116,request:af.SessionLockAcquisitionSerialiser,response:Zl.BooleanSerialiser};var df={};Object.defineProperty(df,"__esModule",{value:!0}),df.responseSuccess=function(e,t){return!e};var yf={},vf=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function s(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){e.done?o(e.value):new r((function(t){t(e.value)})).then(s,a)}u((n=n.apply(e,t||[])).next())}))},_f=this&&this.__generator||function(e,t){var r,n,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(yf,"__esModule",{value:!0});var Sf=qa.create("diffusion.locks.SessionLocks"),Ef=function(){function e(e,t,r){var n=this;this.owned=!0,this.acquisition=e,this.unlockSessionLock=r,t.setOwned=function(e){n.owned=e}}return e.prototype.toString=function(){return"SessionLock [name="+this.acquisition.lockName+", sequence="+this.acquisition.sequence+", scope="+this.acquisition.scope+", owned="+this.owned+"]"},e.prototype.getName=function(){return this.acquisition.lockName},e.prototype.getSequence=function(){return this.acquisition.sequence},e.prototype.isOwned=function(){return this.owned},e.prototype.getScope=function(){return this.acquisition.scope},e.prototype.unlock=function(){return this.owned?(this.owned=!1,this.unlockSessionLock(this.acquisition)):Promise.resolve(!1)},e}(),mf=function(){function e(e,t){var r=this;this.locks={},this.nextRequestId=0,this.serviceLocator=e.getServiceLocator(),this.ACQUIRE_SESSION_LOCK=this.serviceLocator.obtain(hf.ACQUIRE_SESSION_LOCK),this.RELEASE_SESSION_LOCK=this.serviceLocator.obtain(hf.RELEASE_SESSION_LOCK),t.on("change",(function(t,n){return vf(r,void 0,void 0,(function(){var t,r,o=this;return _f(this,(function(i){switch(i.label){case 0:return t=null,r=function(e){e.ownedSetter.setOwned(!1),e.onRemoveLock()},n!==qs.InternalSessionState.DISCONNECTED?[3,2]:(Object.values(this.locks).filter((function(e){return e.lock.getScope()===nf.SessionLockScope.UNLOCK_ON_CONNECTION_LOSS})).forEach(r),[4,e.getConversationSet().newConversation({onOpen:function(){},onResponse:function(){return!0},onDiscard:function(){Object.values(o.locks).forEach(r),o.locks={}}})]);case 1:return t=i.sent(),[3,3];case 2:n===qs.InternalSessionState.CONNECTED?null!==t&&(e.getConversationSet().respondIfPresent(t,null),t=null):n===qs.InternalSessionState.CLOSED&&(Object.values(this.locks).forEach(r),this.locks={}),i.label=3;case 3:return[2]}}))}))}))}return e.prototype.handleAcquisistion=function(e,t,r){var n,o=this.locks[e];return void 0!==o?o.lock.getSequence().equals(t.sequence)?n=o.lock:(o.ownedSetter.setOwned(!1),n=this.createLock(e,t,r)):n=this.createLock(e,t,r),n},e.prototype.createLock=function(e,t,r){var n={setOwned:function(){throw Error("Session lock ownedSetter must be implemented")}},o=new Ef(t,n,this.unlock.bind(this)),i=r?{lock:o,ownedSetter:{setOwned:function(e){n.setOwned(e),r.onOwned(e)}},onRemoveLock:function(){r.onRemoveLock()}}:{lock:o,ownedSetter:n,onRemoveLock:function(){}};return this.locks[e]=i,o},e.prototype.unlock=function(e){var t=this;return new Promise((function(r,n){t.RELEASE_SESSION_LOCK.send(e,(function(o,i){o?(Sf.debug("Release session lock failed"),n(o)):(void 0!==t.locks[e.lockName]&&t.locks[e.lockName].lock.getSequence().toString(10)===e.sequence.toString(10)&&delete t.locks[e.lockName],r(i))}))}))},e.prototype.lock=function(e,t,r){var n=this;return void 0===t&&(t=nf.SessionLockScope.UNLOCK_ON_SESSION_LOSS),new Promise((function(o,i){if(void 0!==n.locks[e]&&n.locks[e].lock.isOwned())r?i(new Error("Cannot register the same lock in different shared sessions")):o(n.locks[e].lock);else{var s=n.nextRequestId++;n.ACQUIRE_SESSION_LOCK.send({lockName:e,requestId:s,scope:t},(function(t,s){if(df.responseSuccess(t,s)){var a=n.handleAcquisistion(e,s,r);o(a)}else Sf.debug("Acquire session lock failed"),i(t)}))}}))},e}();yf.InternalSessionLocks=mf;var wf={};function gf(){return{type:Ya.PROTOCOL.TYPE,version:Ya.PROTOCOL.CURRENT_VERSION,capabilities:Ya.PROTOCOL.CAPABILITIES}}Object.defineProperty(wf,"__esModule",{value:!0}),wf.connect=gf,wf.reconnect=function(e,t,r){return Object.assign(gf(),{token:e,availableClientSequence:t,lastServerSequence:r})};var Tf={};function Of(e,t){return{id:e,message:t}}Object.defineProperty(Tf,"__esModule",{value:!0}),Tf.responseCodes={OK:Of(100,"Connected successfully"),DOWNGRADE:Of(102,"Server does not support the requested protocol level"),RECONNECTED:Of(105,"Reconnected successfully"),RECONNECTED_WITH_MESSAGE_LOSS:Of(106,"Reconnected with message loss"),LICENSE_EXCEEDED:Of(113,"Connection rejected due to license limit"),RECONNECTION_UNSUPPORTED:Of(114,"Reconnection not supported by connector"),CONNECTION_PROTOCOL_ERROR:Of(115,"Connection failed - protocol error"),AUTHENTICATION_FAILED:Of(116,"Connection failed - authentication failed"),UNKNOWN_SESSION:Of(117,"Reconnection failed - the session is unknown"),RECONNECTION_FAILED_MESSAGE_LOSS:Of(118,"Reconnection failed due to message loss"),REJECTED_SERVER_INITIALISING:Of(119,"Connection rejected because the server is not ready")},Ja.enumerize(Tf.responseCodes),Tf.isSuccess=function(e){switch(e){case Tf.responseCodes.OK:case Tf.responseCodes.RECONNECTED:case Tf.responseCodes.RECONNECTED_WITH_MESSAGE_LOSS:return!0;default:return!1}};var If={};function bf(e,t,r,n){void 0===r&&(r=0),void 0===n&&(n=e.length);for(var o=r;o<n;++o)e[o]=t}Object.defineProperty(If,"__esModule",{value:!0}),If.remove=function(e,t){var r=e.indexOf(t);return r>-1&&(e.splice(r,1),!0)},If.fill=bf,If.ofSize=function(e,t){var r=[];return r.length=e,void 0!==t&&bf(r,t),r};var Rf={};Object.defineProperty(Rf,"__esModule",{value:!0});var Cf=function(){function e(e){this.streams=new Map,this.fallbacks=[],this.topicCache=e}return e.prototype.add=function(e,t){var r=this.streams.get(e);r?r.push(t):this.streams.set(e,[t]),this.topicCache.newStream(e,t,this),t.onOpen()},e.prototype.addFallback=function(e){this.fallbacks.push(e)},e.prototype.getFallbacks=function(e){return this.fallbacks.filter((function(t){return t.selects(e)}))},e.prototype.remove=function(e){var t=this;If.remove(this.fallbacks,e),this.streams.forEach((function(r,n){If.remove(r,e)&&t.topicCache.removeStream(e,t),0===r.length&&t.streams.delete(n)}))},e.prototype.streamsFor=function(e,t){var r=[];return this.streams.forEach((function(n,o){o.selects(e)&&(r=r.concat(n.filter((function(e){return e.selects(t)})).map((function(e){return e.adapter?e.adapter(t):e}))))})),r},e.prototype.close=function(){this.topicCache.clear(),this.streams.forEach((function(e){e.forEach((function(e){e.onSubscriptionError(Xa.ErrorReason.SESSION_CLOSED)}))})),this.fallbacks.forEach((function(e){e.onSubscriptionError(Xa.ErrorReason.SESSION_CLOSED)}))},e}();Rf.StreamRegistryImpl=Cf;var Pf={};Object.defineProperty(Pf,"__esModule",{value:!0});var Nf=function(){function e(e,t,r){this.streams=e,this.path=t,this.specification=r}return e.prototype.proxies=function(e,t){return 0===this.streams.length?t.getFallbacks(e).map((function(t){return t.adapter?t.adapter(e):t})):this.streams},e.prototype.getTopicPath=function(){return this.path},e.prototype.getTopicSpecification=function(){return this.specification},e.prototype.notifyInitialSubscription=function(e){var t=this;this.proxies(this.specification,e).forEach((function(e){e.onSubscription(t.path,t.specification)}))},e.prototype.notifySubscription=function(e){e.onSubscription(this.path,this.specification),this.notifyValueToNewStream(this.path,this.specification,e)},e.prototype.notifyUnsubscription=function(e,t){var r=this;this.proxies(this.specification,t).forEach((function(t){t.onUnsubscription(r.path,r.specification,e)}))},e.prototype.notifyValue=function(e,t,r,n,o){var i=this;this.proxies(this.specification,o).forEach((function(o){o.onValue(i.path,i.specification,e,t,r,n)}))},e.prototype.notifyDelta=function(e,t,r,n,o,i){var s=this;this.proxies(this.specification,i).forEach((function(i){i.onDelta(s.path,s.specification,e,t,r,n,o)}))},e.prototype.addStream=function(e,t){var r=this;0===this.streams.length&&t.getFallbacks(this.specification).forEach((function(e){e.onUnsubscription(r.path,r.specification,yu.UnsubscribeReasonEnum.STREAM_CHANGE)})),this.streams.indexOf(e)<0&&(this.streams.push(e),this.notifySubscription(e))},e.prototype.removeStream=function(e,t){var r=this;If.remove(this.streams,e),0===this.streams.length&&t.getFallbacks(this.specification).forEach((function(e){r.notifySubscription(e)}))},e.prototype.removeAllStreams=function(){this.streams.length=0},e}();Pf.TopicCacheEntry=Nf;var Af={},Mf=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(Af,"__esModule",{value:!0});var Lf=function(e){function t(t,r,n,o){var i=e.call(this,t,r,n)||this;return i.datatype=o,n.properties&&n.properties.DONT_RETAIN_VALUE&&(i.dontRetainValue=JSON.parse(n.properties.DONT_RETAIN_VALUE)),i}return Mf(t,e),t.prototype.handleValue=function(e,t,r){var n=this.value,o=this.buffer||null;try{var i=this.datatype.readValue(e);this.notifyValue(o,e,n,i,t),this.dontRetainValue||(this.value=i,this.buffer=e)}catch(e){r(e)}},t.prototype.handleDelta=function(e,t,r){var n=this.value,o=this.buffer||null;try{var i=this.datatype.deltaType("binary"),s=i.readDelta(e),a=i.applyImpl(n,s,this.buffer?new Nu.BufferSlice(this.buffer):void 0),u=a.value,c=a.cbor;this.value=u,this.buffer=c.$buffer,this.notifyDelta(o,c.$buffer,s,n,this.value,t)}catch(e){r(e)}},t.prototype.notifyValueToNewStream=function(e,t,r){this.buffer&&r.onValue(e,t,null,this.buffer,null,this.value)},t}(Pf.TopicCacheEntry);Af.DatatypeCacheEntry=Lf;var Df={},jf=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(Df,"__esModule",{value:!0});var xf=function(e){function t(t,r,n){return e.call(this,t,r,n)||this}return jf(t,e),t.prototype.handleValue=function(e,t){this.notifyValue(null,e,null,e,t)},t.prototype.handleDelta=function(e,t){this.notifyDelta(null,e,null,null,e,t)},t.prototype.notifyValueToNewStream=function(){},t}(Pf.TopicCacheEntry);Df.NoValueEntry=xf;var Uf={},Bf=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(Uf,"__esModule",{value:!0});var kf=function(e){function t(t,r,n,o){return e.call(this,t,r,n,rl.TimeSeriesEventDataType.create(o))||this}return Bf(t,e),t}(Af.DatatypeCacheEntry);Uf.TimeSeriesCacheEntry=kf;var qf={},Vf=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(qf,"__esModule",{value:!0});var Ff=function(){function e(e){this.byPath={},this.byId={},this.datatypes=e}return e.prototype.handleSubscription=function(e,t){var r,n=e.path,o=t.streamsFor(n,e.specification);switch(e.specification.type){case lu.TopicTypeEnum.JSON:case lu.TopicTypeEnum.BINARY:case lu.TopicTypeEnum.STRING:case lu.TopicTypeEnum.DOUBLE:case lu.TopicTypeEnum.INT64:case lu.TopicTypeEnum.RECORD_V2:var i=this.datatypes.get(e.specification.type);if(null===i)throw new Error("Invalid topic type");r=new Af.DatatypeCacheEntry(o,n,e.specification,i);break;case lu.TopicTypeEnum.TIME_SERIES:var s=this.datatypes.get(e.specification.properties.TIME_SERIES_EVENT_VALUE_TYPE);if(null===s)throw new Error("Invalid timeseries event type");r=new Uf.TimeSeriesCacheEntry(o,n,e.specification,s);break;default:r=new Df.NoValueEntry(o,n,e.specification)}var a=this.byPath[n];if(this.byPath[n]=r,a)throw new Error("Existing cache entry for "+n);var u=this.byId[e.id];if(this.byId[e.id]=r,u)throw new Error("Existing cache entry for "+e.id);r.notifyInitialSubscription(t)},e.prototype.notifyUnsubscriptionOfAllTopics=function(e){for(var t in this.byId)this.byId[t].notifyUnsubscription(yu.UnsubscribeReasonEnum.SUBSCRIPTION_REFRESH,e);this.byPath={},this.byId={}},e.prototype.handleValue=function(e,t,r,n){var o=n.getErrorHandler(),i=this.byId[e];i?i.handleValue(t,r,o):o(new Error("Data loss on topic with ID: "+e+" - possibly due to reconnection"))},e.prototype.handleDelta=function(e,t,r,n){var o=n.getErrorHandler(),i=this.byId[e];i?i.handleDelta(t,r,o):o(new Error("Data loss on topic with ID: "+e+" - possibly due to reconnection"))},e.prototype.handleUnsubscription=function(e,t,r){var n=this.byId[e];if(delete this.byId[e],n){var o=n.getTopicPath();delete this.byPath[o],n.notifyUnsubscription(t,r)}},e.prototype.newStream=function(e,t,r){for(var n in this.byPath)if(this.byPath.hasOwnProperty(n)){var o=this.byPath[n],i=o.getTopicSpecification();e.selects(n)&&t.selects(i)&&o.addStream(t.adapter?t.adapter(i):t,r)}},e.prototype.removeStream=function(e,t){for(var r in this.byPath)this.byPath.hasOwnProperty(r)&&this.byPath[r].removeStream(e,t)},e.prototype.removeAllStreams=function(){var e,t;try{for(var r=Vf(Object.getOwnPropertyNames(this.byPath)),n=r.next();!n.done;n=r.next()){var o=n.value;this.byPath[o].removeAllStreams()}}catch(t){e={error:t}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}},e.prototype.clear=function(){this.byPath={},this.byId={}},e}();qf.TopicCache=Ff;var Gf={};Object.defineProperty(Gf,"__esModule",{value:!0}),Gf.cidFromHeaders=function(e){if(!e||0===e.length)throw new Error("Empty headers, expected at least 1");return da.ConversationId.fromString(e[e.length-1])};var Hf={};Object.defineProperty(Hf,"__esModule",{value:!0});var Wf=qa.create("V4 Client Routing"),Yf=function(){function e(e,t,r,n,o){this.errorHandler=e,this.serviceAdapter=t,this.conversationSet=r,this.cache=n,this.registry=o}return e.prototype.route=function(e){switch(e.type){case Ka.types.FETCH_REPLY:var t=Gf.cidFromHeaders(e.headers);this.conversationSet.respondIfPresent(t,e);break;case Ka.types.SERVICE_REQUEST:case Ka.types.SERVICE_RESPONSE:case Ka.types.SERVICE_ERROR:this.serviceAdapter.onMessage(e.type,e.getInputStream());break;case Ka.types.TOPIC_VALUE:this.cache.handleValue(e.id,e.data,this.registry,this.errorHandler);break;case Ka.types.TOPIC_DELTA:this.cache.handleDelta(e.id,e.data,this.registry,this.errorHandler);break;default:Wf.debug("Unhandled V4 message: "+e.type,e)}},e.prototype.subscribe=function(e){this.cache.handleSubscription(e,this.registry)},e.prototype.unsubscribe=function(e,t){this.cache.handleUnsubscription(e,t,this.registry)},e}();Hf.TopicRouting=Yf;var zf={};Object.defineProperty(zf,"__esModule",{value:!0});var Qf=function(){function e(e,t){this.server=e,this.value=t}return e.fromString=function(t){var r,n=t.split("-");if(2!==n.length)throw new Error("SessionId must consist of two hexadecimal parts, joined with a '-'");try{r=new e(Gs.fromString(n[0],!1,16),Gs.fromString(n[1],!1,16))}catch(e){throw new Error("SessionId must consist of two hexadecimal parts, joined with a '-'")}return r},e.validate=function(t){if(t instanceof e)return t;if(0===t.length||t.indexOf("-")<0||t.indexOf(" ")>=0)return!1;try{return e.fromString(t)}catch(e){return!1}},e.prototype.toString=function(){var e="0000000000000000"+this.server.toUnsigned().toString(16),t="0000000000000000"+this.value.toUnsigned().toString(16);return(e.substr(e.length-16)+"-"+t.substr(t.length-16)).toLowerCase()},e}();zf.SessionId=Qf;var $f={};Object.defineProperty($f,"__esModule",{value:!0}),$f.TOKEN_LENGTH=24;var Kf=function(){function e(e){this.external=e}return e.prototype.toString=function(){return this.external.toString("ascii")},e}();$f.SessionToken=Kf;var Jf={};Object.defineProperty(Jf,"__esModule",{value:!0}),Jf.readSessionToken=function(e){return new $f.SessionToken(e.readMany($f.TOKEN_LENGTH))};var Xf={},Zf=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(Xf,"__esModule",{value:!0});var eh,th=qa.create("Cascading");!function(e){e[e.UNRECOGNISED_PROTOCOL_BYTE=0]="UNRECOGNISED_PROTOCOL_BYTE",e[e.PROTOCOL_VERSION_MISMATCH=1]="PROTOCOL_VERSION_MISMATCH"}(eh=Xf.DeserialisationErrorReason||(Xf.DeserialisationErrorReason={}));var rh=function(e){function t(t,r){var n=e.call(this,t)||this;return n.reason=r,n}return Zf(t,e),t}(Error);Xf.deserialise=function(e){var t=new Ga.BufferInputStream(e),r=t.read();if(r!==Ya.PROTOCOL.PROTOCOL_BYTE)throw new rh("Unrecognised protocol byte: "+r,eh.UNRECOGNISED_PROTOCOL_BYTE);var n=t.read();if(n!==Ya.PROTOCOL.CURRENT_VERSION){if(th.debug("Server responded with protocol version "+n+". Client version is "+Ya.PROTOCOL.CURRENT_VERSION+"."),n<Ya.PROTOCOL.CURRENT_VERSION)throw new rh("Unrecognised protocol version: "+n,eh.PROTOCOL_VERSION_MISMATCH);if(n>Ya.PROTOCOL.CURRENT_VERSION)throw new rh("Unsupported protocol version: "+n,eh.PROTOCOL_VERSION_MISMATCH)}var o=tf.read(t,Tf.responseCodes);if(Tf.isSuccess(o)){var i=new zf.SessionId(t.readUInt64(),t.readUInt64()),s=Jf.readSessionToken(t),a=t.readInt64(),u=0,c=-1;return o===Tf.responseCodes.RECONNECTED?u=t.readInt32():c=t.readInt32(),{response:o,identity:i,token:s,systemPingPeriod:a,version:n,success:!0,sequence:u,maximumMessageSize:c}}return{response:o,version:n,identity:null,token:null,systemPingPeriod:null,success:!1,sequence:0,maximumMessageSize:-1}};var nh={};Object.defineProperty(nh,"__esModule",{value:!0});var oh=qa.create("Parsing");nh.connectionResponse=function(e,t,r){oh.trace("Received connection handshake response");try{return e(Xf.deserialise(r))}catch(e){return t(e),null}};var ih={},sh={};Object.defineProperty(sh,"__esModule",{value:!0});var ah=qa.create("Transports");function uh(){return"function"==typeof WebSocket?(ah.debug("Using native websocket"),{factory:WebSocket,enabled:!0,allowsOptions:!1}):"function"==typeof ih?(ah.debug("Using Node WS library"),{factory:ih,enabled:!0,allowsOptions:!0}):(ah.debug("Websocket transport not available"),{enabled:!1,allowsOptions:!1})}function ch(){return"function"==typeof XMLHttpRequest?(ah.debug("Using native XHR"),{factory:XMLHttpRequest,enabled:!0,allowsOptions:!1}):(ah.debug("XHR transport not available"),{enabled:!1,allowsOptions:!1})}sh.Subtransports=Object.freeze({WS:uh(),XHR:ch(),WEBSOCKET:uh(),HTTP_POLLING:ch()});var ph,lh={};Object.defineProperty(lh,"__esModule",{value:!0}),function(e){e[e.NONE=0]="NONE",e[e.PLAIN=1]="PLAIN",e[e.CUSTOM=2]="CUSTOM"}(ph||(ph={})),lh.read=function(e){switch(tf.read(e,ph)){case ph.NONE:return ba.readBytes(e),null;case ph.PLAIN:return ba.readString(e)||null;case ph.CUSTOM:return ba.readBytes(e)}},lh.write=function(e,t){null!=t?"string"==typeof t?(tf.write(e,ph.PLAIN),ba.writeString(e,t)):(tf.write(e,ph.CUSTOM),ba.writeBytes(e,t)):(tf.write(e,ph.NONE),ba.writeInt32(e,0))};var fh={};(function(e){"use strict";Object.defineProperty(fh,"__esModule",{value:!0}),fh.encodeAsString=function(e){var t=new Wa.BufferOutputStream;return lh.write(t,e),t.getBase64()}}).call(this,a({}).Buffer);var hh={};(function(e){"use strict";var t=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(hh,"__esModule",{value:!0});var r=qa.create("Websocket transport");var n=function(n){function o(e,t,r){var o=this,i=Xl.Emitter.create();return(o=n.call(this,i)||this).emitter=i.emitter(o),o.opts=e,o.ws=t,o.allowsOptions=r,o}return t(o,n),o.prototype.handler=function(t){t.data.length>this.opts.maxMessageSize?this.emitter.error(new Error("Received message of size: "+t.data.length+", exceeding max message size: "+this.opts.maxMessageSize)):this.emitter.immediate("data",e.from(t.data))},o.prototype.connect=function(t,n){var o=this;if(void 0!==this.opts.httpProxyAgent&&!this.allowsOptions)throw new Error("httpProxyAgent option is not allowed");try{var i=function(e,t){var r=(t.secure?"wss":"ws")+"://"+t.host+":"+t.port+t.path;return r+="?ty="+e.type,r+="&v="+e.version,r+="&ca="+e.capabilities,r+="&r="+t.reconnect.timeout,e.token&&(r+="&c="+encodeURIComponent(e.token),r+="&cs="+e.availableClientSequence,r+="&ss="+e.lastServerSequence),t.properties&&(r+="&sp="+encodeURIComponent(JSON.stringify(t.properties))),t.principal&&(r+="&username="+encodeURIComponent(t.principal),r+="&password="+encodeURIComponent(fh.encodeAsString(t.credentials))),r}(t,this.opts);this.socket=void 0===this.opts.httpProxyAgent?new this.ws(i):new this.ws(i,{agent:this.opts.httpProxyAgent}),r.debug("Created websocket",i)}catch(e){throw new Error("Unable to construct WebSocket "+e)}this.socket.binaryType="arraybuffer",this.socket.onmessage=function(t){o.socket.onmessage=o.handler.bind(o),o.socket.onerror=function(e){o.emitter.error(e)},n(e.from(t.data))},this.socket.onclose=function(e){o.emitter.close(e)},this.socket.onerror=function(e){o.emitter.close(e)}},o.prototype.dispatch=function(e){r.debug("Sending websocket message",e);try{return this.socket.send(e),!0}catch(e){return r.error("Websocket send error",e),!1}},o.prototype.close=function(){return r.debug("Closing websocket"),void 0!==this.socket&&this.socket.close(1e3),this},o}($l.StreamImpl);hh.WSTransport=n}).call(this,a({}).Buffer);var dh={};Object.defineProperty(dh,"__esModule",{value:!0});var yh=function(){function e(){this.messages=[]}return e.prototype.length=function(){return this.messages.length},e.prototype.add=function(e){this.messages.push(e)},e.prototype.drain=function(){return this.messages.splice(0,this.messages.length)},e.prototype.isEmpty=function(){return 0===this.messages.length},e}();dh.Queue=yh;var vh={};(function(e){"use strict";var t=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),r=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(vh,"__esModule",{value:!0});var n=qa.create("XHR transport");var o=function(o){function i(e,t){var r=this,n=Xl.Emitter.create();return(r=o.call(this,n)||this).emitter=n.emitter(r),r.opts=e,r.protocolVersion=null,r.pollSequence=0,r.pingSequence=0,r.pollRequest=null,r.aborted=!1,r.isSending=!1,r.queue=new dh.Queue,r.xhr=t,r}return t(i,o),i.prototype.connect=function(t,r){var o=this;try{var i=function(e,t){var r=(t.secure?"https":"http")+"://"+t.host+":"+t.port+t.path,n={m:"0",ty:"B",ca:e.capabilities,r:t.reconnect.timeout,v:e.version};return void 0!==e.token&&(n.c=e.token,n.cs=e.availableClientSequence,n.ss=e.lastServerSequence),t.properties&&(n.sp=encodeURIComponent(JSON.stringify(t.properties))),t.principal&&(n.username=encodeURIComponent(t.principal),n.password=fh.encodeAsString(t.credentials)),{uri:r,headers:n}}(t,this.opts);this.protocolVersion=i.headers.v,this.URI=i.uri;var s=this.createRequest(i.headers,i.uri);n.debug("Created XHR",i.uri),s.onreadystatechange=function(){if(4===s.readyState)if(200===s.status){var t=s.responseText,i=r(e.from(t,"binary"));if(!i)return;o.token=i.token;var a=i.response;Tf.isSuccess(a)?o.poll():(n.debug(a.id+" - "+a.message),o.emitter.close())}else o.emitter.close()},s.send(null)}catch(e){throw new Error("Unable to create polling transport "+e)}},i.prototype.close=function(){return n.trace("Closing XHR transport"),this.pollRequest&&(this.aborted=!0,this.pollRequest.abort()),this.queue=new dh.Queue,this.emitter.close(),this},i.prototype.createRequest=function(e,t){var o,i,s=new this.xhr;s.open("POST",t,!0),s.overrideMimeType("text/plain; charset=x-user-defined");try{for(var a=r(Object.getOwnPropertyNames(e)),u=a.next();!u.done;u=a.next()){var c=u.value;try{s.setRequestHeader(c,e[c])}catch(t){n.warn("Can't set header "+c+":"+e.join(":"))}}}catch(e){o={error:e}}finally{try{u&&!u.done&&(i=a.return)&&i.call(a)}finally{if(o)throw o.error}}return s},i.prototype.poll=function(){var t=this,r=this.createRequest({m:"1",c:this.token,s:this.pollSequence++,v:this.protocolVersion},this.URI);r.onreadystatechange=function(){if(4===r.readyState)if("reconnect"===r.getResponseHeader("diffusion-connection"))t.emitter.close();else if(200===r.status){t.aborted||t.poll();for(var n=r.responseText,o=new Ga.BufferInputStream(e.from(n,"base64"));o.pos!==o.count;){var i=o.readInt32();if(i>t.opts.maxMessageSize)return void t.emitter.error(new Error("Received message of size: "+i+", exceeding max message size: "+t.opts.maxMessageSize));var s=o.read(),a=o.readMany(i),u=e.alloc(a.length+1);u.writeUInt8(s,0),a.copy(u,1),t.emitter.emit("data",u)}}else t.emitter.close()},this.pollRequest=r,r.send(null)},i.prototype.dispatch=function(e){return!this.aborted&&(this.queue.add(e),!!this.isSending||void this.flush())},i.prototype.flush=function(){var e=this;if(!this.queue.isEmpty()){var t=function(e){var t,n,o=new Wa.BufferOutputStream;try{for(var i=r(e),s=i.next();!s.done;s=i.next()){var a=s.value;o.writeInt32(a.length-1),o.writeMany(a,0,a.length)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return o.getBuffer()}(this.queue.drain()),n=this.createRequest({m:"2",c:this.token,s:this.pingSequence++,v:this.protocolVersion},this.URI);n.onreadystatechange=function(){4===n.readyState&&("reconnect"===n.getResponseHeader("diffusion-connection")?e.emitter.close():200===n.status?(e.isSending=!1,e.flush()):e.emitter.close())},this.isSending=!0,n.send(t.toString("base64"))}},i}($l.StreamImpl);vh.XHRTransport=o}).call(this,a({}).Buffer);var _h={},Sh=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(_h,"__esModule",{value:!0});var Eh=qa.create("Cascading"),mh=Object.freeze({WS:hh.WSTransport,XHR:vh.XHRTransport,WEBSOCKET:hh.WSTransport,HTTP_POLLING:vh.XHRTransport});function wh(e,t,r){var n=mh[r],o=e[r];if(n&&o&&o.enabled)return new n(t,o.factory,o.allowsOptions);throw new Error("Unknown transport name: "+r)}var gh=function(e){function t(t,r,n,o){var i=this,s=Xl.Emitter.create();return(i=e.call(this,s)||this).emitter=s.emitter(i),i.transports=n,i.cascadeNotifications=o,i.name=null,i.req=null,i.responseReceived=!1,i.transportFactory=wh.bind(null,t,r),i.transport=i.selectTransport(),i.onData=i.onData.bind(i),i.onClose=i.onClose.bind(i),i.onError=i.onError.bind(i),i.onConnectionResponse=i.onConnectionResponse.bind(i),i.onParsingError=i.onParsingError.bind(i),i}return Sh(t,e),t.prototype.onData=function(e){this.emitter.immediate("data",e)},t.prototype.onClose=function(e){!this.responseReceived&&this.cascade(!0)||this.emitter.emit("close",e)},t.prototype.onError=function(e){this.emitter.emit("error",e)},t.prototype.onConnectionResponse=function(e){return this.responseReceived=!0,function(e){return e===Tf.responseCodes.ERROR}(e.response)&&this.cascade()?null:this.onHandshakeSuccess(e)},t.prototype.onParsingError=function(e){if(this.responseReceived=!0,!this.cascade())return this.onHandshakeError(e)},t.prototype.closeQuietly=function(){this.transport&&(this.transport.off("data",this.onData),this.transport.off("close",this.onClose),this.transport.off("error",this.onError),this.transport.close(),this.transport=null)},t.prototype.selectTransport=function(e){return void 0===e&&(e=!1),0===this.transports.length?(this.name=null,this.transport=null,Eh.debug("Transports exhausted"),this.cascadeNotifications.emit("transports-exhausted"),e||this.emitter.emit("close"),null):(this.name=this.transports.shift(),this.transport=this.transportFactory(this.name),Eh.debug("Selecting transport",this.name),this.cascadeNotifications.emit("transport-selected",this.name),this.transport)},t.prototype.internalConnect=function(){if(null===this.transport)throw new Error("Unable to connect when no transport is set");this.responseReceived=!1,Eh.debug("Attempting to connect"),this.cascadeNotifications.emit("cascading-connect"),this.transport.on("data",this.onData),this.transport.on("close",this.onClose),this.transport.on("error",this.onError);try{this.transport.connect(this.req,nh.connectionResponse.bind(null,this.onConnectionResponse,this.onParsingError))}catch(e){if(!this.cascade())throw e}return!0},t.prototype.cascade=function(e){return this.closeQuietly(),!!this.selectTransport(e)&&(this.cascadeNotifications.emit("cascade"),this.internalConnect())},t.prototype.connect=function(e,t,r){this.req=e,this.onHandshakeSuccess=t,this.onHandshakeError=r,this.internalConnect()},t.prototype.dispatch=function(e){if(null===this.transport)throw new Error("Unable to send message when no transport is set");this.transport.dispatch(e)},t.prototype.close=function(){return null!==this.transport&&(this.responseReceived=!0,this.transport.close(),this.transport=null),this},t}($l.StreamImpl),Th=function(e){function t(t){var r=this,n=Xl.Emitter.create();return(r=e.call(this,n)||this).emitter=n.emitter(r),r.subtransports=t,r}return Sh(t,e),t.create=function(e){return new t(e||sh.Subtransports)},t.prototype.get=function(e){var t,r,n=(t=e.transports,r=this.subtransports,t.filter((function(e){return e&&mh.hasOwnProperty(e)&&r[e].enabled})));return 0===n.length?(Eh.warn("No valid transports found"),null):new gh(this.subtransports,e,n,this.emitter)},t}($l.StreamImpl);_h.Transports=Th;var Oh={},Ih=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(Oh,"__esModule",{value:!0});var bh=function(e){function t(t,r){var n=this,o=Xl.Emitter.create();return(n=e.call(this,o)||this).emitter=o.emitter(n),n.states=r,n.current=r[t],n.state=t,n}return Ih(t,e),t.prototype.change=function(e){return this.state===e||!(!this.states[e]||!("*"===this.current||this.current.indexOf(e)>-1))&&(this.emitter.emit("change",this.state,e),this.current=this.states[e],this.state=e,!0)},t}($l.StreamImpl);Oh.FSM=bh;var Rh={};Object.defineProperty(Rh,"__esModule",{value:!0}),Rh.version="6.6.1";var Ch={};Object.defineProperty(Ch,"__esModule",{value:!0}),Ch.CloseReasonEnum={CLOSED_BY_CLIENT:new Eu.CloseReasonImpl(0,"The session was closed by the client",!1),CLOSED_BY_SERVER:new Eu.CloseReasonImpl(1,"The session was closed by the server",!1),RECONNECT_ABORTED:new Eu.CloseReasonImpl(2,"Client aborted a reconnect attempt",!1),CONNECTION_TIMEOUT:new Eu.CloseReasonImpl(3,"The connection attempt timed out",!1),HANDSHAKE_REJECTED:new Eu.CloseReasonImpl(4,"The connection handshake was rejected by the server",!1),HANDSHAKE_ERROR:new Eu.CloseReasonImpl(5,"There was an error parsing the handshake response",!1),TRANSPORT_ERROR:new Eu.CloseReasonImpl(6,"There was an unexpected error with the connection",!0),CONNECTION_ERROR:new Eu.CloseReasonImpl(7,"The client could not establish a connection to the server",!0),IDLE_CONNECTION:new Eu.CloseReasonImpl(8,"The activity monitor detected the connection was idle",!0),LOST_MESSAGES:new Eu.CloseReasonImpl(16,"Loss of messages has been detected",!1),PROTOCOL_VERSION_MISMATCH:new Eu.CloseReasonImpl(17,"There was a mismatch in the protocol versions",!1),LICENSE_EXCEEDED:new Eu.CloseReasonImpl(18,"The license limit was exceeded",!1),ACCESS_DENIED:new Eu.CloseReasonImpl(99,"The connection attempt was rejected by the server because authentication failed",!1)},Ja.enumerize(Ch.CloseReasonEnum);var Ph={},Nh=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(Ph,"__esModule",{value:!0});var Ah=qs.InternalSessionState.INITIALISING,Mh=qs.InternalSessionState.CONNECTING,Lh=qs.InternalSessionState.CONNECTED,Dh=qs.InternalSessionState.DISCONNECTED,jh=qs.InternalSessionState.RECONNECTING,xh=qs.InternalSessionState.CLOSING,Uh=qs.InternalSessionState.CLOSED,Bh=qa.create("Internal Session"),kh=function(e){function t(t,r,n,o){var i,s=this,a=Xl.Emitter.create();return(s=e.call(this,a)||this).emitter=a.emitter(s),s.version=Rh.version,s.principal="",s.conversationSetFactory=t,s.conversationSet=t(),s.serviceRegistry=r,s.opts=o,s.fsm=new Oh.FSM(Ah,((i={})[Ah]=[Mh],i[Mh]=[Lh,xh],i[Lh]=[Dh,xh,Uh],i[Dh]=[jh,xh],i[jh]=[Lh,xh],i[xh]=[Uh],i[Uh]=[],i)),s.fsm.on("change",(function(e,t){Bh.debug("State changed: "+e+" -> "+t)})),s.transports=_h.Transports.create(),s.transports.on({"transport-selected":function(e){s.emitter.emit("transport-selected",e)},cascade:function(){s.emitter.emit("cascade")}}),s.connection=n(s.transports,s.opts.reconnect.timeout,256),s.serviceAdapter=new Za.ServiceAdapter(s,(function(e){s.connection.send(e)})),s.serviceLocator=new nu.ServiceLocatorImpl(s,s.serviceAdapter),s.topicCache=new qf.TopicCache(al.DataTypes),s.topicStreamRegistry=new Rf.StreamRegistryImpl(s.topicCache),s.topicRouting=new Hf.TopicRouting(s,s.serviceAdapter,s.conversationSet,s.topicCache,s.topicStreamRegistry),s.serviceRegistry.addListener(s.serviceAdapter.addService.bind(s.serviceAdapter)),void 0!==yf.InternalSessionLocks&&(s.sessionLocksFeature=new yf.InternalSessionLocks(s,s.fsm)),s.attempts=0,s}return Nh(t,e),Object.defineProperty(t.prototype,"sessionLocks",{get:function(){if(void 0===this.sessionLocksFeature){if(void 0===yf.InternalSessionLocks)throw new Error("Session Locks feature has not been loaded");this.sessionLocksFeature=new yf.InternalSessionLocks(this,this.fsm)}return this.sessionLocksFeature},enumerable:!0,configurable:!0}),t.prototype.getOptions=function(){return this.opts},t.prototype.getState=function(){return this.fsm.state},t.prototype.onStateChange=function(e){this.fsm.on("change",e)},t.prototype.getConversationSet=function(){return this.conversationSet},t.prototype.isConnected=function(){return this.fsm.state===Lh},t.prototype.getServiceRegistry=function(){return this.serviceRegistry},t.prototype.getSessionId=function(){return this.sessionID},t.prototype.getServerMaximumMessageSize=function(){return this.serverMaximumMessageSize},t.prototype.checkConnected=function(e){return!!this.isConnected()||(e(new Error("The session is not connected. Operations are not possible at this time.")),!1)},t.prototype.internalClose=function(e){this.fsm.change(Uh)?(this.topicStreamRegistry.close(),this.conversationSet.discardAll(e),this.emitter.close(e)):Bh.debug("Unable to handle session close, session state: ",this.fsm.state)},t.prototype.reconnect=function(e,t){if(this.fsm.change(jh)){Bh.info("Reconnect attempt ("+ ++this.attempts+")");var r=wf.reconnect(t,this.connection.getAvailableSequence(),this.connection.lastReceivedSequence);this.connection.connect(r,e,e.reconnect.timeout)}else Bh.debug("Unable to attempt reconnect, session state: ",this.fsm.state)},t.prototype.abort=function(e){void 0===e&&(e=Ch.CloseReasonEnum.RECONNECT_ABORTED),this.fsm.change(xh)?(Bh.debug("Aborting reconnect"),this.internalClose(e)):Bh.debug("Unable to abort reconnect, session state: ",this.fsm.state)},t.prototype.replaceConversationSet=function(e){var t=this.conversationSet;this.conversationSet=this.conversationSetFactory(),t.discardAll(e),Bh.debug("Replaced conversation set",e)},t.prototype.connect=function(){var e=this;if(this.fsm.change(Mh)){var t,r=wf.connect();this.connection.on("data",this.topicRouting.route.bind(this.topicRouting)),this.connection.on("close",this.internalClose.bind(this)),this.sessionActivityMonitor=this.opts.activityMonitor?Bs.create(xs.connectionActivityMonitorFactory):Bs.NOOP,this.connection.on("disconnect",(function(r){Bh.debug("Connection disconnected, reason: ",r),e.fsm.change(Dh)||e.fsm.state===jh?(e.sessionActivityMonitor.onConnectionClosed(),e.opts.reconnect.timeout>0&&r.canReconnect?(e.fsm.state===Dh&&(e.emitter.emit("disconnect",r),t=setTimeout((function(){e.fsm.state!==Lh&&e.abort(Ch.CloseReasonEnum.CONNECTION_TIMEOUT)}),e.opts.reconnect.timeout)),e.opts.reconnect.strategy(e.reconnect.bind(e,e.opts,e.token),e.abort.bind(e),r)):e.abort(r)):e.fsm.change(xh)?e.internalClose(r):(e.sessionActivityMonitor.onConnectionClosed(),Bh.debug("Unable to handle session disconnect, session state: ",e.fsm.state))})),this.connection.on("connect",(function(r){e.fsm.change(Lh)?(e.token=r.token,r.response===Tf.responseCodes.OK?(e.sessionID=r.identity,e.serverMaximumMessageSize=r.maximumMessageSize,e.sessionActivityMonitor.onNewConnection(e.connection,r),e.emitter.emit("connect",r.identity)):r.response!==Tf.responseCodes.RECONNECTED&&r.response!==Tf.responseCodes.RECONNECTED_WITH_MESSAGE_LOSS||(e.attempts=0,clearTimeout(t),r.response===Tf.responseCodes.RECONNECTED_WITH_MESSAGE_LOSS?(e.connection.resetSequences(),e.replaceConversationSet(new Error("Peer is disconnected")),e.topicCache.notifyUnsubscriptionOfAllTopics(e.topicStreamRegistry),Bh.info("Reconnected session, but messages may have been lost")):Bh.info("Reconnected session"),e.sessionActivityMonitor.onNewConnection(e.connection,r),e.emitter.emit("reconnect"))):Bh.trace("Unknown connection response: ",r)})),Bh.debug("Connecting with options:",this.opts),Bh.trace("Connecting with request:",r);try{this.connection.connect(r,this.opts)}catch(e){Bh.warn("Connection error",e),this.emitter.emit("error",e),this.fsm.change(xh)&&this.internalClose(Ch.CloseReasonEnum.CONNECTION_ERROR)}this.opts.principal&&(this.principal=this.opts.principal)}else Bh.warn("Unable to connect, session state: ",this.fsm.state),this.emitter.emit("error",new Error("Unable to connect, session state: "+this.fsm.state))},t.prototype.close=function(){return this.fsm.change(xh)?(this.sessionActivityMonitor.onConnectionClosed(),this.connection.close(Ch.CloseReasonEnum.CLOSED_BY_CLIENT)):Bh.debug("Unable to close, session state: ",this.fsm.state),this},t.prototype.getErrorHandler=function(){return function(e){Bh.error("Session error:",e.message)}},t.prototype.getServiceLocator=function(){return this.serviceLocator},t.prototype.getServiceAdapter=function(){return this.serviceAdapter},t.prototype.getPrincipal=function(){return this.principal},t.prototype.setPrincipal=function(e){this.principal=e},t.prototype.getStreamRegistry=function(){return this.topicStreamRegistry},t.prototype.getRouting=function(){return this.topicRouting},t.prototype.onSystemPing=function(){this.sessionActivityMonitor.onSystemPing()},t.prototype.lock=function(e,t,r){return this.sessionLocks.lock(e,t,r)},t.prototype.unlock=function(e){return this.sessionLocks.unlock(e)},t.prototype.isShared=function(){return!1},t.prototype.getContext=function(){return Ql.sessionContext},t.prototype.updateFeatures=function(){void 0===this.sessionLocks&&void 0!==yf.InternalSessionLocks&&(this.sessionLocks=new yf.InternalSessionLocks(this,this.fsm))},t}($l.StreamImpl);Ph.InternalSessionImpl=kh;var qh={};Object.defineProperty(qh,"__esModule",{value:!0});var Vh=function(){function e(){this.services=new Map,this.listeners=[]}return e.prototype.add=function(e,t){if(this.services.has(e))throw new Error("Service already exists for "+e);this.services.set(e,t),this.listeners.forEach((function(r){r(e,t)}))},e.prototype.addListener=function(e){this.listeners.push(e),this.services.forEach((function(t,r){e(r,t)}))},e}();qh.ServiceRegistryImpl=Vh;var Fh={};Object.defineProperty(Fh,"__esModule",{value:!0}),Fh.monitoredPingService={onRequest:function(e,t,r){r.respond(),e.onSystemPing()}};var Gh={};Object.defineProperty(Gh,"__esModule",{value:!0}),Gh.notifySubscriptionService={onRequest:function(e,t,r){r.respond(),e.getRouting().subscribe(t)}};var Hh={};Object.defineProperty(Hh,"__esModule",{value:!0}),Hh.notifyUnsubscriptionService={onRequest:function(e,t,r){r.respond(),e.getRouting().unsubscribe(t.id,t.reason)}};var Wh={};Object.defineProperty(Wh,"__esModule",{value:!0}),Wh.pingService={onRequest:function(e,t,r){r.respond()}};var Yh={},zh=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Qh=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function s(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){e.done?o(e.value):new r((function(t){t(e.value)})).then(s,a)}u((n=n.apply(e,t||[])).next())}))},$h=this&&this.__generator||function(e,t){var r,n,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},Kh=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}},Jh=this;Object.defineProperty(Yh,"__esModule",{value:!0});var Xh,Zh=function(){var e=new Gs(0);return function(){return Qh(Jh,void 0,void 0,(function(){return $h(this,(function(t){return e=e.add(1),[2,new da.ConversationId(e)]}))}))}}();!function(e){e[e.ALREADY_FINISHED=0]="ALREADY_FINISHED",e[e.HANDLED_AND_ACTIVE=1]="HANDLED_AND_ACTIVE",e[e.HANDLED_AND_FINISHED=2]="HANDLED_AND_FINISHED"}(Xh=Yh.Result||(Yh.Result={}));var ed=qa.create("Conversation Set"),td=function(e){function t(t){var r=e.call(this,t)||this;return r.name="NoSuchConversationError",r}return zh(t,e),t}(Error),rd=function(){function e(e,t){this.reserved=!1,this.closed=!1,this.handler=e,this.completedExceptionally=t}return e.prototype.open=function(e){this.handler.onOpen(e)},e.prototype.respond=function(e,t){if(this.closed)return Xh.ALREADY_FINISHED;var r,n=this.reserved;this.reserved=!0;try{r=this.handler.onResponse(e,t)}catch(t){throw this.completedExceptionally(e,this,t),t}return this.closed?(ed.debug("Conversation already closed",e),Xh.HANDLED_AND_FINISHED):r?(ed.debug("Response handler closed conversation",e),this.closed=!0,Xh.HANDLED_AND_FINISHED):this.pendingDiscard?(ed.debug("Conversation closed with pending reason",e),this.notifyDiscard(e,this.pendingDiscard),Xh.HANDLED_AND_FINISHED):(this.reserved=n,Xh.HANDLED_AND_ACTIVE)},e.prototype.discard=function(e,t){this.reserved?this.pendingDiscard=t:this.notifyDiscard(e,t)},e.prototype.close=function(){this.closed=!0},e.prototype.notifyDiscard=function(e,t){if(!this.closed){this.closed=!0;try{this.handler.onDiscard(e,t)}catch(t){throw ed.error("Application handler threw exception [cid="+e+"]",t.stack),t}}},e}(),nd=function(){function e(e){this.nextCID=e,this.conversations={}}return e.prototype.completedExceptionally=function(e,t,r){ed.debug("Application handler threw exception [cid="+e+"]",r.stack),t.close(),delete this.conversations[e.toString()]},e.prototype.newConversation=function(e){return Qh(this,void 0,void 0,(function(){var t,r;return $h(this,(function(n){switch(n.label){case 0:return t=new rd(e,this.completedExceptionally.bind(this)),[4,this.nextCID()];case 1:r=n.sent(),this.conversations[r.toString()]=t;try{t.open(r)}catch(e){throw this.completedExceptionally(r,t,e),e}return void 0!==this.discardReason&&this.discard(r,this.discardReason),[2,r]}}))}))},e.prototype.respond=function(e,t){var r=this.conversations[e.toString()];if(void 0===r)throw ed.debug("No conversation for cid: "+e+", response: ",t),new td("No such conversation");switch(r.respond(e,t)){case Xh.ALREADY_FINISHED:throw new td("No such conversation");case Xh.HANDLED_AND_ACTIVE:break;default:delete this.conversations[e.toString()]}},e.prototype.respondIfPresent=function(e,t){try{this.respond(e,t)}catch(e){if("NoSuchConversationError"!==e.name)throw e}},e.prototype.discard=function(e,t){var r=this.conversations[e.toString()];delete this.conversations[e.toString()],r&&r.discard(e,t)},e.prototype.discardAll=function(e){var t,r;if(void 0===this.discardReason){this.discardReason=e;try{for(var n=Kh(Object.keys(this.conversations)),o=n.next();!o.done;o=n.next()){var i=o.value;this.discard(da.ConversationId.fromString(i),e)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}}},e.prototype.size=function(){return Object.keys(this.conversations).length},e}();Yh.ConversationSet=nd,Yh.create=function(){return new nd(Zh)};var od={};Object.defineProperty(od,"__esModule",{value:!0}),od.NullSerialiser={read:function(){return null},write:function(){}};var id={};Object.defineProperty(id,"__esModule",{value:!0}),id.SYSTEM_PING={id:55,request:od.NullSerialiser,response:od.NullSerialiser},id.USER_PING={id:56,request:od.NullSerialiser,response:od.NullSerialiser};var sd={};Object.defineProperty(sd,"__esModule",{value:!0});var ad=function(e,t,r){this.id=e,this.path=t,this.specification=r};sd.TopicSpecificationInfo=ad;var ud={};(function(e){"use strict";var t,r,n;Object.defineProperty(ud,"__esModule",{value:!0}),ud.read=function(o){if(r&&o.buffer.slice(o.pos,o.pos+n).equals(r))return o.readMany(n),t;var i=o.pos,s=tf.read(o,lu.TopicTypeEnum),a=ba.readDictionary(o,ba.readString),u=new uu.TopicSpecification(s,a);return n=o.pos-i,r=e.from(o.buffer.slice(i,o.pos)),t=Object.freeze(u),u},ud.write=function(e,t){tf.write(e,t.type),ba.writeDictionary(e,t.properties,ba.writeString)}}).call(this,a({}).Buffer);var cd={},pd=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(cd,"__esModule",{value:!0});var ld=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return pd(t,e),t.prototype.read=function(e){var t=ba.readInt32(e),r=ba.readString(e),n=ud.read(e);return new sd.TopicSpecificationInfo(t,r,n)},t.prototype.write=function(e,t){ba.writeInt32(e,t.id),ba.writeString(e,t.path),ud.write(e,t.specification)},t}(Pa.AbstractSerialiser);cd.TopicSpecificationInfoSerialiser=new ld;var fd={};Object.defineProperty(fd,"__esModule",{value:!0});var hd=function(e){this.name=e};fd.ControlGroup=hd,fd.DEFAULT=Object.freeze(new hd("default"));var dd={},yd=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(dd,"__esModule",{value:!0});var vd=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return yd(t,e),t.prototype.read=function(e){var t=ba.readString(e);return new fd.ControlGroup(t)},t.prototype.write=function(e,t){ba.writeString(e,t.name)},t}(Pa.AbstractSerialiser);dd.ControlGroupSerialiser=new vd;var _d={},Sd=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(_d,"__esModule",{value:!0});var Ed=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Sd(t,e),t.prototype.write=function(e,t){ba.writeInt32(e,t.definition.id),dd.ControlGroupSerialiser.write(e,t.group),ba.writeString(e,t.path),ba.writeCollection(e,t.keys,ba.writeString)},t}(Pa.AbstractSerialiser);_d.MessageReceiverControlRegistrationParamsSerialiser=new Ed;var md={},wd=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(md,"__esModule",{value:!0});var gd=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return wd(t,e),t.prototype.write=function(e,t){_d.MessageReceiverControlRegistrationParamsSerialiser.write(e,t.params),Ra.CIDSerialiser.write(e,t.cid)},t}(Pa.AbstractSerialiser);md.MessageReceiverControlRegistrationRequestSerialiser=new gd;var Td={},Od=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(Td,"__esModule",{value:!0});var Id=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Od(t,e),t.prototype.write=function(e,t){ba.writeInt32(e,t.definition.id),dd.ControlGroupSerialiser.write(e,t.group),ba.writeString(e,t.path)},t}(Pa.AbstractSerialiser);Td.TopicControlRegistrationParamsSerialiser=new Id;var bd={},Rd=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(bd,"__esModule",{value:!0});var Cd=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Rd(t,e),t.prototype.write=function(e,t){Td.TopicControlRegistrationParamsSerialiser.write(e,t.params),Ra.CIDSerialiser.write(e,t.cid)},t}(Pa.AbstractSerialiser);bd.TopicControlRegistrationRequestSerialiser=new Cd;var Pd={};Object.defineProperty(Pd,"__esModule",{value:!0}),Pd.read=function(e){return ba.readInt32(e)},Pd.write=function(e,t){ba.writeInt32(e,t)};var Nd={};Object.defineProperty(Nd,"__esModule",{value:!0});var Ad=function(e,t){this.id=e,this.reason=t};Nd.UnsubscriptionNotification=Ad;var Md={},Ld=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(Md,"__esModule",{value:!0});var Dd=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ld(t,e),t.prototype.read=function(e){var t=Pd.read(e),r=tf.read(e,yu.UnsubscribeReasonEnum);return new Nd.UnsubscriptionNotification(t,r)},t.prototype.write=function(e,t){if(Pd.write(e,t.id),void 0===t.reason.id)throw new Error("Cannot serialise UnsubscribeReason ${value.reason.reason}");tf.write(e,t.reason)},t}(Pa.AbstractSerialiser);Md.UnsubscriptionNotificationSerialiser=new Dd;var jd={};Object.defineProperty(jd,"__esModule",{value:!0}),jd.TOPIC_CONTROL_REGISTRATION={id:20,request:bd.TopicControlRegistrationRequestSerialiser,response:od.NullSerialiser},jd.TOPIC_CONTROL_DEREGISTRATION={id:21,request:Td.TopicControlRegistrationParamsSerialiser,response:od.NullSerialiser},jd.UNSUBSCRIPTION_NOTIFICATION={id:42,request:Md.UnsubscriptionNotificationSerialiser,response:od.NullSerialiser},jd.MESSAGE_RECEIVER_CONTROL_REGISTRATION={id:63,request:md.MessageReceiverControlRegistrationRequestSerialiser,response:od.NullSerialiser},jd.MESSAGE_RECEIVER_CONTROL_DEREGISTRATION={id:64,request:_d.MessageReceiverControlRegistrationParamsSerialiser,response:od.NullSerialiser},jd.NOTIFY_SUBSCRIPTION={id:87,request:cd.TopicSpecificationInfoSerialiser,response:od.NullSerialiser},jd.MESSAGING_RECEIVER_CONTROL_REGISTRATION={id:97,request:md.MessageReceiverControlRegistrationRequestSerialiser,response:od.NullSerialiser},jd.MESSAGING_RECEIVER_CONTROL_DEREGISTRATION={id:98,request:_d.MessageReceiverControlRegistrationParamsSerialiser,response:od.NullSerialiser};var xd={};Object.defineProperty(xd,"__esModule",{value:!0});function Ud(e){return e>>10}function Bd(e,t){return e&t-1}var kd=function(){function e(e,t){this.messagesLength=Uu.findNextPowerOfTwo(e),this.indexCapacity=Uu.findNextPowerOfTwo(t),this.messagesMask=cc.curryR(Bd,this.messagesLength),this.indexMask=cc.curryR(Bd,this.indexCapacity),this.messages=If.ofSize(this.messagesLength),this.indices=If.ofSize(this.indexCapacity,-1),this.times=If.ofSize(this.indexCapacity),this.timesHead=0,this.timesTail=0,this.messagesTail=this.messagesMask(0),this.messagesSize=0}return e.prototype.size=function(){return this.messagesSize},e.prototype.put=function(e){if(this.messages[this.messagesTail]=e,this.messagesTail=this.messagesMask(this.messagesTail+1),this.messagesSize<this.messagesLength)this.messagesSize=this.messagesSize+1;else for(;this.indices[this.timesHead]===this.messagesTail;)this.indices[this.timesHead]=-1,this.timesHead=this.indexMask(this.timesHead+1)},e.prototype.recover=function(e,t){if(e<0||e>this.messagesSize)return!1;for(var r=e;r>=1;--r)t(this.messages[this.messagesMask(this.messagesTail-r)]);return!0},e.prototype.clear=function(){If.fill(this.messages,null),If.fill(this.indices,-1),this.timesHead=0,this.timesTail=0,this.messagesSize=0},e.prototype.removeElements=function(e){var t,r=this.messagesMask(this.messagesTail-this.messagesSize);r<e?(If.fill(this.messages,null,r,e),t=this.messagesSize-e+r):r>e?(If.fill(this.messages,null,r,this.messagesLength),If.fill(this.messages,null,0,e),t=this.messagesSize-r+e):(If.fill(this.messages,null),t=0),this.messagesSize=t},e.prototype.markTime=function(e){if(this.messagesSize>0){var t=this.timesHead,r=this.timesTail,n=this.indices[t],o=Ud(e);if(n>=0){var i=this.indexMask(r-1);if(this.indices[i]===this.messagesTail)return;if(this.times[i]===o)return void(this.indices[i]=this.messagesTail)}this.timesTail=this.indexMask(r+1),this.times[r]=o,this.indices[r]=this.messagesTail,t===r&&n>=0&&(this.removeElements(n),this.timesHead=this.timesTail)}},e.prototype.flush=function(e){if(!(0===this.messagesSize||this.indices[this.timesHead]<0)){var t=this.timesTail,r=Ud(e);do{var n=t;if(t=this.indexMask(t-1),this.times[t]<=r)return this.removeElements(this.indices[t]),this.timesHead<=n?If.fill(this.indices,-1,this.timesHead,n):(If.fill(this.indices,-1,this.timesHead,this.indexCapacity),If.fill(this.indices,-1,0,n)),void(this.timesHead=n)}while(t!==this.timesHead)}},e}();xd.RecoveryBuffer=kd;var qd={};(function(e){"use strict";var t=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(qd,"__esModule",{value:!0});var r=qa.create("Connection"),n=e.DIFFUSION_CLOSE_TIMEOUT||1e3,o=e.DIFFUSION_CONNECT_TIMEOUT||1e4,i=e.DIFFUSION_RECOVERY_BUFFER_INDEX_SIZE||8,s=function(e){function s(t,n,o){var s=this,a=Xl.Emitter.create();return(s=e.call(this,a)||this).emitter=a.emitter(s),s.fsm=new Oh.FSM("disconnected",{connecting:["connected","disconnected","closed"],connected:["disconnecting","disconnected","closed"],disconnecting:["disconnected"],disconnected:["connecting","closed"],closed:[]}),s.transports=t,s.reconnectTimeout=n,s.lastSentSequence=0,s.lastReceivedSequence=0,s.recoveryBuffer=new xd.RecoveryBuffer(o,i),s.fsm.on("change",(function(e,t){r.debug("State changed: "+e+" -> "+t)})),s}return t(s,e),s.prototype.onData=function(e){var t=this;r.debug("Received message from transport",e),Ka.parse(e,(function(e,n){if(!e&&n){if(n.type===Ka.types.ABORT_NOTIFICATION)return void t.transport.close();t.lastReceivedSequence++,t.emitter.emit("data",n)}else r.warn("Unable to parse message",e),t.fsm.change("closed")&&(t.closeReason=Ch.CloseReasonEnum.CONNECTION_ERROR,t.transport.close())}))},s.prototype.onClose=function(){this.fsm.change("disconnected")||this.fsm.change("closed")?(clearInterval(this.scheduledRecoveryBufferTrim),clearTimeout(this.scheduledClose),r.trace("Transport closed: ",this.closeReason),"disconnected"===this.fsm.state?this.emitter.emit("disconnect",this.closeReason):this.emitter.close(this.closeReason)):r.debug("Unable to disconnect, current state: ",this.fsm.state)},s.prototype.onError=function(e){r.error("Error from transport",e),this.fsm.change("closed")&&(this.closeReason=Ch.CloseReasonEnum.TRANSPORT_ERROR,this.transport.close())},s.prototype.onHandshakeSuccess=function(e){if(e.response===Tf.responseCodes.RECONNECTED){var t=this.lastSentSequence-e.sequence+1;if(!this.recoveryBuffer.recover(t,this.dispatch.bind(this))){var n=this.lastSentSequence-this.recoveryBuffer.size()-e.sequence+1;return r.warn("Unable to reconnect due to lost messages ("+n+")"),this.fsm.change("disconnected")&&(this.closeReason=Ch.CloseReasonEnum.LOST_MESSAGES,this.transport.close()),e}this.recoveryBuffer.clear(),this.lastSentSequence=e.sequence-1}if(e.success&&this.fsm.change("connected"))r.trace("Connection response: ",e.response),this.closeReason=Ch.CloseReasonEnum.TRANSPORT_ERROR,this.emitter.emit("connect",e);else{switch(r.error("Connection failed: ",e.response),e.response){case Tf.responseCodes.AUTHENTICATION_FAILED:this.closeReason=Ch.CloseReasonEnum.ACCESS_DENIED;break;case Tf.responseCodes.LICENSE_EXCEEDED:this.closeReason=Ch.CloseReasonEnum.LICENSE_EXCEEDED;break;case Tf.responseCodes.DOWNGRADE:this.closeReason=Ch.CloseReasonEnum.PROTOCOL_VERSION_MISMATCH;break;default:this.closeReason=Ch.CloseReasonEnum.HANDSHAKE_REJECTED}this.transport.close()}return clearTimeout(this.scheduledClose),e},s.prototype.onHandshakeError=function(e){e.reason===Xf.DeserialisationErrorReason.PROTOCOL_VERSION_MISMATCH?this.closeReason=Ch.CloseReasonEnum.PROTOCOL_VERSION_MISMATCH:this.closeReason=Ch.CloseReasonEnum.HANDSHAKE_ERROR,clearTimeout(this.scheduledClose),r.trace("Unable to deserialise handshake response",e)},s.prototype.connect=function(e,t,n){var i=this;if(void 0===n&&(n=o),"disconnected"===this.fsm.state){if(this.fsm.change("connecting")){if(this.closeReason=Ch.CloseReasonEnum.CONNECTION_ERROR,this.transport=this.transports.get(t),null===this.transport)throw new Error("No valid transports requested");this.transport.on("data",this.onData.bind(this)),this.transport.on("close",this.onClose.bind(this)),this.transport.on("error",this.onError.bind(this)),this.transport.connect(e,this.onHandshakeSuccess.bind(this),this.onHandshakeError.bind(this)),this.scheduledClose=setTimeout((function(){r.debug("Timed out connection attempt after "+n),i.closeReason=Ch.CloseReasonEnum.CONNECTION_TIMEOUT,i.transport.close()}),n),this.scheduledRecoveryBufferTrim=setInterval((function(){"connected"===i.fsm.state&&i.recoveryBuffer.flush(Date.now()-i.reconnectTimeout)}),this.reconnectTimeout)}}else r.warn("Cannot connect, current state: ",this.fsm.state)},s.prototype.resetSequences=function(){this.recoveryBuffer.clear(),this.lastSentSequence=0,this.lastReceivedSequence=0},s.prototype.getAvailableSequence=function(){return this.lastSentSequence+1-this.recoveryBuffer.size()},s.prototype.dispatch=function(e){var t=new Wa.BufferOutputStream;Ka.writeToBuffer(e,t),this.lastSentSequence+=1,this.recoveryBuffer.put(e),this.recoveryBuffer.markTime(Date.now()),this.transport.dispatch(t.getBuffer())},s.prototype.send=function(e){return"connected"===this.fsm.state&&(this.dispatch(e),!0)},s.prototype.close=function(e){return this.closeReason=e,"disconnected"===this.fsm.state?this.onClose():this.fsm.change("disconnecting")&&(this.dispatch(Ka.create(Ka.types.CLOSE_REQUEST)),this.scheduledClose=setTimeout(this.transport.close.bind(this.transport),n)),this},s.prototype.closeIdleConnection=function(){this.fsm.change("disconnecting")&&(r.debug("Connection detected as idle"),this.closeReason=Ch.CloseReasonEnum.IDLE_CONNECTION,this.transport.close())},s.prototype.getState=function(){return this.fsm.state},s}($l.StreamImpl);qd.Connection=s}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var Vd={};Object.defineProperty(Vd,"__esModule",{value:!0}),Vd.create=function(e,t,r){return new qd.Connection(e,t,r)};var Fd={};Object.defineProperty(Fd,"__esModule",{value:!0});var Gd=function(){function e(){}return e.prototype.read=function(e){return e.readMany(e.count-e.pos)},e.prototype.write=function(e,t){e.writeMany(t)},e}();Fd.BufferSerialiser=new Gd;var Hd={};(function(e){"use strict";var t=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(Hd,"__esModule",{value:!0});var r="undefined"!=typeof window&&window.location.hostname?window.location.hostname:"localhost",n="undefined"!=typeof window&&"http:"===window.location.protocol&&window.location.port?parseInt(window.location.port,10):80,o="undefined"!=typeof window&&"https:"===window.location.protocol&&window.location.port?parseInt(window.location.port,10):443,i="undefined"==typeof window||"http:"!==window.location.protocol,s=function(e){setTimeout(e,5e3)},a=function(e,t){t()},u="undefined"==typeof window?["WEBSOCKET"]:["WEBSOCKET","XHR"],c=function(){function c(t){if(void 0===t&&(t={}),void 0===t.host)t.host=r;else if(1===(t.host.match(/:/g)||[]).length||t.host.match(/^\[[^\]]*\]:\d+$/)){var c=t.host.lastIndexOf(":");void 0===t.port&&(t.port=parseInt(t.host.substr(c+1),10)),t.host=t.host.substr(0,c)}var p;t.host.indexOf(":")>-1&&!t.host.match(/^\[/)&&(t.host="["+t.host+"]"),void 0===t.path?t.path="/diffusion":("/"!==t.path[0]&&(t.path="/"+t.path),"/diffusion"!==t.path.substring(t.path.length-"/diffusion".length)&&("/"===t.path[t.path.length-1]&&(t.path=t.path.substring(0,t.path.length-1)),t.path=t.path+"/diffusion")),void 0!==t.port&&"string"==typeof t.port&&(isNaN(parseInt(t.port,10))?t.port=void 0:t.port=parseInt(t.port,10)),void 0===t.secure&&(void 0===t.port?t.secure=i:t.secure=t.port===o),void 0===t.port&&(t.port=t.secure?o:n),this.host=t.host,this.port=t.port,this.path=t.path,this.secure=t.secure,void 0===t.reconnect||"boolean"==typeof t.reconnect&&t.reconnect?this.reconnect={timeout:6e4,strategy:s}:"number"==typeof t.reconnect?this.reconnect={timeout:t.reconnect,strategy:s}:"function"==typeof t.reconnect?this.reconnect={timeout:6e4,strategy:t.reconnect}:"object"==typeof t.reconnect?this.reconnect={timeout:void 0===t.reconnect.timeout?6e4:t.reconnect.timeout,strategy:t.reconnect.strategy||s}:this.reconnect={timeout:0,strategy:a},void 0!==t.principal&&(this.principal=t.principal||"","string"==typeof t.credentials?this.credentials=t.credentials:(p=t.credentials)instanceof Int8Array||p instanceof Int16Array||p instanceof Int32Array||p instanceof Uint8Array||p instanceof Uint8ClampedArray||p instanceof Uint16Array||p instanceof Uint32Array||p instanceof Float32Array||p instanceof Float64Array?this.credentials=e.from(t.credentials.buffer):Array.isArray(t.credentials)?(t.credentials.forEach((function(e){if("number"!=typeof e||e>127||e<-128)throw new Error("Custom credentials invalid. Element must be octet.")})),this.credentials=e.from(t.credentials)):this.credentials=""),"string"==typeof t.transports?this.transports=[t.transports]:"object"==typeof t.transports&&t.transports instanceof Array&&t.transports.length>0?this.transports=t.transports.slice():this.transports=u.slice(),this.transports=this.transports.slice().map((function(e){return e.toUpperCase()}));var l=t.maxMessageSize&&t.maxMessageSize>1024?t.maxMessageSize:2147483647;if(this.maxMessageSize=l,this.activityMonitor=void 0===t.activityMonitor||t.activityMonitor,void 0!==t.properties){var f={};Object.getOwnPropertyNames(t.properties).forEach((function(e){"string"==typeof t.properties[e]&&(f[e]=t.properties[e])})),this.properties=f}this.httpProxyAgent=t.httpProxyAgent}return c.prototype.with=function(e){var r,n,o,i,s,a={};try{for(var u=t(Object.getOwnPropertyNames(this)),p=u.next();!p.done;p=u.next())a[s=p.value]=this[s]}catch(e){r={error:e}}finally{try{p&&!p.done&&(n=u.return)&&n.call(u)}finally{if(r)throw r.error}}try{for(var l=t(Object.getOwnPropertyNames(e)),f=l.next();!f.done;f=l.next())a[s=f.value]=e[s]}catch(e){o={error:e}}finally{try{f&&!f.done&&(i=l.return)&&i.call(l)}finally{if(o)throw o.error}}return new c(a)},c}();Hd.OptionsImpl=c}).call(this,a({}).Buffer);var Wd={};Object.defineProperty(Wd,"__esModule",{value:!0}),function(e){e.CONNECT="connect",e.CONNECT_EXISTING="connect-existing",e.CLOSE="close",e.MESSAGE="message",e.STREAM="stream",e.SERVICE="service",e.LOCK="lock",e.CID="cid"}(Wd.WorkerCommand||(Wd.WorkerCommand={})),function(e){e.ACQUIRED="acquired",e.ACQUIRE_ERROR="acquire_error",e.OWNED="owned",e.REMOVED="removed",e.RELEASED="released",e.RELEASE_ERROR="release_error"}(Wd.WorkerSessionLockCommand||(Wd.WorkerSessionLockCommand={})),function(e){e.OPEN="open",e.VALUE="value",e.SUBSCRIPTION="subscription",e.UNSUBSCRIPTION="unsubscription",e.SUBSCRIPTION_ERROR="subscription_error"}(Wd.WorkerStreamCommand||(Wd.WorkerStreamCommand={}));var Yd={},zd=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)s.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return s};Object.defineProperty(Yd,"__esModule",{value:!0});var Qd=qa.create("InternalSessionLocksProxy"),$d=function(){function e(e,t,r,n,o){var i=this;this.owned=!0,this.name=e,this.sequence=t,this.scope=r,this.releaseLock=o,n.setOwned=function(e){i.owned=e}}return e.prototype.getName=function(){return this.name},e.prototype.getSequence=function(){return this.sequence},e.prototype.isOwned=function(){return this.owned},e.prototype.getScope=function(){return this.scope},e.prototype.unlock=function(){return this.owned?(this.owned=!1,this.releaseLock(this)):Promise.resolve(!1)},e}(),Kd=function(){function e(e){var t=this;this.activeRequests={},this.releaseRequests={},this.locks={},this.nextRequestId=0,this.connector=e,this.connector.on("lock_event",(function(e){var r=zd(e,3),n=r[0],o=r[1],i=r[2];switch(o){case Wd.WorkerSessionLockCommand.ACQUIRED:t.onLockAcquired(n,i);break;case Wd.WorkerSessionLockCommand.ACQUIRE_ERROR:t.onLockAcquireError(n,i);break;case Wd.WorkerSessionLockCommand.OWNED:t.onLockOwned(n,i);break;case Wd.WorkerSessionLockCommand.REMOVED:t.onLockRemoved(n);break;case Wd.WorkerSessionLockCommand.RELEASED:t.onLockReleased(i);break;case Wd.WorkerSessionLockCommand.RELEASE_ERROR:t.onLockReleaseError(i);break;default:Qd.error("Unrecognised lock_event "+o)}}))}return e.prototype.onLockAcquired=function(e,t){var r=zd(t,3),n=r[0],o=r[1],i=r[2];void 0!==this.activeRequests[n]&&(this.activeRequests[n](void 0,e,Gs.fromString(o,10),i),delete this.activeRequests[n])},e.prototype.onLockAcquireError=function(e,t){var r=zd(t,2),n=r[0],o=r[1];void 0!==this.activeRequests[n]&&(this.activeRequests[n](o,e),delete this.activeRequests[n])},e.prototype.onLockOwned=function(e,t){void 0!==this.locks[e]&&this.locks[e].ownedSetter.setOwned(t)},e.prototype.onLockRemoved=function(e){delete this.locks[e]},e.prototype.onLockReleased=function(e){var t=zd(e,2),r=t[0],n=t[1];this.releaseRequests[r](void 0,n)},e.prototype.onLockReleaseError=function(e){var t=zd(e,2),r=t[0],n=t[1];this.releaseRequests[r](n)},e.prototype.handleAcquisition=function(e,t,r){var n=this.locks[e];if(void 0!==n&&n.lock.getSequence().equals(t))return n.lock;var o={setOwned:function(){throw Error("Session lock ownedSetter must be implemented")}},i=new $d(e,t,r,o,this.releaseLock.bind(this));return this.locks[e]={lock:i,ownedSetter:o},i},e.prototype.releaseLock=function(e){var t=this;return new Promise((function(r,n){var o=t.nextRequestId++;t.releaseRequests[o]=function(e,i){delete t.releaseRequests[o],e?(Qd.debug("Release shared-session lock failed"),n(e)):r(i)},t.connector.send(Wd.WorkerCommand.LOCK,JSON.stringify({action:"release",requestId:o,name:e.getName(),sequence:e.getSequence().toString(10),scope:e.getScope()}))}))},e.prototype.lock=function(e,t){var r=this;return new Promise((function(n,o){if(void 0!==r.locks[e]&&r.locks[e].lock.isOwned())n(r.locks[e].lock);else{var i=r.nextRequestId++;r.activeRequests[i]=function(e,t,s,a){delete r.activeRequests[i],e?(Qd.debug("Acquire shared-session lock failed"),o(e)):n(r.handleAcquisition(t,s,a))},r.connector.send(Wd.WorkerCommand.LOCK,JSON.stringify({action:"acquire",requestId:i,name:e,scope:t}))}}))},e}();Yd.InternalSessionLocksProxy=Kd;var Jd={};(function(e){"use strict";function t(t){var r=new Ga.BufferInputStream(e.from(t,"base64"));return ud.read(r)}function r(e,t,r){return e?"any"===t.name()?(r.type===lu.TopicTypeEnum.TIME_SERIES?al.DataTypes.timeseries(al.DataTypes.get(r.properties.TIME_SERIES_EVENT_VALUE_TYPE)):al.DataTypes.get(r.type)).readValue(e):t.readValue(e):null}Object.defineProperty(Jd,"__esModule",{value:!0});var n=function(){function n(e,t){this.stream=e,this.datatype=t}return n.prototype.onOpen=function(){this.stream.onOpen()},n.prototype.onValue=function(n){var o=JSON.parse(n),i=t(o.specification),s=o.oldValue?e.from(o.oldValue,"base64"):null,a=e.from(o.newValue,"base64");this.stream.onValue(o.path,i,s,a,r(s,this.datatype,i),r(a,this.datatype,i))},n.prototype.onSubscription=function(e){var r=JSON.parse(e);this.stream.onSubscription(r.path,t(r.specification))},n.prototype.onUnsubscription=function(e){var r=JSON.parse(e),n=void 0!==r.reason?yu.UnsubscribeReasonEnum[yu.UnsubscribeReasonEnum[r.reason]]:yu.UnsubscribeReasonEnum.UNKNOWN_UNSUBSCRIBE_REASON;this.stream.onUnsubscription(r.path,t(r.specification),n)},n.prototype.onSubscriptionError=function(e){this.stream.onSubscriptionError(Xa.ErrorReason[Xa.ErrorReason[parseInt(e,10)]])},n}();Jd.ValueStreamWorkerReceiver=n}).call(this,a({}).Buffer);var Xd={},Zd=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)s.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return s},ey=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(Xd,"__esModule",{value:!0});var ty=function(){var e=new Gs(0);return function(){return e=e.add(1),new da.ConversationId(e)}}(),ry=function(){function e(e){var t=this;this.connector=e,this.adapters={},this.connector.on({stream_event:function(e){var r=Zd(e,4),n=r[0],o=r[1],i=r[2],s=r[3],a=t.adapters[n];if(a)switch(o){case Wd.WorkerStreamCommand.OPEN:a.onOpen();break;case Wd.WorkerStreamCommand.VALUE:a.onValue(s);break;case Wd.WorkerStreamCommand.SUBSCRIPTION:a.onSubscription(s);break;case Wd.WorkerStreamCommand.UNSUBSCRIPTION:a.onUnsubscription(s);break;case Wd.WorkerStreamCommand.SUBSCRIPTION_ERROR:a.onSubscriptionError(i)}}})}return e.prototype.add=function(e,t,r){var n=ty();this.adapters[n.toString()]=new Jd.ValueStreamWorkerReceiver(t,r);var o={action:"add",adapterId:n.toString(),topic:e.expression,datatype:r.name()};this.connector.send(Wd.WorkerCommand.STREAM,JSON.stringify(o))},e.prototype.addFallback=function(e,t){var r=ty();this.adapters[r.toString()]=new Jd.ValueStreamWorkerReceiver(e,t);var n={action:"add_fallback",adapterId:r.toString(),datatype:t.name()};this.connector.send(Wd.WorkerCommand.STREAM,JSON.stringify(n))},e.prototype.remove=function(e){var t,r;try{for(var n=ey(Object.getOwnPropertyNames(this.adapters)),o=n.next();!o.done;o=n.next()){var i=o.value;if(this.adapters[i].stream===e){var s={action:"remove",adapterId:i.toString()};this.connector.send(Wd.WorkerCommand.STREAM,JSON.stringify(s)),delete this.adapters[i]}}}catch(e){t={error:e}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}},e.prototype.close=function(){this.connector.send(Wd.WorkerCommand.STREAM,JSON.stringify({action:"close_registry"}))},e}();Xd.StreamRegistryWebworkerProxy=ry;var ny={};(function(e){"use strict";var t=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),r=this&&this.__rest||function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&(r[n[o]]=e[n[o]])}return r},n=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)s.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return s};Object.defineProperty(ny,"__esModule",{value:!0});var o=qa.create("InternalSessionWebworkerProxy"),i=function(i){function s(t,r,s,a){var u=this,c=Xl.Emitter.create();return(u=i.call(this,c)||this).emitter=c.emitter(u),u.connector=s,u.opts=a,u.connected=!1,u.state=qs.InternalSessionState.INITIALISING,u.connector.on({connect_event:function(e){var t=n(e,3),r=t[0],i=t[1],s=t[2];u.sessionID=zf.SessionId.fromString(r),u.connected=!0;try{u.serverMaximumMessageSize=parseInt(s,10),u.opts=JSON.parse(i),u.emitter.emit("connect",u.sessionID,new Hd.OptionsImpl(u.opts))}catch(e){o.error("Unable to parse options from shared session",e),u.emitter.emit("error",new Error("Unable to parse options from shared session"))}},connect_error:function(e){u.connector.disconnect(),u.emitter.emit("error",Ch.CloseReasonEnum[e]||new Error(e))},reconnect_event:function(){u.connected=!0,u.emitter.emit("reconnect")},disconnect_event:function(e){u.connected=!1;var t=Ch.CloseReasonEnum[e];u.emitter.emit("disconnect",Ch.CloseReasonEnum[t])},close_event:function(e){u.connector.disconnect(),u.connected=!1;var t=Ch.CloseReasonEnum[e];u.emitter.close(Ch.CloseReasonEnum[t])},error_event:function(e){u.connector.disconnect(),u.connected=!1,u.emitter.emit("error",new Error(e))},command_response:function(t){var r=n(t,2),o=r[0],i=r[1],s=da.ConversationId.fromString(o),a=new Ga.BufferInputStream(e.from(i,"base64"));u.conversationSet.respondIfPresent(s,a)},command_error:function(e){var t,r=n(e,2),o=r[0],i=r[1],s=da.ConversationId.fromString(o);try{t=JSON.parse(i)}catch(e){t=new Error("Could not parse error response")}u.conversationSet.discard(s,t)},service_request:function(t){var r=n(t,3),o=r[0],i=r[1],s=r[2],a=da.ConversationId.fromString(i),c=new Wa.BufferOutputStream;Da.CommandHeaderSerialiser.write(c,new Aa.CommandHeader(parseInt(o,10),a)),Fd.BufferSerialiser.write(c,e.from(s,"base64"));var p=new Ga.BufferInputStream(c.getBuffer());u.serviceAdapter.onMessage(Ka.types.SERVICE_REQUEST,p)},state_change:function(e){u.state=e}}),u.serviceAdapter=new Za.ServiceAdapter(u,(function(e){u.connector.sendMessage(e)})),u.serviceLocator=new nu.ServiceLocatorImpl(u,u.serviceAdapter),u.serviceRegistry=r,u.serviceRegistry.addListener(u.serviceAdapter.addService.bind(u.serviceAdapter)),u.serviceRegistry.addListener((function(e){u.connector.send(Wd.WorkerCommand.SERVICE,JSON.stringify({action:"add",serviceId:e.id}))})),u.topicStreamRegistry=new Xd.StreamRegistryWebworkerProxy(u.connector),u.conversationSet=t(),u.sessionLocks=new Yd.InternalSessionLocksProxy(u.connector),u}return t(s,i),s.prototype.connect=function(){if(this.opts){var t=this.opts,n=t.credentials,o=t.reconnect,i=r(t,["credentials","reconnect"]),s=n instanceof e,a=s?n.toString("base64"):n;i.reconnect=o.timeout,this.connector.send(Wd.WorkerCommand.CONNECT,JSON.stringify([i,s,a]))}else this.connector.send(Wd.WorkerCommand.CONNECT_EXISTING)},s.prototype.close=function(){return this.state!==qs.InternalSessionState.CLOSED&&this.connector.send(Wd.WorkerCommand.CLOSE),this},s.prototype.isConnected=function(){return this.connected},s.prototype.checkConnected=function(e){return!!this.isConnected()||(e(new Error("The session is not connected. Operations are not possible at this time.")),!1)},s.prototype.getSessionId=function(){return this.sessionID},s.prototype.getPrincipal=function(){if(void 0===this.opts)throw new Error("Shared session is not connected");return this.opts.principal},s.prototype.setPrincipal=function(e){if(void 0===this.opts)throw new Error("Shared session is not connected");this.opts.principal=e},s.prototype.getOptions=function(){if(void 0===this.opts)throw new Error("Shared session is not connected");return this.opts},s.prototype.getState=function(){return this.state},s.prototype.getServerMaximumMessageSize=function(){return this.serverMaximumMessageSize},s.prototype.lock=function(e,t){return this.sessionLocks.lock(e,t)},s.prototype.onSystemPing=function(){throw new Error("Method not implemented.")},s.prototype.getStreamRegistry=function(){return this.topicStreamRegistry},s.prototype.getServiceRegistry=function(){return this.serviceRegistry},s.prototype.getRouting=function(){throw new Error("Method not implemented.")},s.prototype.getServiceLocator=function(){return this.serviceLocator},s.prototype.getConversationSet=function(){return this.conversationSet},s.prototype.isShared=function(){return!0},s.prototype.getContext=function(){return Ql.sessionContext},s.prototype.updateFeatures=function(){},s}($l.StreamImpl);ny.InternalSessionWebworkerProxy=i}).call(this,a({}).Buffer);var oy={},iy=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),sy=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}},ay=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)s.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return s},uy=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(ay(arguments[t]));return e};Object.defineProperty(oy,"__esModule",{value:!0});var cy=function(){function e(e){var t=this;this.listeners={},this.worker=new SharedWorker(e),this.worker.port.onmessage=function(e){var r,n,o=e.data[0];if(void 0!==t.listeners[o])try{for(var i=sy(t.listeners[o]),s=i.next();!s.done;s=i.next()){s.value.apply(void 0,uy([e.data[1]],e.data.slice(2)))}}catch(e){r={error:e}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}}}return e.prototype.getWorker=function(){return this.worker},e.prototype.addListener=function(e,t){void 0===this.listeners[e]?this.listeners[e]=[t]:this.listeners[e].push(t)},e.prototype.removeListener=function(e,t){void 0!==this.listeners[e]&&(this.listeners[e]=this.listeners[e].filter((function(e){return e!==t})))},e}(),py={};function ly(e){if(!window||!window.SharedWorker)throw new Error("SharedWorker could not be found!");return void 0===py[e]&&(py[e]=new cy(e)),py[e]}var fy=function(e){function t(t,r){var n=this,o=Xl.Emitter.create();return(n=e.call(this,o)||this).emitter=o.emitter(n),n.sessionName=t,n.router=ly(r),n.worker=n.router.getWorker(),n.listener=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];t.length<2?n.emitter.emit(e,t[0]):n.emitter.emit(e,t)},n.router.addListener(t,n.listener),n}return iy(t,e),t.prototype.send=function(e,t){this.worker.port.postMessage([this.sessionName,e,t])},t.prototype.sendMessage=function(e){var t={type:e.type,encoding:e.encoding,data:e.data.toString("base64"),stream:e.getBuffer().toString("base64"),headers:e.headers,id:e.id,topic:e.topic};this.send(Wd.WorkerCommand.MESSAGE,JSON.stringify(t))},t.prototype.disconnect=function(){this.router.removeListener(this.sessionName,this.listener)},t}($l.StreamImpl);oy.SharedSessionConnector=fy,oy.getSharedConversationSetFactory=function(e){var t=[];function r(){return new Promise((function(r){t.push(r),e.send(Wd.WorkerCommand.CID)}))}return e.on("cid_event",(function(e){t.length>0&&t.shift()(new da.ConversationId(Gs.fromString(e)))})),function(){return new Yh.ConversationSet(r)}};var hy={};function dy(e){e=gc.requireNonNull(e,"options");var t=new qh.ServiceRegistryImpl;return t.add(id.USER_PING,Wh.pingService),t.add(id.SYSTEM_PING,Fh.monitoredPingService),t.add(jd.NOTIFY_SUBSCRIPTION,Gh.notifySubscriptionService),t.add(jd.UNSUBSCRIPTION_NOTIFICATION,Hh.notifyUnsubscriptionService),new Ph.InternalSessionImpl(Yh.create,t,Vd.create,e)}function yy(e,t){var r=new qh.ServiceRegistryImpl,n=new oy.SharedSessionConnector(e,t),o=oy.getSharedConversationSetFactory(n);return function(e){return new ny.InternalSessionWebworkerProxy(o,r,n,e)}}Object.defineProperty(hy,"__esModule",{value:!0}),hy.createShared=yy,hy.create=function(e,t){if(void 0===e&&void 0===t)return dy;if(void 0!==e&&void 0!==t)return yy(e,t);throw new Error('Missing parameter "name" or "workerJs" when creating a shared session')};var vy={};Object.defineProperty(vy,"__esModule",{value:!0}),vy.escape=function(e){return cl.escape(gc.requireNonNull(e,"string"))},vy.stringToRoles=function(e){return cl.stringToSet(gc.requireNonNull(e,"string"))},vy.rolesToString=function(e){return cl.collectionToString(gc.requireNonNull(e,"roles"))};var _y={},Sy=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Ey=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function s(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){e.done?o(e.value):new r((function(t){t(e.value)})).then(s,a)}u((n=n.apply(e,t||[])).next())}))},my=this&&this.__generator||function(e,t){var r,n,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},wy=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)s.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return s},gy=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(wy(arguments[t]));return e};Object.defineProperty(_y,"__esModule",{value:!0});var Ty,Oy=qa.create("Registration");!function(e){e[e.REGISTERING=0]="REGISTERING",e[e.ACTIVE=1]="ACTIVE",e[e.CLOSED=2]="CLOSED"}(Ty=_y.ResponseHandlerState||(_y.ResponseHandlerState={}));var Iy=function(e){function t(t){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];var o=e.apply(this,gy(r))||this;return o.cause=t,o}return Sy(t,e),t}(Error);function by(e,t,r){var n,o=Ty.REGISTERING;return{onDiscard:function(r,n){try{n instanceof e.getContext().CloseReason?t.close():t.close(n)}catch(n){Oy.error("REGISTERED_HANDLER_EXCEPTION",n)}o=Ty.CLOSED},onOpen:function(t){n=function(){return new Promise((function(n,i){o!==Ty.CLOSED?r(t,(function(r){r?(e.getConversationSet().discard(t,r),i(r)):(e.getConversationSet().respondIfPresent(t,Ty.CLOSED),n())})):i(new Error("Handler already closed"))}))}},onResponse:function(r,i){if(i===Ty.CLOSED){try{t.close()}catch(e){Oy.error("REGISTERED_HANDLER_EXCEPTION",e)}return o=i,!0}try{return i===Ty.ACTIVE?(t.active(n,r),o=i,!1):t.respond(i)}catch(t){Oy.error("REGISTERED_HANDLER_EXCEPTION",t),e.getConversationSet().discard(r,new Iy(t,"An error was thrown by the handler")),n().catch((function(e){Oy.debug("Failed to deregister with the server",e)}))}return!0}}}function Ry(e,t,r,n){return function(o){o?(e.discard(t,o),n(o)):(e.respondIfPresent(t,Ty.ACTIVE),r())}}function Cy(e,t,r,n,o){return Ey(this,void 0,void 0,(function(){var i,s,a,u,c;return my(this,(function(p){switch(p.label){case 0:return i=e.getConversationSet(),s=e.getServiceLocator(),a=s.obtain(n),u=s.obtain(o),[4,i.newConversation(by(e,r,(function(e,r){u.send(t,r)})))];case 1:return c=p.sent(),[2,new Promise((function(e,r){a.send({params:t,cid:c},Ry(i,c,e,r))}))]}}))}))}_y.responseHandler=by,_y.registrationCallback=Ry,_y.registerHandler=Cy,_y.registerRequestHandler=function(e,t,r){return Cy(e,t,r,jd.MESSAGING_RECEIVER_CONTROL_REGISTRATION,jd.MESSAGING_RECEIVER_CONTROL_DEREGISTRATION)},_y.registerTopicHandler=function(e,t,r){return Cy(e,t,r,jd.TOPIC_CONTROL_REGISTRATION,jd.TOPIC_CONTROL_DEREGISTRATION)};var Py={};Object.defineProperty(Py,"__esModule",{value:!0});var Ny=function(){function e(e,t){this.resultList=e,this.totalSelectedCount=t,this.hasMoreFlag=e.length<t}return e.prototype.results=function(){return this.resultList},e.prototype.hasMore=function(){return this.hasMoreFlag},e.prototype.size=function(){return this.resultList.length},e.prototype.totalSelected=function(){return this.totalSelectedCount},e.prototype.isEmpty=function(){return 0===this.resultList.length},e}();Py.SessionFetchResultImpl=Ny;var Ay={};Object.defineProperty(Ay,"__esModule",{value:!0});var My=function(){function e(){}return e.prototype.read=function(e){return ba.readString(e)},e.prototype.write=function(e,t){ba.writeString(e,t)},e}();Ay.StringSerialiser=new My;var Ly={},Dy=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(Ly,"__esModule",{value:!0});var jy=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Dy(t,e),t.prototype.read=function(e){return zl.parseSelector(ba.readString(e))},t.prototype.write=function(e,t){ba.writeString(e,t.expression)},t}(Pa.AbstractSerialiser);Ly.TopicSelectorSerialiser=new jy;var xy={};Object.defineProperty(xy,"__esModule",{value:!0});var Uy=function(e,t){this.filter=e,this.selector=t};xy.ClientFilterSubscribeRequest=Uy;var By={},ky=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(By,"__esModule",{value:!0});var qy=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ky(t,e),t.prototype.read=function(e){var t=ba.readString(e),r=Ly.TopicSelectorSerialiser.read(e);return new xy.ClientFilterSubscribeRequest(t,r)},t.prototype.write=function(e,t){ba.writeString(e,t.filter),Ly.TopicSelectorSerialiser.write(e,t.selector)},t}(Pa.AbstractSerialiser);By.ClientFilterSubscribeRequestSerialiser=new qy;var Vy={};Object.defineProperty(Vy,"__esModule",{value:!0});var Fy=function(){function e(e,t,r){this.message=gc.requireNonNull(e,"message"),this.line=t||0,this.column=r||0}return e.prototype.toString=function(){return"ErrorReport ["+this.message+" at ["+this.line+":"+this.column+"]]"},e}();Vy.ErrorReportImpl=Fy;var Gy={},Hy=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(Gy,"__esModule",{value:!0});var Wy=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Hy(t,e),t.prototype.read=function(e){var t=ba.readString(e),r=ba.readInt32(e),n=ba.readInt32(e);return new Vy.ErrorReportImpl(t,r,n)},t.prototype.write=function(e,t){ba.writeString(e,t.message),ba.writeInt32(e,t.line),ba.writeInt32(e,t.column)},t}(Pa.AbstractSerialiser);Gy.ErrorReportSerialiser=new Wy;var Yy={};Object.defineProperty(Yy,"__esModule",{value:!0});var zy=function(){function e(e,t){this.selected=e,this.errors=t}return e.prototype.isSuccess=function(){return 0===this.errors.length},e}();Yy.ClientFilterSubscribeResponse=zy;var Qy={},$y=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(Qy,"__esModule",{value:!0});var Ky=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return $y(t,e),t.prototype.read=function(e){if(ba.readByte(e)){var t=ba.readCollection(e,Gy.ErrorReportSerialiser.read);return new Yy.ClientFilterSubscribeResponse(0,t)}var r=ba.readInt32(e);return new Yy.ClientFilterSubscribeResponse(r,[])},t.prototype.write=function(e,t){t.isSuccess()?(ba.writeByte(e,0),ba.writeInt32(e,t.selected)):(ba.writeByte(e,1),ba.writeCollection(e,t.errors,Gy.ErrorReportSerialiser.write))},t}(Pa.AbstractSerialiser);Qy.ClientFilterSubscribeResponseSerialiser=new Ky;var Jy={};Object.defineProperty(Jy,"__esModule",{value:!0});var Xy=function(){function e(){}return e.prototype.read=function(e){var t=ba.readInt64(e),r=ba.readInt64(e);return new zf.SessionId(t,r)},e.prototype.write=function(e,t){ba.writeInt64(e,t.server),ba.writeInt64(e,t.value)},e}();Jy.SessionIdSerialiser=new Xy;var Zy={};Object.defineProperty(Zy,"__esModule",{value:!0});var ev=function(e,t){this.sessionID=e,this.selector=t};Zy.ClientSubscribeRequest=ev;var tv={},rv=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(tv,"__esModule",{value:!0});var nv=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return rv(t,e),t.prototype.read=function(e){var t=Jy.SessionIdSerialiser.read(e),r=Ly.TopicSelectorSerialiser.read(e);return new Zy.ClientSubscribeRequest(t,r)},t.prototype.write=function(e,t){Jy.SessionIdSerialiser.write(e,t.sessionID),Ly.TopicSelectorSerialiser.write(e,t.selector)},t}(Pa.AbstractSerialiser);tv.ClientSubscribeRequestSerialiser=new nv;var ov={},iv=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(ov,"__esModule",{value:!0});var sv=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return iv(t,e),t.prototype.write=function(e,t){ba.writeString(e,t.filter),ba.writeCollection(e,t.rolesToRemove,ba.writeString),ba.writeCollection(e,t.rolesToAdd,ba.writeString)},t}(Pa.AbstractSerialiser);ov.ChangeAuthorisationRolesFilterRequestSerialiser=new sv;var av={},uv=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(av,"__esModule",{value:!0});var cv=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return uv(t,e),t.prototype.write=function(e,t){if(void 0===t.sessionID||null===t.sessionID)throw new Error("Session ID is null or undefined");Jy.SessionIdSerialiser.write(e,t.sessionID),ba.writeCollection(e,t.rolesToRemove,ba.writeString),ba.writeCollection(e,t.rolesToAdd,ba.writeString)},t}(Pa.AbstractSerialiser);av.ChangeAuthorisationRolesRequestSerialiser=new cv;var pv={};Object.defineProperty(pv,"__esModule",{value:!0});var lv=function(){function e(e){this.sessionID=e}return e.prototype.toString=function(){return"CloseClientRequest ["+this.sessionID+"]"},e}();pv.CloseClientRequest=lv;var fv={},hv=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(fv,"__esModule",{value:!0});var dv=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return hv(t,e),t.prototype.read=function(e){var t=Jy.SessionIdSerialiser.read(e);return new pv.CloseClientRequest(t)},t.prototype.write=function(e,t){Jy.SessionIdSerialiser.write(e,t.sessionID)},t}(Pa.AbstractSerialiser);fv.CloseClientRequestSerialiser=new dv;var yv={},vv=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(yv,"__esModule",{value:!0});var _v=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return vv(t,e),t.prototype.write=function(e,t){if(void 0===t.sessionID||null===t.sessionID)throw new Error("session ID is null or undefined");Jy.SessionIdSerialiser.write(e,t.sessionID),void 0!==t.propertyKeys&&null!==t.propertyKeys?ba.writeCollection(e,t.propertyKeys,ba.writeString):ba.writeCollection(e,[],ba.writeString)},t}(Pa.AbstractSerialiser);yv.GetSessionPropertiesRequestSerialiser=new _v;var Sv={};Object.defineProperty(Sv,"__esModule",{value:!0});var Ev=function(){function e(e){this.properties=e}return e.prototype.toString=function(){return"GetSessionPropertiesResponse []"},e}();Sv.GetSessionPropertiesResponse=Ev;var mv={},wv=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(mv,"__esModule",{value:!0});var gv=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return wv(t,e),t.prototype.read=function(e){return ba.readBoolean(e)?new Sv.GetSessionPropertiesResponse(ba.readDictionary(e,ba.readString)):null},t}(Pa.AbstractSerialiser);mv.GetSessionPropertiesResponseSerialiser=new gv;var Tv={};Object.defineProperty(Tv,"__esModule",{value:!0}),function(e){e[e.CONNECTION_LOST=0]="CONNECTION_LOST",e[e.IO_EXCEPTION=1]="IO_EXCEPTION",e[e.CLIENT_UNRESPONSIVE=2]="CLIENT_UNRESPONSIVE",e[e.MESSAGE_QUEUE_LIMIT_REACHED=3]="MESSAGE_QUEUE_LIMIT_REACHED",e[e.CLOSED_BY_CLIENT=4]="CLOSED_BY_CLIENT",e[e.MESSAGE_TOO_LARGE=5]="MESSAGE_TOO_LARGE",e[e.INTERNAL_ERROR=6]="INTERNAL_ERROR",e[e.INVALID_INBOUND_MESSAGE=7]="INVALID_INBOUND_MESSAGE",e[e.ABORT=8]="ABORT",e[e.LOST_MESSAGES=9]="LOST_MESSAGES",e[e.SERVER_CLOSING=10]="SERVER_CLOSING",e[e.CLOSED_BY_CONTROLLER=11]="CLOSED_BY_CONTROLLER"}(Tv.SessionCloseReason||(Tv.SessionCloseReason={}));var Ov={};Object.defineProperty(Ov,"__esModule",{value:!0});var Iv=function(e,t,r,n,o,i){this.sessionId=e,this.type=t,this.updateType=r,this.oldProperties=n,this.newProperties=o,this.closeReason=i};Ov.SessionPropertiesEvent=Iv;var bv={};Object.defineProperty(bv,"__esModule",{value:!0}),function(e){e[e.OPEN=0]="OPEN",e[e.UPDATE=1]="UPDATE",e[e.CLOSE=2]="CLOSE"}(bv.SessionPropertiesEventType||(bv.SessionPropertiesEventType={}));var Rv,Cv={},Pv=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(Cv,"__esModule",{value:!0}),function(e){e[e.NEW=1]="NEW",e[e.CHANGE=2]="CHANGE",e[e.REMOVE=3]="REMOVE",e[e.SAME=4]="SAME"}(Rv||(Rv={}));var Nv=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Pv(t,e),t.prototype.read=function(e){var t=Jy.SessionIdSerialiser.read(e),r=tf.read(e,bv.SessionPropertiesEventType);switch(r){case bv.SessionPropertiesEventType.OPEN:var n=ba.readDictionary(e,ba.readString);return new Ov.SessionPropertiesEvent(t,r,void 0,n);case bv.SessionPropertiesEventType.UPDATE:return function(e,t){for(var r=ba.readByte(e),n={},o={},i=ba.readInt32(e),s=0;s<i;++s){var a=ba.readString(e);switch(tf.read(e,Rv)){case Rv.NEW:n[a]=null,o[a]=ba.readString(e);break;case Rv.CHANGE:n[a]=ba.readString(e),o[a]=ba.readString(e);break;case Rv.REMOVE:n[a]=ba.readString(e);break;case Rv.SAME:o[a]=ba.readString(e);break;default:throw new Error("Invalid update entry type: type")}}return new Ov.SessionPropertiesEvent(t,bv.SessionPropertiesEventType.UPDATE,r,n,o)}(e,t);case bv.SessionPropertiesEventType.CLOSE:var o=tf.read(e,Tv.SessionCloseReason),i=ba.readDictionary(e,ba.readString);return new Ov.SessionPropertiesEvent(t,r,void 0,i,void 0,o);default:throw new Error("Unknown session properties event type: "+r)}},t}(Pa.AbstractSerialiser);Cv.SessionPropertiesEventSerialiser=new Nv;var Av={};Object.defineProperty(Av,"__esModule",{value:!0});var Mv=function(e,t){this.cid=e,this.events=t};Av.SessionPropertiesEventBatch=Mv;var Lv={},Dv=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(Lv,"__esModule",{value:!0});var jv=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Dv(t,e),t.prototype.read=function(e){var t=Ra.CIDSerialiser.read(e),r=ba.readCollection(e,Cv.SessionPropertiesEventSerialiser.read);return new Av.SessionPropertiesEventBatch(t,r)},t}(Pa.AbstractSerialiser);Lv.SessionPropertiesEventBatchSerialiser=new jv;var xv={},Uv=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(xv,"__esModule",{value:!0});var Bv=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Uv(t,e),t.prototype.write=function(e,t){ba.writeString(e,t.filter),ba.writeBoolean(e,t.conflate)},t}(Pa.AbstractSerialiser);xv.SetClientConflationFilterRequestSerialiser=new Bv;var kv={},qv=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(kv,"__esModule",{value:!0});var Vv=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return qv(t,e),t.prototype.write=function(e,t){Jy.SessionIdSerialiser.write(e,t.sessionID),ba.writeBoolean(e,t.conflate)},t}(Pa.AbstractSerialiser);kv.SetClientConflationRequestSerialiser=new Vv;var Fv={},Gv=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(Fv,"__esModule",{value:!0});var Hv=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Gv(t,e),t.prototype.write=function(e,t){ba.writeString(e,t.filter),0===Object.keys(t.overwriteProperties).length?ba.writeByte(e,0):(ba.writeByte(e,1),ba.writeDictionary(e,t.overwriteProperties,ba.writeString)),0===Object.keys(t.removeProperties).length?ba.writeByte(e,0):(ba.writeByte(e,1),ba.writeCollection(e,t.removeProperties,ba.writeString))},t}(Pa.AbstractSerialiser);Fv.SetSessionPropertiesFilterRequestSerialiser=new Hv;var Wv={},Yv=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(Wv,"__esModule",{value:!0});var zv=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Yv(t,e),t.prototype.write=function(e,t){t.properties?(ba.writeInt32(e,0),ba.writeCollection(e,t.properties,ba.writeString)):ba.writeInt32(e,1),Ra.CIDSerialiser.write(e,t.cid)},t}(Pa.AbstractSerialiser);Wv.SetSessionPropertiesListenerSerialiser=new zv;var Qv={},$v=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(Qv,"__esModule",{value:!0});var Kv=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return $v(t,e),t.prototype.write=function(e,t){if(void 0===t.sessionID||null===t.sessionID)throw new Error("Session ID is null or undefined");Jy.SessionIdSerialiser.write(e,t.sessionID),0===Object.keys(t.overwriteProperties).length?ba.writeByte(e,0):(ba.writeByte(e,1),ba.writeDictionary(e,t.overwriteProperties,ba.writeString)),0===Object.keys(t.removeProperties).length?ba.writeByte(e,0):(ba.writeByte(e,1),ba.writeCollection(e,t.removeProperties,ba.writeString))},t}(Pa.AbstractSerialiser);Qv.SetSessionPropertiesRequestSerialiser=new Kv;var Jv={},Xv=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(Jv,"__esModule",{value:!0});var Zv=function(e,t){var r,n,o,i;this.properties={};try{for(var s=Xv(Object.getOwnPropertyNames(e)),a=s.next();!a.done;a=s.next()){var u=a.value;this.properties[u]=e[u]}}catch(e){r={error:e}}finally{try{a&&!a.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}try{for(var c=Xv(t),p=c.next();!p.done;p=c.next()){var l=p.value;this.properties[l]=null}}catch(e){o={error:e}}finally{try{p&&!p.done&&(i=c.return)&&i.call(c)}finally{if(o)throw o.error}}};Jv.SetSessionPropertiesResult=Zv;var e_={},t_=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(e_,"__esModule",{value:!0});var r_=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return t_(t,e),t.prototype.read=function(e){var t,r;return t=0===ba.readByte(e)?{}:ba.readDictionary(e,ba.readString),r=0===ba.readByte(e)?[]:ba.readCollection(e,ba.readString),new Jv.SetSessionPropertiesResult(t,r)},t}(Pa.AbstractSerialiser);e_.SetSessionPropertiesResultSerialiser=new r_;var n_={};Object.defineProperty(n_,"__esModule",{value:!0});var o_=function(e,t){this.count=gc.requireNonNull(e,"count"),this.errors=gc.requireNonNull(t,"errors")};n_.CountOrParserErrors=o_;var i_={},s_=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(i_,"__esModule",{value:!0});var a_=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s_(t,e),t.prototype.read=function(e){var t=ba.readInt32(e),r=ba.readCollection(e,Gy.ErrorReportSerialiser.read);return new n_.CountOrParserErrors(t,r)},t.prototype.write=function(e,t){ba.writeInt32(e,t.count),ba.writeCollection(e,t.errors,Gy.ErrorReportSerialiser.write)},t}(Pa.AbstractSerialiser);i_.CountOrParserErrorsSerialiser=new a_;var u_={};Object.defineProperty(u_,"__esModule",{value:!0});var c_=function(){function e(e){this.errors=gc.requireNonNull(e,"errors")}return e.prototype.toString=function(){return"ErrorReportList ["+this.errors+"]"},e}();u_.ErrorReportList=c_;var p_={},l_=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(p_,"__esModule",{value:!0});var f_=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return l_(t,e),t.prototype.read=function(e){var t=ba.readCollection(e,Gy.ErrorReportSerialiser.read);return new u_.ErrorReportList(t)},t.prototype.write=function(e,t){ba.writeCollection(e,t.errors,Gy.ErrorReportSerialiser.write)},t}(Pa.AbstractSerialiser);p_.ErrorReportListSerialiser=new f_;var h_={};Object.defineProperty(h_,"__esModule",{value:!0});var d_=function(e,t,r){this.results=e,this.totalCount=t,this.errors=r};h_.SessionFetchQueryResult=d_;var y_={},v_=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();function __(e){var t=null;1===ba.readByte(e)&&(t=ba.readInt64(e));var r=ba.readDictionary(e,ba.readString);return t&&(r.$StartTime=t.toString()),r}Object.defineProperty(y_,"__esModule",{value:!0});var S_=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return v_(t,e),t.prototype.read=function(e){if(0===ba.readByte(e)){var t=ba.readCollection(e,__),r=ba.readInt32(e);return new h_.SessionFetchQueryResult(t,r)}var n=p_.ErrorReportListSerialiser.read(e);return new h_.SessionFetchQueryResult(void 0,void 0,n)},t}(Pa.AbstractSerialiser);y_.SessionFetchQueryResultSerialiser=new S_;var E_={},m_=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),w_=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)s.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return s},g_=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(w_(arguments[t]));return e};function T_(e,t){void 0===t?ba.writeByte(e,0):(ba.writeByte(e,1),ba.writeInt64(e,t))}Object.defineProperty(E_,"__esModule",{value:!0});var O_=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return m_(t,e),t.prototype.write=function(e,t){ba.writeString(e,t.filter),function(e,t){null===t?ba.writeByte(e,0):(ba.writeByte(e,1),ba.writeCollection(e,g_(t),ba.writeString))}(e,t.withProperties),function(e,t){T_(e,t.from),T_(e,t.to)}(e,t.range),function(e,t){t===Uu.MAX_INT32?ba.writeByte(e,0):(ba.writeByte(e,1),ba.writeInt32(e,t))}(e,t.limit),ba.writeInt32(e,t.maximumResultSize),ba.writeBoolean(e,t.requiresStartTime)},t}(Pa.AbstractSerialiser);E_.SessionFetchQuerySerialiser=new O_;var I_={};Object.defineProperty(I_,"__esModule",{value:!0}),I_.SUBSCRIBE_CLIENT={id:10,request:tv.ClientSubscribeRequestSerialiser,response:od.NullSerialiser},I_.UNSUBSCRIBE_CLIENT={id:11,request:tv.ClientSubscribeRequestSerialiser,response:od.NullSerialiser},I_.CLOSE_CLIENT={id:14,request:fv.CloseClientRequestSerialiser,response:od.NullSerialiser},I_.SET_CLIENT_CONFLATION={id:15,request:kv.SetClientConflationRequestSerialiser,response:od.NullSerialiser},I_.FILTER_SUBSCRIBE={id:65,request:By.ClientFilterSubscribeRequestSerialiser,response:Qy.ClientFilterSubscribeResponseSerialiser},I_.FILTER_UNSUBSCRIBE={id:66,request:By.ClientFilterSubscribeRequestSerialiser,response:Qy.ClientFilterSubscribeResponseSerialiser},I_.GET_SESSION_PROPERTIES={id:67,request:yv.GetSessionPropertiesRequestSerialiser,response:mv.GetSessionPropertiesResponseSerialiser},I_.SESSION_PROPERTIES_REGISTRATION_2={id:81,request:Wv.SetSessionPropertiesListenerSerialiser,response:od.NullSerialiser},I_.SESSION_PROPERTIES_EVENT_2={id:82,request:Lv.SessionPropertiesEventBatchSerialiser,response:od.NullSerialiser},I_.SET_SESSION_PROPERTIES={id:105,request:Qv.SetSessionPropertiesRequestSerialiser,response:e_.SetSessionPropertiesResultSerialiser},I_.SET_SESSION_PROPERTIES_FILTER={id:106,request:Fv.SetSessionPropertiesFilterRequestSerialiser,response:i_.CountOrParserErrorsSerialiser},I_.CHANGE_AUTHORISATION_ROLES={id:123,request:av.ChangeAuthorisationRolesRequestSerialiser,response:od.NullSerialiser},I_.CHANGE_AUTHORISATION_ROLES_FILTER={id:124,request:ov.ChangeAuthorisationRolesFilterRequestSerialiser,response:i_.CountOrParserErrorsSerialiser},I_.CLOSE_CLIENT_FILTER={id:162,request:Ay.StringSerialiser,response:i_.CountOrParserErrorsSerialiser},I_.SET_CLIENT_CONFLATION_FILTER={id:163,request:xv.SetClientConflationFilterRequestSerialiser,response:i_.CountOrParserErrorsSerialiser},I_.SESSION_FETCH={id:168,request:E_.SessionFetchQuerySerialiser,response:y_.SessionFetchQueryResultSerialiser};var b_={};Object.defineProperty(b_,"__esModule",{value:!0});var R_=function(e,t,r,n,o,i){this.filter=e,this.range=t,this.withProperties=r,this.limit=n,this.maximumResultSize=o,this.requiresStartTime=i};b_.SessionFetchQuery=R_;var C_={};Object.defineProperty(C_,"__esModule",{value:!0}),C_.ClientControlOptions={PropertyKeys:Object.freeze({ALL_FIXED_PROPERTIES:["*F"],ALL_USER_PROPERTIES:["*U"],ALL_PROPERTIES:["*F","*U"],SESSION_ID:"$SessionId",PRINCIPAL:"$Principal",CONNECTOR:"$Connector",TRANSPORT:"$Transport",CLIENT_TYPE:"$ClientType",COUNTRY:"$Country",LANGUAGE:"$Language",SERVER_NAME:"$ServerName",CLIENT_IP:"$ClientIP",LATITUDE:"$Latitude",LONGITUDE:"$Longitude",START_TIME:"$StartTime",ROLES:"$Roles",MQTT_CLIENT_ID:"$MQTTClientId",GATEWAY_TYPE:"$GatewayType",GATEWAY_ID:"$GatewayId"}),ANONYMOUS:"",CloseReason:Ch.CloseReasonEnum};var P_={};Object.defineProperty(P_,"__esModule",{value:!0});var N_=qa.create("Session Fetch Request"),A_=function(){function e(e,t){this.from=e,this.to=t}return e.prototype.isUnbounded=function(){return void 0===this.from&&void 0===this.to},e}();function M_(e,t){if(!Number.isInteger(e)||e<0)throw new Error("Invalid argument '"+t+"': "+e);return e}function L_(e,t){if(e instanceof Gs&&e.gte(0))return e;if("number"==typeof e&&Number.isInteger(e)&&e>=0)return Gs.fromNumber(e);throw new Error("Invalid argument '"+t+"': "+e)}var D_=function(){function e(e,t){var r={range:new A_,filter:"all",withProperties:null,limit:Uu.MAX_INT32,maximumResultSize:e.getOptions().maxMessageSize};this.internal=e,this.options=Object.assign(r,t)}return e.prototype.copyOptions=function(){return{range:new A_(this.options.range.from,this.options.range.to),filter:this.options.filter,withProperties:this.options.withProperties,limit:this.options.limit,maximumResultSize:this.options.maximumResultSize}},e.prototype.from=function(t){var r=L_(t,"time");return new e(this.internal,Object.assign(this.copyOptions(),{range:new A_(r,this.options.range.to)}))},e.prototype.to=function(t){var r=L_(t,"time");return new e(this.internal,Object.assign(this.copyOptions(),{range:new A_(this.options.range.from,r)}))},e.prototype.withProperties=function(t){return new e(this.internal,Object.assign(this.copyOptions(),{withProperties:t}))},e.prototype.first=function(t){return new e(this.internal,Object.assign(this.copyOptions(),{limit:M_(t,"count")}))},e.prototype.last=function(t){return new e(this.internal,Object.assign(this.copyOptions(),{limit:0-M_(t,"count")}))},e.prototype.maximumResultSize=function(t){return new e(this.internal,Object.assign(this.copyOptions(),{maximumResultSize:Math.min(M_(t,"maximumSize"),this.internal.getOptions().maxMessageSize)}))},e.prototype.filter=function(t){return new e(this.internal,Object.assign(this.copyOptions(),{filter:t}))},e.prototype.fetch=function(){var e=this.internal.getServiceLocator().obtain(I_.SESSION_FETCH),t=this.options.withProperties&&new Set(this.options.withProperties),r=!t||t.has(C_.ClientControlOptions.PropertyKeys.START_TIME)||t.has(C_.ClientControlOptions.PropertyKeys.ALL_FIXED_PROPERTIES[0]),n=new b_.SessionFetchQuery(this.options.filter,this.options.range,t,this.options.limit,this.options.maximumResultSize,r);return new Promise((function(t,r){e.send(n,(function(e,n){df.responseSuccess(e,n)?n.errors?(N_.debug("Session fetch query failed"),r(n.errors.errors)):t(new Py.SessionFetchResultImpl(n.results||[],n.totalCount||0)):(N_.debug("Session fetch query failed"),r(e))}))}))},e}();P_.SessionFetchRequestImpl=D_;var j_={};Object.defineProperty(j_,"__esModule",{value:!0});var x_=function(e,t,r){this.filter=e,this.rolesToRemove=t,this.rolesToAdd=r};j_.ChangeAuthorisationRolesFilterRequest=x_;var U_={};Object.defineProperty(U_,"__esModule",{value:!0});var B_=function(e,t,r){this.sessionID=e,this.rolesToRemove=t,this.rolesToAdd=r};U_.ChangeAuthorisationRolesRequest=B_;var k_={};Object.defineProperty(k_,"__esModule",{value:!0});var q_=function(e,t){this.filter=e,this.conflate=t};k_.SetClientConflationFilterRequest=q_;var V_={};Object.defineProperty(V_,"__esModule",{value:!0});var F_=function(e,t){this.sessionID=e,this.conflate=t};V_.SetClientConflationRequest=F_;var G_={};Object.defineProperty(G_,"__esModule",{value:!0});var H_=function(e,t,r){this.filter=e,this.overwriteProperties=t,this.removeProperties=r};G_.SetSessionPropertiesFilterRequest=H_;var W_={};Object.defineProperty(W_,"__esModule",{value:!0}),function(e){e[e.UPDATED=0]="UPDATED",e[e.RECONNECTED=1]="RECONNECTED",e[e.FAILED_OVER=2]="FAILED_OVER",e[e.DISCONNECTED=3]="DISCONNECTED"}(W_.SessionEventType||(W_.SessionEventType={}));var Y_={},z_=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function s(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){e.done?o(e.value):new r((function(t){t(e.value)})).then(s,a)}u((n=n.apply(e,t||[])).next())}))},Q_=this&&this.__generator||function(e,t){var r,n,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},$_=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}},K_=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)s.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return s},J_=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(K_(arguments[t]));return e};Object.defineProperty(Y_,"__esModule",{value:!0});var X_=qa.create("Session.Clients"),Z_=function(){function e(e){this.SessionEventType=W_.SessionEventType,this.internal=e,this.serviceLocator=e.getServiceLocator(),this.SET_CLIENT_CONFLATION=this.serviceLocator.obtain(I_.SET_CLIENT_CONFLATION),this.SET_CLIENT_CONFLATION_FILTER=this.serviceLocator.obtain(I_.SET_CLIENT_CONFLATION_FILTER),this.GET_SESSION_PROPERTIES=this.serviceLocator.obtain(I_.GET_SESSION_PROPERTIES),this.SESSION_PROPERTIES_REGISTRATION=this.serviceLocator.obtain(I_.SESSION_PROPERTIES_REGISTRATION_2),this.CHANGE_AUTHORISATION_ROLES=this.serviceLocator.obtain(I_.CHANGE_AUTHORISATION_ROLES),this.CHANGE_AUTHORISATION_ROLES_FILTER=this.serviceLocator.obtain(I_.CHANGE_AUTHORISATION_ROLES_FILTER),this.SET_SESSION_PROPERTIES_FILTER=this.serviceLocator.obtain(I_.SET_SESSION_PROPERTIES_FILTER),this.internal.getServiceRegistry().add(I_.SESSION_PROPERTIES_EVENT_2,{onRequest:function(e,t,r){e.getConversationSet().respondIfPresent(t.cid,t),r.respond()}})}return e.prototype.close=function(e){var t=this;return new Promise((function(r,n){try{gc.requireNonNull(e,"sessions")}catch(e){return void n(e)}if(t.internal.checkConnected(n)){var o=zf.SessionId.validate(e);o?t.serviceLocator.obtain(I_.CLOSE_CLIENT).send({sessionID:o},(function(e,t){e?n(e):r(1)})):"string"==typeof e?t.serviceLocator.obtain(I_.CLOSE_CLIENT_FILTER).send(e,(function(e,t){df.responseSuccess(e,t)?t.errors.length>0?n(t.errors):r(t.count):n(e)})):n(new Error("Invalid SessionID: "+e))}}))},e.prototype.subscribe=function(e,t){var r=this;return new Promise((function(n,o){try{e=gc.requireNonNull(e,"SessionID or Session Filter"),t=gc.requireNonNull(t,"Topic Selector")}catch(e){return void o(e)}if(r.internal.checkConnected(o)){var i=void 0;try{i=r.internal.getContext().parseSelector(t)}catch(e){return void o(e)}var s=zf.SessionId.validate(e);s?r.serviceLocator.obtain(I_.SUBSCRIBE_CLIENT).send({sessionID:s,selector:i},(function(e){e?o(e):n()})):r.serviceLocator.obtain(I_.FILTER_SUBSCRIBE).send({filter:e,selector:i},(function(e,t){df.responseSuccess(e,t)?t.isSuccess()?n(t.selected):o(t.errors):o(e)}))}}))},e.prototype.unsubscribe=function(e,t){var r=this;return new Promise((function(n,o){try{gc.requireNonNull(e,"SessionID or Session Filter"),gc.requireNonNull(t,"Topic Selector")}catch(e){return void o(e)}if(r.internal.checkConnected(o)){var i=void 0;try{i=r.internal.getContext().parseSelector(t)}catch(e){return void o(e)}var s=zf.SessionId.validate(e);s?r.serviceLocator.obtain(I_.UNSUBSCRIBE_CLIENT).send({sessionID:s,selector:i},(function(e){e?o(e):n()})):r.serviceLocator.obtain(I_.FILTER_UNSUBSCRIBE).send({filter:e,selector:i},(function(e,t){df.responseSuccess(e,t)?t.isSuccess()?n(t.selected):o(t.errors):o(e)}))}}))},e.prototype.getSessionProperties=function(e,t){var r=this;return void 0===t&&(t=[]),new Promise((function(n,o){"string"==typeof e&&(e=zf.SessionId.fromString(e)),r.internal.checkConnected(o)&&r.GET_SESSION_PROPERTIES.send({sessionID:e,propertyKeys:t},(function(e,t){df.responseSuccess(e,t)?null===t?o(new Error("Invalid session ID")):n(t.properties):o(e)}))}))},e.prototype.setSessionProperties=function(e,t){var r=this;return new Promise((function(n,o){try{gc.requireNonNull(e,"sessionId"),gc.requireNonNull(t,"properties")}catch(e){return void o(e)}if("string"==typeof e&&(e=zf.SessionId.fromString(e)),r.internal.checkConnected(o)){var i={},s=[];r.extractOverwriteAndRemoveProperties(i,s,t),r.serviceLocator.obtain(I_.SET_SESSION_PROPERTIES).send({sessionID:e,overwriteProperties:i,removeProperties:s},(function(e,t){df.responseSuccess(e,t)?n(t.properties):o(e)}))}}))},e.prototype.setOverwriteOrRemoveProperty=function(e,t,r,n){null===n?t.push(r):e[r]=n},e.prototype.extractOverwriteAndRemoveProperties=function(e,t,r){var n,o,i=this;if(r.forEach instanceof Function)r.forEach((function(r,n){i.setOverwriteOrRemoveProperty(e,t,r,n)}));else try{for(var s=$_(Object.getOwnPropertyNames(r)),a=s.next();!a.done;a=s.next()){var u=a.value;this.setOverwriteOrRemoveProperty(e,t,u,r[u])}}catch(e){n={error:e}}finally{try{a&&!a.done&&(o=s.return)&&o.call(s)}finally{if(n)throw n.error}}},e.prototype.setSessionPropertiesByFilter=function(e,t){var r=this;return new Promise((function(n,o){try{gc.requireNonNull(e,"filter"),gc.requireNonNull(t,"properties")}catch(e){return void o(e)}if(r.internal.checkConnected(o)){var i={},s=[],a=new G_.SetSessionPropertiesFilterRequest(e,i,s);r.extractOverwriteAndRemoveProperties(i,s,t),r.SET_SESSION_PROPERTIES_FILTER.send(a,(function(e,t){df.responseSuccess(e,t)?t.errors.length>0?o(t.errors):n(t.count):o(e)}))}}))},e.prototype.setSessionPropertiesListener=function(e,t){var r=this;return new Promise((function(n,o){return z_(r,void 0,void 0,(function(){var r,i,s,a=this;return Q_(this,(function(u){switch(u.label){case 0:return t||o(new Error("Session Properties listener is null or undefined")),this.internal.checkConnected(o)?(X_.debug("Adding Session Properties Listener"),r={active:function(e){X_.debug("Session Properties Listener active"),t.onActive(e)},respond:function(e){var r,n;try{for(var o=$_(e.events),i=o.next();!i.done;i=o.next()){var s=i.value;switch(s.type){case bv.SessionPropertiesEventType.OPEN:t.onSessionOpen(s.sessionId,s.oldProperties);break;case bv.SessionPropertiesEventType.UPDATE:t.onSessionEvent(s.sessionId,s.updateType,s.newProperties,s.oldProperties);break;case bv.SessionPropertiesEventType.CLOSE:t.onSessionClose(s.sessionId,s.oldProperties,s.closeReason);break;default:X_.debug("Unknown event type received for session properties listener",s.type)}}}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return!1},close:function(e){X_.debug("Session Properties Listener closed"),e?t.onError(e):t.onClose()}},[4,(i=this.internal.getConversationSet()).newConversation(_y.responseHandler(this.internal,r,(function(e,t){a.SESSION_PROPERTIES_REGISTRATION.send({cid:e},t)})))]):[3,2];case 1:s=u.sent(),this.SESSION_PROPERTIES_REGISTRATION.send({cid:s,properties:e},_y.registrationCallback(i,s,n,o)),u.label=2;case 2:return[2]}}))}))}))},e.prototype.changeRoles=function(e,t,r){var n=this,o=Array.isArray(t)?t:J_(t),i=Array.isArray(r)?r:J_(r);if(0===o.length&&0===i.length)throw new Error("rolesToRemove and rolesToAdd cannot both be empty");var s=zf.SessionId.validate(e);return new Promise((function(t,r){try{gc.requireNonNull(e,"sessions")}catch(e){return void r(e)}if(n.internal.checkConnected(r))if(!1===s){var a=new j_.ChangeAuthorisationRolesFilterRequest(e,o,i);n.CHANGE_AUTHORISATION_ROLES_FILTER.send(a,(function(e,n){e?r(e):n.errors.length>0?r(n.errors):t(n.count)}))}else{a=new U_.ChangeAuthorisationRolesRequest(s,o,i);n.CHANGE_AUTHORISATION_ROLES.send(a,(function(e){e?r(e):t(1)}))}}))},e.prototype.setConflated=function(e,t){var r=this;return new Promise((function(n,o){try{gc.requireNonNull(e,"sessions")}catch(e){return void o(e)}if(r.internal.checkConnected(o)){var i=zf.SessionId.validate(e);if(i){var s=new V_.SetClientConflationRequest(i,t);r.SET_CLIENT_CONFLATION.send(s,(function(e){e?o(e):n(1)}))}else if("string"==typeof e){s=new k_.SetClientConflationFilterRequest(e,t);r.SET_CLIENT_CONFLATION_FILTER.send(s,(function(e,t){df.responseSuccess(e,t)?t.errors.length>0?o(t.errors):n(t.count):o(e)}))}else o(new Error("Invalid SessionID: "+e))}}))},e.prototype.fetchRequest=function(){return new P_.SessionFetchRequestImpl(this.internal)},e}();Y_.ClientControlImpl=Z_;var eS={};Object.defineProperty(eS,"__esModule",{value:!0});var tS=function(e){this.sessionId=e};eS.BaseGatewayClientRequest=tS;var rS={};Object.defineProperty(rS,"__esModule",{value:!0}),function(e){e[e.GET_CONFIGURATION=1]="GET_CONFIGURATION",e[e.GET_STATUS=2]="GET_STATUS"}(rS.GatewayRequestType||(rS.GatewayRequestType={}));var nS={},oS=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(nS,"__esModule",{value:!0});var iS=function(e){function t(t){var r=e.call(this,t)||this;return r.type=rS.GatewayRequestType.GET_CONFIGURATION,r}return oS(t,e),t}(eS.BaseGatewayClientRequest);nS.GatewayClientGetConfigurationRequest=iS;var sS={},aS=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(sS,"__esModule",{value:!0});var uS=function(e){function t(t){var r=e.call(this,t)||this;return r.type=rS.GatewayRequestType.GET_STATUS,r}return aS(t,e),t}(eS.BaseGatewayClientRequest);sS.GatewayClientGetStatusRequest=uS;var cS={},pS=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(cS,"__esModule",{value:!0});var lS=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return pS(t,e),t.prototype.read=function(e){return{type:ba.readString(e),id:ba.readString(e)}},t.prototype.write=function(e,t){ba.writeString(e,t.type),ba.writeString(e,t.id)},t}(Pa.AbstractSerialiser);cS.GatewayClientKeySerialiser=new lS;var fS={},hS=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(fS,"__esModule",{value:!0});var dS=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return hS(t,e),t.prototype.read=function(e){return{clients:ba.readCollection(e,cS.GatewayClientKeySerialiser.read)}},t}(Pa.AbstractSerialiser);fS.GatewayClientListSerialiser=new dS;var yS={},vS=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(yS,"__esModule",{value:!0});var _S=function(e){function t(t){return e.call(this,"Cannot serialise unknown gateway request type: "+t)||this}return vS(t,e),t}(Error),SS=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return vS(t,e),t.prototype.write=function(e,t){var r=t.type;switch(r in rS.GatewayRequestType&&(Jy.SessionIdSerialiser.write(e,t.sessionId),tf.write(e,r)),r){case rS.GatewayRequestType.GET_CONFIGURATION:case rS.GatewayRequestType.GET_STATUS:break;default:throw new _S(r)}},t}(Pa.AbstractSerialiser);yS.GatewayClientRequestSerialiser=new SS;var ES={};Object.defineProperty(ES,"__esModule",{value:!0});var mS=function(e,t,r){this.type=rS.GatewayRequestType.GET_CONFIGURATION,this.config=r,this.schemaType=e,this.schema=t};ES.GetConfigurationResponse=mS;var wS={};Object.defineProperty(wS,"__esModule",{value:!0});var gS=function(e){this.type=rS.GatewayRequestType.GET_STATUS,this.items=e};wS.GetStatusResponse=gS;var TS={};Object.defineProperty(TS,"__esModule",{value:!0});var OS=function(e,t){this.firstEntry=e,this.entryCount=t};TS.EntriesFetchRequest=OS;var IS={},bS=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(IS,"__esModule",{value:!0});var RS=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return bS(t,e),t.prototype.read=function(e){var t=ba.readInt64(e),r=ba.readInt64(e);return new TS.EntriesFetchRequest(t,r)},t.prototype.write=function(e,t){ba.writeInt64(e,t.firstEntry),ba.writeInt64(e,t.entryCount)},t}(Pa.AbstractSerialiser);IS.EntriesFetchRequestSerialiser=new RS;var CS={};Object.defineProperty(CS,"__esModule",{value:!0});var PS=function(e,t,r,n,o,i){this.firstEntry=e,this.entryCount=t,this.fileId=r,this.maxEntriesAvailable=n,this.firstLineNumber=o,this.entries=i};CS.EntriesFetchResponse=PS;var NS={},AS=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(NS,"__esModule",{value:!0});var MS=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return AS(t,e),t.prototype.read=function(e){var t=ba.readInt64(e),r=ba.readInt64(e),n=ba.readInt64(e),o=ba.readInt64(e),i=ba.readBytes(e),s=ba.readInt64(e);return new CS.EntriesFetchResponse(t,r,s,n,o,i)},t.prototype.write=function(e,t){ba.writeInt64(e,t.firstEntry),ba.writeInt64(e,t.entryCount),ba.writeInt64(e,t.maxEntriesAvailable),ba.writeInt64(e,t.firstLineNumber),ba.writeBytes(e,t.entries),ba.writeInt64(e,t.fileId)},t}(Pa.AbstractSerialiser);NS.EntriesFetchResponseSerialiser=new MS;var LS={};Object.defineProperty(LS,"__esModule",{value:!0}),LS.FETCH_LOG_ENTRIES_SERVICE={id:132,request:IS.EntriesFetchRequestSerialiser,response:NS.EntriesFetchResponseSerialiser};var DS={};Object.defineProperty(DS,"__esModule",{value:!0});var jS=function(){function e(e){this.internal=e,this.FETCH_LOG_ENTRIES_SERVICE=e.getServiceLocator().obtain(LS.FETCH_LOG_ENTRIES_SERVICE)}return e.prototype.fetchEntries=function(e,t){var r=this;return new Promise((function(n,o){r.internal.checkConnected(o)&&r.FETCH_LOG_ENTRIES_SERVICE.send(new TS.EntriesFetchRequest(e,t),(function(e,t){e?o(e):n(t)}))}))},e}();DS.LogRetrieval=jS;var xS={};Object.defineProperty(xS,"__esModule",{value:!0}),xS.create=function(e){return{onRequest:function(t,r,n){try{e(t,r,n)}catch(e){n.fail(t.getContext().ErrorReason.CALLBACK_EXCEPTION,e.message)}}}};var US={};Object.defineProperty(US,"__esModule",{value:!0});var BS=function(e,t,r,n,o,i){this.cid=e,this.sessionID=t,this.path=r,this.properties=n,this.dataType=o,this.content=i};US.MessagingClientForwardSendRequest=BS;var kS={},qS=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(kS,"__esModule",{value:!0});var VS=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return qS(t,e),t.prototype.read=function(e){var t=Ra.CIDSerialiser.read(e),r=Jy.SessionIdSerialiser.read(e),n=ba.readString(e),o=ba.readDictionary(e,ba.readString),i=ba.readString(e),s=ba.readBytes(e);return new US.MessagingClientForwardSendRequest(t,r,n,o,i,s)},t}(Pa.AbstractSerialiser);kS.MessagingClientForwardSendRequestSerialiser=new VS;var FS={},GS=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(FS,"__esModule",{value:!0});var HS=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return GS(t,e),t.prototype.write=function(e,t){Jy.SessionIdSerialiser.write(e,t.sessionId),ba.writeString(e,t.path),ba.writeString(e,t.dataType),ba.writeBytes(e,t.request)},t}(Pa.AbstractSerialiser);FS.MessagingClientSendRequestSerialiser=new HS;var WS={};Object.defineProperty(WS,"__esModule",{value:!0});var YS=function(e,t,r,n){this.cid=e,this.sessionID=t,this.response=r,this.errorReason=n};WS.MessagingFilterResponse=YS;var zS={};Object.defineProperty(zS,"__esModule",{value:!0});var QS=function(e,t){this.responseDataType=e,this.data=t};zS.MessagingResponse=QS;var $S={},KS=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty($S,"__esModule",{value:!0});var JS=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return KS(t,e),t.prototype.read=function(e){var t=ba.readString(e),r=ba.readBytes(e);return new zS.MessagingResponse(t,r)},t.prototype.write=function(e,t){ba.writeString(e,t.responseDataType),ba.writeBytes(e,t.data)},t}(Pa.AbstractSerialiser);$S.MessagingResponseSerialiser=new JS;var XS={},ZS=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(XS,"__esModule",{value:!0});var eE=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ZS(t,e),t.prototype.read=function(e){var t=ba.readInt32(e),r=ba.readString(e);return new Vs.ErrorReason(t,r)},t.prototype.write=function(e,t){ba.writeInt32(e,t.id),ba.writeString(e,t.reason)},t}(Pa.AbstractSerialiser);XS.ErrorReasonSerialiser=new eE;var tE={},rE=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(tE,"__esModule",{value:!0});var nE=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return rE(t,e),t.prototype.read=function(e){var t=Ra.CIDSerialiser.read(e),r=Jy.SessionIdSerialiser.read(e);switch(ba.readByte(e)){case 0:var n=$S.MessagingResponseSerialiser.read(e);return new WS.MessagingFilterResponse(t,r,n);default:var o=XS.ErrorReasonSerialiser.read(e);return new WS.MessagingFilterResponse(t,r,null,o)}},t}(Pa.AbstractSerialiser);tE.MessagingFilterResponseSerialiser=new nE;var oE={},iE=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(oE,"__esModule",{value:!0});var sE=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return iE(t,e),t.prototype.write=function(e,t){Ra.CIDSerialiser.write(e,t.cid),ba.writeString(e,t.filter),ba.writeString(e,t.path),ba.writeString(e,t.dataType.name()),ba.writeBytes(e,t.request)},t}(Pa.AbstractSerialiser);oE.MessagingFilterSendRequestSerialiser=new sE;var aE={};Object.defineProperty(aE,"__esModule",{value:!0});var uE=function(e,t){this.numberSent=e,this.errors=t,this.isSuccess=0===t.length};aE.MessagingFilterSendResponse=uE;var cE={},pE=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(cE,"__esModule",{value:!0});var lE=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return pE(t,e),t.prototype.read=function(e){if(0===ba.readByte(e)){var t=ba.readInt32(e);return new aE.MessagingFilterSendResponse(t,[])}var r=ba.readCollection(e,Gy.ErrorReportSerialiser.read);return new aE.MessagingFilterSendResponse(0,r)},t}(Pa.AbstractSerialiser);cE.MessagingFilterSendResponseSerialiser=new lE;var fE={};Object.defineProperty(fE,"__esModule",{value:!0});var hE=function(e,t,r){this.path=e,this.dataType=t,this.request=r};fE.MessagingSendRequest=hE;var dE={},yE=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(dE,"__esModule",{value:!0});var vE=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return yE(t,e),t.prototype.read=function(e){var t=ba.readString(e),r=ba.readString(e),n=ba.readBytes(e);return new fE.MessagingSendRequest(t,r,n)},t.prototype.write=function(e,t){ba.writeString(e,t.path),ba.writeString(e,t.dataType),ba.writeBytes(e,t.request)},t}(Pa.AbstractSerialiser);dE.MessagingSendRequestSerialiser=new vE;var _E={};Object.defineProperty(_E,"__esModule",{value:!0}),_E.MESSAGING_SEND={id:85,request:dE.MessagingSendRequestSerialiser,response:$S.MessagingResponseSerialiser},_E.MESSAGING_RECEIVER_SERVER={id:86,request:FS.MessagingClientSendRequestSerialiser,response:$S.MessagingResponseSerialiser},_E.MESSAGING_RECEIVER_CLIENT={id:88,request:kS.MessagingClientForwardSendRequestSerialiser,response:$S.MessagingResponseSerialiser},_E.MESSAGING_FILTER_SEND={id:102,request:oE.MessagingFilterSendRequestSerialiser,response:cE.MessagingFilterSendResponseSerialiser},_E.FILTER_RESPONSE={id:103,request:tE.MessagingFilterResponseSerialiser,response:od.NullSerialiser};var SE={},EE=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function s(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){e.done?o(e.value):new r((function(t){t(e.value)})).then(s,a)}u((n=n.apply(e,t||[])).next())}))},mE=this&&this.__generator||function(e,t){var r,n,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(SE,"__esModule",{value:!0});var wE=qa.create("Session.Messages"),gE=function(e,t,r){this.reqType=e,this.resType=t,this.stream=r},TE=function(){function e(e,t,r){this.callback=e,this.context=t,this.responseType=r}return e.prototype.respond=function(e){var t=this.context.DataTypes;if(0===arguments.length)throw new Error("No argument provided to the responder");if(null==e&&!this.responseType)throw new Error("No response type has been provided and the value provided is null. Unable to determine the response type.");var r=this.responseType?t.getChecked(this.responseType):t.getByValue(e);if(void 0===r)throw new Error("Unable to determine the response type.");var n=r.writeValue(e);this.callback.respond({responseDataType:r.name(),data:n})},e.prototype.reject=function(e){this.callback.fail(Xa.ErrorReason.REJECTED_REQUEST,e)},e}();var OE=function(){function e(e){var t=this;this.requestStreams={},this.internal=e;var r=this.internal.getContext().DataTypes,n=e.getServiceLocator();this.MESSAGING_SEND=n.obtain(_E.MESSAGING_SEND),this.MESSAGING_FILTER_SEND=n.obtain(_E.MESSAGING_FILTER_SEND),this.MESSAGING_RECEIVER_SERVER=n.obtain(_E.MESSAGING_RECEIVER_SERVER),this.deregisterRequestHandler=n.obtain(jd.MESSAGING_RECEIVER_CONTROL_DEREGISTRATION);var o=e.getServiceRegistry();o.add(_E.MESSAGING_SEND,xS.create((function(n,o,i){var s=t.requestStreams[o.path];if(void 0!==s){var a,u,c=new TE(i,e.getContext(),s.resType),p=r.get(o.dataType),l=s.reqType?s.reqType:p.valueClass;if(p.canReadAs(l)){var f=void 0;try{f=p.readAs(l,o.request)}catch(e){return wE.error("Failed to convert "+p.name()+" datatype to "+l),s.stream.onError(Xa.ErrorReason.INVALID_DATA),void delete t.requestStreams[o.path]}try{s.stream.onRequest(o.path,f,c)}catch(e){wE.error("Messaging request stream threw an error",e),i.fail(Xa.ErrorReason.CALLBACK_EXCEPTION,e.stack)}}else{var h="Messaging request for path "+o.path+" with "+p.name()+"datatype is incompatible for stream ("+l+")";wE.debug(h),i.fail(Xa.ErrorReason.INCOMPATIBLE_DATATYPE,h)}}else i.fail(Xa.ErrorReason.UNHANDLED_MESSAGE,(a=n.getSessionId(),u=o.path,"Session "+a+" has no registered streams for message sent to path '"+u+"'"))}))),o.add(_E.FILTER_RESPONSE,xS.create((function(e,t,r){r.respond(),e.getConversationSet().respondIfPresent(t.cid,t)}))),o.add(_E.MESSAGING_RECEIVER_CLIENT,xS.create((function(e,t,r){e.getConversationSet().respondIfPresent(t.cid,{request:t,callback:r.respond,fail:r.fail})})))}return e.prototype.addRequestHandler=function(e,t,r,n){var o=this,i=this.internal.getContext().DataTypes;return new Promise((function(s,a){if(o.internal.checkConnected(a)){try{gc.requireNonNull(e,"Message path"),gc.requireNonNull(t,"Request handler")}catch(e){return void a(e)}wE.debug("Adding request handler",e);var u={definition:_E.MESSAGING_RECEIVER_CLIENT,group:fd.DEFAULT,path:e,keys:void 0!==r?r:[]},c={active:function(r,n){wE.debug("Request handler active",e),s({close:function(){return new Promise((function(e){o.deregisterRequestHandler.send(u,(function(r,i){r?(o.internal.getConversationSet().discard(n,r),wE.debug("Error with request handler deregistration: ",r)):(t.onClose(),o.internal.getConversationSet().respondIfPresent(n,i)),e()}))}))}})},respond:function(r){wE.debug("Request handler pair.request",e);var o={sessionId:r.request.sessionID,path:r.request.path,properties:r.request.properties};try{var s=(n||i.getChecked(r.request.dataType)).readValue(r.request.content),a={respond:function(e,t){var n=i.getChecked(void 0!==t?t:e);r.callback({responseDataType:n.name(),data:n.writeValue(e)})},reject:function(e){r.fail(Xa.ErrorReason.REJECTED_REQUEST,e,!1)}};return t.onRequest(s,o,a),!1}catch(e){return wE.info("An exception has occurred whilst processing the request:",e),t.onError(e),r.fail(Xa.ErrorReason.CALLBACK_EXCEPTION,e&&e.message),!1}},close:function(){wE.debug("Request handler closed",e),t.onClose()}};_y.registerRequestHandler(o.internal,u,c).then(void 0,(function(e){a(e)}))}}))},e.prototype.sendRequestToController=function(e,t,r,n,o,i){var s,a=this.internal.getContext().DataTypes;try{gc.requireNonNull(r,"Message path"),gc.requireNonNull(n,"Request")}catch(e){return void t(e)}try{s=o?a.getChecked(o):a.getByValue(n)}catch(e){return void t(e)}if(void 0===s)throw new Error("Could not determine request type");wE.debug("Sending request to server",n),this.MESSAGING_SEND.send({path:r,dataType:s.name(),request:s.writeValue(n)},(function(n,o){var s;if(df.responseSuccess(n,o)){wE.debug("Request complete",r);try{s=a.getChecked(i||o.responseDataType)}catch(e){return void t(e)}e(s.readValue(o.data))}else wE.debug("Request failed",r),t(n)}))},e.prototype.sendRequestToSession=function(e,t,r,n,o,i,s){var a,u=this.internal.getContext().DataTypes;try{gc.requireNonNull(o,"Session ID"),gc.requireNonNull(r,"Message path"),gc.requireNonNull(n,"Request")}catch(e){return void t(e)}try{a=i?u.getChecked(i):u.getByValue(n)}catch(e){return void t(e)}if(void 0===a)throw new Error("Could not determine request type");wE.debug("Sending request to session",o,n),this.MESSAGING_RECEIVER_SERVER.send({sessionId:o,path:r,dataType:a.name(),request:a.writeValue(n)},(function(n,o){var i;if(df.responseSuccess(n,o)){wE.debug("Request complete",r);try{i=u.getChecked(s||o.responseDataType)}catch(e){return void t(e)}e(i.readValue(o.data))}else wE.debug("Request failed",r),t(n)}))},e.prototype.sendRequest=function(e,t,r,n,o){var i=this;return new Promise((function(s,a){if(i.internal.checkConnected(a))if(r instanceof zf.SessionId)i.sendRequestToSession(s,a,e,t,r,n,o);else if("string"==typeof r){var u=function(e){try{return zf.SessionId.fromString(e)}catch(e){return!1}}(r);u?i.sendRequestToSession(s,a,e,t,u,n,o):i.sendRequestToController(s,a,e,t,r,n)}else i.sendRequestToController(s,a,e,t,r,n)}))},e.prototype.sendRequestToFilter=function(e,t,r,n,o,i){var s=this,a=this.internal.getContext().DataTypes;return new Promise((function(u,c){return EE(s,void 0,void 0,(function(){var s,p,l,f,h,d=this;return mE(this,(function(y){switch(y.label){case 0:if(!this.internal.checkConnected(c))return[3,2];try{gc.requireNonNull(t,"Message path"),gc.requireNonNull(e,"Session filter"),gc.requireNonNull(r,"Request"),gc.requireNonNull(n,"Response callback")}catch(e){return c(e),[2]}s=void 0;try{s=o?a.getChecked(o):a.getByValue(r)}catch(e){return c(e),[2]}if(void 0===s)throw new Error("Could not determine request type");return p=0,l=-1,f=function(){return p>=l&&-1!==l||0===l},[4,this.internal.getConversationSet().newConversation({onOpen:function(){},onResponse:function(e,t){if(null===t)return!0;if("number"==typeof t)return l=t,f();var r=t.sessionID;if(p++,t.errorReason)n.onResponseError(r,t.errorReason);else{var o=a.getByName(t.response.responseDataType),s=void 0;try{s=a.getChecked(i||t.response.responseDataType)}catch(e){return c(e),f()}if(o.canReadAs(s.valueClass)){var u=void 0;try{u=o.readAs(s.valueClass,t.response.data)}catch(e){return n.onResponseError(r,e),f()}try{n.onResponse(r,u)}catch(e){wE.error("Exception within messaging filter callback",e)}}else n.onResponseError(r,new Error("The received response was a "+o+",'\n                                        + ' which cannot be read as: "+s))}return f()},onDiscard:function(){}})];case 1:h=y.sent(),wE.debug("Sending filter request to server",r),this.MESSAGING_FILTER_SEND.send({cid:h,path:t,filter:e,dataType:s,request:s.writeValue(r)},(function(e,r){df.responseSuccess(e,r)?r.isSuccess?(wE.debug("Request complete",t),d.internal.getConversationSet().respondIfPresent(h,r.numberSent),u(r.numberSent)):(wE.debug("Request failed",t),d.internal.getConversationSet().respondIfPresent(h,null),c(r.errors)):(wE.debug("Request failed",t),d.internal.getConversationSet().respondIfPresent(h,null),c(e))})),y.label=2;case 2:return[2]}}))}))}))},e.prototype.setRequestStream=function(e,t,r,n){var o=this.internal.getContext().DataTypes,i=new gE(r?o.getValueClassChecked(r):void 0,n?o.getValueClassChecked(n):void 0,t),s=this.requestStreams[e];if(this.requestStreams[e]=i,s)return s.stream},e.prototype.removeRequestStream=function(e){var t=this.requestStreams[e];if(delete this.requestStreams[e],t)return t.stream},e}();SE.MessagesImpl=OE;var IE={};Object.defineProperty(IE,"__esModule",{value:!0});var bE=function(e,t){this.names=e,this.isClustered=t};IE.JMXFetchRequest=bE;var RE={},CE=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(RE,"__esModule",{value:!0});var PE=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return CE(t,e),t.prototype.read=function(e){var t=ba.readCollection(e,ba.readString),r=ba.readBoolean(e);return new IE.JMXFetchRequest(t,r)},t.prototype.write=function(e,t){ba.writeCollection(e,t.names,ba.writeString),ba.writeBoolean(e,t.isClustered)},t}(Pa.AbstractSerialiser);RE.JMXFetchRequestSerialiser=new PE;var NE={},AE=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(NE,"__esModule",{value:!0});var ME=new xu.Encoder,LE=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return AE(t,e),t.prototype.read=function(e){var t=ba.readBytes(e);return new ju.Decoder(t).nextValueExpecting((function(e){return e===Ou.types.MAP}))},t.prototype.write=function(e,t){ME.encode(t),ba.writeBytes(e,ME.flush())},t}(Pa.AbstractSerialiser);NE.MBeanValuesSerialiser=new LE;var DE={},jE=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(DE,"__esModule",{value:!0});var xE=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return jE(t,e),t.prototype.read=function(e){return ba.readDictionary(e,this.readWrapper)},t.prototype.write=function(e,t){ba.writeDictionary(e,t,this.writeWrapper)},t.prototype.readWrapper=function(e){switch(ba.readByte(e)){case 0:return NE.MBeanValuesSerialiser.read(e);default:case 1:return XS.ErrorReasonSerialiser.read(e)}},t.prototype.writeWrapper=function(e,t){this.isErrorReason(t)?(ba.writeByte(e,1),XS.ErrorReasonSerialiser.write(e,t)):(ba.writeByte(e,0),NE.MBeanValuesSerialiser.write(e,t))},t.prototype.isErrorReason=function(e){return"reason"in e},t}(Pa.AbstractSerialiser);DE.JMXFetchResponseSerialiser=new xE;var UE={};Object.defineProperty(UE,"__esModule",{value:!0});var BE=function(e){this.collectors=e};UE.SessionMetricCollectorList=BE;var kE={};Object.defineProperty(kE,"__esModule",{value:!0});var qE=function(e,t){this.name=e,this.exportToPrometheus=t,this.name=e,this.exportToPrometheus=t};kE.AbstractMetricCollector=qE;var VE={},FE=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(VE,"__esModule",{value:!0});var GE=function(e){function t(t,r,n,o,i){var s=e.call(this,t,r)||this;return s.removeMetricsWithNoMatches=n,s.sessionFilter=o,s.groupByProperties=i,s}return FE(t,e),t}(kE.AbstractMetricCollector);VE.SessionMetricCollector=GE;var HE={},WE=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(HE,"__esModule",{value:!0});var YE=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return WE(t,e),t.prototype.read=function(e){var t=ba.readString(e),r=ba.readBoolean(e),n=ba.readBoolean(e),o=ba.readString(e),i=ba.readCollection(e,ba.readString);return new VE.SessionMetricCollector(t,r,n,o,i)},t.prototype.write=function(e,t){ba.writeString(e,t.name),ba.writeBoolean(e,t.exportToPrometheus),ba.writeBoolean(e,t.removeMetricsWithNoMatches),ba.writeString(e,t.sessionFilter),ba.writeCollection(e,t.groupByProperties,ba.writeString)},t}(Pa.AbstractSerialiser);HE.SessionMetricCollectorSerialiser=new YE;var zE={},QE=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(zE,"__esModule",{value:!0});var $E=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return QE(t,e),t.prototype.read=function(e){var t=ba.readCollection(e,HE.SessionMetricCollectorSerialiser.read);return new UE.SessionMetricCollectorList(t)},t.prototype.write=function(e,t){ba.writeCollection(e,t.collectors,HE.SessionMetricCollectorSerialiser.write)},t}(Pa.AbstractSerialiser);zE.SessionMetricCollectorListSerialiser=new $E;var KE={};Object.defineProperty(KE,"__esModule",{value:!0});var JE=function(e){this.collectors=e};KE.TopicMetricCollectorList=JE;var XE={},ZE=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(XE,"__esModule",{value:!0});var em=function(e){function t(t,r,n,o){var i=e.call(this,t,r)||this;return i.topicSelector=n,i.groupByTopicType=o,i}return ZE(t,e),t}(kE.AbstractMetricCollector);XE.TopicMetricCollector=em;var tm={},rm=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(tm,"__esModule",{value:!0});var nm=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return rm(t,e),t.prototype.read=function(e){var t=ba.readString(e),r=ba.readBoolean(e),n=ba.readString(e),o=ba.readBoolean(e);return new XE.TopicMetricCollector(t,r,n,o)},t.prototype.write=function(e,t){ba.writeString(e,t.name),ba.writeBoolean(e,t.exportToPrometheus),ba.writeString(e,t.topicSelector),ba.writeBoolean(e,t.groupByTopicType)},t}(Pa.AbstractSerialiser);tm.TopicMetricCollectorSerialiser=new nm;var om={},im=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(om,"__esModule",{value:!0});var sm=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return im(t,e),t.prototype.read=function(e){var t=ba.readCollection(e,tm.TopicMetricCollectorSerialiser.read);return new KE.TopicMetricCollectorList(t)},t.prototype.write=function(e,t){ba.writeCollection(e,t.collectors,tm.TopicMetricCollectorSerialiser.write)},t}(Pa.AbstractSerialiser);om.TopicMetricCollectorListSerialiser=new sm;var am={};Object.defineProperty(am,"__esModule",{value:!0});var um=function(e,t){this.metricNames=e,this.values=t};am.MeasuredEntityClassMetrics=um;var cm={},pm=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();function lm(e,t){return ba.readMap(e,(function(e){return ba.readCollection(e,ba.readString)}),t)}function fm(e,t,r){ba.writeMap(e,t,(function(e,t){return ba.writeCollection(e,t,ba.writeString)}),r)}Object.defineProperty(cm,"__esModule",{value:!0});var hm=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return pm(t,e),t.prototype.read=function(e){var t=ba.readCollection(e,ba.readString),r=lm(e,(function(e){return lm(e,(function(e){return ba.readCollection(e,ba.readInt64)}))}));return new am.MeasuredEntityClassMetrics(t,r)},t.prototype.write=function(e,t){ba.writeCollection(e,t.metricNames,ba.writeString),fm(e,t.values,(function(e,t){return fm(e,t,(function(e,t){return ba.writeCollection(e,t,ba.writeInt64)}))}))},t}(Pa.AbstractSerialiser);cm.MeasuredEntityClassMetricsSerialiser=new hm;var dm={};Object.defineProperty(dm,"__esModule",{value:!0});var ym=function(e,t){this.entityClass=e,this.serverName=t};dm.MeasuredEntityClassRequest=ym;var vm={},_m=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(vm,"__esModule",{value:!0});var Sm=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return _m(t,e),t.prototype.read=function(e){var t=ba.readString(e),r=1===ba.readByte(e)?ba.readString(e):void 0;return new dm.MeasuredEntityClassRequest(t,r)},t.prototype.write=function(e,t){ba.writeString(e,t.entityClass),void 0!==t.serverName?(ba.writeByte(e,1),ba.writeString(e,t.serverName)):ba.writeByte(e,0)},t}(Pa.AbstractSerialiser);vm.MeasuredEntityClassRequestSerialiser=new Sm;var Em={},mm=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(Em,"__esModule",{value:!0});var wm=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return mm(t,e),t.prototype.read=function(e){return ba.readDictionary(e,(function(e){return ba.readDictionary(e,ba.readInt64)}))},t.prototype.write=function(e,t){ba.writeDictionary(e,t,(function(e,t){return ba.writeDictionary(e,t,ba.writeInt64)}))},t}(Pa.AbstractSerialiser);Em.ServerMetricsSerialiser=new wm;var gm={};Object.defineProperty(gm,"__esModule",{value:!0}),gm.PUT_SESSION_METRIC_COLLECTOR={id:135,request:HE.SessionMetricCollectorSerialiser,response:p_.ErrorReportListSerialiser},gm.REMOVE_SESSION_METRIC_COLLECTOR={id:136,request:Ay.StringSerialiser,response:od.NullSerialiser},gm.FETCH_SESSION_METRIC_COLLECTORS={id:137,request:od.NullSerialiser,response:zE.SessionMetricCollectorListSerialiser},gm.GET_SERVER_METRICS={id:142,request:od.NullSerialiser,response:Em.ServerMetricsSerialiser},gm.GET_MEASURED_ENTITY_CLASS_METRICS={id:145,request:vm.MeasuredEntityClassRequestSerialiser,response:cm.MeasuredEntityClassMetricsSerialiser},gm.PUT_TOPIC_METRIC_COLLECTOR={id:146,request:tm.TopicMetricCollectorSerialiser,response:od.NullSerialiser},gm.REMOVE_TOPIC_METRIC_COLLECTOR={id:147,request:Ay.StringSerialiser,response:od.NullSerialiser},gm.FETCH_TOPIC_METRIC_COLLECTORS={id:148,request:od.NullSerialiser,response:om.TopicMetricCollectorListSerialiser},gm.FETCH_JMX_VALUES={id:149,request:RE.JMXFetchRequestSerialiser,response:DE.JMXFetchResponseSerialiser};var Tm={},Om=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)s.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return s};Object.defineProperty(Tm,"__esModule",{value:!0});var Im=function(){function e(e){this.internal=e}return e.prototype.callService=function(e,t){var r=this;return new Promise((function(n,o){r.internal.checkConnected(o)&&r.internal.getServiceLocator().obtain(e).send(t,(function(e,t){e?o(e):n(null===t?void 0:t)}))}))},e.prototype.putSessionMetricCollector=function(e){return this.callService(gm.PUT_SESSION_METRIC_COLLECTOR,e)},e.prototype.removeSessionMetricCollector=function(e){return this.callService(gm.REMOVE_SESSION_METRIC_COLLECTOR,e)},e.prototype.fetchSessionMetricCollectors=function(){return this.callService(gm.FETCH_SESSION_METRIC_COLLECTORS,null)},e.prototype.putTopicMetricCollector=function(e){return this.callService(gm.PUT_TOPIC_METRIC_COLLECTOR,e)},e.prototype.removeTopicMetricCollector=function(e){return this.callService(gm.REMOVE_TOPIC_METRIC_COLLECTOR,e)},e.prototype.fetchTopicMetricCollectors=function(){return this.callService(gm.FETCH_TOPIC_METRIC_COLLECTORS,null)},e.prototype.getServerMetrics=function(){return this.callService(gm.GET_SERVER_METRICS,null)},e.prototype.getMeasuredEntityClassMetrics=function(e,t){return this.callService(gm.GET_MEASURED_ENTITY_CLASS_METRICS,new dm.MeasuredEntityClassRequest(e,t))},e.prototype.fetchJMXValues=function(e){return this.callService(gm.FETCH_JMX_VALUES,new IE.JMXFetchRequest(e,!1)).then((function(e){var t=Om(Object.keys(e)),r=t[0],n=t.slice(1),o=e[r];if(!n.length&&!("reason"in o))return o;throw Xa.ErrorReason.INVALID_DATA}))},e.prototype.fetchClusterJMXValues=function(e){return this.callService(gm.FETCH_JMX_VALUES,new IE.JMXFetchRequest(e,!0))},e}();Tm.Metrics=Im;var bm={};Object.defineProperty(bm,"__esModule",{value:!0});var Rm=function(){function e(e,t){void 0===t&&(t=Date.now),this.currentTime=Date.now,this.internal=e,this.currentTime=t,this.ping=e.getServiceLocator().obtain(id.USER_PING)}return e.prototype.pingServer=function(){var e=this;return new Promise((function(t,r){if(e.internal.checkConnected(r)){var n=e.currentTime();e.ping.send(null,(function(o){if(o)r(o);else{var i=e.currentTime()-n;t({timestamp:n,rtt:i})}}))}}))},e}();bm.PingImpl=Rm;var Cm={};Object.defineProperty(Cm,"__esModule",{value:!0});var Pm=function(e){this.status=e};Cm.CheckRemoteServerResult=Pm;var Nm={};Object.defineProperty(Nm,"__esModule",{value:!0}),function(e){e[e.CONNECTION_TIMEOUT=1]="CONNECTION_TIMEOUT",e[e.INPUT_BUFFER_SIZE=2]="INPUT_BUFFER_SIZE",e[e.MAXIMUM_QUEUE_SIZE=3]="MAXIMUM_QUEUE_SIZE",e[e.OUTPUT_BUFFER_SIZE=4]="OUTPUT_BUFFER_SIZE",e[e.RECONNECTION_TIMEOUT=5]="RECONNECTION_TIMEOUT",e[e.RECOVERY_BUFFER_SIZE=6]="RECOVERY_BUFFER_SIZE",e[e.RETRY_DELAY=7]="RETRY_DELAY",e[e.WRITE_TIMEOUT=8]="WRITE_TIMEOUT"}(Nm.ConnectionOption||(Nm.ConnectionOption={})),function(e){e[e.INACTIVE=1]="INACTIVE",e[e.CONNECTED=2]="CONNECTED",e[e.RETRYING=3]="RETRYING",e[e.FAILED=4]="FAILED",e[e.MISSING=5]="MISSING"}(Nm.ConnectionState||(Nm.ConnectionState={}));var Am={};Object.defineProperty(Am,"__esModule",{value:!0}),Am.readRemoteServerStatus=function(e){return{connectionState:tf.read(e,Nm.ConnectionState),failureMessage:ba.readString(e)}};var Mm={},Lm=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(Mm,"__esModule",{value:!0});var Dm=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Lm(t,e),t.prototype.read=function(e){var t=Am.readRemoteServerStatus(e);return new Cm.CheckRemoteServerResult(t)},t}(Pa.AbstractSerialiser);Mm.CheckRemoteServerResultSerialiser=new Dm;var jm={};Object.defineProperty(jm,"__esModule",{value:!0}),jm.readRemoteServer=function(e){return{name:ba.readString(e),url:ba.readString(e),principal:ba.readString(e),connectionOptions:ba.readObject(e,(function(e){return tf.read(e,Nm.ConnectionOption)}),ba.readString)}};var xm={};Object.defineProperty(xm,"__esModule",{value:!0});var Um=function(e,t){this.server=e,this.errors=t};xm.CreateRemoteServerResult=Um;var Bm={},km=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(Bm,"__esModule",{value:!0});var qm=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return km(t,e),t.prototype.read=function(e){if(0===e.peek()){ba.readByte(e);var t=jm.readRemoteServer(e);return new xm.CreateRemoteServerResult(t)}var r=p_.ErrorReportListSerialiser.read(e);return new xm.CreateRemoteServerResult(void 0,r)},t}(Pa.AbstractSerialiser);Bm.CreateRemoteServerResultSerialiser=new qm;var Vm={};Object.defineProperty(Vm,"__esModule",{value:!0});var Fm=function(e){this.result=e};Vm.ListRemoteServersResult=Fm;var Gm={},Hm=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(Gm,"__esModule",{value:!0});var Wm=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Hm(t,e),t.prototype.read=function(e){var t=ba.readCollection(e,jm.readRemoteServer);return new Vm.ListRemoteServersResult(t)},t}(Pa.AbstractSerialiser);Gm.ListRemoteServersResultSerialiser=new Wm;var Ym={},zm=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(Ym,"__esModule",{value:!0});var Qm=function(e,t){return ba.writeByte(e,parseInt(t,10))},$m=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return zm(t,e),t.prototype.write=function(e,t){ba.writeString(e,t.name),ba.writeString(e,t.url),ba.writeString(e,t.principal),ba.writeObject(e,t.connectionOptions,Qm,ba.writeString),lh.write(e,t.credentials)},t}(Pa.AbstractSerialiser);Ym.RemoteServerDefinitionSerialiser=new $m;var Km={};Object.defineProperty(Km,"__esModule",{value:!0}),Km.CREATE_REMOTE_SERVER={id:157,request:Ym.RemoteServerDefinitionSerialiser,response:Bm.CreateRemoteServerResultSerialiser},Km.REMOVE_REMOTE_SERVER={id:158,request:Ay.StringSerialiser,response:od.NullSerialiser},Km.LIST_REMOTE_SERVERS={id:164,request:od.NullSerialiser,response:Gm.ListRemoteServersResultSerialiser},Km.CHECK_REMOTE_SERVER={id:165,request:Ay.StringSerialiser,response:Mm.CheckRemoteServerResultSerialiser};var Jm={};Object.defineProperty(Jm,"__esModule",{value:!0});var Xm=function(e,t,r,n,o){this.name=e,this.url=t,this.principal=r,this.credentials=n,this.connectionOptions=o};Jm.RemoteServerDefinition=Xm;var Zm={};Object.defineProperty(Zm,"__esModule",{value:!0});var ew=qa.create("RemoteServers"),tw=function(){function e(e){this.internal=e;var t=e.getServiceLocator();this.CREATE_REMOTE_SERVER=t.obtain(Km.CREATE_REMOTE_SERVER),this.LIST_REMOTE_SERVERS=t.obtain(Km.LIST_REMOTE_SERVERS),this.CHECK_REMOTE_SERVER=t.obtain(Km.CHECK_REMOTE_SERVER),this.REMOVE_REMOTE_SERVER=t.obtain(Km.REMOVE_REMOTE_SERVER)}return e.prototype.createRemoteServer=function(e,t,r,n,o){var i=this;return new Promise((function(s,a){if(0===gc.requireNonNull(e,"name").length)throw new Error("Remote server name cannot be empty");if(i.internal.checkConnected(a)){var u=new Jm.RemoteServerDefinition(e,gc.requireNonNull(t,"url"),gc.requireNonNull(r,"url"),gc.requireNonNull(n,"credentials"),o||{});i.CREATE_REMOTE_SERVER.send(u,(function(e,t){df.responseSuccess(e,t)?t.errors?(a(t.errors.errors),ew.debug("Create remote server failed")):s(t.server):(a(e),ew.debug("Create remote server failed"))}))}}))},e.prototype.checkRemoteServer=function(e){var t=this;return new Promise((function(r,n){t.internal.checkConnected(n)&&t.CHECK_REMOTE_SERVER.send(gc.requireNonNull(e,"name"),(function(e,t){e?(n(e),ew.debug("Check remote server failed")):r(t.status)}))}))},e.prototype.listRemoteServers=function(){var e=this;return new Promise((function(t,r){e.internal.checkConnected(r)&&e.LIST_REMOTE_SERVERS.send(null,(function(e,n){df.responseSuccess(e,n)?t(n.result):(r(e),ew.debug("List remote servers failed"))}))}))},e.prototype.removeRemoteServer=function(e){var t=this;return new Promise((function(r,n){t.internal.checkConnected(n)&&t.REMOVE_REMOTE_SERVER.send(gc.requireNonNull(e,"name"),(function(e){e?(n(e),ew.debug("Remove remote server failed")):r()}))}))},e}();Zm.RemoteServersImpl=tw;var rw={};Object.defineProperty(rw,"__esModule",{value:!0});var nw=function(){function e(){}return e.prototype.read=function(e){return ba.readBytes(e)},e.prototype.write=function(e,t){ba.writeBytes(e,t)},e}();rw.BytesSerialiser=new nw;var ow={};Object.defineProperty(ow,"__esModule",{value:!0});var iw=function(e,t){this.type=e,this.resString=t};ow.ReplaceLicenceResponse=iw;var sw={},aw=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(sw,"__esModule",{value:!0});var uw=function(e){function t(){var t=e.call(this)||this;return t.responseCode=[],t.responseCode[0]="The license was replaced successfully.",t.responseCode[1]="The provided license does not match this version of Diffusion.",t.responseCode[2]="Diffusion was unable to find the IP address provided within the license.",t.responseCode[3]="The provided license has expired.",t.responseCode[4]="The date on the provided license is not valid.",t.responseCode[5]="The license file is missing.Please check the read / write permissions of your Diffusion server.",t.responseCode[6]="The licencing service has encountered an unknown error.",t.responseCode[7]="The provided license is not valid for the given IP address(es).",t.responseCode[8]="The provided license is not valid for the given MAC address(es).",t.responseCode[9]="The license file provided cannot be read, and may be corrupt.",t.responseCode[10]="The new license has an non-matching feature set to the current license.\nPlease shut down the server and replace the license manually.",t}return aw(t,e),t.prototype.read=function(e){var t=ba.readByte(e),r=t in this.responseCode?this.responseCode[t]:"An unknown response was received from the server.";return new ow.ReplaceLicenceResponse(t,r)},t}(Pa.AbstractSerialiser);sw.ReplaceLicenceResponseSerialiser=new uw;var cw={};Object.defineProperty(cw,"__esModule",{value:!0}),cw.UPDATE_LICENSE={id:159,request:rw.BytesSerialiser,response:sw.ReplaceLicenceResponseSerialiser};var pw={};(function(e){"use strict";Object.defineProperty(pw,"__esModule",{value:!0});var t=function(){function t(e){this.LICENCE_UPDATE=e.getServiceLocator().obtain(cw.UPDATE_LICENSE)}return t.prototype.updateLicence=function(t){var r=this,n=e.from(t);return new Promise((function(e,t){r.LICENCE_UPDATE.send(n,(function(r,n){r?t(r):e(n)}))}))},t}();pw.LicenceUpdater=t}).call(this,a({}).Buffer);var lw={},fw=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};function hw(e){var t,r,n="";if(e.indexOf("'")<0&&e.indexOf("\\")<0)n+=e;else try{for(var o=fw(e),i=o.next();!i.done;i=o.next()){var s=i.value;"'"!==s&&"\\"!==s||(n+="\\"),n+=s}}catch(e){t={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}return"'"+n+"'"}Object.defineProperty(lw,"__esModule",{value:!0}),lw.quoteAndEscape=hw,lw.setToString=function(e){return"["+e.map(hw).join(" ")+"]"},lw.permissionsToString=function(e){return"["+e.join(" ")+"]"};var dw={};Object.defineProperty(dw,"__esModule",{value:!0});var yw=function(){function e(){this.commands="",this.setDefaultTopicPermissions=this.setDefaultPathPermissions.bind(this)}return e.prototype.maybeApppendNewLine=function(){this.commands.length>0&&(this.commands+="\n")},e.prototype.build=function(){return this.commands},e.prototype.toString=function(){return"ConfigurationScriptBuilder ["+this.commands+"]"},e.prototype.setRolesForAnonymousSessions=function(e){var t=gc.requireNonNull(e,"roles");return this.maybeApppendNewLine(),this.commands+="set roles for anonymous sessions ",this.commands+=lw.setToString(t),this},e.prototype.setRolesForNamedSessions=function(e){var t=gc.requireNonNull(e,"roles");return this.maybeApppendNewLine(),this.commands+="set roles for named sessions ",this.commands+=lw.setToString(t),this},e.prototype.setGlobalPermissions=function(e,t){var r=gc.requireNonNull(e,"role"),n=gc.requireNonNull(t,"permissions");return this.maybeApppendNewLine(),this.commands+="set "+lw.quoteAndEscape(r)+" permissions ",this.commands+=lw.permissionsToString(n),this},e.prototype.setDefaultPathPermissions=function(e,t){var r=gc.requireNonNull(e,"role"),n=gc.requireNonNull(t,"permissions");return this.maybeApppendNewLine(),this.commands+="set "+lw.quoteAndEscape(r)+" default path permissions ",this.commands+=lw.permissionsToString(n),this},e.prototype.removeTopicPermissions=function(e,t){return this.removePathPermissions(e,t)},e.prototype.removePathPermissions=function(e,t){var r=gc.requireNonNull(e,"role"),n=gc.requireNonNull(t,"path");return this.maybeApppendNewLine(),this.commands+="remove "+lw.quoteAndEscape(r)+" permissions for path "+lw.quoteAndEscape(n),this},e.prototype.setTopicPermissions=function(e,t,r){return this.setPathPermissions(e,t,r)},e.prototype.setPathPermissions=function(e,t,r){var n=gc.requireNonNull(e,"role"),o=gc.requireNonNull(t,"path"),i=gc.requireNonNull(r,"permissions");return this.maybeApppendNewLine(),this.commands+="set "+lw.quoteAndEscape(n)+" path "+lw.quoteAndEscape(o)+" permissions ",this.commands+=lw.permissionsToString(i),this},e.prototype.setRoleIncludes=function(e,t){var r=gc.requireNonNull(e,"role"),n=gc.requireNonNull(t,"includedRoles");return this.maybeApppendNewLine(),this.commands+="set "+lw.quoteAndEscape(r)+" includes ",this.commands+=lw.setToString(n),this},e.prototype.setRoleLockedByPrincipal=function(e,t){var r=gc.requireNonNull(e,"role"),n=gc.requireNonNull(t,"lockingPrincipal");return this.maybeApppendNewLine(),this.commands+="set role "+lw.quoteAndEscape(r)+" locked by principal "+lw.quoteAndEscape(n),this},e.prototype.isolatePath=function(e){var t=gc.requireNonNull(e,"path");return this.maybeApppendNewLine(),this.commands+="isolate path "+lw.quoteAndEscape(t),this},e.prototype.deisolatePath=function(e){var t=gc.requireNonNull(e,"path");return this.maybeApppendNewLine(),this.commands+="deisolate path "+lw.quoteAndEscape(t),this},e}();dw.SecurityScriptBuilderImpl=yw;var vw={};Object.defineProperty(vw,"__esModule",{value:!0});var _w=function(){function e(){this.commands=""}return e.prototype.maybeApppendNewLine=function(){this.commands.length>0&&(this.commands+="\n")},e.prototype.build=function(){return this.commands},e.prototype.toString=function(){return"SystemAuthenticationScriptBuilder ["+this.commands+"]"},e.prototype.assignRoles=function(e,t){var r=gc.requireNonNull(t,"roles"),n=gc.requireNonNull(e,"principal");return this.maybeApppendNewLine(),this.commands+="assign roles "+lw.quoteAndEscape(n)+" ",this.commands+=lw.setToString(r),this},e.prototype.addPrincipal=function(e,t,r,n){void 0===r&&(r=[]);var o=gc.requireNonNull(r,"roles"),i=gc.requireNonNull(e,"principal"),s=gc.requireNonNull(t,"password");return this.maybeApppendNewLine(),this.commands+="add principal "+lw.quoteAndEscape(i)+" "+lw.quoteAndEscape(s),o.length&&(this.commands+=" ",this.commands+=lw.setToString(o)),n&&(this.commands+=" locked by "+lw.quoteAndEscape(n)),this},e.prototype.setPassword=function(e,t){var r=gc.requireNonNull(e,"principal"),n=gc.requireNonNull(t,"password");return this.maybeApppendNewLine(),this.commands+="set password "+lw.quoteAndEscape(r)+" "+lw.quoteAndEscape(n),this},e.prototype.verifyPassword=function(e,t){var r=gc.requireNonNull(e,"principal"),n=gc.requireNonNull(t,"password");return this.maybeApppendNewLine(),this.commands+="verify password "+lw.quoteAndEscape(r)+" "+lw.quoteAndEscape(n),this},e.prototype.removePrincipal=function(e){var t=gc.requireNonNull(e,"principal");return this.maybeApppendNewLine(),this.commands+="remove principal "+lw.quoteAndEscape(t),this},e.prototype.allowAnonymousConnections=function(e){var t=gc.requireNonNull(e,"roles");return this.maybeApppendNewLine(),this.commands+="allow anonymous connections"+(e?" ":""),this.commands+=lw.setToString(t),this},e.prototype.denyAnonymousConnections=function(){return this.maybeApppendNewLine(),this.commands+="deny anonymous connections",this},e.prototype.abstainAnonymousConnections=function(){return this.maybeApppendNewLine(),this.commands+="abstain anonymous connections",this},e.prototype.trustClientProposedPropertyIn=function(e,t){var r=gc.requireNonNull(e,"propertyName"),n=gc.requireNonNull(t,"allowedValues");return this.maybeApppendNewLine(),this.commands+="trust client proposed property "+lw.quoteAndEscape(r)+" if value in ",this.commands+=lw.setToString(n),this},e.prototype.trustClientProposedPropertyMatches=function(e,t){var r=gc.requireNonNull(e,"propertyName"),n=gc.requireNonNull(t,"regex");return this.maybeApppendNewLine(),this.commands+="trust client proposed property "+lw.quoteAndEscape(r)+" if value matches "+lw.quoteAndEscape(n),this},e.prototype.ignoreClientProposedProperty=function(e){var t=gc.requireNonNull(e,"propertyName");return this.maybeApppendNewLine(),this.commands+="ignore client proposed property "+lw.quoteAndEscape(t),this},e}();vw.SystemAuthenticationScriptBuilderImpl=_w;var Sw={};Object.defineProperty(Sw,"__esModule",{value:!0});var Ew=function(){function e(e){this.script=gc.requireNonNull(e,"script")}return e.prototype.toString=function(){return"SecurityCommandScript ["+this.script+"]"},e}();Sw.SecurityCommandScript=Ew;var mw={},ww=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(mw,"__esModule",{value:!0});var gw=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ww(t,e),t.prototype.read=function(e){var t=ba.readString(e);return new Sw.SecurityCommandScript(t)},t.prototype.write=function(e,t){ba.writeString(e,t.script)},t}(Pa.AbstractSerialiser);mw.SecurityCommandScriptSerialiser=new gw;var Tw={};Object.defineProperty(Tw,"__esModule",{value:!0});var Ow=function(){function e(e,t,r,n){void 0===e&&(e=[]),void 0===r&&(r=[]),void 0===n&&(n={}),this.principals=e,this.anonymous={action:t,roles:r},this.trustedClientProposedProperties=n}return e.prototype.toString=function(){return"SystemAuthenticationConfiguration [principals="+this.principals+", anonymous="+this.anonymous+"]"},e}();Tw.SystemAuthentication=Ow,Tw.CONNECTION_ACTION={ALLOW:{id:0,value:"allow"},DENY:{id:1,value:"deny"},ABSTAIN:{id:2,value:"abstain"}},Ja.enumerize(Tw.CONNECTION_ACTION),Tw.connectionActionFromString=function(e){return Tw.CONNECTION_ACTION[e.toUpperCase()]};var Iw={};Object.defineProperty(Iw,"__esModule",{value:!0});var bw=function(e){this.type=e};Iw.SessionPropertyValidationImpl=bw;var Rw={};Object.defineProperty(Rw,"__esModule",{value:!0}),function(e){e.AUTHENTICATE="AUTHENTICATE",e.VIEW_SESSION="VIEW_SESSION",e.MODIFY_SESSION="MODIFY_SESSION",e.REGISTER_HANDLER="REGISTER_HANDLER",e.VIEW_SERVER="VIEW_SERVER",e.CONTROL_SERVER="CONTROL_SERVER",e.VIEW_SECURITY="VIEW_SECURITY",e.MODIFY_SECURITY="MODIFY_SECURITY",e.UNKNOWN_GLOBAL_PERMISSION="UNKNOWN_GLOBAL_PERMISSION",e.READ_TOPIC_VIEWS="READ_TOPIC_VIEWS",e.MODIFY_TOPIC_VIEWS="MODIFY_TOPIC_VIEWS"}(Rw.GlobalPermission||(Rw.GlobalPermission={})),function(e){e.READ_TOPIC="READ_TOPIC",e.UPDATE_TOPIC="UPDATE_TOPIC",e.MODIFY_TOPIC="MODIFY_TOPIC",e.SEND_TO_MESSAGE_HANDLER="SEND_TO_MESSAGE_HANDLER",e.SEND_TO_SESSION="SEND_TO_SESSION",e.SELECT_TOPIC="SELECT_TOPIC",e.QUERY_OBSOLETE_TIME_SERIES_EVENTS="QUERY_OBSOLETE_TIME_SERIES_EVENTS",e.EDIT_TIME_SERIES_EVENTS="EDIT_TIME_SERIES_EVENTS",e.EDIT_OWN_TIME_SERIES_EVENTS="EDIT_OWN_TIME_SERIES_EVENTS",e.ACQUIRE_LOCK="ACQUIRE_LOCK",e.UNKNOWN_PATH_PERMISSION="UNKNOWN_PATH_PERMISSION",e.UNKNOWN_TOPIC_PERMISSION="UNKNOWN_TOPIC_PERMISSION"}(Rw.PathPermission||(Rw.PathPermission={})),function(e){e[e.REGEX=0]="REGEX",e[e.VALUES=1]="VALUES"}(Rw.ValidationType||(Rw.ValidationType={}));var Cw={},Pw=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(Cw,"__esModule",{value:!0});var Nw=function(e){function t(t){var r=e.call(this,Rw.ValidationType.REGEX)||this;return r.regex=t,r}return Pw(t,e),t.prototype.toString=function(){return"SessionPropertyValidation [type="+this.type+", regex="+this.regex+"]"},t}(Iw.SessionPropertyValidationImpl);Cw.MatchesSessionPropertyValidationImpl=Nw;var Aw={},Mw=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(Aw,"__esModule",{value:!0});var Lw=function(e){function t(t){var r=e.call(this,Rw.ValidationType.VALUES)||this;return r.values=t,r}return Mw(t,e),t.prototype.toString=function(){return"SessionPropertyValidation [type="+this.type+", values="+this.values+"]"},t}(Iw.SessionPropertyValidationImpl);Aw.ValuesSessionPropertyValidationImpl=Lw;var Dw={},jw=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(Dw,"__esModule",{value:!0});var xw=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return jw(t,e),t.prototype.read=function(e){if(tf.read(e,Rw.ValidationType)===Rw.ValidationType.REGEX)return new Cw.MatchesSessionPropertyValidationImpl(ba.readString(e));var t=ba.readCollection(e,ba.readString);return new Aw.ValuesSessionPropertyValidationImpl(t)},t.prototype.write=function(e,t){var r=t.type;if(ba.writeByte(e,r),r===Rw.ValidationType.REGEX){var n=t;ba.writeString(e,n.regex)}else{var o=t;ba.writeCollection(e,o.values,ba.writeString)}},t}(Pa.AbstractSerialiser);Dw.SessionPropertyValidationSerialiser=new xw;var Uw={};Object.defineProperty(Uw,"__esModule",{value:!0});var Bw=function(){function e(e,t,r){this.name=gc.requireNonNull(e,"name"),this.roles=t||[],this.lockingPrincipal=r}return e.prototype.toString=function(){return"SystemPrincipal ["+this.name+", "+this.roles+"]"},e}();Uw.SystemPrincipalImpl=Bw;var kw={},qw=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(kw,"__esModule",{value:!0});var Vw=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return qw(t,e),t.prototype.read=function(e){var t=ba.readString(e),r=ba.readCollection(e,ba.readString),n=ba.readBoolean(e)?ba.readString(e):void 0;return new Uw.SystemPrincipalImpl(t,r,n)},t.prototype.write=function(e,t){ba.writeString(e,t.name),ba.writeCollection(e,t.roles,ba.writeString),ba.writeBoolean(e,!!t.lockingPrincipal),t.lockingPrincipal&&ba.writeString(e,t.lockingPrincipal)},t}(Pa.AbstractSerialiser);kw.SystemPrincipalSerialiser=new Vw;var Fw={},Gw=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(Fw,"__esModule",{value:!0});var Hw=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Gw(t,e),t.prototype.read=function(e){var t=ba.readCollection(e,kw.SystemPrincipalSerialiser.read),r=tf.read(e,Tw.CONNECTION_ACTION),n=ba.readCollection(e,ba.readString),o=ba.readDictionary(e,Dw.SessionPropertyValidationSerialiser.read);return new Tw.SystemAuthentication(t,r.value,n,o)},t.prototype.write=function(e,t){ba.writeCollection(e,t.principals,kw.SystemPrincipalSerialiser.write);var r=Tw.connectionActionFromString(t.anonymous.action);ba.writeByte(e,r.id),ba.writeCollection(e,t.anonymous.roles,ba.writeString),ba.writeDictionary(e,t.trustedClientProposedProperties,Dw.SessionPropertyValidationSerialiser.write)},t}(Pa.AbstractSerialiser);Fw.SystemAuthenticationConfigurationSerialiser=new Hw;var Ww={},Yw=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(Ww,"__esModule",{value:!0});var zw=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Yw(t,e),t.prototype.write=function(e,t){ba.writeString(e,t.principal),lh.write(e,t.credentials)},t}(Pa.AbstractSerialiser);Ww.ChangePrincipalRequestSerialiser=new zw;var Qw={};Object.defineProperty(Qw,"__esModule",{value:!0});var $w=function(e,t){this.definition=e,this.group=t};Qw.ControlRegistrationParams=$w;var Kw={},Jw=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(Kw,"__esModule",{value:!0});var Xw=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Jw(t,e),t.prototype.read=function(e){var t=ba.readInt32(e),r=dd.ControlGroupSerialiser.read(e);return new Qw.ControlRegistrationParams({id:t},r)},t.prototype.write=function(e,t){ba.writeInt32(e,t.definition.id),dd.ControlGroupSerialiser.write(e,t.group)},t}(Pa.AbstractSerialiser);Kw.ControlRegistrationParamsSerialiser=new Xw;var Zw={},eg=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(Zw,"__esModule",{value:!0});var tg=function(e){function t(t,r,n){var o=e.call(this,r,n)||this;return o.name=t,o}return eg(t,e),t}(Qw.ControlRegistrationParams);Zw.AuthenticatorRegistrationParameters=tg;var rg={},ng=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(rg,"__esModule",{value:!0});var og=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ng(t,e),t.prototype.read=function(e){var t=Kw.ControlRegistrationParamsSerialiser.read(e),r=ba.readString(e);return new Zw.AuthenticatorRegistrationParameters(r,t.definition,t.group)},t.prototype.write=function(e,t){Kw.ControlRegistrationParamsSerialiser.write(e,t),ba.writeString(e,t.name)},t}(Pa.AbstractSerialiser);rg.AuthenticatorRegistrationParametersSerialiser=new og;var ig={};Object.defineProperty(ig,"__esModule",{value:!0});var sg=function(e,t){this.params=e,this.cid=t};ig.AuthenticatorRegistrationRequest=sg;var ag={},ug=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(ag,"__esModule",{value:!0});var cg=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ug(t,e),t.prototype.read=function(e){var t=rg.AuthenticatorRegistrationParametersSerialiser.read(e),r=Ra.CIDSerialiser.read(e);return new ig.AuthenticatorRegistrationRequest(t,r)},t.prototype.write=function(e,t){rg.AuthenticatorRegistrationParametersSerialiser.write(e,t.params),Ra.CIDSerialiser.write(e,t.cid)},t}(Pa.AbstractSerialiser);ag.AuthenticatorRegistrationRequestSerialiser=new cg;var pg={};Object.defineProperty(pg,"__esModule",{value:!0});var lg=function(e,t,r,n,o){this.principal=e,this.credentials=t,this.sessionProperties=r,this.proposedProperties=n,this.cid=o};pg.AuthenticatorRequest=lg;var fg={},hg=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(fg,"__esModule",{value:!0});var dg=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return hg(t,e),t.prototype.read=function(e){var t=ba.readString(e),r=lh.read(e),n=ba.readDictionary(e,ba.readString),o=ba.readDictionary(e,ba.readString),i=Ra.CIDSerialiser.read(e);return new pg.AuthenticatorRequest(t,r,n,o,i)},t}(Pa.AbstractSerialiser);fg.AuthenticatorRequestSerialiser=new dg;var yg,vg={};Object.defineProperty(vg,"__esModule",{value:!0}),function(e){e[e.DENY=0]="DENY",e[e.ABSTAIN=1]="ABSTAIN",e[e.ALLOW=2]="ALLOW"}(yg=vg.TypeCode||(vg.TypeCode={}));var _g=function(e,t){this.type=e,this.properties=t};vg.AuthenticatorResponse=_g,vg.DENY=Object.freeze(new _g(yg.DENY)),vg.ABSTAIN=Object.freeze(new _g(yg.ABSTAIN));var Sg={},Eg=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(Sg,"__esModule",{value:!0});var mg=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Eg(t,e),t.prototype.read=function(e){switch(tf.read(e,vg.TypeCode)){case vg.TypeCode.ABSTAIN:return vg.ABSTAIN;case vg.TypeCode.ALLOW:var t=ba.readDictionary(e,ba.readString);return new vg.AuthenticatorResponse(vg.TypeCode.ALLOW,t);default:return vg.DENY}},t.prototype.write=function(e,t){tf.write(e,t.type),t.type===vg.TypeCode.ALLOW&&ba.writeDictionary(e,t.properties||{},ba.writeString)},t}(Pa.AbstractSerialiser);Sg.AuthenticatorResponseSerialiser=new mg;var wg={};Object.defineProperty(wg,"__esModule",{value:!0}),function(e){e[e.AUTHENTICATE=0]="AUTHENTICATE",e[e.VIEW_SESSION=1]="VIEW_SESSION",e[e.MODIFY_SESSION=2]="MODIFY_SESSION",e[e.REGISTER_HANDLER=3]="REGISTER_HANDLER",e[e.VIEW_SERVER=4]="VIEW_SERVER",e[e.CONTROL_SERVER=5]="CONTROL_SERVER",e[e.VIEW_SECURITY=6]="VIEW_SECURITY",e[e.MODIFY_SECURITY=7]="MODIFY_SECURITY",e[e.UNKNOWN_GLOBAL_PERMISSION=8]="UNKNOWN_GLOBAL_PERMISSION",e[e.READ_TOPIC_VIEWS=9]="READ_TOPIC_VIEWS",e[e.MODIFY_TOPIC_VIEWS=10]="MODIFY_TOPIC_VIEWS"}(wg.GlobalPermissionCode||(wg.GlobalPermissionCode={})),function(e){e[e.READ_TOPIC=0]="READ_TOPIC",e[e.UPDATE_TOPIC=1]="UPDATE_TOPIC",e[e.MODIFY_TOPIC=2]="MODIFY_TOPIC",e[e.SEND_TO_MESSAGE_HANDLER=3]="SEND_TO_MESSAGE_HANDLER",e[e.SEND_TO_SESSION=4]="SEND_TO_SESSION",e[e.SELECT_TOPIC=5]="SELECT_TOPIC",e[e.QUERY_OBSOLETE_TIME_SERIES_EVENTS=6]="QUERY_OBSOLETE_TIME_SERIES_EVENTS",e[e.EDIT_TIME_SERIES_EVENTS=7]="EDIT_TIME_SERIES_EVENTS",e[e.EDIT_OWN_TIME_SERIES_EVENTS=8]="EDIT_OWN_TIME_SERIES_EVENTS",e[e.ACQUIRE_LOCK=9]="ACQUIRE_LOCK",e[e.UNKNOWN_TOPIC_PERMISSION=10]="UNKNOWN_TOPIC_PERMISSION",e[e.UNKNOWN_PATH_PERMISSION=10]="UNKNOWN_PATH_PERMISSION"}(wg.PathPermissionCode||(wg.PathPermissionCode={}));var gg={};Object.defineProperty(gg,"__esModule",{value:!0});var Tg=function(e){this.permissions=e};gg.ListGlobalPermissionsResult=Tg;var Og={},Ig=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(Og,"__esModule",{value:!0});var bg=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ig(t,e),t.prototype.read=function(e){return new gg.ListGlobalPermissionsResult(ba.readCollection(e,(function(){var t=wg.GlobalPermissionCode[e.read()];return Rw.GlobalPermission[t]})))},t}(Pa.AbstractSerialiser);Og.ListGlobalPermissionsResultSerialiser=new bg;var Rg={};Object.defineProperty(Rg,"__esModule",{value:!0});var Cg=function(e){this.permissions=e};Rg.ListPathPermissionsResult=Cg;var Pg={},Ng=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(Pg,"__esModule",{value:!0});var Ag=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ng(t,e),t.prototype.read=function(e){return new Rg.ListPathPermissionsResult(ba.readCollection(e,(function(){var t=wg.PathPermissionCode[e.read()];return Rw.PathPermission[t]})))},t}(Pa.AbstractSerialiser);Pg.ListPathPermissionsResultSerialiser=new Ag;var Mg={};Object.defineProperty(Mg,"__esModule",{value:!0});var Lg=function(){function e(e,t,r,n){this.anonymous=e,this.named=t,this.roles=r,this.isolatedPaths=n}return e.prototype.toString=function(){return"SecurityConfiguration [anonymous=${this.anonymous}, named=${this.named}, roles=${this.roles}, isolatedPaths=${this.isolatedPaths}]"},e}();Mg.SecurityConfigurationImpl=Lg;var Dg={};Object.defineProperty(Dg,"__esModule",{value:!0});var jg=function(e,t,r,n,o,i){this.name=e,this.global=t,this.default=r,this.topic=n,this.roles=o,this.lockingPrincipal=i};Dg.RoleImpl=jg;var xg={};Object.defineProperty(xg,"__esModule",{value:!0}),xg.read=function(e){var t=ba.readString(e),r=ba.readCollection(e,(function(){return tf.read(e,wg.GlobalPermissionCode)})).map((function(e){return wg.GlobalPermissionCode[e]})),n=ba.readCollection(e,(function(){return tf.read(e,wg.PathPermissionCode)})).map((function(e){return wg.PathPermissionCode[e]})),o=ba.readDictionary(e,(function(){return ba.readCollection(e,(function(){return tf.read(e,wg.PathPermissionCode)})).map((function(e){return wg.PathPermissionCode[e]}))})),i=ba.readCollection(e,ba.readString),s=ba.readBoolean(e)?ba.readString(e):void 0;return new Dg.RoleImpl(t,r,n,o,i,s)};var Ug={},Bg=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(Ug,"__esModule",{value:!0});var kg=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Bg(t,e),t.prototype.read=function(e){var t=ba.readCollection(e,ba.readString),r=ba.readCollection(e,ba.readString),n=ba.readCollection(e,xg.read),o=ba.readCollection(e,ba.readString);return new Mg.SecurityConfigurationImpl(t,r,n,o)},t}(Pa.AbstractSerialiser);Ug.SecurityConfigurationSerialiser=new kg;var qg={};Object.defineProperty(qg,"__esModule",{value:!0}),qg.CHANGE_PRINCIPAL={id:5,request:Ww.ChangePrincipalRequestSerialiser,response:Zl.BooleanSerialiser},qg.GET_SYSTEM_AUTHENTICATION={id:57,request:od.NullSerialiser,response:Fw.SystemAuthenticationConfigurationSerialiser},qg.UPDATE_SYSTEM_AUTHENTICATION={id:58,request:mw.SecurityCommandScriptSerialiser,response:p_.ErrorReportListSerialiser},qg.GET_SECURITY_CONFIGURATION={id:59,request:od.NullSerialiser,response:Ug.SecurityConfigurationSerialiser},qg.UPDATE_SECURITY_CONFIGURATION={id:60,request:mw.SecurityCommandScriptSerialiser,response:p_.ErrorReportListSerialiser},qg.AUTHENTICATOR_REGISTRATION={id:119,request:ag.AuthenticatorRegistrationRequestSerialiser,response:od.NullSerialiser},qg.AUTHENTICATOR={id:120,request:fg.AuthenticatorRequestSerialiser,response:Sg.AuthenticatorResponseSerialiser},qg.AUTHENTICATOR_DEREGISTRATION={id:121,request:rg.AuthenticatorRegistrationParametersSerialiser,response:od.NullSerialiser},qg.LIST_GLOBAL_PERMISSIONS={id:143,request:od.NullSerialiser,response:Og.ListGlobalPermissionsResultSerialiser},qg.LIST_PATH_PERMISSIONS={id:144,request:Ay.StringSerialiser,response:Pg.ListPathPermissionsResultSerialiser};var Vg={},Fg=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(Vg,"__esModule",{value:!0});var Gg=qa.create("Session.Security"),Hg=function(){function e(e){this.GlobalPermission=Rw.GlobalPermission,this.PathPermission=Rw.PathPermission,this.TopicPermission=Rw.PathPermission,this.internal=e;var t=e.getServiceLocator();this.CHANGE_PRINCIPAL=t.obtain(qg.CHANGE_PRINCIPAL),this.GET_SECURITY_CONFIGURATION=t.obtain(qg.GET_SECURITY_CONFIGURATION),this.GET_SYSTEM_AUTHENTICATION=t.obtain(qg.GET_SYSTEM_AUTHENTICATION),this.UPDATE_SECURITY_CONFIGURATION=t.obtain(qg.UPDATE_SECURITY_CONFIGURATION),this.UPDATE_SYSTEM_AUTHENTICATION=t.obtain(qg.UPDATE_SYSTEM_AUTHENTICATION),this.AUTHENTICATOR_DEREGISTRATION=t.obtain(qg.AUTHENTICATOR_DEREGISTRATION),this.LIST_GLOBAL_PERMISSIONS=t.obtain(qg.LIST_GLOBAL_PERMISSIONS),this.LIST_PATH_PERMISSIONS=t.obtain(qg.LIST_PATH_PERMISSIONS),e.getServiceRegistry().add(qg.AUTHENTICATOR,xS.create((function(e,t,r){e.getConversationSet().respondIfPresent(t.cid,{req:t,callback:r})})))}return e.prototype.getPrincipal=function(){return this.internal.getPrincipal()},e.prototype.changePrincipal=function(e,t){var r=this;return new Promise((function(n,o){r.internal.checkConnected(o)&&(Gg.debug("Changing principal",e),r.CHANGE_PRINCIPAL.send({principal:e,credentials:t},(function(t,i){t?o(t):i?(r.internal.setPrincipal(e),n()):o(new Error("Unable to change principal due to authentication failure"))})))}))},e.prototype.getSecurityConfiguration=function(){var e=this;return new Promise((function(t,r){e.internal.checkConnected(r)&&(Gg.debug("Getting security configuration"),e.GET_SECURITY_CONFIGURATION.send(null,(function(e,n){e?r(e):t(n)})))}))},e.prototype.getSystemAuthenticationConfiguration=function(){var e=this;return new Promise((function(t,r){e.internal.checkConnected(r)&&(Gg.debug("Getting system authentication"),e.GET_SYSTEM_AUTHENTICATION.send(null,(function(e,n){e?r(e):t(n)})))}))},e.prototype.setAuthenticator=function(e,t){var r=this;return new Promise((function(n,o){if(r.internal.checkConnected(o)){try{gc.requireNonNull(e,"handlerName"),gc.requireNonNull(t,"authenticator")}catch(e){return void o(e)}"function"==typeof t.authenticate&&"function"==typeof t.onError&&"function"==typeof t.onClose||o(new Error("authenticator does not implement the Authenticator interface")),Gg.debug("Adding authenticator",e);var i={name:e,definition:qg.AUTHENTICATOR,group:fd.DEFAULT},s={active:function(o,s){Gg.debug("Authenticator active",e),n({close:function(){return new Promise((function(e){r.AUTHENTICATOR_DEREGISTRATION.send(i,(function(n,o){n?(r.internal.getConversationSet().discard(s,n),Gg.debug("Error with authenticator deregistration: ",n)):(r.internal.getConversationSet().respondIfPresent(s,o),t.onClose()),e()}))}))}})},respond:function(e){var r=e.req,n=e.callback;try{t.authenticate(r.principal,r.credentials,r.sessionProperties,r.proposedProperties,{allow:function(e){var t,o;if(e){e=Object.assign({},e);try{for(var i=Fg(Object.getOwnPropertyNames(r.sessionProperties)),s=i.next();!s.done;s=i.next()){var a=s.value;e[a]===r.sessionProperties[a]&&delete e[a]}}catch(e){t={error:e}}finally{try{s&&!s.done&&(o=i.return)&&o.call(i)}finally{if(t)throw t.error}}}n.respond(new vg.AuthenticatorResponse(vg.TypeCode.ALLOW,e))},abstain:function(){n.respond(vg.ABSTAIN)},deny:function(){n.respond(vg.DENY)}})}catch(e){throw t.onError(e),n.fail(Xa.ErrorReason.CALLBACK_EXCEPTION,e&&e.message),e}return!1},close:function(r){r?(Gg.debug("'Authenticator closed with error for \""+e+"\"'"),t.onError(r)):(Gg.debug("'Authentication Handler closed for \""+e+"\"'"),t.onClose())}};_y.registerHandler(r.internal,i,s,qg.AUTHENTICATOR_REGISTRATION,qg.AUTHENTICATOR_DEREGISTRATION).then(void 0,(function(e){o(e)}))}}))},e.prototype.updateStoreCallback=function(e,t,r,n){e?n(e):t.errors.length>0?n(t.errors):r()},e.prototype.updateStore=function(e,t){var r=this;return new Promise((function(n,o){""===t?n():t&&"string"==typeof t?r.internal.checkConnected(o)&&e.send(new Sw.SecurityCommandScript(t),(function(e,t){r.updateStoreCallback(e,t,n,o)})):o(new Error("Invalid argument for script: "+t))}))},e.prototype.updateSecurityStore=function(e){return Gg.debug("Updating security store"),this.updateStore(this.UPDATE_SECURITY_CONFIGURATION,e)},e.prototype.updateAuthenticationStore=function(e){return Gg.debug("Updating authentication store"),this.updateStore(this.UPDATE_SYSTEM_AUTHENTICATION,e)},e.prototype.securityScriptBuilder=function(){return new dw.SecurityScriptBuilderImpl},e.prototype.authenticationScriptBuilder=function(){return new vw.SystemAuthenticationScriptBuilderImpl},e.prototype.getGlobalPermissions=function(){var e=this;return new Promise((function(t,r){e.internal.checkConnected(r)&&(Gg.debug("Getting global permissions"),e.LIST_GLOBAL_PERMISSIONS.send(null,(function(e,n){e?r(e):t(n.permissions)})))}))},e.prototype.getPathPermissions=function(e){var t=this;return new Promise((function(r,n){t.internal.checkConnected(n)&&(Gg.debug("Getting path permissions"),t.LIST_PATH_PERMISSIONS.send(e,(function(e,t){e?n(e):r(t.permissions)})))}))},e.prototype.getTopicPermissions=function(e){var t=this;return new Promise((function(r,n){t.internal.checkConnected(n)&&(Gg.debug("Getting path permissions"),t.LIST_PATH_PERMISSIONS.send(e,(function(e,t){e?n(e):r(t.permissions)})))}))},e}();Vg.SecurityImpl=Hg;var Wg={};function Yg(e,t){if(null==e||e<0)throw new Error(t+" is negative: "+e);return e}Object.defineProperty(Wg,"__esModule",{value:!0});var zg=function(e,t,r,n){this.id=e,this.anchorOperator=t,this.spanOperator=r,this.unitsSuffix=n};Wg.Types={ABSOLUTE_START:new zg(0,"fromStart","toStart",""),ABSOLUTE_SEQUENCE:new zg(1,"from","to",""),ABSOLUTE_TIME:new zg(2,"from","to"," ms"),OFFSET_SEQUENCE:new zg(3,"fromLast","untilLast",""),OFFSET_TIME:new zg(4,"fromLast","untilLast"," ms"),NEXT_COUNT:new zg(5,null,"next",""),NEXT_TIME:new zg(6,null,"next"," ms"),PREVIOUS_COUNT:new zg(7,null,"previous",""),PREVIOUS_TIME:new zg(8,null,"previous"," ms")},Ja.enumerize(Wg.Types);var Qg=function(){function e(e,t){this.value=e,this.type=t}return e.at=function(t){return t instanceof Date?new e(gc.requireNonNull(t,"Date").getTime(),Wg.Types.ABSOLUTE_TIME):new e(Yg(t,"Sequence"),Wg.Types.ABSOLUTE_SEQUENCE)},e.atStart=function(){return $g},e.offset=function(t){return new e(Yg(t,"Count"),Wg.Types.OFFSET_SEQUENCE)},e.offsetMillis=function(t){return new e(Yg(t,"Timespan"),Wg.Types.OFFSET_TIME)},e.next=function(t){return new e(Yg(t,"Count"),Wg.Types.NEXT_COUNT)},e.nextMillis=function(t){return new e(Yg(t,"Timespan"),Wg.Types.NEXT_TIME)},e.previous=function(t){return new e(Yg(t,"Count"),Wg.Types.PREVIOUS_COUNT)},e.previousMillis=function(t){return new e(Yg(t,"Timespan"),Wg.Types.PREVIOUS_TIME)},e.prototype.equals=function(t){return!!(t&&t instanceof e)&&(this.value===t.value&&this.type===t.type)},e}();Wg.Point=Qg;var $g=new Qg(0,Wg.Types.ABSOLUTE_START),Kg={};Object.defineProperty(Kg,"__esModule",{value:!0});var Jg=function(){function e(e,t){this.anchor=e,this.span=t}return e.prototype.equals=function(t){return!!(t&&t instanceof e)&&(this.anchor.equals(t.anchor)&&this.span.equals(t.span))},e.prototype.from=function(t){return new e(Wg.Point.at(t),this.span)},e.prototype.fromStart=function(){return new e(Wg.Point.atStart(),this.span)},e.prototype.fromLast=function(t){return new e(Wg.Point.offset(t),this.span)},e.prototype.fromLastMillis=function(t){return new e(Wg.Point.offsetMillis(t),this.span)},e.prototype.to=function(t){return new e(this.anchor,Wg.Point.at(t))},e.prototype.toStart=function(){return new e(this.anchor,Wg.Point.atStart())},e.prototype.untilLast=function(t){return new e(this.anchor,Wg.Point.offset(t))},e.prototype.untilLastMillis=function(t){return new e(this.anchor,Wg.Point.offsetMillis(t))},e.prototype.next=function(t){return new e(this.anchor,Wg.Point.next(t))},e.prototype.nextMillis=function(t){return new e(this.anchor,Wg.Point.nextMillis(t))},e.prototype.previous=function(t){return new e(this.anchor,Wg.Point.previous(t))},e.prototype.previousMillis=function(t){return new e(this.anchor,Wg.Point.previousMillis(t))},e}();Kg.Range=Jg,Kg.DEFAULT_RANGE=new Jg(Wg.Point.atStart(),Wg.Point.offset(0));var Xg={};Object.defineProperty(Xg,"__esModule",{value:!0});var Zg=function(){function e(e,t){this.id=e,this.name=t}return e.prototype.toString=function(){return this.name},e}();Xg.StreamStructures={VALUE_EVENT_STREAM:new Zg(1,"VALUE_EVENT_STREAM"),EDIT_EVENT_STREAM:new Zg(2,"EDIT_EVENT_STREAM")},Ja.enumerize(Xg.StreamStructures),Object.freeze(Xg.StreamStructures);var eT=function(e,t){this.id=e,this.streamStructure=t};Xg.QueryTypes={VALUES:new eT(0,Xg.StreamStructures.VALUE_EVENT_STREAM),ALL_EDITS:new eT(1,Xg.StreamStructures.EDIT_EVENT_STREAM),LATEST_EDITS:new eT(2,Xg.StreamStructures.EDIT_EVENT_STREAM)},Ja.enumerize(Xg.QueryTypes),Object.freeze(Xg.QueryTypes);var tT=function(){function e(e,t,r,n){this.queryType=e,this.viewRange=t,this.editRange=r,this.limit=n}return e.prototype.withViewRange=function(t){return new e(this.queryType,t,this.editRange,this.limit)},e.prototype.withEditRange=function(t){return new e(this.queryType,this.viewRange,t,this.limit)},e.prototype.withLimit=function(t){return new e(this.queryType,this.viewRange,this.editRange,function(e,t){if(e<0)throw new Error(t+'" is negative: '+e);return e}(t,"limit"))},e.prototype.withQueryType=function(t){return new e(t,this.viewRange,this.editRange,this.limit)},e.prototype.equals=function(t){return!!(t&&t instanceof e)&&(this.queryType===t.queryType&&this.viewRange.equals(t.viewRange)&&this.editRange.equals(t.editRange)&&this.limit===t.limit)},e}();Xg.RangeQueryParameters=tT,Xg.DEFAULT_RANGE_QUERY=Object.freeze(new tT(Xg.QueryTypes.VALUES,Kg.DEFAULT_RANGE,Kg.DEFAULT_RANGE,Uu.MAX_SAFE_INTEGER));var rT={};function nT(e,t){return e.withViewRange(t(e.viewRange))}function oT(e,t){return e.withEditRange(t(e.editRange))}Object.defineProperty(rT,"__esModule",{value:!0});var iT=function(){function e(e,t,r,n){this.context=e,this.valueType=t,this.parameters=r,this.mode=n}return e.prototype.withCurrentRange=function(t){return new e(this.context,this.valueType,this.mode(this.parameters,t),this.mode)},e.prototype.selectFrom=function(e){var t=this;return new Promise((function(r,n){if(e){var o={topicPath:e,parameters:t.parameters};t.context.send(o,(function(e,o){df.responseSuccess(e,o)?r(o.createQueryResult(t.valueType,t.parameters.queryType.streamStructure)):n(e)}))}else n(new Error("Topic path is null"))}))},e.prototype.forValues=function(){return new e(this.context,this.valueType,this.parameters.withQueryType(Xg.QueryTypes.VALUES).withViewRange(Kg.DEFAULT_RANGE),nT)},e.prototype.forEdits=function(){return new e(this.context,this.valueType,this.parameters.withQueryType(Xg.QueryTypes.ALL_EDITS).withViewRange(Kg.DEFAULT_RANGE),nT)},e.prototype.editRange=function(){if(this.parameters.queryType!==Xg.QueryTypes.VALUES)throw new Error(".editRange() cannot be applied to this edit range query");return new e(this.context,this.valueType,this.parameters,oT)},e.prototype.allEdits=function(){if(this.parameters.queryType===Xg.QueryTypes.VALUES)throw new Error(".allEdits() cannot be applied to this value range query");return new e(this.context,this.valueType,this.parameters.withQueryType(Xg.QueryTypes.ALL_EDITS),oT)},e.prototype.latestEdits=function(){if(this.parameters.queryType===Xg.QueryTypes.VALUES)throw new Error(".latestEdits() cannot be applied to this value range query");return new e(this.context,this.valueType,this.parameters.withQueryType(Xg.QueryTypes.LATEST_EDITS),oT)},e.prototype.limit=function(t){return new e(this.context,this.valueType,this.parameters.withLimit(t),this.mode)},e.prototype.as=function(t){if(t&&t.valueClass)return new e(this.context,t.valueClass,this.parameters,this.mode);if(t instanceof Function)return new e(this.context,t,this.parameters,this.mode);throw new Error("Invalid value type: "+t)},e.prototype.from=function(e){return this.withCurrentRange((function(t){return t.from(e)}))},e.prototype.fromStart=function(){return this.withCurrentRange((function(e){return e.fromStart()}))},e.prototype.fromLast=function(e){return this.withCurrentRange((function(t){return t.fromLast(e)}))},e.prototype.fromLastMillis=function(e){return this.withCurrentRange((function(t){return t.fromLastMillis(e)}))},e.prototype.to=function(e){return this.withCurrentRange((function(t){return t.to(e)}))},e.prototype.toStart=function(){return this.withCurrentRange((function(e){return e.toStart()}))},e.prototype.untilLast=function(e){return this.withCurrentRange((function(t){return t.untilLast(e)}))},e.prototype.untilLastMillis=function(e){return this.withCurrentRange((function(t){return t.untilLastMillis(e)}))},e.prototype.next=function(e){return this.withCurrentRange((function(t){return t.next(e)}))},e.prototype.nextMillis=function(e){return this.withCurrentRange((function(t){return t.nextMillis(e)}))},e.prototype.previous=function(e){return this.withCurrentRange((function(t){return t.previous(e)}))},e.prototype.previousMillis=function(e){return this.withCurrentRange((function(t){return t.previousMillis(e)}))},e.createDefault=function(t){return new e(t,oc.BytesImpl,Xg.DEFAULT_RANGE_QUERY,nT)},e.prototype.equals=function(t){return!!(t&&t instanceof e)&&this.parameters.equals(t.parameters)},e.prototype.toString=function(){return this.parameters.toString()},e}();rT.RangeQueryImpl=iT;var sT={};function aT(e){var t=ba.readInt64(e),r=tf.read(e,Wg.Types);return new Wg.Point(t,r)}function uT(e){var t=aT(e),r=aT(e);return new Kg.Range(t,r)}function cT(e,t){ba.writeInt64(e,t.value),tf.write(e,t.type)}function pT(e,t){cT(e,t.anchor),cT(e,t.span)}Object.defineProperty(sT,"__esModule",{value:!0}),sT.read=function(e){var t=tf.read(e,Xg.QueryTypes),r=uT(e),n=uT(e),o=ba.readInt64(e);return new Xg.RangeQueryParameters(t,r,n,o)},sT.write=function(e,t){tf.write(e,t.queryType),pT(e,t.viewRange),pT(e,t.editRange),ba.writeInt64(e,t.limit)};var lT={};Object.defineProperty(lT,"__esModule",{value:!0});var fT=function(e,t){this.topicPath=e,this.parameters=t};lT.RangeQueryRequest=fT;var hT={},dT=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(hT,"__esModule",{value:!0});var yT=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return dT(t,e),t.prototype.read=function(e){var t=ba.readString(e),r=sT.read(e);return new lT.RangeQueryRequest(t,r)},t.prototype.write=function(e,t){ba.writeString(e,t.topicPath),sT.write(e,t.parameters)},t}(Pa.AbstractSerialiser);hT.RangeQueryRequestSerialiser=new yT;var vT={};function _T(e){return!!e}function ST(e,t){return e.originalEvent.sequence!==t.originalEvent.sequence?e.originalEvent.sequence-t.originalEvent.sequence:e.sequence-t.sequence}Object.defineProperty(vT,"__esModule",{value:!0});var ET=function(){function e(e,t,r,n){this.events=n,this.selectedCount=e.toNumber(),this.isComplete=e.equals(t),this.streamStructure=r}return e.prototype.merge=function(t){var r,n,o=this.events.concat(t.events).sort(ST).map((r=this.events.concat(t.events),n={},r.forEach((function(e){var t=e.originalEvent.sequence.toString(10);(!n[t]||n[t].sequence<e.sequence)&&(n[t]=e)})),function(e){var t=e.originalEvent.sequence.toString(10),r=n[t];return r?e.isEditEvent?e.sequence.equals(r.sequence)?(delete n[t],e):null:(delete n[t],r):null})).filter(_T),i=Gs.fromNumber(o.length);return new e(i,i,Xg.StreamStructures.VALUE_EVENT_STREAM,o)},e}();vT.QueryResultImpl=ET;var mT={};Object.defineProperty(mT,"__esModule",{value:!0});var wT=function(){function e(e,t,r){this.valueDataType=e,this.selectedCount=t,this.events=r}return e.prototype.createQueryResult=function(e,t){var r=this;if(!this.valueDataType.canReadAs(e))throw new Error("Time series topic has an incompatible event data type: "+this.valueDataType);return new vT.QueryResultImpl(this.selectedCount,Gs.fromNumber(this.events.length),t,this.events.map((function(t){return t.withValue(r.valueDataType.readAs(e,t.value))})))},e}();mT.RangeQueryResult=wT;var gT={},TT=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(gT,"__esModule",{value:!0});var OT=function(e,t){this.sequence=e,this.timestamp=t};function IT(e,t,r){var n=ba.readInt64(e).add(t.sequence),o=ba.readInt64(e).add(t.timestamp),i=ba.readBytes(e),s=r[i.toString()],a=s||i.toString("utf-8");return new Kp.EventMetadataImpl(n.toNumber(),o.toNumber(),a)}function bT(e,t,r){var n=IT(e,t,r);return Qp.EventImpl.create(n,n,ba.readBytes(e))}function RT(e,t,r){var n=IT(e,t,r),o=IT(e,t,r);return Qp.EventImpl.create(o,n,ba.readBytes(e))}function CT(e,t){t[ba.readBytes(e).toString()]=ba.readString(e)}var PT=function(e){function t(t){var r=e.call(this)||this;return r.datatypes=t,r}return TT(t,e),t.prototype.read=function(e){var t=this.datatypes.get(ba.readString(e));if(null===t)throw new Error("Received unexpected data type");for(var r,n=ba.readInt64(e),o=new OT(Gs.ZERO,Gs.ZERO),i={},s=[],a=ba.readInt32(e),u=0;u<a;++u)switch(ba.readByte(e)){case 0:s.push(bT(e,o,i));break;case 1:s.push(RT(e,o,i));break;case 2:r=e,o=new OT(ba.readInt64(r),ba.readInt64(r));break;case 3:CT(e,i);break;default:CT(e,i)}return new mT.RangeQueryResult(t,n,s)},t}(Pa.AbstractSerialiser);gT.RangeQueryResultSerialiserClass=PT;var NT={},AT=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(NT,"__esModule",{value:!0});var MT=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return AT(t,e),t.prototype.write=function(e,t){ba.writeString(e,t.path),ba.writeString(e,t.dataType.name()),ba.writeBytes(e,t.value)},t}(Pa.AbstractSerialiser);NT.TimeSeriesAppendRequestSerialiser=new MT;var LT={},DT=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(LT,"__esModule",{value:!0});var jT=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return DT(t,e),t.prototype.write=function(e,t){ba.writeString(e,t.path),ba.writeString(e,t.dataType.name()),ba.writeInt64(e,t.sequence),ba.writeBytes(e,t.value)},t}(Pa.AbstractSerialiser);LT.TimeSeriesEditRequestSerialiser=new jT;var xT={},UT=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(xT,"__esModule",{value:!0});var BT=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return UT(t,e),t.prototype.write=function(e,t){ba.writeString(e,t.path),ba.writeString(e,t.dataType.name()),ba.writeBytes(e,t.value),ba.writeInt64(e,t.timestamp)},t}(Pa.AbstractSerialiser);xT.TimeSeriesTimestampAppendRequestSerialiser=new BT;var kT={};Object.defineProperty(kT,"__esModule",{value:!0}),kT.rangeQueryFactory=function(e){return{id:84,request:hT.RangeQueryRequestSerialiser,response:new gT.RangeQueryResultSerialiserClass(e)}},kT.TIME_SERIES_APPEND={id:99,request:NT.TimeSeriesAppendRequestSerialiser,response:Xp.EventMetadataImplSerialiser},kT.TIME_SERIES_EDIT={id:100,request:LT.TimeSeriesEditRequestSerialiser,response:Xp.EventMetadataImplSerialiser},kT.TIME_SERIES_TIMESTAMP_APPEND={id:166,request:xT.TimeSeriesTimestampAppendRequestSerialiser,response:Xp.EventMetadataImplSerialiser};var qT={};Object.defineProperty(qT,"__esModule",{value:!0});var VT=function(e,t,r){this.path=e,this.dataType=t,this.value=r};qT.TimeSeriesAppendRequest=VT;var FT={};Object.defineProperty(FT,"__esModule",{value:!0});var GT=function(e,t,r,n){this.path=e,this.dataType=t,this.value=r,this.timestamp=n};FT.TimeSeriesTimestampAppendRequest=GT;var HT={};Object.defineProperty(HT,"__esModule",{value:!0});var WT=function(){function e(e){this.internal=e;var t=e.getServiceLocator();this.defaultRangeQuery=rT.RangeQueryImpl.createDefault(t.obtain(kT.rangeQueryFactory(e.getContext().DataTypes))),this.appendService=t.obtain(kT.TIME_SERIES_APPEND),this.appendTimestampService=t.obtain(kT.TIME_SERIES_TIMESTAMP_APPEND),this.editService=t.obtain(kT.TIME_SERIES_EDIT)}return e.prototype.rangeQuery=function(){return this.defaultRangeQuery},e.prototype.edit=function(e,t,r,n){var o=this,i=this.internal.getContext().DataTypes;return new Promise((function(s,a){var u;try{u=n instanceof o.internal.getContext().AbstractDataType?n:n?i.getByClass(n):i.getByValue(r),gc.requireNonNull(e,"Path"),gc.requireNonNull(r,"Value"),gc.requireNonNull(t,"Sequence"),u=gc.requireNonNull(u,"Data type")}catch(e){return void a(e)}o.editService.send({path:e,sequence:t,dataType:u,value:u.writeValue(r)},(function(e,t){e?a(e):s(t)}))}))},e.prototype.append=function(e,t,r,n){var o=this,i=this.internal.getContext().DataTypes;return new Promise((function(s,a){var u;try{u=r instanceof o.internal.getContext().AbstractDataType?r:r?i.getByClass(r):i.getByValue(t),gc.requireNonNull(e,"Path"),gc.requireNonNull(t,"Value"),u=gc.requireNonNull(u,"Data type")}catch(e){return void a(e)}var c=function(e,t){e?a(e):s(t)};void 0===n?o.appendService.send(new qT.TimeSeriesAppendRequest(e,u,u.writeValue(t)),c):o.appendTimestampService.send(new FT.TimeSeriesTimestampAppendRequest(e,u,u.writeValue(t),"number"==typeof n?Gs.fromNumber(n):n),c)}))},e}();HT.TimeSeriesImpl=WT;var YT={},zT=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(YT,"__esModule",{value:!0});var QT=function(){function e(){this.cache={}}return e.prototype.get=function(e){return this.cache[dl.canonicalise(e)]},e.prototype.put=function(e,t){this.cache[dl.canonicalise(e)]=t},e.prototype.remove=function(e){var t,r;try{for(var n=zT(Object.getOwnPropertyNames(this.cache)),o=n.next();!o.done;o=n.next()){var i=o.value;e.selects(i)&&delete this.cache[i]}}catch(e){t={error:e}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}},e}();YT.ValueCache=QT;var $T={};Object.defineProperty($T,"__esModule",{value:!0}),function(e){e[e.OK=0]="OK",e[e.EXISTS=1]="EXISTS"}($T.TopicAddResponseStatus||($T.TopicAddResponseStatus={}));var KT=function(e){this.status=e};$T.TopicAddResponse=KT;var JT={};Object.defineProperty(JT,"__esModule",{value:!0});var XT=function(){function e(){}return e.prototype.read=function(e){return ba.readInt32(e)},e.prototype.write=function(e,t){ba.writeInt32(e,t)},e}();JT.IntegerSerialiser=new XT;var ZT={};Object.defineProperty(ZT,"__esModule",{value:!0});var eO=function(e,t,r){this.sessionID=e,this.selector=t,this.cid=r};ZT.MissingTopicRequest=eO;var tO={},rO=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(tO,"__esModule",{value:!0});var nO=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return rO(t,e),t.prototype.read=function(e){var t=Jy.SessionIdSerialiser.read(e),r=Ly.TopicSelectorSerialiser.read(e),n=Ra.CIDSerialiser.read(e);return new ZT.MissingTopicRequest(t,r,n)},t.prototype.write=function(e,t){Jy.SessionIdSerialiser.write(e,t.sessionID),Ly.TopicSelectorSerialiser.write(e,t.selector),Ra.CIDSerialiser.write(e,t.cid)},t}(Pa.AbstractSerialiser);tO.MissingTopicRequestSerialiser=new nO;var oO={},iO=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(oO,"__esModule",{value:!0});var sO=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return iO(t,e),t.prototype.write=function(e,t){ba.writeString(e,t.selector.expression)},t}(Pa.AbstractSerialiser);oO.RemoveTopicSerialiser=new sO;var aO={},uO=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(aO,"__esModule",{value:!0});var cO=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return uO(t,e),t.prototype.write=function(e,t){ba.writeString(e,t.path),ud.write(e,t.specification)},t}(Pa.AbstractSerialiser);aO.TopicAddRequestSerialiser=new cO;var pO={},lO=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(pO,"__esModule",{value:!0});var fO=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return lO(t,e),t.prototype.read=function(e){var t=ba.readByte(e);return new $T.TopicAddResponse(t)},t}(Pa.AbstractSerialiser);pO.TopicAddResponseSerialiser=new fO;var hO={};Object.defineProperty(hO,"__esModule",{value:!0}),function(e){e[e.REMOVE_TOPICS=0]="REMOVE_TOPICS"}(hO.Will||(hO.Will={}));var dO=function(e,t){this.path=e,this.will=t};hO.TopicWillParameters=dO;var yO={},vO=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(yO,"__esModule",{value:!0});var _O=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return vO(t,e),t.prototype.read=function(e){var t=ba.readString(e),r=tf.read(e,hO.Will);return new hO.TopicWillParameters(t,r)},t.prototype.write=function(e,t){ba.writeString(e,t.path),tf.write(e,t.will)},t}(Pa.AbstractSerialiser);yO.TopicWillParametersSerialiser=new _O;var SO={};Object.defineProperty(SO,"__esModule",{value:!0}),function(e){e[e.SUCCESS=0]="SUCCESS",e[e.GROUP_CONFLICT=1]="GROUP_CONFLICT",e[e.TOPIC_TREE_CONFLICT=2]="TOPIC_TREE_CONFLICT"}(SO.WillRegistrationResultEnum||(SO.WillRegistrationResultEnum={}));var EO=function(e){this.result=e};SO.WillRegistrationResult=EO;var mO={},wO=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(mO,"__esModule",{value:!0});var gO=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return wO(t,e),t.prototype.read=function(e){var t=tf.read(e,SO.WillRegistrationResultEnum);return new SO.WillRegistrationResult(t)},t.prototype.write=function(e,t){tf.write(e,t.result)},t}(Pa.AbstractSerialiser);mO.WillRegistrationResultSerialiser=new gO;var TO={};Object.defineProperty(TO,"__esModule",{value:!0}),TO.MISSING_TOPIC={id:50,request:tO.MissingTopicRequestSerialiser,response:Zl.BooleanSerialiser},TO.TOPIC_REMOVAL={id:83,request:oO.RemoveTopicSerialiser,response:JT.IntegerSerialiser},TO.TOPIC_ADD={id:112,request:aO.TopicAddRequestSerialiser,response:pO.TopicAddResponseSerialiser},TO.TOPIC_SCOPED_WILL_REGISTRATION={id:53,request:yO.TopicWillParametersSerialiser,response:mO.WillRegistrationResultSerialiser},TO.TOPIC_SCOPED_WILL_DEREGISTRATION={id:54,request:yO.TopicWillParametersSerialiser,response:od.NullSerialiser};var OO={};Object.defineProperty(OO,"__esModule",{value:!0});var IO=qa.create("Session.Topics"),bO=function(){function e(e){this.internal=e;var t=e.getServiceLocator();this.TOPIC_ADD_SERVICE=t.obtain(TO.TOPIC_ADD),this.TOPIC_REMOVAL=t.obtain(TO.TOPIC_REMOVAL),this.TOPIC_WILL_REGISTRATION=t.obtain(TO.TOPIC_SCOPED_WILL_REGISTRATION),this.TOPIC_WILL_DEREGISTRATION=t.obtain(TO.TOPIC_SCOPED_WILL_DEREGISTRATION);var r=e.getContext().TopicAddFailReasonEnum;this.errorReasonIdToAddFailReason={103:r.PERMISSIONS_FAILURE,110:r.CLUSTER_REPARTITION,9004:r.EXISTS_MISMATCH,9005:r.INVALID_NAME,9006:r.INVALID_DETAILS,9007:r.EXCEEDED_LICENSE_LIMIT,9008:r.INCOMPATIBLE_PARENT,9010:r.EXISTS_INCOMPATIBLE,9011:r.UNEXPECTED_ERROR},this.valueCache=new YT.ValueCache,e.getServiceRegistry().add(TO.MISSING_TOPIC,xS.create((function(e,t,r){r.respond(!0),e.getConversationSet().respondIfPresent(t.cid,{request:t,callback:r})})))}return e.prototype.isSupportedTopicType=function(e){var t=this.internal.getContext().TopicTypeEnum;return Object.keys(t).some((function(r){return t[r]===e}))},e.prototype.add=function(e,t){var r=this,n=this.internal.getContext().TopicSpecification;return new Promise((function(o,i){if(e){if(r.internal.checkConnected(i)){IO.debug("Adding topic",e);var s=r.isSupportedTopicType(t)?new n(t):t;if(!(s instanceof n))throw new Error("Invalid topic specification or type");r.TOPIC_ADD_SERVICE.send({path:e,specification:s},(function(t,n){t?i(r.errorReasonIdToAddFailReason[t.id]):(r.valueCache.put(e,void 0),o({topic:e,added:n.status===$T.TopicAddResponseStatus.OK}))}))}}else i({id:0,reason:"Path cannot be empty or null"})}))},e.prototype.remove=function(e){for(var t=this,r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];var o=arguments,i=this.internal.getContext().parseSelector;return new Promise((function(r,n){if(t.internal.checkConnected(n)){IO.debug("Removing topics",e);try{t.TOPIC_REMOVAL.send({selector:o.length>1?i(Array.prototype.slice.call(o)):i(e)},(function(t,o){t?(IO.debug("Topic removal failed",e),n(t)):(IO.debug("Topic removal complete",e),r({removedCount:o}))}))}catch(t){IO.debug("Error parsing selector",e),n(t)}}}))},e.prototype.removeWithSession=function(e){var t=this;return new Promise((function(r,n){if(t.internal.checkConnected(n)){IO.debug("Registering removeWithSession",e);var o=new hO.TopicWillParameters(e,hO.Will.REMOVE_TOPICS);t.TOPIC_WILL_REGISTRATION.send(o,(function(i,s){if(df.responseSuccess(i,s))if(s.result===SO.WillRegistrationResultEnum.SUCCESS){IO.debug("removeWithSession registration complete",e);var a=!0;r({deregister:function(){return new Promise((function(r,n){a&&t.internal.checkConnected(n)&&(IO.debug("Deregistering removeWithSession",e),t.TOPIC_WILL_DEREGISTRATION.send(o,(function(t){t?n(t):(a=!1,r({topic:e}))})))}))}})}else IO.debug("removeWithSession registration failed",e),n(new Error("REGISTRATION_CONFLICT"));else IO.debug("removeWithSession registration failed",e),n(i)}))}}))},e.prototype.addMissingTopicHandler=function(e,t){var r=this;return new Promise((function(n,o){if(t){if(r.internal.checkConnected(o)){var i={active:function(r){IO.debug("Missing Topic Handler registered for "+e),t.onRegister(e,r),n()},respond:function(r){var n=r.callback;IO.debug("Missing Topic Handler notification for "+r.request.sessionID+" using "+r.request.selector);try{t.onMissingTopic({path:r.request.selector.prefix,selector:r.request.selector,sessionID:r.request.sessionID,proceed:function(){},cancel:function(){}})}catch(r){throw t.onError(e,r),n.fail(Xa.ErrorReason.CALLBACK_EXCEPTION,r&&r.message),r}return!1},close:function(r){IO.debug("Missing Topic Handler closed for "+e),r?t.onError(e,r):t.onClose(e)}},s={definition:TO.MISSING_TOPIC,group:fd.DEFAULT,path:e};n(_y.registerTopicHandler(r.internal,s,i))}}else o(new Error("Missing Topic handler is null or undefined"))}))},e}();OO.TopicControlImpl=bO;var RO={},CO=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(RO,"__esModule",{value:!0});var PO=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return CO(t,e),t.prototype.write=function(e,t){Ra.CIDSerialiser.write(e,t.cid)},t}(Pa.AbstractSerialiser);RO.TopicNotificationDeregistrationRequestSerialiser=new PO;var NO={};Object.defineProperty(NO,"__esModule",{value:!0}),function(e){e[e.ADDED=0]="ADDED",e[e.SELECTED=1]="SELECTED",e[e.REMOVED=2]="REMOVED",e[e.DESELECTED=3]="DESELECTED"}(NO.TopicNotificationType||(NO.TopicNotificationType={}));var AO={};Object.defineProperty(AO,"__esModule",{value:!0});var MO=function(e,t,r){this.cid=e,this.path=t,this.type=r,this.isDescendantEvent=!0};AO.TopicNotificationDescendantEvent=MO;var LO={},DO=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(LO,"__esModule",{value:!0});var jO=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return DO(t,e),t.prototype.read=function(e){var t=Ra.CIDSerialiser.read(e),r=ba.readString(e),n=tf.read(e,NO.TopicNotificationType);return new AO.TopicNotificationDescendantEvent(t,r,n)},t}(Pa.AbstractSerialiser);LO.TopicNotificationDescendantEventSerialiser=new jO;var xO={},UO=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(xO,"__esModule",{value:!0});var BO=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return UO(t,e),t.prototype.write=function(e,t){Ra.CIDSerialiser.write(e,t.cid),Ly.TopicSelectorSerialiser.write(e,t.selector)},t}(Pa.AbstractSerialiser);xO.TopicNotificationDeselectionSerialiser=new BO;var kO={};Object.defineProperty(kO,"__esModule",{value:!0});var qO=function(e,t,r,n){this.cid=e,this.path=t,this.type=r,this.specification=n,this.isDescendantEvent=!1};kO.TopicNotificationEvent=qO;var VO={},FO=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(VO,"__esModule",{value:!0});var GO=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return FO(t,e),t.prototype.read=function(e){var t=Ra.CIDSerialiser.read(e),r=ba.readString(e),n=tf.read(e,NO.TopicNotificationType),o=ud.read(e);return new kO.TopicNotificationEvent(t,r,n,o)},t}(Pa.AbstractSerialiser);VO.TopicNotificationEventSerialiser=new GO;var HO={},WO=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(HO,"__esModule",{value:!0});var YO=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return WO(t,e),t.prototype.write=function(e,t){Ra.CIDSerialiser.write(e,t.cid),Ly.TopicSelectorSerialiser.write(e,t.selector)},t}(Pa.AbstractSerialiser);HO.TopicNotificationSelectionSerialiser=new YO;var zO={};Object.defineProperty(zO,"__esModule",{value:!0}),zO.TOPIC_NOTIFICATION_DEREGISTRATION={id:91,request:RO.TopicNotificationDeregistrationRequestSerialiser,response:od.NullSerialiser},zO.TOPIC_NOTIFICATION_EVENTS={id:92,request:VO.TopicNotificationEventSerialiser,response:od.NullSerialiser},zO.TOPIC_DESCENDANT_EVENTS={id:93,request:LO.TopicNotificationDescendantEventSerialiser,response:od.NullSerialiser},zO.TOPIC_NOTIFICATION_SELECTION={id:94,request:HO.TopicNotificationSelectionSerialiser,response:od.NullSerialiser},zO.TOPIC_NOTIFICATION_DESELECTION={id:95,request:xO.TopicNotificationDeselectionSerialiser,response:od.NullSerialiser};var QO={},$O=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function s(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){e.done?o(e.value):new r((function(t){t(e.value)})).then(s,a)}u((n=n.apply(e,t||[])).next())}))},KO=this&&this.__generator||function(e,t){var r,n,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(QO,"__esModule",{value:!0});var JO=qa.create("Session.Notifications"),XO=function(){function e(e){this.TopicNotificationType=NO.TopicNotificationType,this.internal=e;var t=e.getServiceLocator();this.conversationSet=e.getConversationSet(),this.TOPIC_NOTIFICATION_SELECTION=t.obtain(zO.TOPIC_NOTIFICATION_SELECTION),this.TOPIC_NOTIFICATION_DESELECTION=t.obtain(zO.TOPIC_NOTIFICATION_DESELECTION),this.TOPIC_NOTIFICATION_DEREGISTRATION=t.obtain(zO.TOPIC_NOTIFICATION_DEREGISTRATION);var r=e.getServiceRegistry(),n=xS.create((function(e,t,r){r.respond(),e.getConversationSet().respond(t.cid,t)}));r.add(zO.TOPIC_NOTIFICATION_EVENTS,n),r.add(zO.TOPIC_DESCENDANT_EVENTS,n)}return e.prototype.addListener=function(e){var t=this,r=this.internal.getContext().parseSelector;return new Promise((function(n,o){return $O(t,void 0,void 0,(function(){var t,i,s=this;return KO(this,(function(a){switch(a.label){case 0:return e?this.internal.checkConnected(o)?(JO.debug("Adding Topic Notification Listener"),t={active:function(t,o){JO.debug("Topic Notification Listener active"),n({select:function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return new Promise((function(n,i){if(e)try{var a=t.length>0?r([e].concat(t)):r(e);s.TOPIC_NOTIFICATION_SELECTION.send({cid:o,selector:a},(function(e){e?(s.conversationSet.discard(o,e),i(e)):n()}))}catch(e){i(e)}else i(new Error("No topic selector provided"))}))},deselect:function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return new Promise((function(n,i){if(e)try{var a=t.length>0?r([e].concat(t)):r(e);s.TOPIC_NOTIFICATION_DESELECTION.send({cid:o,selector:a},(function(e){e?(s.conversationSet.discard(o,e),i(e)):n()}))}catch(e){i(e)}else i(new Error("No topic selector provided"))}))},close:function(){s.TOPIC_NOTIFICATION_DEREGISTRATION.send({cid:o},(function(t,r){t?(s.conversationSet.discard(o,t),JO.debug("Error with topic notification deregistration: ",t)):(e.onClose(),s.conversationSet.respondIfPresent(o,r))}))}})},respond:function(t){return t.isDescendantEvent?e.onDescendantNotification(t.path,t.type):e.onTopicNotification(t.path,t.specification,t.type),!1},close:function(t){JO.debug("Topic Notification Listener closed"),t?e.onError(t):e.onClose()}},[4,this.conversationSet.newConversation(_y.responseHandler(this.internal,t,(function(e,t){s.TOPIC_NOTIFICATION_DEREGISTRATION.send({cid:e},t)})))]):[3,2]:(o(new Error("Topic Notification Listener is null or undefined")),[2]);case 1:i=a.sent(),_y.registrationCallback(this.conversationSet,i,(function(){}),(function(){}))(void 0),a.label=2;case 2:return[2]}}))}))}))},e}();QO.TopicNotificationsImpl=XO;var ZO={},eI=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(ZO,"__esModule",{value:!0}),function(e){e[e.UNCONSTRAINED=0]="UNCONSTRAINED",e[e.CONJUNCTION=1]="CONJUNCTION",e[e.BINARY_VALUE=2]="BINARY_VALUE",e[e.NO_VALUE=3]="NO_VALUE",e[e.LOCKED=4]="LOCKED",e[e.NO_TOPIC=5]="NO_TOPIC",e[e.PARTIAL_JSON=6]="PARTIAL_JSON"}(ZO.ConstraintType||(ZO.ConstraintType={}));var tI=function(){function e(){}return e.prototype.and=function(e){if(!Array.isArray(e)&&"CONJUNCTION"===e.getConstraintType())return e.and(this);var t=Array.isArray(e)?e.concat(this):[this,e];return cI(t),new nI(t)},e}(),rI=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return eI(t,e),t.prototype.getConstraintType=function(){return"UNCONSTRAINED"},t}(tI);ZO.Unconstrained=rI;var nI=function(){function e(e){cI(e),this.constraints=e}return e.prototype.and=function(t){if(!Array.isArray(t)&&"CONJUNCTION"===t.getConstraintType())return t.and(this.constraints);var r=this.constraints.concat(t);return cI(r),new e(r)},e.prototype.getConstraints=function(){return this.constraints.slice()},e.prototype.getConstraintType=function(){return"CONJUNCTION"},e}(),oI=function(e){function t(t){var r=e.call(this)||this;return r.bytes=t,r}return eI(t,e),t.prototype.getBytes=function(){return this.bytes},t.prototype.getConstraintType=function(){return"BINARY_VALUE"},t}(tI);ZO.BinaryValue=oI;var iI=function(e){function t(t){var r=e.call(this)||this;return r.lock=t,r.lockName=t.getName(),r.sequence=t.getSequence(),r}return eI(t,e),t.prototype.getLockName=function(){return this.lockName},t.prototype.getSequence=function(){return this.sequence},t.prototype.getConstraintType=function(){return"LOCKED"},t}(tI);ZO.Locked=iI;var sI=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return eI(t,e),t.prototype.getConstraintType=function(){return"NO_TOPIC"},t}(tI);ZO.NoTopic=sI;var aI=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return eI(t,e),t.prototype.getConstraintType=function(){return"NO_VALUE"},t}(tI);ZO.NoValue=aI;var uI=function(e){function t(t,r){void 0===t&&(t={}),void 0===r&&(r=new Set);var n=e.call(this)||this;return n.withValues=t,n.withoutValues=r,n}return eI(t,e),t.prototype.getWithValues=function(){return Object.assign({},this.withValues)},t.prototype.getWithoutValues=function(){return new Set(this.withoutValues)},t.prototype.with=function(e,r,n){var o=void 0!==n?n:al.DataTypes.getByValue(r);if(void 0===o)throw new Error("Datatype invalid or could not be inferred");gc.requireNonNull(r,"value"),yc.JSONPointer.parse(gc.requireNonNull(e,"pointer"));var i={};return i[e.toString()]=o.toBytes(r),new t(Object.assign({},this.withValues,i),this.withoutValues)},t.prototype.without=function(e){yc.JSONPointer.parse(gc.requireNonNull(e,"pointer"));var r=new Set(this.withoutValues);return r.add(e.toString()),new t(this.withValues,r)},t.prototype.getConstraintType=function(){return"PARTIAL_JSON"},t}(tI);function cI(e){var t;e.forEach((function(e){if(function(e){switch(e.getConstraintType()){case"BINARY_VALUE":case"NO_VALUE":case"NO_TOPIC":case"PARTIAL_JSON":return!0;default:return!1}}(e)){if(void 0!==t)throw new Error("Multiple value constraints found: "+t+" and "+e);t=e}}))}ZO.PartialJSONImpl=uI;var pI={};Object.defineProperty(pI,"__esModule",{value:!0}),pI.write=function(e,t){ba.writeBytes(e,t.getBytes().asBuffer())};var lI={};Object.defineProperty(lI,"__esModule",{value:!0}),lI.write=function(e,t,r){ba.writeCollection(e,t.getConstraints(),r)};var fI={};Object.defineProperty(fI,"__esModule",{value:!0}),fI.write=function(e,t){ba.writeString(e,t.getLockName()),ba.writeInt64(e,t.getSequence())};var hI={};Object.defineProperty(hI,"__esModule",{value:!0}),hI.write=function(){};var dI={};Object.defineProperty(dI,"__esModule",{value:!0}),dI.write=function(){};var yI={};Object.defineProperty(yI,"__esModule",{value:!0}),yI.write=function(e,t){ba.writeObject(e,t.getWithValues(),ba.writeString,(function(e,t){ba.writeBytes(e,t.asBuffer())})),ba.writeCollection(e,Array.from(t.getWithoutValues()),ba.writeString)};var vI={};Object.defineProperty(vI,"__esModule",{value:!0}),vI.write=function(){};var _I={};Object.defineProperty(_I,"__esModule",{value:!0});var SI={UNCONSTRAINED:vI,CONJUNCTION:lI,BINARY_VALUE:pI,NO_VALUE:dI,LOCKED:fI,NO_TOPIC:hI,PARTIAL_JSON:yI};_I.write=function e(t,r){if(void 0===r.getConstraintType||void 0===ZO.ConstraintType[r.getConstraintType()])throw new Error("Unknown constraint type");ba.writeByte(t,ZO.ConstraintType[r.getConstraintType()]),SI[r.getConstraintType()].write(t,r,e)};var EI={},mI=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(EI,"__esModule",{value:!0});var wI=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return mI(t,e),t.prototype.write=function(e,t){ba.writeString(e,t.path),ud.write(e,t.topicSpecification),ba.writeBytes(e,t.value),_I.write(e,t.constraint)},t}(Pa.AbstractSerialiser);EI.AddAndSetTopicRequestSerialiser=new wI;var gI,TI={};Object.defineProperty(TI,"__esModule",{value:!0}),function(e){e[e.CREATED=1]="CREATED",e[e.EXISTS=2]="EXISTS"}(gI=TI.TopicCreationResult||(TI.TopicCreationResult={})),TI.TopicUpdateNamespace={TopicCreationResult:gI};var OI={};Object.defineProperty(OI,"__esModule",{value:!0});var II=function(e){this.result=e};OI.AddTopicResult=II;var bI,RI={},CI=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(RI,"__esModule",{value:!0}),function(e){e[e.CREATED=0]="CREATED",e[e.EXISTS=1]="EXISTS"}(bI||(bI={}));var PI=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return CI(t,e),t.prototype.read=function(e){var t=tf.read(e,bI)===bI.CREATED?TI.TopicCreationResult.CREATED:TI.TopicCreationResult.EXISTS;return new OI.AddTopicResult(t)},t}(Pa.AbstractSerialiser);RI.AddTopicResultSerialiser=new PI;var NI={},AI=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(NI,"__esModule",{value:!0});var MI=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return AI(t,e),t.prototype.write=function(e,t){ba.writeString(e,t.path),ba.writeString(e,t.patch),_I.write(e,t.constraint)},t}(Pa.AbstractSerialiser);NI.ApplyJsonPatchRequestSerialiser=new MI;var LI={},DI=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(LI,"__esModule",{value:!0});var jI=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return DI(t,e),t.prototype.write=function(e,t){ba.writeString(e,t.path),tf.write(e,t.topicType),ba.writeBytes(e,t.value),_I.write(e,t.constraint)},t}(Pa.AbstractSerialiser);LI.CreateUpdateStreamAndSetRequestSerialiser=new jI;var xI={},UI=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(xI,"__esModule",{value:!0});var BI=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return UI(t,e),t.prototype.write=function(e,t){ba.writeString(e,t.path),tf.write(e,t.topicType),_I.write(e,t.constraint)},t}(Pa.AbstractSerialiser);xI.CreateUpdateStreamRequestSerialiser=new BI;var kI={};Object.defineProperty(kI,"__esModule",{value:!0});var qI=function(e,t,r){this.streamId=e,this.retainsValue=t,this.supportsConflation=r};kI.CreateUpdateStreamResponse=qI;var VI={};Object.defineProperty(VI,"__esModule",{value:!0});var FI=function(e,t,r,n,o){this.topicId=e,this.instanceId=t,this.clustered=r,this.partitionId=n,this.generationId=o};VI.UpdateStreamId=FI;var GI={},HI=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(GI,"__esModule",{value:!0});var WI=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return HI(t,e),t.prototype.read=function(e){var t=ba.readInt32(e),r=ba.readInt32(e),n=ba.readInt32(e),o=ba.readInt32(e),i=0!==n;return new VI.UpdateStreamId(t,r,i,i?n-1:0,i?o:0)},t.prototype.write=function(e,t){ba.writeInt32(e,t.topicId),ba.writeInt32(e,t.instanceId),t.clustered?(ba.writeInt32(e,t.partitionId+1),ba.writeInt32(e,t.generationId)):(ba.writeInt32(e,0),ba.writeInt32(e,0))},t}(Pa.AbstractSerialiser);GI.UpdateStreamIdSerialiser=new WI;var YI={},zI=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(YI,"__esModule",{value:!0});var QI=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return zI(t,e),t.prototype.read=function(e){var t=GI.UpdateStreamIdSerialiser.read(e),r=ba.readByte(e),n=(1&r)>0,o=(2&r)>0;return new kI.CreateUpdateStreamResponse(t,n,o)},t}(Pa.AbstractSerialiser);YI.CreateUpdateStreamResponseSerialiser=new QI;var $I={};Object.defineProperty($I,"__esModule",{value:!0});var KI=function(e){this.failedOperation=e<0?void 0:e};$I.JsonPatchResult=KI;var JI={},XI=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(JI,"__esModule",{value:!0});var ZI=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return XI(t,e),t.prototype.read=function(e){var t=ba.readInt32(e);return new $I.JsonPatchResult(t)},t}(Pa.AbstractSerialiser);JI.JsonPatchResultSerialiser=new ZI;var eb={},tb=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(eb,"__esModule",{value:!0});var rb=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return tb(t,e),t.prototype.write=function(e,t){ba.writeString(e,t.path),tf.write(e,t.topicType),ba.writeBytes(e,t.value),_I.write(e,t.constraint)},t}(Pa.AbstractSerialiser);eb.SetTopicRequestSerialiser=new rb;var nb={},ob=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(nb,"__esModule",{value:!0});var ib=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ob(t,e),t.prototype.write=function(e,t){ba.writeString(e,t.path),ud.write(e,t.topicSpecification),_I.write(e,t.constraint)},t}(Pa.AbstractSerialiser);nb.UpdateStreamAddTopicRequestSerialiser=new ib;var sb={};Object.defineProperty(sb,"__esModule",{value:!0});var ab=function(e,t,r,n){this.creationResult=e,this.streamId=t,this.retainsValue=r,this.supportsConflation=n};sb.UpdateStreamAddTopicResponse=ab;var ub={},cb=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(ub,"__esModule",{value:!0});var pb=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return cb(t,e),t.prototype.read=function(e){var t=RI.AddTopicResultSerialiser.read(e),r=GI.UpdateStreamIdSerialiser.read(e),n=ba.readByte(e),o=(1&n)>0,i=(2&n)>0;return new sb.UpdateStreamAddTopicResponse(t.result,r,o,i)},t}(Pa.AbstractSerialiser);ub.UpdateStreamAddTopicResponseSerialiser=new pb;var lb={},fb=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(lb,"__esModule",{value:!0});var hb=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return fb(t,e),t.prototype.write=function(e,t){GI.UpdateStreamIdSerialiser.write(e,t.streamId),ba.writeBytes(e,t.update)},t}(Pa.AbstractSerialiser);lb.UpdateStreamRequestSerialiser=new hb;var db={};Object.defineProperty(db,"__esModule",{value:!0}),db.SET_TOPIC={id:118,request:eb.SetTopicRequestSerialiser,response:od.NullSerialiser},db.ADD_AND_SET_TOPIC={id:122,request:EI.AddAndSetTopicRequestSerialiser,response:RI.AddTopicResultSerialiser},db.APPLY_JSON_PATCH={id:151,request:NI.ApplyJsonPatchRequestSerialiser,response:JI.JsonPatchResultSerialiser},db.CREATE_UPDATE_STREAM={id:125,request:xI.CreateUpdateStreamRequestSerialiser,response:YI.CreateUpdateStreamResponseSerialiser},db.CREATE_UPDATE_STREAM_AND_SET={id:126,request:LI.CreateUpdateStreamAndSetRequestSerialiser,response:YI.CreateUpdateStreamResponseSerialiser},db.CHECK_UPDATE_STREAM={id:127,request:GI.UpdateStreamIdSerialiser,response:od.NullSerialiser},db.STREAM_SET_TOPIC_SERVICE={id:128,request:lb.UpdateStreamRequestSerialiser,response:od.NullSerialiser},db.STREAM_APPLY_DELTA_SERVICE={id:129,request:lb.UpdateStreamRequestSerialiser,response:od.NullSerialiser},db.STREAM_ADD_TOPIC_SERVICE={id:130,request:nb.UpdateStreamAddTopicRequestSerialiser,response:ub.UpdateStreamAddTopicResponseSerialiser},db.STREAM_ADD_AND_SET_TOPIC_SERVICE={id:131,request:EI.AddAndSetTopicRequestSerialiser,response:ub.UpdateStreamAddTopicResponseSerialiser};var yb={};Object.defineProperty(yb,"__esModule",{value:!0});var vb=function(e,t,r,n){this.path=e,this.topicSpecification=t,this.value=r,this.constraint=n};yb.AddAndSetTopicRequest=vb;var _b={};Object.defineProperty(_b,"__esModule",{value:!0});var Sb=function(e,t,r){this.path=e,this.topicSpecification=t,this.constraint=r};_b.UpdateStreamAddTopicRequest=Sb;var Eb={};Object.defineProperty(Eb,"__esModule",{value:!0});var mb=function(e,t){this.streamId=e,this.update=t};Eb.UpdateStreamRequest=mb;var wb={};Object.defineProperty(wb,"__esModule",{value:!0});var gb=function(){function e(e,t){this.value=t,this.err=e}return e.prototype.set=function(){return Promise.reject(this.err)},e.prototype.get=function(){return this.value},e.prototype.validate=function(){return Promise.reject(this.err)},e.prototype.onSetComplete=function(){},e.prototype.onSetFailed=function(){},e.prototype.onValidateComplete=function(){},e.prototype.onValidateFailed=function(){},e}();wb.InvalidSetStream=gb;var Tb={};Object.defineProperty(Tb,"__esModule",{value:!0});var Ob=qa.create("diffusion.TopicUpdate"),Ib=function(){function e(e,t,r,n,o){this.streamServices=e,this.options=t,this.stream=r,this.streamId=n,this.cache=o}return e.prototype.set=function(e){var t=this;return this.options.checkOperation(e),new Promise((function(r,n){var o=t.options.toBuffer(t.cache,e);t.cache=e,t.options.deltaService.send(new Eb.UpdateStreamRequest(t.streamId,o),(function(e){e?(Ob.debug("Set update stream failed"),t.stream.onSetFailed(e),n(e)):(t.stream.onSetComplete(t.streamId,t.options.retainsValue,t.options.supportsConflation),r())}))}))},e.prototype.get=function(){return this.cache},e.prototype.validate=function(){var e=this;return new Promise((function(t,r){e.streamServices.CHECK_UPDATE_STREAM.send(e.streamId,(function(n){n?(Ob.debug("Validate update stream failed"),e.stream.onValidateFailed(n),r(n)):(e.stream.onValidateComplete(e.streamId,e.options.retainsValue,e.options.supportsConflation),t(TI.TopicCreationResult.EXISTS))}))}))},e.prototype.onSetComplete=function(){},e.prototype.onSetFailed=function(e){this.stream.setDelegate(new wb.InvalidSetStream(e,this.cache))},e.prototype.onValidateComplete=function(){},e.prototype.onValidateFailed=function(e){this.stream.setDelegate(new wb.InvalidSetStream(e,this.cache))},e}();Tb.SetStream=Ib;var bb={};(function(e){"use strict";Object.defineProperty(bb,"__esModule",{value:!0});var t=function(){function t(e,t,r,n,o){this.streamServices=e,this.options=t,this.stream=r,this.pendingResult=n,this.deferredResolvers=[],this.value=o,this.nextValue=o}return t.prototype.set=function(e){var t=this;return this.options.checkOperation(e),this.nextValue=e,new Promise((function(r,n){t.deferredResolvers.push({value:e,resolve:r,reject:n})}))},t.prototype.get=function(){return this.nextValue},t.prototype.validate=function(){var e=this;return new Promise((function(t,r){e.pendingResult.then((function(e){return t(TI.TopicCreationResult.EXISTS),e}),(function(e){r(e)}))}))},t.prototype.onSetComplete=function(e,t,r){var n=this;this.options.retainsValue=t,this.options.supportsConflation=r,t||(this.options.toBuffer=function(e,t){return n.options.dataType.toBytes(t).asBuffer()},this.options.deltaService=this.streamServices.STREAM_SET_TOPIC_SERVICE),this.stream.setDelegate(new Tb.SetStream(this.streamServices,this.options,this.stream,e,this.nextValue)),t&&r?this.processPendingUpdatesRetainsValue(e):this.processPendingUpdatesDoesntRetainValue(e)},t.prototype.processPendingUpdatesRetainsValue=function(t){var r=this,n=this.options.dataType.toBytes(this.value).asBuffer(),o=this.options.dataType.toBytes(this.nextValue).asBuffer();if(0!==e.compare(n,o)){var i=this.options.toBuffer(this.value,this.nextValue);this.options.deltaService.send(new Eb.UpdateStreamRequest(t,i),(function(e){e?r.deferredResolvers.forEach((function(t){t.reject(e)})):r.deferredResolvers.forEach((function(e){e.resolve()}))}))}else this.deferredResolvers.forEach((function(e){e.resolve()}))},t.prototype.processPendingUpdatesDoesntRetainValue=function(e){var t=this,r=this.value;this.deferredResolvers.forEach((function(n){var o=t.options.toBuffer(r,n.value);r=n.value,t.options.deltaService.send(new Eb.UpdateStreamRequest(e,o),(function(e){e?n.reject(e):n.resolve()}))}))},t.prototype.onSetFailed=function(e){this.stream.setDelegate(new wb.InvalidSetStream(e,this.nextValue)),this.deferredResolvers.forEach((function(t){t.reject(e)}))},t.prototype.onValidateComplete=function(){throw new Error("No validate request has been sent")},t.prototype.onValidateFailed=function(){throw new Error("No validate request has been sent")},t}();bb.PendingSetStream=t}).call(this,a({}).Buffer);var Rb={};Object.defineProperty(Rb,"__esModule",{value:!0});var Cb=function(){function e(e){this.err=e}return e.prototype.set=function(){return Promise.reject(this.err)},e.prototype.get=function(){throw new Error("No value has been set")},e.prototype.validate=function(){return Promise.reject(this.err)},e.prototype.onSetComplete=function(){},e.prototype.onSetFailed=function(){},e.prototype.onValidateComplete=function(){},e.prototype.onValidateFailed=function(){},e}();Rb.InvalidUnsetStream=Cb;var Pb={};Object.defineProperty(Pb,"__esModule",{value:!0});var Nb=function(){function e(e,t,r,n,o,i){this.streamServices=e,this.options=t,this.stream=r,this.pendingResult=n,this.deferredResolvers=[o],this.nextValue=i}return e.prototype.set=function(e){var t=this;return this.options.checkOperation(e),this.nextValue=e,new Promise((function(r,n){t.deferredResolvers.push({value:e,resolve:r,reject:n})}))},e.prototype.get=function(){return this.nextValue},e.prototype.validate=function(){var e=this;return new Promise((function(t,r){e.pendingResult.then((function(e){return t(TI.TopicCreationResult.EXISTS),e}),(function(e){r(e)}))}))},e.prototype.onSetComplete=function(){throw new Error("No set request has been sent")},e.prototype.onSetFailed=function(){throw new Error("No set request has been sent")},e.prototype.onValidateComplete=function(e,t,r){var n=this;this.options.retainsValue=t,this.options.supportsConflation=r,t||(this.options.toBuffer=function(e,t){return n.options.dataType.toBytes(t).asBuffer()},this.options.deltaService=this.streamServices.STREAM_SET_TOPIC_SERVICE),this.stream.setDelegate(new Tb.SetStream(this.streamServices,this.options,this.stream,e,this.nextValue)),t&&r?this.processPendingUpdatesRetainsValue(e):this.processPendingUpdatesDoesntRetainValue(e)},e.prototype.processPendingUpdatesRetainsValue=function(e){var t=this,r=this.options.dataType.toBytes(this.nextValue).asBuffer();this.streamServices.STREAM_SET_TOPIC_SERVICE.send(new Eb.UpdateStreamRequest(e,r),(function(e){e?t.deferredResolvers.forEach((function(t){t.reject(e)})):t.deferredResolvers.forEach((function(e){e.resolve()}))}))},e.prototype.processPendingUpdatesDoesntRetainValue=function(e){var t=this;this.deferredResolvers.forEach((function(r){var n=t.options.dataType.toBytes(r.value).asBuffer();t.streamServices.STREAM_SET_TOPIC_SERVICE.send(new Eb.UpdateStreamRequest(e,n),(function(e){e?r.reject(e):r.resolve()}))}))},e.prototype.onValidateFailed=function(e){this.stream.setDelegate(new wb.InvalidSetStream(e,this.nextValue)),this.deferredResolvers.forEach((function(t){t.reject(e)}))},e}();Pb.PendingValidateAndSetStream=Nb;var Ab={};Object.defineProperty(Ab,"__esModule",{value:!0});var Mb=qa.create("diffusion.TopicUpdate"),Lb=function(){function e(e,t,r,n){this.streamServices=e,this.options=t,this.stream=r,this.streamId=n}return e.prototype.set=function(e){var t=this;return this.options.checkOperation(e),new Promise((function(r,n){t.stream.setDelegate(new Tb.SetStream(t.streamServices,t.options,t.stream,t.streamId,e));var o=t.options.dataType.toBytes(e).asBuffer();t.streamServices.STREAM_SET_TOPIC_SERVICE.send(new Eb.UpdateStreamRequest(t.streamId,o),(function(e){e?(Mb.debug("Stream set topic failed"),t.stream.onSetFailed(e),n(e)):(t.stream.onSetComplete(t.streamId,t.options.retainsValue,t.options.supportsConflation),r())}))}))},e.prototype.get=function(){throw new Error("The set method has not been called")},e.prototype.validate=function(){var e=this;return new Promise((function(t,r){e.streamServices.CHECK_UPDATE_STREAM.send(e.streamId,(function(n){n?(Mb.debug("Validate update stream failed"),e.stream.onValidateFailed(n),r(n)):(e.stream.onValidateComplete(e.streamId,e.options.retainsValue,e.options.supportsConflation),t(TI.TopicCreationResult.EXISTS))}))}))},e.prototype.onSetComplete=function(){throw new Error("The set method has not been called")},e.prototype.onSetFailed=function(){throw new Error("The set method has not been called")},e.prototype.onValidateComplete=function(){},e.prototype.onValidateFailed=function(e){this.stream.setDelegate(new Rb.InvalidUnsetStream(e))},e}();Ab.ValidatedStream=Lb;var Db={};Object.defineProperty(Db,"__esModule",{value:!0});var jb=function(){function e(e,t,r,n){this.streamServices=e,this.options=t,this.stream=r,this.pendingResult=n}return e.prototype.set=function(e){var t=this;return this.options.checkOperation(e),new Promise((function(r,n){t.stream.setDelegate(new Pb.PendingValidateAndSetStream(t.streamServices,t.options,t.stream,t.pendingResult,{value:e,resolve:r,reject:n},e))}))},e.prototype.get=function(){throw new Error("The set method has not been called")},e.prototype.validate=function(){var e=this;return new Promise((function(t,r){e.pendingResult.then((function(e){return t(TI.TopicCreationResult.EXISTS),e}),(function(e){r(e)}))}))},e.prototype.onSetComplete=function(){throw new Error("No set request has been sent")},e.prototype.onSetFailed=function(){throw new Error("No set request has been sent")},e.prototype.onValidateComplete=function(e,t,r){var n=this;this.options.retainsValue=t,this.options.supportsConflation=r,t||(this.options.toBuffer=function(e,t){return n.options.dataType.toBytes(t).asBuffer()},this.options.deltaService=this.streamServices.STREAM_SET_TOPIC_SERVICE),this.stream.setDelegate(new Ab.ValidatedStream(this.streamServices,this.options,this.stream,e))},e.prototype.onValidateFailed=function(e){this.stream.setDelegate(new Rb.InvalidUnsetStream(e))},e}();Db.PendingValidateStream=jb;var xb={};Object.defineProperty(xb,"__esModule",{value:!0});var Ub=qa.create("diffusion.TopicUpdate"),Bb=function(){function e(e,t,r,n,o,i){this.streamServices=e,this.options=t,this.stream=r,this.path=n,this.specification=o,this.constraint=i}return e.prototype.set=function(e){var t=this;this.options.checkOperation(e);var r=new Promise((function(r,n){var o=t.options.dataType.toBytes(e).asBuffer();t.streamServices.STREAM_ADD_AND_SET_TOPIC_SERVICE.send(new yb.AddAndSetTopicRequest(t.path,t.specification,o,t.constraint),(function(e,o){df.responseSuccess(e,o)?(t.stream.onSetComplete(o.streamId,o.retainsValue,o.supportsConflation),r(o.creationResult)):(Ub.debug("Stream add and set topic failed"),t.stream.onSetFailed(e),n(e))}))}));return this.stream.setDelegate(new bb.PendingSetStream(this.streamServices,this.options,this.stream,r,e)),r},e.prototype.get=function(){throw new Error("The set method has not been called")},e.prototype.validate=function(){var e=this,t=new Promise((function(t,r){e.streamServices.STREAM_ADD_TOPIC_SERVICE.send(new _b.UpdateStreamAddTopicRequest(e.path,e.specification,e.constraint),(function(n,o){df.responseSuccess(n,o)?(e.stream.onValidateComplete(o.streamId,o.retainsValue,o.supportsConflation),t(o.creationResult)):(Ub.debug("Stream add topic failed"),e.stream.onValidateFailed(n),r(n))}))}));return this.stream.setDelegate(new Db.PendingValidateStream(this.streamServices,this.options,this.stream,t)),t},e.prototype.onSetComplete=function(){throw new Error("No set request has been sent")},e.prototype.onSetFailed=function(){throw new Error("No set request has been sent")},e.prototype.onValidateComplete=function(){throw new Error("No validate request has been sent")},e.prototype.onValidateFailed=function(){throw new Error("No validate request has been sent")},e}();xb.NewAddTopicAndUpdateStream=Bb;var kb={};Object.defineProperty(kb,"__esModule",{value:!0});var qb=function(e,t,r,n){this.path=e,this.topicType=t,this.value=r,this.constraint=n};kb.CreateUpdateStreamAndSetRequest=qb;var Vb={};Object.defineProperty(Vb,"__esModule",{value:!0});var Fb=function(e,t,r){this.path=e,this.topicType=t,this.constraint=r};Vb.CreateUpdateStreamRequest=Fb;var Gb={};Object.defineProperty(Gb,"__esModule",{value:!0});var Hb=qa.create("diffusion.TopicUpdate"),Wb=function(){function e(e,t,r,n,o,i){this.streamServices=e,this.options=t,this.stream=r,this.path=n,this.topicType=o,this.constraint=i}return e.prototype.set=function(e){var t=this;this.options.checkOperation(e);var r=new Promise((function(r,n){var o=t.options.dataType.toBytes(e).asBuffer();t.streamServices.CREATE_UPDATE_STREAM_AND_SET.send(new kb.CreateUpdateStreamAndSetRequest(t.path,t.topicType,o,t.constraint),(function(e,o){df.responseSuccess(e,o)?(t.stream.onSetComplete(o.streamId,o.retainsValue,o.supportsConflation),r(TI.TopicCreationResult.EXISTS)):(Hb.debug("Failed to create update stream and set"),t.stream.onSetFailed(e),n(e))}))}));return this.stream.setDelegate(new bb.PendingSetStream(this.streamServices,this.options,this.stream,r,e)),r},e.prototype.get=function(){throw new Error("The set method has not been called")},e.prototype.validate=function(){var e=this,t=new Promise((function(t,r){e.streamServices.CREATE_UPDATE_STREAM.send(new Vb.CreateUpdateStreamRequest(e.path,e.topicType,e.constraint),(function(n,o){df.responseSuccess(n,o)?(e.stream.onValidateComplete(o.streamId,o.retainsValue,o.supportsConflation),t(TI.TopicCreationResult.EXISTS)):(Hb.debug("Create update stream failed"),e.stream.onValidateFailed(n),r(n))}))}));return this.stream.setDelegate(new Db.PendingValidateStream(this.streamServices,this.options,this.stream,t)),t},e.prototype.onSetComplete=function(){throw new Error("No set request has been sent")},e.prototype.onSetFailed=function(){throw new Error("No set request has been sent")},e.prototype.onValidateComplete=function(){throw new Error("No validate request has been sent")},e.prototype.onValidateFailed=function(){throw new Error("No validate request has been sent")},e}();Gb.NewUpdateStream=Wb;var Yb={};Object.defineProperty(Yb,"__esModule",{value:!0});var zb=function(){function e(e){this.delegate=e(this)}return e.prototype.set=function(e){return this.delegate.set(e)},e.prototype.get=function(){return this.delegate.get()},e.prototype.validate=function(){return this.delegate.validate()},e.prototype.onSetComplete=function(e,t,r){this.delegate.onSetComplete(e,t,r)},e.prototype.onSetFailed=function(e){this.delegate.onSetFailed(e)},e.prototype.onValidateComplete=function(e,t,r){this.delegate.onValidateComplete(e,t,r)},e.prototype.onValidateFailed=function(e){this.delegate.onValidateFailed(e)},e.prototype.setDelegate=function(e){this.delegate=e},e}();Yb.UpdateStreamImpl=zb;var Qb={};Object.defineProperty(Qb,"__esModule",{value:!0});var $b=function(){function e(e,t){this.context=t,this.streamServices=e}return e.prototype.getValueCheckOperation=function(e){switch(e.name()){case"int64":case"double":case"string":return function(){};default:return function(e){gc.requireNonNull(e,"null can only be passed for int64, double or string topics")}}},e.prototype.getChangeService=function(e){return void 0===e?this.streamServices.STREAM_SET_TOPIC_SERVICE:this.streamServices.STREAM_APPLY_DELTA_SERVICE},e.prototype.getToBytesFunction=function(e,t){return void 0===t?function(t,r){return e.toBytes(r).asBuffer()}:function(e,r){var n=t.diff(e,r);return n.$buffer.slice(n.$offset,n.$offset+n.$length)}},e.prototype.binaryDeltaType=function(e){try{return e.binaryDeltaType()}catch(e){return}},e.prototype.createUpdateStream=function(e,t,r){var n=this,o=this.binaryDeltaType(t),i={dataType:t,retainsValue:!0,supportsConflation:!0,checkOperation:this.getValueCheckOperation(t),toBuffer:this.getToBytesFunction(t,o),deltaService:this.getChangeService(o)},s=lu.TopicTypeEnum[t.name().toUpperCase()];return new Yb.UpdateStreamImpl((function(t){return new Gb.NewUpdateStream(n.streamServices,i,t,e,s,r)}))},e.prototype.createUpdateStreamThatAddsTopic=function(e,t,r,n){var o=this;if(t.type===lu.TopicTypeEnum.TIME_SERIES){var i=t.properties.TIME_SERIES_EVENT_VALUE_TYPE;if(null==i)throw new Error("The specification for time-series topics requires an event type.");if(i.toLowerCase()!==r.name().toLowerCase())throw new Error("The time-series event and value have different data types.")}else if(r!==this.context.DataTypes.getByValue(t.type))throw new Error("The specification and value have different data types");var s=this.binaryDeltaType(r),a={dataType:r,retainsValue:!0,supportsConflation:!0,checkOperation:this.getValueCheckOperation(r),toBuffer:this.getToBytesFunction(r,s),deltaService:this.getChangeService(s)};return new Yb.UpdateStreamImpl((function(r){return new xb.NewAddTopicAndUpdateStream(o.streamServices,a,r,e,t,n)}))},e}();Qb.UpdateStreamFactory=$b;var Kb={};Object.defineProperty(Kb,"__esModule",{value:!0});var Jb=qa.create("Session.TopicUpdate"),Xb=new ZO.Unconstrained,Zb=function(){function e(e){this.internal=e;var t=e.getServiceLocator();this.SET_TOPIC=t.obtain(db.SET_TOPIC),this.ADD_AND_SET_TOPIC=t.obtain(db.ADD_AND_SET_TOPIC),this.APPLY_JSON_PATCH=t.obtain(db.APPLY_JSON_PATCH);var r={CREATE_UPDATE_STREAM:t.obtain(db.CREATE_UPDATE_STREAM),CREATE_UPDATE_STREAM_AND_SET:t.obtain(db.CREATE_UPDATE_STREAM_AND_SET),CHECK_UPDATE_STREAM:t.obtain(db.CHECK_UPDATE_STREAM),STREAM_SET_TOPIC_SERVICE:t.obtain(db.STREAM_SET_TOPIC_SERVICE),STREAM_APPLY_DELTA_SERVICE:t.obtain(db.STREAM_APPLY_DELTA_SERVICE),STREAM_ADD_TOPIC_SERVICE:t.obtain(db.STREAM_ADD_TOPIC_SERVICE),STREAM_ADD_AND_SET_TOPIC_SERVICE:t.obtain(db.STREAM_ADD_AND_SET_TOPIC_SERVICE)};this.updateStreamFactory=new Qb.UpdateStreamFactory(r,e.getContext())}return e.prototype.setTopic=function(e,t,r,n){var o=this;return new Promise((function(i,s){var a=o.internal.getContext().TopicTypeEnum;o.SET_TOPIC.send({path:e,topicType:a[t.name().toUpperCase()],value:t.toBytes(r).asBuffer(),constraint:n},(function(e){e?(Jb.debug("Set topic failed"),s(e)):i()}))}))},e.prototype.addAndSetTopic=function(e,t,r,n,o){var i=this,s=this.internal.getContext().TopicTypeEnum;if(t.type!==s[r.name().toUpperCase()]&&t.type!==s.TIME_SERIES)throw new Error("The specification and value have different data types");var a=r.toBytes(n).asBuffer();return new Promise((function(r,n){i.ADD_AND_SET_TOPIC.send({path:e,topicSpecification:t,value:a,constraint:o},(function(e,t){e?(Jb.debug("Add and set topic failed"),n(e)):r(t.result)}))}))},e.prototype.set=function(e,t,r,n){var o=void 0!==n&&void 0!==n.constraint?n.constraint:Xb;return void 0!==n&&void 0!==n.specification?this.addAndSetTopic(e,n.specification,t,r,o):this.setTopic(e,t,r,o)},e.prototype.createUpdateStream=function(e,t,r){var n=void 0!==r&&void 0!==r.constraint?r.constraint:Xb;return void 0!==r&&void 0!==r.specification?this.updateStreamFactory.createUpdateStreamThatAddsTopic(e,r.specification,t,n):this.updateStreamFactory.createUpdateStream(e,t,n)},e.prototype.applyJsonPatch=function(e,t,r){var n=this;return new Promise((function(o,i){n.APPLY_JSON_PATCH.send({path:e,patch:"string"==typeof t?t:JSON.stringify(t),constraint:r||Xb},(function(e,t){e?(Jb.debug("Apply JSON patch failed"),i(e)):o(t)}))}))},e}();Kb.TopicUpdateImpl=Zb;var eR={};Object.defineProperty(eR,"__esModule",{value:!0});var tR=function(e,t){this.view=e,this.errors=t};eR.CreateTopicViewResult=tR;var rR={};Object.defineProperty(rR,"__esModule",{value:!0}),rR.readTopicView=function(e){return{name:ba.readString(e),specification:ba.readString(e),roles:new Set(ba.readCollection(e,ba.readString))}};var nR={},oR=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(nR,"__esModule",{value:!0});var iR=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return oR(t,e),t.prototype.read=function(e){if(0===e.peek()){ba.readByte(e);var t=rR.readTopicView(e);return new eR.CreateTopicViewResult(t)}var r=p_.ErrorReportListSerialiser.read(e);return new eR.CreateTopicViewResult(void 0,r)},t}(Pa.AbstractSerialiser);nR.CreateTopicViewResultSerialiser=new iR;var sR={};Object.defineProperty(sR,"__esModule",{value:!0});var aR=function(e){this.result=e};sR.ListTopicViewsResult=aR;var uR={},cR=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(uR,"__esModule",{value:!0});var pR=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return cR(t,e),t.prototype.read=function(e){var t=ba.readCollection(e,rR.readTopicView);return new sR.ListTopicViewsResult(t)},t}(Pa.AbstractSerialiser);uR.ListTopicViewsResultSerialiser=new pR;var lR={},fR=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(lR,"__esModule",{value:!0});var hR=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return fR(t,e),t.prototype.write=function(e,t){ba.writeString(e,t.name),ba.writeString(e,t.specification)},t}(Pa.AbstractSerialiser);lR.NamedTopicViewSpecificationSerialiser=new hR;var dR={};Object.defineProperty(dR,"__esModule",{value:!0}),dR.CREATE_TOPIC_VIEW={id:138,request:lR.NamedTopicViewSpecificationSerialiser,response:nR.CreateTopicViewResultSerialiser},dR.REMOVE_TOPIC_VIEW={id:139,request:Ay.StringSerialiser,response:od.NullSerialiser},dR.LIST_TOPIC_VIEWS={id:141,request:od.NullSerialiser,response:uR.ListTopicViewsResultSerialiser};var yR={};Object.defineProperty(yR,"__esModule",{value:!0});var vR=function(e,t){this.name=e,this.specification=t};yR.NamedTopicViewSpecification=vR;var _R={};Object.defineProperty(_R,"__esModule",{value:!0});var SR=qa.create("TopicViews"),ER=function(){function e(e){this.internal=e;var t=e.getServiceLocator();this.CREATE_TOPIC_VIEW=t.obtain(dR.CREATE_TOPIC_VIEW),this.LIST_TOPIC_VIEWS=t.obtain(dR.LIST_TOPIC_VIEWS),this.REMOVE_TOPIC_VIEW=t.obtain(dR.REMOVE_TOPIC_VIEW)}return e.prototype.createTopicView=function(e,t){var r=this;return new Promise((function(n,o){if(0===gc.requireNonNull(e,"name").length)throw new Error("Topic View name cannot be empty");if(r.internal.checkConnected(o)){var i=new yR.NamedTopicViewSpecification(e,gc.requireNonNull(t,"specification"));r.CREATE_TOPIC_VIEW.send(i,(function(e,t){df.responseSuccess(e,t)?t.errors?(o(t.errors.errors),SR.debug("Create topic view failed")):n(t.view):(o(e),SR.debug("Create topic view failed"))}))}}))},e.prototype.listTopicViews=function(){var e=this;return new Promise((function(t,r){e.internal.checkConnected(r)&&e.LIST_TOPIC_VIEWS.send(null,(function(e,n){df.responseSuccess(e,n)?t(n.result):(r(e),SR.debug("List topic views failed"))}))}))},e.prototype.removeTopicView=function(e){var t=this;return new Promise((function(r,n){t.internal.checkConnected(n)&&t.REMOVE_TOPIC_VIEW.send(gc.requireNonNull(e,"name"),(function(e){e?(n(e),SR.debug("Remove topic view failed")):r()}))}))},e}();_R.TopicViewsImpl=ER;var mR={};Object.defineProperty(mR,"__esModule",{value:!0});var wR=function(){function e(e,t,r,n){this.mPath=e,this.mType=t,this.mValue=r,this.mProperties=n}return e.prototype.path=function(){return this.mPath},e.prototype.type=function(){return this.mType},e.prototype.value=function(){return this.mValue},e.prototype.specification=function(){return new uu.TopicSpecification(this.mType,this.mProperties)},e}();mR.TopicResultImpl=wR;var gR={};Object.defineProperty(gR,"__esModule",{value:!0}),gR.TIME_SERIES_DATA_TYPE=rl.TimeSeriesEventDataType.create({name:function(){return"event data type"},readValue:function(e){return e},toBytes:function(e){return e}});var TR=function(){function e(e,t,r){this.resultList=t.results.map((function(n){var o;if(void 0!==n.value)if(n.type===r.TopicTypeEnum.TIME_SERIES){var i=gR.TIME_SERIES_DATA_TYPE.readAs(gR.TIME_SERIES_DATA_TYPE.valueClass,n.value);o=e instanceof r.TimeSeriesEventDataType?i:e.readAs(e.valueClass,i.value)}else{o=r.DataTypes.get(n.type).readAs(e.valueClass,n.value)}return new mR.TopicResultImpl(n.path,n.type,o,0===t.properties.length?{}:t.properties[n.propertiesIndex])})),this.hasMoreFlag=t.hasMore}return e.prototype.results=function(){return this.resultList},e.prototype.hasMore=function(){return this.hasMoreFlag},e.prototype.size=function(){return this.resultList.length},e.prototype.isEmpty=function(){return 0===this.resultList.length},e}();gR.FetchResultImpl=TR;var OR={};Object.defineProperty(OR,"__esModule",{value:!0});var IR=function(e,t,r,n,o,i,s,a,u,c){this.selector=gc.requireNonNull(e,"FetchQuery.selector"),this.range=t,this.topicTypes=gc.requireNonNull(r,"FetchQuery.topicTypes"),this.withValues=n,this.withProperties=o,this.limit=i,this.maximumResultSize=s,this.deepBranchDepth=a,this.deepBranchLimit=u,this.withUnpublishedDelayedTopics=c};OR.FetchQuery=IR;var bR={};Object.defineProperty(bR,"__esModule",{value:!0});var RR=function(e,t,r,n){this.path=e,this.type=t,this.value=n,this.propertiesIndex=r};bR.FetchTopicResult=RR;var CR={};Object.defineProperty(CR,"__esModule",{value:!0});var PR=function(e,t,r){this.properties=e,this.results=t,this.hasMore=r};CR.FetchQueryResult=PR;var NR={},AR=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();function MR(e){return ba.readDictionary(e,ba.readString)}function LR(e){var t=ba.readString(e),r=tf.read(e,lu.TopicTypeEnum),n=0!==ba.readByte(e)?ba.readBytes(e):void 0,o=ba.readInt32(e);return new bR.FetchTopicResult(t,r,o,n)}Object.defineProperty(NR,"__esModule",{value:!0});var DR=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return AR(t,e),t.prototype.read=function(e){var t=ba.readCollection(e,MR),r=ba.readCollection(e,LR),n=ba.readBoolean(e);return new CR.FetchQueryResult(t,r,n)},t}(Pa.AbstractSerialiser);NR.FetchQueryResultSerialiser=new DR;var jR={};Object.defineProperty(jR,"__esModule",{value:!0}),jR.write=function(e,t){var r=Gs.UZERO,n={write:function(e){if(e>=64)throw new Error("Cannot encode enum in long, "+e+" >= 64'");r=r.or(Gs.ONE.shiftLeft(e))}};t.forEach((function(e){tf.write(n,e)})),ba.writeInt64(e,r)};var xR={},UR=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();function BR(e,t){void 0===t?ba.writeByte(e,0):(ba.writeByte(e,1),ba.writeString(e,t.path),ba.writeBoolean(e,t.includesPath))}Object.defineProperty(xR,"__esModule",{value:!0});var kR=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return UR(t,e),t.prototype.write=function(e,t){Ly.TopicSelectorSerialiser.write(e,t.selector),function(e,t){BR(e,t.from),BR(e,t.to)}(e,t.range),jR.write(e,t.topicTypes),ba.writeBoolean(e,t.withValues),ba.writeBoolean(e,t.withProperties),ba.writeInt32(e,t.limit),ba.writeInt32(e,t.maximumResultSize),ba.writeInt32(e,t.deepBranchDepth),ba.writeInt32(e,t.deepBranchLimit),ba.writeBoolean(e,t.withUnpublishedDelayedTopics)},t}(Pa.AbstractSerialiser);xR.FetchQuerySerialiser=new kR;var qR={};Object.defineProperty(qR,"__esModule",{value:!0}),qR.SUBSCRIBE={id:3,request:Ly.TopicSelectorSerialiser,response:od.NullSerialiser},qR.UNSUBSCRIBE={id:4,request:Ly.TopicSelectorSerialiser,response:od.NullSerialiser},qR.FETCH_QUERY={id:117,request:xR.FetchQuerySerialiser,response:NR.FetchQueryResultSerialiser};var VR={},FR=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(VR,"__esModule",{value:!0});var GR=qa.create("Fetch Request"),HR=function(e,t){this.path=e,this.includesPath=t},WR=function(){function e(e,t){this.from=e,this.to=t}return e.prototype.isUnbounded=function(){return void 0===this.from&&void 0===this.to},e}();function YR(e,t,r){if(t===lu.TopicTypeEnum.TIME_SERIES)return gR.TIME_SERIES_DATA_TYPE.canReadAs(r);var n=e.getByValue(t);return null!==n&&void 0!==r.valueClass&&n.canReadAs(r.valueClass)}function zR(e,t){if(!Number.isInteger(e)||e<0)throw new Error("Invalid argument "+t+": "+e);return e}var QR=function(e){function t(t,r){var n=e.call(this)||this,o={range:new WR,topicTypes:hu.FetchRequest.getAllTypes(),dataType:void 0,withProperties:!1,limit:Uu.MAX_INT32,maximumResultSize:t.getOptions().maxMessageSize,deepBranchDepth:Uu.MAX_INT32,deepBranchLimit:Uu.MAX_INT32,withUnpublishedDelayedTopics:!1};return n.internal=t,n.options=Object.assign(o,r),n}return FR(t,e),t.prototype.copyOptions=function(){return{range:new WR(this.options.range.from,this.options.range.to),topicTypes:new Set(this.options.topicTypes),dataType:this.options.dataType,withProperties:this.options.withProperties,limit:this.options.limit,maximumResultSize:this.options.maximumResultSize,deepBranchDepth:this.options.deepBranchDepth,deepBranchLimit:this.options.deepBranchLimit,withUnpublishedDelayedTopics:this.options.withUnpublishedDelayedTopics}},t.prototype.from=function(e){var r=new HR(e,!0);return new t(this.internal,Object.assign(this.copyOptions(),{range:new WR(r,this.options.range.to)}))},t.prototype.after=function(e){var r=new HR(e,!1);return new t(this.internal,Object.assign(this.copyOptions(),{range:new WR(r,this.options.range.to)}))},t.prototype.to=function(e){var r=new HR(e,!0);return new t(this.internal,Object.assign(this.copyOptions(),{range:new WR(this.options.range.from,r)}))},t.prototype.before=function(e){var r=new HR(e,!1);return new t(this.internal,Object.assign(this.copyOptions(),{range:new WR(this.options.range.from,r)}))},t.prototype.topicTypes=function(e){var r=this;if(Array.isArray(e)&&(e=new Set(e)),0===e.size)throw new Error("No types specified");var n=hu.FetchRequest.getAllTypes(),o=this.internal.getContext();return e.forEach((function(e){if(!n.has(e))throw new Error("Invalid topic type "+e.id);if(void 0!==r.options.dataType&&!YR(o.DataTypes,e,r.options.dataType)&&e!==o.TopicTypeEnum.TIME_SERIES)throw new Error("Topic type "+e.id+" cannot be read as "+r.options.dataType)})),new t(this.internal,Object.assign(this.copyOptions(),{topicTypes:e}))},t.prototype.withValues=function(e){var r,n=this;if(void 0===e||e instanceof wu.AnyDataTypeImpl)r=this.options.topicTypes;else if(r=new Set(this.options.topicTypes),this.options.topicTypes.forEach((function(t){YR(n.internal.getContext().DataTypes,t,e)||r.delete(t)})),0===r.size)throw new Error("No selected topic types can be read as "+e);return new t(this.internal,Object.assign(this.copyOptions(),{topicTypes:r,dataType:e}))},t.prototype.withProperties=function(){return new t(this.internal,Object.assign(this.copyOptions(),{withProperties:!0}))},t.prototype.first=function(e){return new t(this.internal,Object.assign(this.copyOptions(),{limit:zR(e,"count")}))},t.prototype.last=function(e){return new t(this.internal,Object.assign(this.copyOptions(),{limit:0-zR(e,"count")}))},t.prototype.maximumResultSize=function(e){return new t(this.internal,Object.assign(this.copyOptions(),{maximumResultSize:Math.min(zR(e,"maximumSize"),this.internal.getOptions().maxMessageSize)}))},t.prototype.limitDeepBranches=function(e,r){return new t(this.internal,Object.assign(this.copyOptions(),{deepBranchDepth:zR(e,"deepBranchDepth"),deepBranchLimit:zR(r,"deepBranchLimit")}))},t.prototype.withUnpublishedDelayedTopics=function(){return new t(this.internal,Object.assign(this.copyOptions(),{withUnpublishedDelayedTopics:!0}))},t.prototype.fetch=function(e){var t=this,r=this.internal.getContext().parseSelector,n=this.internal.getServiceLocator(),o=n.obtain(qR.FETCH_QUERY),i=r(arguments.length>1?Array.prototype.slice.call(arguments):e),s=new OR.FetchQuery(i,this.options.range,this.options.topicTypes,void 0!==this.options.dataType,this.options.withProperties,this.options.limit,this.options.maximumResultSize,this.options.deepBranchDepth,this.options.deepBranchLimit,this.options.withUnpublishedDelayedTopics);return new Promise((function(e,r){o.send(s,(function(n,o){if(df.responseSuccess(n,o)){var i=new gR.FetchResultImpl(t.options.dataType,o,t.internal.getContext());e(i)}else GR.debug("Fetch query failed"),r(n)}))}))},t}(hu.FetchRequest);VR.FetchRequestImpl=QR;var $R={},KR=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty($R,"__esModule",{value:!0});var JR=function(e){function t(t,r){var n=e.call(this,t)||this;return n.selector=r,n}return KR(t,e),t}($l.StreamImpl);$R.ValueStreamImpl=JR;var XR={},ZR=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(XR,"__esModule",{value:!0});var eC=function(){function e(e,t,r){this.stream=e,this.datatype=t,this.sourceDatatype=this.getSourceDataType(r)}return e.prototype.selects=function(e){return this.stream.selects(e)},e.prototype.onOpen=function(){return this.stream.onOpen()},e.prototype.onDelta=function(e,t,r,n,o,i,s){return this.stream.onDelta(e,t,r,n,o,null!==r?this.readAsDataType(r,i):null,this.readAsDataType(n,s))},e.prototype.onValue=function(e,t,r,n,o,i){return this.stream.onValue(e,t,r,n,null!==r?this.readAsDataType(r,o):null,this.readAsDataType(n,i))},e.prototype.onSubscription=function(e,t){return this.stream.onSubscription(e,t)},e.prototype.onUnsubscription=function(e,t,r){return this.stream.onUnsubscription(e,t,r)},e.prototype.onSubscriptionError=function(e){return this.stream.onSubscriptionError(e)},e}(),tC=function(e){function t(t,r,n){return e.call(this,t,r,n)||this}return ZR(t,e),t.prototype.getSourceDataType=function(e){return al.DataTypes.getByValue(e.type)},t.prototype.readAsDataType=function(e){return this.sourceDatatype.readAs(this.datatype.valueClass,e)},t}(eC);XR.ValueStreamAdapter=tC;var rC=function(e){function t(t,r,n){var o=e.call(this,t,r,n)||this;return o.sourceValuetype=al.DataTypes.getByName(o.sourceDatatype.valueTypeName),o.destValuetype=al.DataTypes.getByName(o.datatype.valueTypeName),o}return ZR(t,e),t.prototype.getSourceDataType=function(e){return al.DataTypes.timeseries(al.DataTypes.getByName(e.properties.TIME_SERIES_EVENT_VALUE_TYPE))},t.prototype.readAsDataType=function(e,t){var r=this.sourceValuetype.readAs(this.destValuetype.valueClass,this.sourceValuetype.writeValue(t.value));return new Qp.EventImpl(t.metadata,t.originalEvent,r)},t}(eC);XR.ValueStreamTimeseriesAdapter=rC;var nC=function(e){function t(t,r,n){var o=e.call(this,t,r,n)||this;return o.sourceValuetype=al.DataTypes.getByName(o.sourceDatatype.valueTypeName),o}return ZR(t,e),t.prototype.getSourceDataType=function(e){return al.DataTypes.timeseries(al.DataTypes.getByName(e.properties.TIME_SERIES_EVENT_VALUE_TYPE))},t.prototype.readAsDataType=function(e,t){return this.sourceValuetype.readAs(this.datatype.valueClass,this.sourceValuetype.writeValue(t.value))},t}(eC);XR.ValueStreamTimeseriesToPrimitiveAdapter=nC;var oC={};Object.defineProperty(oC,"__esModule",{value:!0});var iC=function(){function e(e,t,r,n,o,i){var s=this;this.pending=!0;var a=Xl.Emitter.create();this.subscription=o(a,t),this.emitter=a.emitter(this.subscription),this.subscription.on("close",(function(){e.remove(s)})),this.adapterFactory=i,this.datatype=r,this.registry=e;var u=this.subscription.on.bind(this.subscription);this.subscription.on=function(o,i){var a=u(o,i);return s.pending&&(n?e.addFallback(s,r):e.add(t,s,r),s.pending=!1),a}}return e.prototype.selects=function(e){if(e){if(e.type===lu.TopicTypeEnum.TIME_SERIES){var t=al.DataTypes.get(e.properties.TIME_SERIES_EVENT_VALUE_TYPE),r=this.datatype instanceof rl.TimeSeriesEventDataType?al.DataTypes.get(this.datatype.valueTypeName):this.datatype;return!!t&&t.canReadAs(r.valueClass)}return al.DataTypes.getByValue(e.type).canReadAs(this.datatype.valueClass)}return!1},e.prototype.adapter=function(e){return e.type===lu.TopicTypeEnum.TIME_SERIES&&this.datatype.valueTypeName===e.properties.TIME_SERIES_EVENT_VALUE_TYPE||e.type===lu.TopicTypeEnum[this.datatype.name().toUpperCase()]||"any"===this.datatype.name()?this:this.adapterFactory(this,this.datatype,e)},e.prototype.onOpen=function(){this.emitter.emit("open",this.subscription)},e.prototype.onDelta=function(e,t,r,n,o,i,s){this.emitter.emit("value",e,t,s,i)},e.prototype.onValue=function(e,t,r,n,o,i){this.emitter.emit("value",e,t,i,o)},e.prototype.onSubscription=function(e,t){this.emitter.emit("subscribe",e,t)},e.prototype.onUnsubscription=function(e,t,r){this.emitter.emit("unsubscribe",e,t,r)},e.prototype.onSubscriptionError=function(e){this.emitter.error(e),this.registry.remove(this)},e}(),sC=new Il.SelectorSet([]);oC.create=function(e,t,r,n){return void 0===n&&(n=sC),new iC(e,n,t,r,(function(e,t){return new $R.ValueStreamImpl(e,t)}),(function(e,r,n){return t instanceof rl.TimeSeriesEventDataType?new XR.ValueStreamTimeseriesAdapter(e,r,n):n.type===lu.TopicTypeEnum.TIME_SERIES?new XR.ValueStreamTimeseriesToPrimitiveAdapter(e,r,n):new XR.ValueStreamAdapter(e,r,n)})).subscription};var aC={},uC=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(aC,"__esModule",{value:!0});var cC=qa.create("Session"),pC=function(e){function t(t,r,n){var o=e.call(this,r,n)||this;return o.internal=t,o.UNSUBSCRIBE=t.getServiceLocator().obtain(qR.UNSUBSCRIBE),o.SUBSCRIBE=t.getServiceLocator().obtain(qR.SUBSCRIBE),o.streamRegistry=t.getStreamRegistry(),o}return uC(t,e),t.prototype.unsubscribe=function(e){for(var t=this,r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];var o=arguments,i=this.internal.getContext().parseSelector;return new Promise((function(r,n){try{var s=o.length>1?i(Array.prototype.slice.call(o)):i(e);if(t.internal.checkConnected(n)){cC.debug("Unsubscribing",e),t.UNSUBSCRIBE.send(s,(function(t){t?(cC.debug("Unsubscribe failed",e),n(t)):(cC.debug("Unsubscribe complete",e),r())}))}}catch(e){n(e)}}))},t.prototype.fetchRequest=function(){return new VR.FetchRequestImpl(this.internal)},t.prototype.select=function(e){for(var t=this,r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];var o=arguments,i=this.internal.getContext().parseSelector;return new Promise((function(r,n){cC.debug("Subscribing",e);try{var s=o.length>1?i(Array.prototype.slice.call(o)):i(e);t.internal.checkConnected(n)&&t.SUBSCRIBE.send(s,(function(e){e?n(e):r()}))}catch(e){n(e)}}))},t.prototype.addStream=function(e,t){if(2!==arguments.length)throw new Error("Both topic selector and value type are needed");if(!t||al.DataTypes.get(t))throw new Error("Data type required");var r=this.internal.getContext().parseSelector(e);return oC.create(this.streamRegistry,t,!1,r)},t.prototype.addFallbackStream=function(e){if(!e||al.DataTypes.get(e))throw new Error("Data type required");return oC.create(this.streamRegistry,e,!0)},t}($l.StreamImpl);aC.TopicsImpl=pC;var lC={},fC=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(lC,"__esModule",{value:!0});var hC=r({}),dC=function(e){function t(t,r,n){var o=this,i=Xl.Emitter.create();o=e.call(this,n,i)||this;var s=i.emitter(o);return n.on({reconnect:function(){s.emit("reconnect")},disconnect:function(e){s.emit("disconnect",e)},error:function(e){s.emit("error",e)},close:function(e){s.emit("close",e)}}),o.sessionId=t,o.sessionID=t.toString(),void 0!==OO.TopicControlImpl&&(o.topicsFeature=new OO.TopicControlImpl(n)),void 0!==Y_.ClientControlImpl&&(o.clientsFeature=new Y_.ClientControlImpl(n)),void 0!==hC.GatewayControlImpl&&(o.gatewaysFeature=new hC.GatewayControlImpl(n)),void 0!==SE.MessagesImpl&&(o.messagesFeature=new SE.MessagesImpl(n)),void 0!==QO.TopicNotificationsImpl&&(o.notificationsFeature=new QO.TopicNotificationsImpl(n)),void 0!==Zm.RemoteServersImpl&&(o.remoteServersFeature=new Zm.RemoteServersImpl(n)),void 0!==Vg.SecurityImpl&&(o.securityFeature=new Vg.SecurityImpl(n)),void 0!==HT.TimeSeriesImpl&&(o.timeseriesFeature=new HT.TimeSeriesImpl(n)),void 0!==Kb.TopicUpdateImpl&&(o.topicUpdateFeature=new Kb.TopicUpdateImpl(n)),void 0!==_R.TopicViewsImpl&&(o.topicViewsFeature=new _R.TopicViewsImpl(n)),void 0!==DS.LogRetrieval&&(o.logRetrievalFeature=new DS.LogRetrieval(n)),void 0!==Tm.Metrics&&(o.metricsFeature=new Tm.Metrics(n)),void 0!==pw.LicenceUpdater&&(o.licenceUpdaterFeature=new pw.LicenceUpdater(n)),void 0!==bm.PingImpl&&(o.pingFeature=new bm.PingImpl(n)),o.options=void 0!==r?r.with({credentials:void 0}):{},o}return fC(t,e),Object.defineProperty(t.prototype,"topics",{get:function(){if(void 0===this.topicsFeature){if(void 0===OO.TopicControlImpl)throw new Error("Topic Control feature has not been loaded");this.topicsFeature=new OO.TopicControlImpl(this.internal)}return this.topicsFeature},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"clients",{get:function(){if(void 0===this.clientsFeature){if(void 0===Y_.ClientControlImpl)throw new Error("Client Control feature has not been loaded");this.clientsFeature=new Y_.ClientControlImpl(this.internal)}return this.clientsFeature},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"messages",{get:function(){if(void 0===this.messagesFeature){if(void 0===SE.MessagesImpl)throw new Error("Messages feature has not been loaded");this.messagesFeature=new SE.MessagesImpl(this.internal)}return this.messagesFeature},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"notifications",{get:function(){if(void 0===this.notificationsFeature){if(void 0===QO.TopicNotificationsImpl)throw new Error("Topic Notifications feature has not been loaded");this.notificationsFeature=new QO.TopicNotificationsImpl(this.internal)}return this.notificationsFeature},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"security",{get:function(){if(void 0===this.securityFeature){if(void 0===Vg.SecurityImpl)throw new Error("Security feature has not been loaded");this.securityFeature=new Vg.SecurityImpl(this.internal)}return this.securityFeature},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"timeseries",{get:function(){if(void 0===this.timeseriesFeature){if(void 0===HT.TimeSeriesImpl)throw new Error("Timeseries feature has not been loaded");this.timeseriesFeature=new HT.TimeSeriesImpl(this.internal)}return this.timeseriesFeature},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"topicUpdate",{get:function(){if(void 0===this.topicUpdateFeature){if(void 0===Kb.TopicUpdateImpl)throw new Error("Topic Update feature has not been loaded");this.topicUpdateFeature=new Kb.TopicUpdateImpl(this.internal)}return this.topicUpdateFeature},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"topicViews",{get:function(){if(void 0===this.topicViewsFeature){if(void 0===_R.TopicViewsImpl)throw new Error("Topic Views feature has not been loaded");this.topicViewsFeature=new _R.TopicViewsImpl(this.internal)}return this.topicViewsFeature},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"remoteServers",{get:function(){if(void 0===this.remoteServersFeature){if(void 0===Zm.RemoteServersImpl)throw new Error("Remote Servers feature has not been loaded");this.remoteServersFeature=new Zm.RemoteServersImpl(this.internal)}return this.remoteServersFeature},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"logRetrieval",{get:function(){if(void 0===this.logRetrievalFeature){if(void 0===DS.LogRetrieval)throw new Error("Log Retrieval feature has not been loaded");this.logRetrievalFeature=new DS.LogRetrieval(this.internal)}return this.logRetrievalFeature},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"metrics",{get:function(){if(void 0===this.metricsFeature){if(void 0===Tm.Metrics)throw new Error("Metrics feature has not been loaded");this.metricsFeature=new Tm.Metrics(this.internal)}return this.metricsFeature},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"licenceUpdater",{get:function(){if(void 0===this.licenceUpdaterFeature){if(void 0===pw.LicenceUpdater)throw new Error("Licence Updater feature has not been loaded");this.licenceUpdaterFeature=new pw.LicenceUpdater(this.internal)}return this.licenceUpdaterFeature},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"gateways",{get:function(){if(void 0===this.gatewaysFeature){if(void 0===hC.GatewayControlImpl)throw new Error("Gateway Control feature has not been loaded");this.gatewaysFeature=new hC.GatewayControlImpl(this.internal)}return this.gatewaysFeature},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ping",{get:function(){if(void 0===this.pingFeature){if(void 0===bm.PingImpl)throw new Error("Ping feature has not been loaded");this.pingFeature=new bm.PingImpl(this.internal)}return this.pingFeature},enumerable:!0,configurable:!0}),t.prototype.updateFeatures=function(){this.internal.updateFeatures()},t.prototype.close=function(){return this.internal.close(),this},t.prototype.closeSession=function(){var e=this;return new Promise((function(t,r){e.on("close",t),e.close()}))},t.prototype.isClosed=function(){var e=this.internal.getState();return"closing"===e||"closed"===e},t.prototype.isConnected=function(){return this.internal.isConnected()},t.prototype.toString=function(){return"Session<"+this.sessionId+" "+this.internal.getState()+">"},t.prototype.getPrincipal=function(){return this.options.principal||""},t.prototype.lock=function(e,t){return void 0===t&&(t=nf.SessionLockScope.UNLOCK_ON_SESSION_LOSS),this.internal.lock(e,t)},t.prototype.pingServer=function(){return this.ping.pingServer()},t.prototype.getServerMaximumMessageSize=function(){return this.internal.getServerMaximumMessageSize()},t.create=function(e,r){var n;return void 0!==r&&(n="string"==typeof r?new Hd.OptionsImpl({host:r}):new Hd.OptionsImpl(r)),new Promise((function(r,o){var i=e(n);function s(e,o){i.off("connect",s),i.off("close",a),i.off("error",a),r(new t(e,o||n,i))}function a(e){i.off("connect",s),i.off("close",a),i.off("error",a),o(e)}i.on("connect",s),i.on("close",a),i.on("error",a),i.connect()}))},t}(aC.TopicsImpl);lC.SessionImpl=dC;var yC={};Object.defineProperty(yC,"__esModule",{value:!0});var vC=function(){function e(){}return e.prototype.locked=function(e){return new ZO.Locked(e)},e.prototype.value=function(e,t){gc.requireNonNull(e,"value");var r=void 0!==t?t:al.DataTypes.getByValue(e);if(void 0===r)throw new Error("Datatype invalid or could not be inferred");return new ZO.BinaryValue(r.toBytes(e))},e.prototype.noValue=function(){return new ZO.NoValue},e.prototype.noTopic=function(){return new ZO.NoTopic},e.prototype.jsonValue=function(){return new ZO.PartialJSONImpl},e}(),_C=Object.freeze(new vC);yC.updateConstraintFactory=_C;var SC={},EC=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)s.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return s},mC=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(EC(arguments[t]));return e};Object.defineProperty(SC,"__esModule",{value:!0});var wC=function(){function e(){this.Prefix=hl.Prefix,this.Type=hl.Type}return e.prototype.parse=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return zl.parseSelector.apply(void 0,mC([e],t))},e}();SC.TopicSelectors=wC;var gC={};Object.defineProperty(gC,"__esModule",{value:!0}),function(e){e.trace="trace",e.debug="debug",e.info="info",e.warn="warn",e.error="error",e.silent="silent"}(gC.LogLevel||(gC.LogLevel={}));var TC={};return function(e){"use strict";Object.defineProperty(TC,"__esModule",{value:!0}),qa.setLevel("warn"),TC.version="6.6.1",TC.build="c2715060",TC.log=function(e){qa.setLevel(e)},TC.connect=function(e,t,r){return lC.SessionImpl.create(hy.create(t,r),e)},TC.connectShared=function(e,t){return lC.SessionImpl.create(hy.createShared(e,t),void 0)},TC.escape=function(e){return vy.escape(e)},TC.stringToRoles=function(e){return vy.stringToRoles(e)},TC.rolesToString=function(e){return vy.rolesToString(e)},TC.updateConstraints=function(){return yC.updateConstraintFactory},TC.datatypes=al.DataTypes,TC.selectors=new SC.TopicSelectors,TC.topics=yu.topicsNamespace,TC.topicUpdate=TI.TopicUpdateNamespace,TC.errors=Xa.ErrorReason,TC.clients=C_.ClientControlOptions,TC.locks=nf.SessionLockOptions,TC.CloseReasonEnum=Ch.CloseReasonEnum,TC.SessionEventType=W_.SessionEventType,TC.ConnectionOption=Nm.ConnectionOption,TC.ConnectionState=Nm.ConnectionState,TC.GlobalPermission=Rw.GlobalPermission,TC.PathPermission=Rw.PathPermission,TC.ValidationType=Rw.ValidationType,TC.SessionLockScope=nf.SessionLockScope,TC.TopicNotificationType=NO.TopicNotificationType,TC.Prefix=hl.Prefix,TC.Type=hl.Type,TC.TopicCreationResult=TI.TopicCreationResult,TC.LogLevel=gC.LogLevel;var t=r({});TC.SchemaType=t.SchemaType,TC.StatusLevel=t.StatusLevel,TC.TopicPermission=Rw.PathPermission,TC.buffer=e}.call(this,a({}).Buffer),TC}));